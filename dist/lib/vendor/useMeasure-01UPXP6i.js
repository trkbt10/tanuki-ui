"use strict";const c=require("react");function p(i){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const n in i)if(n!=="default"){const t=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(e,n,t.get?t:{enumerable:!0,get:()=>i[n]})}}return e.default=i,Object.freeze(e)}const o=p(c);class u{rafId=0;pointerIds=[];handlers={};targetPointers={};pointers={};constructor(){window.addEventListener("pointermove",e=>{this.pointers[e.pointerId]?(this.pointers[e.pointerId].pageX=e.pageX,this.pointers[e.pointerId].pageY=e.pageY):this.pointers[e.pointerId]={pageX:e.pageX,pageY:e.pageY}}),window.addEventListener("pointercancel",e=>this.removeTrackTarget(e)),window.addEventListener("pointerup",e=>this.removeTrackTarget(e)),document.addEventListener("pointerleave",e=>this.removeTrackTarget(e)),this.start()}start(){this.tick()}end(){cancelAnimationFrame(this.rafId)}removeTrackTarget(e){this.emitChange(e.pointerId.toString(),"pointerend"),delete this.pointers[e.pointerId],delete this.targetPointers[e.pointerId],delete this.handlers[e.pointerId];const n=this.pointerIds.indexOf(e.pointerId.toString());this.pointerIds.splice(n,1)}tick(){this.rafId=requestAnimationFrame(()=>this.tick());for(const e of this.pointerIds){const n=this.targetPointers[e],t=this.pointers[e];if(!n||!t)continue;const[r,s]=[n.deltaX,n.deltaY];n.deltaX=t.pageX-n.startX,n.deltaY=t.pageY-n.startY,n.elapsedtime=performance.now()-n.timestamp,!(r===n.deltaX&&s===n.deltaY)&&this.emitChange(e,"pointermove")}}emitChange(e,n){if(!this.handlers[e])return;const t=this.targetPointers[e],r=this.pointers[e];this.handlers[e]({pointerId:e.toString(),timestamp:t.timestamp,elapsedtime:t.elapsedtime,type:n,pageX:r.pageX,pageY:r.pageY,deltaX:t.deltaX,deltaY:t.deltaY,startX:t.startX,startY:t.startY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,button:t.button,isFinal:n==="pointerend",target:t.target,ZIndexList:t.ZIndexList,defaultPrevented:t.defaultPrevented})}addTrackTarget(e,n){e.target instanceof HTMLElement&&(this.pointerIds.push(e.pointerId.toString()),this.targetPointers[e.pointerId]={timestamp:performance.now(),elapsedtime:0,deltaX:0,deltaY:0,startX:e.pageX,startY:e.pageY,button:e.button,target:e.target,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,ZIndexList:f(e.target),defaultPrevented:e.defaultPrevented},this.pointerIds=this.pointerIds.sort((t,r)=>l(this.targetPointers[t]?.ZIndexList??[],this.targetPointers[r]?.ZIndexList??[])),this.pointers[e.pointerId]={pageX:e.pageX,pageY:e.pageY},this.handlers[e.pointerId]=n,this.emitChange(e.pointerId,"pointerdown"))}}const l=(i,e)=>{const n=Math.max(i.length,e.length);if(n<=0)return 0;for(let t=0;t<n;t++){const r=i[t],s=e[t];if(typeof r>"u")return-1;if(typeof s>"u")return 1;if(r!==s)return r>s?-1:1}return 0},f=i=>{const e=[],n=t=>{const s=+window.getComputedStyle(t).getPropertyValue("z-index");Number.isNaN(s)||e.push(s),t.parentElement&&n(t.parentElement)};return n(i),e.reverse()};let a;const g=(i,e)=>{a||(a=new u);const n=o.useRef(e);n.current=e,o.useEffect(()=>{if(!i.current)return;const t=i.current,r=s=>{s.defaultPrevented||(s.preventDefault(),a.addTrackTarget(s,d=>{n.current&&n.current(d)}))};return t.addEventListener("pointerdown",r),()=>{t.removeEventListener("pointerdown",r)}},[])},h=i=>{const[e,n]=o.useState(),t=o.useDeferredValue(e),r=o.useCallback(()=>{if(!i.current)return;const s=i.current.getBoundingClientRect();n({x:s.x,y:s.y,width:s.width,height:s.height})},[n]);return o.useEffect(()=>(window.addEventListener("scroll",r),()=>{window.removeEventListener("scroll",r)}),[]),o.useEffect(()=>(window.addEventListener("resize",r,!1),r(),()=>{window.removeEventListener("resize",r,!1)}),[r]),o.useEffect(()=>{const s=new ResizeObserver(d=>{r()});return i.current&&s.observe(i.current),()=>{i.current&&s.unobserve(i.current),s.disconnect()}},[r]),[t,r]};exports.useMeasure=h;exports.useObservePointer=g;
