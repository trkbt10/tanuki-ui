"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const D=require("react/jsx-runtime"),p=require("react");var y=(e=>(e.ACTIVATE_TAB="ACTIVATE_TAB",e.CLOSE_TAB="CLOSE_TAB",e.CREATE_TAB="CREATE_TAB",e.MOVE_TAB="MOVE_TAB",e.REORDER_TAB="REORDER_TAB",e.SPLIT_PANEL="SPLIT_PANEL",e.CLOSE_PANEL="CLOSE_PANEL",e.RESIZE_PANEL="RESIZE_PANEL",e.FOCUS_PANEL="FOCUS_PANEL",e.START_DRAG="START_DRAG",e.SET_DROP_TARGET="SET_DROP_TARGET",e.END_DRAG="END_DRAG",e.EXECUTE_DROP="EXECUTE_DROP",e.PRUNE_EMPTY_NODES="PRUNE_EMPTY_NODES",e.RESTORE_TAB="RESTORE_TAB",e.SET_STATE="SET_STATE",e))(y||{});const F=e=>({activateTab:(t,r)=>{e({type:"ACTIVATE_TAB",payload:{leafId:t,tabId:r}})},closeTab:(t,r)=>{e({type:"CLOSE_TAB",payload:{leafId:t,tabId:r}})},createTab:(t,r)=>{r&&e({type:"CREATE_TAB",payload:{leafId:t,tab:r}})},moveTab:(t,r,o,a)=>{console.log("🎭 ACTION moveTab dispatching:",{sourceLeafId:t,targetLeafId:r,tabId:o,targetIndex:a}),e({type:"MOVE_TAB",payload:{sourceLeafId:t,targetLeafId:r,tabId:o,targetIndex:a}})},reorderTab:(t,r,o)=>{console.log("🎭 ACTION reorderTab dispatching:",{leafId:t,tabId:r,newIndex:o}),e({type:"REORDER_TAB",payload:{leafId:t,tabId:r,newIndex:o}})},splitPanel:(t,r,o)=>{e({type:"SPLIT_PANEL",payload:{leafId:t,orientation:r,ratio:o}})},closePanel:t=>{e({type:"CLOSE_PANEL",payload:{panelId:t}})},resizePanel:(t,r)=>{e({type:"RESIZE_PANEL",payload:{panelId:t,sizes:r}})},focusPanel:t=>{e({type:"FOCUS_PANEL",payload:{leafId:t}})},startDrag:(t,r)=>{e({type:"START_DRAG",payload:{tabId:t,sourceLeafId:r}})},setDropTarget:(t,r,o)=>{e({type:"SET_DROP_TARGET",payload:{leafId:t,direction:r,insertIndex:o}})},endDrag:()=>{e({type:"END_DRAG"})},executeDrop:()=>{e({type:"EXECUTE_DROP"})},pruneEmptyNodes:()=>{e({type:"PRUNE_EMPTY_NODES"})},restoreTab:()=>{e({type:"RESTORE_TAB"})}}),k=()=>Math.random().toString(36).substr(2,9),P=(e,t)=>{if(e.id===t)return e;if(e.type==="split")for(const r of e.children){const o=P(r,t);if(o)return o}return null},X=(e,t)=>{if(e.type==="split"){const r=e.children.findIndex(o=>o.id===t);if(r!==-1)return{parent:e,index:r};for(const o of e.children){const a=X(o,t);if(a)return a}}return null},Y=(e,t)=>{if(e.id===t)return null;if(e.type==="split"){const r=e.children.map(o=>Y(o,t)).filter(o=>o!==null);return{...e,children:r}}return e},A=e=>{if(e.type==="leaf")return e.tabs.length>0?e:null;const t=e.children.map(o=>A(o)).filter(o=>o!==null);if(t.length===0)return null;if(t.length===1)return t[0];const r=t.map(()=>1/t.length);return{...e,children:t,sizes:r}},oe=(e,t,r)=>{const o=a=>a.id===t&&a.type==="leaf"?{...a,activeTabId:r}:a.type==="split"?{...a,children:a.children.map(o)}:a;return{...e,root:o(e.root),focusedLeafId:t}},le=(e,t,r)=>{const o=P(e.root,t);if(!o||o.type!=="leaf")return e;const a=o.tabs.findIndex(b=>b.id===r);if(a===-1)return e;const l=o.tabs[a],u=o.tabs.filter(b=>b.id!==r),i=[...e.recentlyClosedTabs||[],l];let c=o.activeTabId;o.activeTabId===r&&(a<u.length?c=u[a].id:u.length>0?c=u[u.length-1].id:c="");const n=b=>b.id===t&&b.type==="leaf"?{...b,tabs:u,activeTabId:c}:b.type==="split"?{...b,children:b.children.map(n)}:b,d=n(e.root),s=A(d);return{...e,root:s||O(),recentlyClosedTabs:i.slice(-10)}},J=(e,t,r)=>{const o=a=>a.id===t&&a.type==="leaf"?{...a,tabs:[...a.tabs,r],activeTabId:r.id}:a.type==="split"?{...a,children:a.children.map(o)}:a;return{...e,root:o(e.root),focusedLeafId:t}},B=(e,t,r,o,a)=>{const l=P(e.root,t),u=P(e.root,r);if(!l||!u||l.type!=="leaf"||u.type!=="leaf")return e;const i=l.tabs.find(E=>E.id===o);if(!i)return e;const c=l.tabs.filter(E=>E.id!==o);let n=l.activeTabId;if(l.activeTabId===o&&c.length>0){const E=l.tabs.findIndex(f=>f.id===o);E<c.length?n=c[E].id:n=c[c.length-1].id}const d=a??u.tabs.length,s=Math.max(0,Math.min(d,u.tabs.length)),b=[...u.tabs];b.splice(s,0,i),console.log("🚚 Move Tab:",{tabId:o,sourceLeafId:t,targetLeafId:r,requestedIndex:a,insertIndex:d,clampedInsertIndex:s,targetTabsLength:u.tabs.length,newTargetTabsLength:b.length});const m=E=>E.id===t&&E.type==="leaf"?{...E,tabs:c,activeTabId:n}:E.id===r&&E.type==="leaf"?{...E,tabs:b,activeTabId:i.id}:E.type==="split"?{...E,children:E.children.map(m)}:E,S=m(e.root),C=A(S);return{...e,root:C||O(),focusedLeafId:r}},V=(e,t,r,o=.5)=>{const a=P(e.root,t);if(!a||a.type!=="leaf")return e;const u={id:k(),type:"leaf",tabs:[],activeTabId:""},i={id:k(),type:"split",orientation:r,children:[a,u],sizes:[o,1-o]},c=n=>n.id===t?i:n.type==="split"?{...n,children:n.children.map(c)}:n;return e.root.id===t?{...e,root:i}:{...e,root:c(e.root)}},se=(e,t,r)=>{const o=a=>a.id===t&&a.type==="split"?{...a,sizes:r}:a.type==="split"?{...a,children:a.children.map(o)}:a;return{...e,root:o(e.root)}},ie=(e,t,r,o)=>{const a=l=>{if(l.id===t&&l.type==="leaf"){const u=l.tabs.findIndex(d=>d.id===r);if(u===-1)return l;const i=[...l.tabs],[c]=i.splice(u,1),n=Math.max(0,Math.min(o,i.length));return i.splice(n,0,c),console.log("🔄 REORDER:",{tabId:r,from:u,to:n,originalTabs:l.tabs.map(d=>d.id),newTabs:i.map(d=>d.id)}),{...l,tabs:i}}return l.type==="split"?{...l,children:l.children.map(a)}:l};return{...e,root:a(e.root)}},ce=e=>{if(!e.recentlyClosedTabs||e.recentlyClosedTabs.length===0)return e;const t=e.recentlyClosedTabs[e.recentlyClosedTabs.length-1],r=e.recentlyClosedTabs.slice(0,-1),o=e.focusedLeafId||W(e.root);return o?J({...e,recentlyClosedTabs:r},o,t):e},W=e=>{if(e.type==="leaf")return e.id;if(e.type==="split")for(const t of e.children){const r=W(t);if(r)return r}return null},O=()=>({id:k(),type:"leaf",tabs:[],activeTabId:""}),H=(e,t)=>{switch(t.type){case y.ACTIVATE_TAB:return{...e,panelState:oe(e.panelState,t.payload.leafId,t.payload.tabId)};case y.CLOSE_TAB:return{...e,panelState:le(e.panelState,t.payload.leafId,t.payload.tabId)};case y.CREATE_TAB:return{...e,panelState:J(e.panelState,t.payload.leafId,t.payload.tab)};case y.MOVE_TAB:console.log("📢 REDUCER MOVE_TAB:",t.payload);const r=B(e.panelState,t.payload.sourceLeafId,t.payload.targetLeafId,t.payload.tabId,t.payload.targetIndex);return console.log("📢 REDUCER MOVE_TAB result:",{oldState:e.panelState,newState:r,changed:JSON.stringify(e.panelState)!==JSON.stringify(r)}),{...e,panelState:r};case y.REORDER_TAB:console.log("📢 REDUCER REORDER_TAB:",t.payload);const o=ie(e.panelState,t.payload.leafId,t.payload.tabId,t.payload.newIndex);return console.log("📢 REDUCER REORDER_TAB result:",{oldState:e.panelState,newState:o,changed:JSON.stringify(e.panelState)!==JSON.stringify(o)}),{...e,panelState:o};case y.SPLIT_PANEL:return{...e,panelState:V(e.panelState,t.payload.leafId,t.payload.orientation,t.payload.ratio)};case y.CLOSE_PANEL:{const a=Y(e.panelState.root,t.payload.panelId),l=a?A(a):null;return{...e,panelState:{...e.panelState,root:l||O()}}}case y.RESIZE_PANEL:return{...e,panelState:se(e.panelState,t.payload.panelId,t.payload.sizes)};case y.FOCUS_PANEL:return{...e,panelState:{...e.panelState,focusedLeafId:t.payload.leafId}};case y.START_DRAG:return{...e,dragState:{isDragging:!0,draggedTabId:t.payload.tabId,sourceLeafId:t.payload.sourceLeafId}};case y.SET_DROP_TARGET:return{...e,dragState:{...e.dragState,dropTargetLeafId:t.payload.leafId,dropDirection:t.payload.direction,insertIndex:t.payload.insertIndex}};case y.END_DRAG:return{...e,dragState:{isDragging:!1}};case y.EXECUTE_DROP:{const{dragState:a}=e;if(!a.isDragging||!a.draggedTabId||!a.sourceLeafId)return{...e,dragState:{isDragging:!1}};let l=e.panelState;if(a.dropTargetLeafId&&a.dropDirection){const u=a.dropDirection==="left"||a.dropDirection==="right"?"horizontal":"vertical",i=V(l,a.dropTargetLeafId,u,.5);if(P(i.root,a.dropTargetLeafId)){const n=X(i.root,a.dropTargetLeafId);if(n&&n.parent.type==="split"){const d=n.parent.children.findIndex(m=>m.id===a.dropTargetLeafId);let s;a.dropDirection==="right"||a.dropDirection==="bottom"?s=d+1:s=d;const b=n.parent.children[s];b&&b.type==="leaf"&&(l=B(i,a.sourceLeafId,b.id,a.draggedTabId))}}}else a.dropTargetLeafId&&(l=B(l,a.sourceLeafId,a.dropTargetLeafId,a.draggedTabId,a.insertIndex));return{...e,panelState:l,dragState:{isDragging:!1}}}case y.PRUNE_EMPTY_NODES:{const a=A(e.panelState.root);return{...e,panelState:{...e.panelState,root:a||O()}}}case y.RESTORE_TAB:return{...e,panelState:ce(e.panelState)};case y.SET_STATE:return{...e,panelState:t.payload.state};default:return e}},q=e=>{const t={root:O(),pruneEmptyPanel:!0,recentlyClosedTabs:[]};return{panelState:e||t,dragState:{isDragging:!1}}},Q=p.createContext(null),I=()=>{const e=p.useContext(Q);if(!e)throw new Error("usePanelContext must be used within a PanelProvider");return e},de={pruneEmptyGroups:!0,enableTabDrag:!0,enablePanelSplit:!0,enableTabReorder:!0,minPanelSize:100,splitterSize:4,showCloseButton:!0,maxTabWidth:200,minTabWidth:80,enableKeyboardShortcuts:!0,keyBindings:{closeTab:["Ctrl+W","Cmd+W"],newTab:["Ctrl+T","Cmd+T"],nextTab:["Ctrl+Tab","Cmd+Option+ArrowRight"],prevTab:["Ctrl+Shift+Tab","Cmd+Option+ArrowLeft"],splitRight:["Ctrl+\\","Cmd+\\"],splitDown:["Ctrl+K Ctrl+\\","Cmd+K Cmd+\\"],focusGroup:["Ctrl+1","Cmd+1"],moveTabRight:["Ctrl+Alt+ArrowRight","Cmd+Ctrl+ArrowRight"],moveTabLeft:["Ctrl+Alt+ArrowLeft","Cmd+Ctrl+ArrowLeft"]}},ee=({children:e,value:t,defaultValue:r,onChange:o,options:a={}})=>{const l=p.useMemo(()=>({...de,...a}),[a]),[u,i]=p.useReducer(H,q(t||r)),c=t||u.panelState,n=u.dragState,d=p.useRef(u.panelState);p.useEffect(()=>{o&&JSON.stringify(d.current)!==JSON.stringify(u.panelState)&&(d.current=u.panelState,o(u.panelState))},[u.panelState,o]);const s=p.useMemo(()=>F(i),[i]),b=p.useCallback((h,v)=>{s.activateTab(h,v)},[s]),m=p.useCallback((h,v)=>{s.closeTab(h,v)},[s]),S=p.useCallback((h,v)=>{v&&s.createTab(h,v)},[s]),C=p.useCallback((h,v,L,K)=>{console.log("🚚 CONTEXT moveTab called:",{sourceLeafId:h,targetLeafId:v,tabId:L,targetIndex:K}),s.moveTab(h,v,L,K)},[s]),E=p.useCallback((h,v,L)=>{console.log("🔄 CONTEXT reorderTab called:",{leafId:h,tabId:v,newIndex:L}),s.reorderTab(h,v,L)},[s]),f=p.useCallback((h,v,L)=>{s.splitPanel(h,v,L)},[s]),T=p.useCallback(h=>{s.closePanel(h)},[s]),x=p.useCallback((h,v)=>{s.resizePanel(h,v)},[s]),w=p.useCallback(h=>{s.focusPanel(h)},[s]),R=p.useCallback((h,v)=>{console.log("🚀 CONTEXT startDrag called:",{tabId:h,sourceLeafId:v,enableTabDrag:l.enableTabDrag}),l.enableTabDrag?s.startDrag(h,v):console.log("❌ Tab drag disabled in options")},[s,l.enableTabDrag]),z=p.useCallback((h,v,L)=>{s.setDropTarget(h,v,L)},[s]),j=p.useCallback(()=>{s.endDrag()},[s]),M=p.useCallback(()=>{s.executeDrop()},[s]),$=p.useCallback(()=>{l.pruneEmptyGroups&&s.pruneEmptyNodes()},[s,l.pruneEmptyGroups]),U=p.useCallback(()=>{s.restoreTab()},[s]),G=p.useMemo(()=>({activateTab:b,closeTab:m,createTab:S,moveTab:C,reorderTab:E,splitPanel:f,closePanel:T,resizePanel:x,focusPanel:w,startDrag:R,setDropTarget:z,endDrag:j,executeDrop:M,pruneEmptyNodes:$,restoreTab:U}),[b,m,S,C,E,f,T,x,w,R,z,j,M,$,U]),re=p.useMemo(()=>({state:c,dragState:n,actions:G,options:l}),[c,n,G,l]);return D.jsx(Q.Provider,{value:re,children:e})},te=()=>{const{state:e}=I();return e},N=()=>{const{dragState:e}=I();return e},_=()=>{const{actions:e}=I();return e},ae=()=>{const{options:e}=I();return e},pe=e=>{const{actions:t}=I();return p.useMemo(()=>({activateTab:r=>t.activateTab(e,r),closeTab:r=>t.closeTab(e,r),createTab:r=>t.createTab(e,r),reorderTab:(r,o)=>t.reorderTab(e,r,o)}),[t,e])},ue=e=>{const{actions:t}=I();return p.useMemo(()=>({splitPanel:(r,o)=>t.splitPanel(e,r,o),closePanel:()=>t.closePanel(e),focusPanel:()=>t.focusPanel(e)}),[t,e])},fe=()=>{const{actions:e}=I();return p.useMemo(()=>({startDrag:e.startDrag,setDropTarget:e.setDropTarget,endDrag:e.endDrag,executeDrop:e.executeDrop}),[e])},ge="xtnpnlpnl",be="xtnpnlpnlcnt",Te="xtnpnlsplitcnt",De="xtnpnlpnlChild",Se="xtnpnlsplitter",Ee="xtnpnlvtspl",he="xtnpnlhzspl",ve="xtnpnlspl",me="xtnpnlleafcnt",Ce="xtnpnldrotar",ye="xtnpnltabBar",xe="xtnpnltabs",Re="xtnpnltab",Le="xtnpnlactTab",Ie="xtnpnltabdrg",Pe="xtnpnltabdraove",Ae="xtnpnltabdrozon",Oe="xtnpnltabTitle",Ne="xtnpnltab4wP",_e="xtnpnlnewtab",we="xtnpnltabctn",Be="xtnpnldrozonlay",ke="xtnpnldragact",Ze="xtnpnldropZone",ze="xtnpnlact",je="xtnpnldrozonlef",Me="xtnpnldrozonrig",$e="xtnpnldrozontop",Ue="xtnpnldrozonbot",Ge="xtnpnldrozoncen",Ke="xtnpnldrg",Ve="xtnpnlresizing",g={panel:ge,panelContainer:be,splitContainer:Te,panelChild:De,splitter:Se,verticalSplitter:Ee,horizontalSplitter:he,splitterDragging:ve,leafContainer:me,dropTarget:Ce,tabBar:ye,tabs:xe,tab:Re,activeTab:Le,tabDragging:Ie,tabDragOver:Pe,tabDropZone:Ae,tabTitle:Oe,tabCloseButton:Ne,newTabButton:_e,tabContent:we,dropZoneLayer:Be,dragActive:ke,dropZone:Ze,active:ze,dropZoneLeft:je,dropZoneRight:Me,dropZoneTop:$e,dropZoneBottom:Ue,dropZoneCenter:Ge,dragging:Ke,resizing:Ve},Fe=({value:e,defaultValue:t,onChange:r,style:o,className:a,children:l,onRequestTabCreate:u,onTabClose:i,onTabMove:c,onPanelSplit:n,onPanelClose:d,renderTabBar:s,renderSplitter:b,renderDropZone:m,options:S})=>D.jsx(ee,{value:e,defaultValue:t,onChange:r,options:S,children:D.jsx("div",{className:`${g.panel} ${a||""}`,style:o,children:D.jsx(Xe,{children:l,onRequestTabCreate:u,onTabClose:i,onTabMove:c,onPanelSplit:n,onPanelClose:d,renderTabBar:s,renderSplitter:b,renderDropZone:m})})}),Xe=e=>{const{state:t}=I(),r=N();return D.jsx("div",{className:`${g.panelContainer} ${r.isDragging?g.dragActive:""}`,children:D.jsx(ne,{node:t.root,...e})})},ne=p.memo(({node:e,...t})=>e.type==="split"?D.jsx(Ye,{node:e,...t}):D.jsx(Je,{node:e,...t})),Ye=p.memo(({node:e,renderSplitter:t,...r})=>{const o=_(),[a,l]=p.useState(!1),u=p.useRef(null),i=p.useCallback((n,d)=>{if(!u.current)return;const s=e.orientation==="horizontal"?u.current.offsetWidth:u.current.offsetHeight,b=[...e.sizes],m=b.reduce((T,x)=>T+x,0),S=b.map(T=>T/m*s);S[n]+=d,S[n+1]-=d;const C=50;if(S[n]<C){const T=C-S[n];S[n]=C,S[n+1]-=T}if(S[n+1]<C){const T=C-S[n+1];S[n+1]=C,S[n]-=T}const E=S.reduce((T,x)=>T+x,0),f=S.map(T=>T/E);o.resizePanel(e.id,f)},[e.id,e.orientation,e.sizes,o]),c={display:"flex",flexDirection:e.orientation==="horizontal"?"row":"column",width:"100%",height:"100%"};return D.jsx("div",{ref:u,className:g.splitContainer,style:c,children:e.children.map((n,d)=>D.jsxs(p.Fragment,{children:[D.jsx("div",{className:g.panelChild,style:{flex:e.sizes[d]||1,minWidth:e.orientation==="horizontal"?"50px":void 0,minHeight:e.orientation==="vertical"?"50px":void 0},children:D.jsx(ne,{node:n,...r})}),d<e.children.length-1&&D.jsx(He,{orientation:e.orientation,onResize:s=>i(d,s),onResizeStart:()=>l(!0),onResizeEnd:()=>l(!1),isResizing:a,renderSplitter:t})]},n.id))})}),Je=p.memo(({node:e,children:t,onRequestTabCreate:r,onTabClose:o,onTabMove:a,renderTabBar:l,...u})=>{const i=_(),c=N(),n=e.tabs.find(f=>f.id===e.activeTabId),d=p.useCallback(f=>{i.activateTab(e.id,f)},[i,e.id]),s=p.useCallback(f=>{(o?o(f,e.id):!0)!==!1&&i.closeTab(e.id,f)},[i,e.id,o]),b=p.useCallback(()=>{if(r){const f=r(e.id);f&&i.createTab(e.id,f)}},[i,e.id,r]),m=p.useCallback((f,T)=>{console.log("🚀 Tab Drag Start:",{tabId:f,leafId:e.id}),T.dataTransfer.effectAllowed="move",T.dataTransfer.setData("text/tab-id",f),i.startDrag(f,e.id)},[i,e.id]),S=p.useCallback(()=>{console.log("🏁 Tab Drag End - Scheduling cleanup"),setTimeout(()=>{console.log("🧹 Executing endDrag cleanup"),i.endDrag()},200)},[i]),C=p.useCallback((f,T)=>{if(console.log("📍 LEAF DROP:",{draggedTabId:f,index:T,sourceLeaf:c.sourceLeafId,targetLeaf:e.id,currentDragState:c}),!f||!c.sourceLeafId){console.log("❌ Missing essential data:",{draggedTabId:f,sourceLeafId:c.sourceLeafId});return}console.log("✅ Proceeding with drop execution"),c.sourceLeafId===e.id?(console.log("🔄 REORDER in same panel"),i.reorderTab(e.id,f,T)):(console.log("🚚 MOVE to different panel"),(a?a(f,c.sourceLeafId,e.id,T):!0)!==!1&&i.moveTab(c.sourceLeafId,e.id,f,T))},[i,e.id,c,a]),E=c.dropTargetLeafId===e.id;return D.jsxs("div",{className:`${g.leafContainer} ${E?g.dropTarget:""} ${c.isDragging?g.dragging:""}`,children:[D.jsx(qe,{leafId:e.id}),l?l({leafId:e.id,tabs:e.tabs,activeTabId:e.activeTabId,onTabClick:d,onTabClose:s,onTabDragStart:m,onTabDragEnd:S,onTabDrop:C,onNewTab:b,isDropTarget:E}):D.jsx(We,{leafId:e.id,tabs:e.tabs,activeTabId:e.activeTabId,onTabClick:d,onTabClose:s,onTabDragStart:m,onTabDragEnd:S,onTabDrop:C,onNewTab:b,isDropTarget:E}),D.jsx("div",{className:g.tabContent,children:n&&t(n)})]})}),We=p.memo(({tabs:e,activeTabId:t,onTabClick:r,onTabClose:o,onTabDragStart:a,onTabDragEnd:l,onTabDrop:u,onNewTab:i,isDropTarget:c})=>{const[n,d]=p.useState(null),s=N(),b=p.useCallback((f,T)=>{console.log("🎯 START Drag:",{tabId:T}),f.dataTransfer.effectAllowed="move",f.dataTransfer.setData("text/tab-id",T),a(T,f)},[a]),m=p.useCallback(()=>{console.log("🏁 DefaultTabBar END Drag - clearing UI state only"),d(null),setTimeout(()=>{console.log("🏁 DefaultTabBar calling onTabDragEnd"),l()},50)},[l]),S=p.useCallback((f,T)=>{f.preventDefault(),f.dataTransfer.dropEffect="move",d(T),console.log("🎯 OVER:",T)},[]),C=p.useCallback(()=>{d(null)},[]),E=p.useCallback((f,T)=>{f.preventDefault(),f.stopPropagation();const x=f.dataTransfer.getData("text/tab-id");console.log("💧 TabBar DROP:",{draggedTabId:x,dropIndex:T,isDragging:s.isDragging}),x?(console.log("🚀 Executing tab drop immediately"),u(x,T)):console.log("❌ No dragged tab ID found"),d(null)},[u,s.isDragging]);return D.jsxs("div",{className:`${g.tabBar} ${c?g.dropTarget:""}`,children:[D.jsxs("div",{className:g.tabs,children:[e.map((f,T)=>{const x=s.isDragging&&s.draggedTabId===f.id,w=n===T;return D.jsxs("div",{className:`${g.tab} ${f.id===t?g.activeTab:""} ${x?g.tabDragging:""} ${w?g.tabDragOver:""}`,draggable:!0,onDragStart:R=>b(R,f.id),onDragEnd:m,onDragOver:R=>S(R,T),onDragLeave:C,onDrop:R=>E(R,T),onClick:()=>r(f.id),children:[D.jsx("span",{className:g.tabTitle,children:f.title}),f.isClosable!==!1&&D.jsx("button",{className:g.tabCloseButton,onClick:R=>{R.stopPropagation(),o(f.id)},children:"×"})]},f.id)}),D.jsx("div",{className:`${g.tabDropZone} ${n===e.length?g.tabDragOver:""}`,onDragOver:f=>S(f,e.length),onDragLeave:C,onDrop:f=>E(f,e.length)})]}),D.jsx("button",{className:g.newTabButton,onClick:i,children:"+"})]})}),He=p.memo(({orientation:e,onResize:t,onResizeStart:r,onResizeEnd:o,isResizing:a,renderSplitter:l})=>{const[u,i]=p.useState(!1),[c,n]=p.useState({x:0,y:0}),d=p.useCallback(s=>{i(!0),n({x:s.clientX,y:s.clientY}),r();const b=S=>{const C=e==="horizontal"?S.clientX-c.x:S.clientY-c.y;t(C),n({x:S.clientX,y:S.clientY})},m=()=>{i(!1),o(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",m)},[e,t,r,o,c]);return l?l({orientation:e,onResize:t,onResizeStart:r,onResizeEnd:o,isResizing:a}):D.jsx("div",{className:`${g.splitter} ${e==="horizontal"?g.verticalSplitter:g.horizontalSplitter} ${u?g.splitterDragging:""}`,onMouseDown:d})}),qe=p.memo(({leafId:e})=>{const t=N(),r=_(),[o,a]=p.useState(null),l=p.useCallback(n=>{console.log("💧 DropZone Drop:",{leafId:e,direction:n,dragState:t}),r.setDropTarget(e,n),r.executeDrop(),a(null)},[r,e,t]),u=p.useCallback(n=>{t.sourceLeafId!==e?(console.log("🔥 DropZone activated:",{zone:n,leafId:e,sourceLeafId:t.sourceLeafId}),a(n)):console.log("🚫 DropZone ignored (same panel):",{zone:n,leafId:e})},[t.sourceLeafId,e]),i=p.useCallback(()=>{a(null)},[]);return t.isDragging?t.sourceLeafId===e?(console.log("🚫 DropZone hidden for same panel operation"),null):D.jsx("div",{className:g.dropZoneLayer,children:D.jsxs(D.Fragment,{children:[D.jsx("div",{className:`${g.dropZone} ${g.dropZoneLeft} ${o==="left"?g.active:""}`,onDragOver:n=>n.preventDefault(),onDragEnter:()=>u("left"),onDragLeave:i,onDrop:n=>{n.preventDefault(),n.dataTransfer.getData("text/tab-id")&&l("left")}}),D.jsx("div",{className:`${g.dropZone} ${g.dropZoneRight} ${o==="right"?g.active:""}`,onDragOver:n=>n.preventDefault(),onDragEnter:()=>u("right"),onDragLeave:i,onDrop:n=>{n.preventDefault(),n.dataTransfer.getData("text/tab-id")&&l("right")}}),D.jsx("div",{className:`${g.dropZone} ${g.dropZoneTop} ${o==="top"?g.active:""}`,onDragOver:n=>n.preventDefault(),onDragEnter:()=>u("top"),onDragLeave:i,onDrop:n=>{n.preventDefault(),n.dataTransfer.getData("text/tab-id")&&l("top")}}),D.jsx("div",{className:`${g.dropZone} ${g.dropZoneBottom} ${o==="bottom"?g.active:""}`,onDragOver:n=>n.preventDefault(),onDragEnter:()=>u("bottom"),onDragLeave:i,onDrop:n=>{n.preventDefault(),n.dataTransfer.getData("text/tab-id")&&l("bottom")}}),D.jsx("div",{className:`${g.dropZone} ${g.dropZoneCenter} ${o==="center"?g.active:""}`,onDragOver:n=>n.preventDefault(),onDragEnter:()=>u("center"),onDragLeave:i,onDrop:n=>{n.preventDefault(),n.dataTransfer.getData("text/tab-id")&&l()}})]})}):null}),Z=e=>e.type==="leaf"?[e]:e.children.flatMap(Z),Qe=(e,t)=>{if(!t)return null;const r=o=>{if(o.type==="leaf"&&o.id===t)return o;if(o.type==="split")for(const a of o.children){const l=r(a);if(l)return l}return null};return r(e)},et=()=>{const e=te(),t=_(),r=ae(),o=p.useCallback(a=>{if(!r.enableKeyboardShortcuts)return;const l=a.ctrlKey||a.metaKey,u=a.shiftKey,i=a.key,c=Qe(e.root,e.focusedLeafId);if(c){if(l&&i==="w"&&!u){a.preventDefault(),c.activeTabId&&t.closeTab(c.id,c.activeTabId);return}if(l&&i==="t"&&!u){a.preventDefault(),t.focusPanel(c.id);return}if(l&&i==="\\"&&!u){a.preventDefault(),t.splitPanel(c.id,"horizontal");return}if(l&&i==="Tab"){a.preventDefault();const n=c.tabs.findIndex(d=>d.id===c.activeTabId);if(n!==-1){let d;u?d=n===0?c.tabs.length-1:n-1:d=n===c.tabs.length-1?0:n+1;const s=c.tabs[d];s&&t.activateTab(c.id,s.id)}return}if(l&&(i==="PageUp"||i==="PageDown")){a.preventDefault();const n=c.tabs.findIndex(d=>d.id===c.activeTabId);if(n!==-1){let d;i==="PageUp"?d=n===0?c.tabs.length-1:n-1:d=n===c.tabs.length-1?0:n+1;const s=c.tabs[d];s&&t.activateTab(c.id,s.id)}return}if(l&&i>="1"&&i<="9"){a.preventDefault();const n=parseInt(i)-1,d=c.tabs[n];d&&t.activateTab(c.id,d.id);return}if(!(l&&i==="k")){if(l&&u&&i==="t"){a.preventDefault(),t.restoreTab();return}if(l&&a.altKey&&(i==="ArrowLeft"||i==="ArrowRight")){if(a.preventDefault(),!c.activeTabId)return;const n=Z(e.root),d=n.findIndex(s=>s.id===c.id);if(d!==-1){let s;i==="ArrowRight"?s=d===n.length-1?0:d+1:s=d===0?n.length-1:d-1;const b=n[s];b&&b.id!==c.id&&t.moveTab(c.id,b.id,c.activeTabId)}return}if(l&&!u&&!a.altKey&&i>="1"&&i<="3"){a.preventDefault();const n=Z(e.root),d=parseInt(i)-1,s=n[d];s&&t.focusPanel(s.id);return}}}},[e,t,r.enableKeyboardShortcuts]);p.useEffect(()=>{if(r.enableKeyboardShortcuts)return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[o,r.enableKeyboardShortcuts])};exports.Panel=Fe;exports.PanelActionType=y;exports.PanelProvider=ee;exports.createInitialState=q;exports.createPanelActions=F;exports.panelReducer=H;exports.useDragOperations=fe;exports.useDragState=N;exports.useKeyboardShortcuts=et;exports.usePanelActions=_;exports.usePanelContext=I;exports.usePanelOperations=ue;exports.usePanelOptions=ae;exports.usePanelState=te;exports.useTabOperations=pe;
