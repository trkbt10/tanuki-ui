"use strict";var _n=Object.defineProperty;var $n=(e,t,n)=>t in e?_n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var le=(e,t,n)=>$n(e,typeof t!="symbol"?t+"":t,n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("react/jsx-runtime"),Hn=require("react"),_=require("../vendor/Toolbar-Bqgav2uv.js");function Bn(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const l=Bn(Hn),lt=e=>{const t=[];return e.ctrl&&t.push("ctrl"),e.shift&&t.push("shift"),e.alt&&t.push("alt"),e.meta&&t.push("meta"),t.push(e.key.toLowerCase()),t.join("+")},Gn=(e,t)=>e.key.toLowerCase()===t.key.toLowerCase()&&!!e.ctrlKey==!!t.ctrl&&!!e.shiftKey==!!t.shift&&!!e.altKey==!!t.alt&&!!e.metaKey==!!t.meta,Un=(e,t)=>{switch(t.type){case"REGISTER_SHORTCUT":{const n=lt(t.payload.shortcut),o=new Map(e.shortcuts);return o.set(n,t.payload.handler),{...e,shortcuts:o}}case"UNREGISTER_SHORTCUT":{const n=lt(t.payload.shortcut),o=new Map(e.shortcuts);return o.delete(n),{...e,shortcuts:o}}case"ENABLE_SHORTCUTS":return{...e,isEnabled:!0};case"DISABLE_SHORTCUTS":return{...e,isEnabled:!1};default:return e}},Fn={shortcuts:new Map,isEnabled:!0},_e={registerShortcut:(e,t)=>({type:"REGISTER_SHORTCUT",payload:{shortcut:e,handler:t}}),unregisterShortcut:e=>({type:"UNREGISTER_SHORTCUT",payload:{shortcut:e}}),enableShortcuts:()=>({type:"ENABLE_SHORTCUTS"}),disableShortcuts:()=>({type:"DISABLE_SHORTCUTS"})},wt=l.createContext(null),Et=({children:e,initialState:t})=>{const[n,o]=l.useReducer(Un,{...Fn,...t});l.useEffect(()=>{const c=d=>{if(!n.isEnabled)return;const u=d.target;if(!(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable))for(const[p,h]of n.shortcuts){const x=p.split("+"),y=x[x.length-1],v=x.slice(0,-1),g={key:y,ctrl:v.includes("ctrl"),shift:v.includes("shift"),alt:v.includes("alt"),meta:v.includes("meta")};if(Gn(d,g)){d.preventDefault(),d.stopPropagation(),h(d);break}}};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[n.shortcuts,n.isEnabled]);const s=l.useCallback((c,d)=>{o(_e.registerShortcut(c,d))},[o]),r=l.useCallback(c=>{o(_e.unregisterShortcut(c))},[o]),i={state:n,dispatch:o,actions:_e,registerShortcut:s,unregisterShortcut:r};return a.jsx(wt.Provider,{value:i,children:e})},Xn=()=>{const e=l.useContext(wt);if(!e)throw new Error("useKeyboardShortcut must be used within a KeyboardShortcutProvider");return e},ie=(e,t,n=[])=>{const{registerShortcut:o,unregisterShortcut:s}=Xn();l.useEffect(()=>(o(e,t),()=>s(e)),[o,s,...n])},Yn=(e,t)=>{switch(t.type){case"SET_VIEWPORT":return{...e,viewport:t.payload.viewport};case"PAN_VIEWPORT":{const{delta:n}=t.payload;return{...e,viewport:{...e.viewport,offset:{x:e.viewport.offset.x+n.x,y:e.viewport.offset.y+n.y}}}}case"ZOOM_VIEWPORT":{const{scale:n,center:o}=t.payload,s=Math.max(.01,Math.min(64,n));if(o){const r=s/e.viewport.scale,i={x:o.x-(o.x-e.viewport.offset.x)*r,y:o.y-(o.y-e.viewport.offset.y)*r};return{...e,viewport:{offset:i,scale:s}}}return{...e,viewport:{...e.viewport,scale:s}}}case"RESET_VIEWPORT":return{...e,viewport:{offset:{x:0,y:0},scale:1}};case"UPDATE_GRID_SETTINGS":return{...e,gridSettings:{...e.gridSettings,...t.payload.settings}};case"SET_SPACE_PANNING":return{...e,isSpacePanning:t.payload.isSpacePanning};case"START_PAN":return{...e,panState:{isPanning:!0,startPosition:t.payload.position}};case"UPDATE_PAN":{if(!e.panState.isPanning||!e.panState.startPosition)return e;const n=t.payload.position.x-e.panState.startPosition.x,o=t.payload.position.y-e.panState.startPosition.y;return{...e,viewport:{...e.viewport,offset:{x:e.viewport.offset.x+n,y:e.viewport.offset.y+o}},panState:{...e.panState,startPosition:t.payload.position}}}case"END_PAN":return{...e,panState:{isPanning:!1,startPosition:null}};default:return e}},Wn={viewport:{offset:{x:0,y:0},scale:1},gridSettings:{enabled:!1,size:20,showGrid:!0,snapToGrid:!1,snapThreshold:8},isSpacePanning:!1,panState:{isPanning:!1,startPosition:null}},Kn={setViewport:e=>({type:"SET_VIEWPORT",payload:{viewport:e}}),panViewport:e=>({type:"PAN_VIEWPORT",payload:{delta:e}}),zoomViewport:(e,t)=>({type:"ZOOM_VIEWPORT",payload:{scale:e,center:t}}),resetViewport:()=>({type:"RESET_VIEWPORT"}),updateGridSettings:e=>({type:"UPDATE_GRID_SETTINGS",payload:{settings:e}}),setSpacePanning:e=>({type:"SET_SPACE_PANNING",payload:{isSpacePanning:e}}),startPan:e=>({type:"START_PAN",payload:{position:e}}),updatePan:e=>({type:"UPDATE_PAN",payload:{position:e}}),endPan:()=>({type:"END_PAN"})},Zn=(e,t)=>({screenToCanvas:(n,o)=>{if(!e.current)return console.warn("Canvas ref is not available for coordinate conversion"),{x:n,y:o};const s=e.current.getBoundingClientRect();return{x:(n-s.left-t.offset.x)/t.scale,y:(o-s.top-t.offset.y)/t.scale}},canvasToScreen:(n,o)=>{if(!e.current)return console.warn("Canvas ref is not available for coordinate conversion"),{x:n,y:o};const s=e.current.getBoundingClientRect();return{x:n*t.scale+t.offset.x+s.left,y:o*t.scale+t.offset.y+s.top}}}),It=l.createContext(null),Dt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(Yn,{...Wn,...t}),s=l.useRef(null),r=l.useMemo(()=>Zn(s,n.viewport),[n.viewport]),i={state:n,dispatch:o,actions:Kn,canvasRef:s,utils:r};return a.jsx(It.Provider,{value:i,children:e})},ne=()=>{const e=l.useContext(It);if(!e)throw new Error("useNodeCanvas must be used within a NodeCanvasProvider");return e},qn=(e,t)=>{switch(t.type){case"SELECT_NODE":{const{nodeId:n,multiple:o}=t.payload;if(o){const s=e.selectedNodeIds.includes(n);return{...e,selectedNodeIds:s?e.selectedNodeIds.filter(r=>r!==n):[...e.selectedNodeIds,n]}}return{...e,selectedNodeIds:[n],selectedConnectionIds:[]}}case"SELECT_CONNECTION":{const{connectionId:n,multiple:o}=t.payload;if(o){const s=e.selectedConnectionIds.includes(n);return{...e,selectedConnectionIds:s?e.selectedConnectionIds.filter(r=>r!==n):[...e.selectedConnectionIds,n]}}return{...e,selectedConnectionIds:[n],selectedNodeIds:[]}}case"CLEAR_SELECTION":return{...e,selectedNodeIds:[],selectedConnectionIds:[],selectionBox:null};case"SELECT_ALL_NODES":return{...e,selectedNodeIds:t.payload.nodeIds,selectedConnectionIds:[]};case"SET_SELECTION_BOX":return{...e,selectionBox:t.payload.box};case"START_NODE_DRAG":{const{nodeIds:n,startPosition:o,initialPositions:s,affectedChildNodes:r}=t.payload;return{...e,dragState:{nodeIds:n,startPosition:o,offset:{x:0,y:0},initialPositions:s,affectedChildNodes:r}}}case"UPDATE_NODE_DRAG":return e.dragState?{...e,dragState:{...e.dragState,offset:t.payload.offset}}:e;case"END_NODE_DRAG":return{...e,dragState:null};case"SET_HOVERED_NODE":return{...e,hoveredNodeId:t.payload.nodeId};case"SET_HOVERED_CONNECTION":return{...e,hoveredConnectionId:t.payload.connectionId};case"START_CONNECTION_DRAG":return{...e,connectionDragState:{fromPort:t.payload.fromPort,toPosition:{x:0,y:0},validTarget:null,candidatePort:null}};case"UPDATE_CONNECTION_DRAG":return e.connectionDragState?{...e,connectionDragState:{...e.connectionDragState,toPosition:t.payload.toPosition,candidatePort:t.payload.candidatePort}}:e;case"END_CONNECTION_DRAG":return{...e,connectionDragState:null};case"START_CONNECTION_DISCONNECT":return{...e,connectionDisconnectState:{connectionId:t.payload.originalConnection.id,fixedPort:t.payload.fixedPort,draggingEnd:t.payload.disconnectedEnd,draggingPosition:t.payload.draggingPosition,originalConnection:t.payload.originalConnection,disconnectedEnd:t.payload.disconnectedEnd,candidatePort:null}};case"UPDATE_CONNECTION_DISCONNECT":return e.connectionDisconnectState?{...e,connectionDisconnectState:{...e.connectionDisconnectState,draggingPosition:t.payload.draggingPosition,candidatePort:t.payload.candidatePort}}:e;case"END_CONNECTION_DISCONNECT":return{...e,connectionDisconnectState:null};case"SET_HOVERED_PORT":return{...e,hoveredPort:t.payload.port};case"UPDATE_CONNECTED_PORTS":return{...e,connectedPorts:t.payload.connectedPorts};case"UPDATE_CONNECTABLE_PORTS":return{...e,connectablePortIds:t.payload.connectablePortIds};case"START_NODE_RESIZE":{const{nodeId:n,startPosition:o,startSize:s,handle:r}=t.payload;return{...e,resizeState:{nodeId:n,startPosition:o,startSize:s,currentSize:s,currentPosition:o,handle:r}}}case"UPDATE_NODE_RESIZE":return e.resizeState?{...e,resizeState:{...e.resizeState,currentSize:t.payload.currentSize}}:e;case"END_NODE_RESIZE":return{...e,resizeState:null};case"SHOW_CONTEXT_MENU":return{...e,contextMenu:{visible:!0,position:t.payload.position,canvasPosition:t.payload.canvasPosition,nodeId:t.payload.nodeId}};case"HIDE_CONTEXT_MENU":return{...e,contextMenu:{visible:!1,position:{x:0,y:0},canvasPosition:void 0,nodeId:void 0}};default:return e}},Jn={selectedNodeIds:[],selectedConnectionIds:[],selectionBox:null,dragState:null,resizeState:null,hoveredNodeId:null,hoveredConnectionId:null,connectionDragState:null,connectionDisconnectState:null,hoveredPort:null,connectedPorts:new Set,connectablePortIds:new Set,contextMenu:{visible:!1,position:{x:0,y:0},canvasPosition:void 0,nodeId:void 0}},Qn={selectNode:(e,t=!1)=>({type:"SELECT_NODE",payload:{nodeId:e,multiple:t}}),selectConnection:(e,t=!1)=>({type:"SELECT_CONNECTION",payload:{connectionId:e,multiple:t}}),clearSelection:()=>({type:"CLEAR_SELECTION"}),selectAllNodes:e=>({type:"SELECT_ALL_NODES",payload:{nodeIds:e}}),setSelectionBox:e=>({type:"SET_SELECTION_BOX",payload:{box:e}}),startNodeDrag:(e,t,n,o)=>({type:"START_NODE_DRAG",payload:{nodeIds:e,startPosition:t,initialPositions:n,affectedChildNodes:o}}),updateNodeDrag:e=>({type:"UPDATE_NODE_DRAG",payload:{offset:e}}),endNodeDrag:()=>({type:"END_NODE_DRAG"}),setHoveredNode:e=>({type:"SET_HOVERED_NODE",payload:{nodeId:e}}),setHoveredConnection:e=>({type:"SET_HOVERED_CONNECTION",payload:{connectionId:e}}),startConnectionDrag:e=>({type:"START_CONNECTION_DRAG",payload:{fromPort:e}}),updateConnectionDrag:(e,t)=>({type:"UPDATE_CONNECTION_DRAG",payload:{toPosition:e,candidatePort:t}}),endConnectionDrag:()=>({type:"END_CONNECTION_DRAG"}),setHoveredPort:e=>({type:"SET_HOVERED_PORT",payload:{port:e}}),updateConnectedPorts:e=>({type:"UPDATE_CONNECTED_PORTS",payload:{connectedPorts:e}}),updateConnectablePorts:e=>({type:"UPDATE_CONNECTABLE_PORTS",payload:{connectablePortIds:e}}),startConnectionDisconnect:(e,t,n,o)=>({type:"START_CONNECTION_DISCONNECT",payload:{originalConnection:e,disconnectedEnd:t,fixedPort:n,draggingPosition:o}}),updateConnectionDisconnect:(e,t)=>({type:"UPDATE_CONNECTION_DISCONNECT",payload:{draggingPosition:e,candidatePort:t}}),endConnectionDisconnect:()=>({type:"END_CONNECTION_DISCONNECT"}),startNodeResize:(e,t,n,o)=>({type:"START_NODE_RESIZE",payload:{nodeId:e,startPosition:t,startSize:n,handle:o}}),updateNodeResize:e=>({type:"UPDATE_NODE_RESIZE",payload:{currentSize:e}}),endNodeResize:()=>({type:"END_NODE_RESIZE"}),showContextMenu:(e,t,n)=>({type:"SHOW_CONTEXT_MENU",payload:{position:e,nodeId:t,canvasPosition:n}}),hideContextMenu:()=>({type:"HIDE_CONTEXT_MENU"})},Pt=l.createContext(null),jt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(qn,{...Jn,...t}),s={state:n,dispatch:o,actions:Qn};return a.jsx(Pt.Provider,{value:s,children:e})},W=()=>{const e=l.useContext(Pt);if(!e)throw new Error("useEditorActionState must be used within an EditorActionStateProvider");return e},eo=(e,t)=>{switch(t.type){case"START_EDITING":{const{nodeId:n,field:o,value:s}=t.payload;return{editingNodeId:n,editingField:o,originalValue:s,currentValue:s,isActive:!0}}case"UPDATE_VALUE":return e.isActive?{...e,currentValue:t.payload.value}:e;case"CONFIRM_EDIT":case"CANCEL_EDIT":case"END_EDITING":return{editingNodeId:null,editingField:null,originalValue:"",currentValue:"",isActive:!1};default:return e}},to={editingNodeId:null,editingField:null,originalValue:"",currentValue:"",isActive:!1},Ne={startEditing:(e,t,n)=>({type:"START_EDITING",payload:{nodeId:e,field:t,value:n}}),updateValue:e=>({type:"UPDATE_VALUE",payload:{value:e}}),confirmEdit:()=>({type:"CONFIRM_EDIT"}),cancelEdit:()=>({type:"CANCEL_EDIT"}),endEditing:()=>({type:"END_EDITING"})},kt=l.createContext(null),Tt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(eo,{...to,...t}),s=l.useCallback((p,h)=>!(!n.isActive||n.editingNodeId!==p||h&&n.editingField!==h),[n.isActive,n.editingNodeId,n.editingField]),r=l.useCallback((p,h,x)=>{o(Ne.startEditing(p,h,x))},[o]),i=l.useCallback(p=>{o(Ne.updateValue(p))},[o]),c=l.useCallback(()=>{o(Ne.confirmEdit())},[o]),d=l.useCallback(()=>{o(Ne.cancelEdit())},[o]),u={state:n,dispatch:o,actions:Ne,isEditing:s,startEditing:r,updateValue:i,confirmEdit:c,cancelEdit:d};return a.jsx(kt.Provider,{value:u,children:e})},Ot=()=>{const e=l.useContext(kt);if(!e)throw new Error("useInlineEditing must be used within an InlineEditingProvider");return e};function no(){const e=new Map;return{definitions:e,register(t){e.set(t.type,t)},unregister(t){e.delete(t)},get(t){return e.get(t)},getAll(){return Array.from(e.values())},getByCategory(t){return Array.from(e.values()).filter(n=>n.category===t)}}}const oo={type:"standard",displayName:"Standard Node",description:"A basic node with customizable properties",category:"Basic",defaultData:{title:"New Node",content:""},defaultSize:{width:200,height:100},ports:[{id:"input",type:"input",label:"Input",position:"left"},{id:"output",type:"output",label:"Output",position:"right"}]},so={type:"group",displayName:"Group",description:"A container node that can hold other nodes",category:"Structure",defaultData:{title:"Group"},defaultSize:{width:300,height:200},supportsChildren:!0,visualState:"info"};function ro(e){return e}function io(e){return e.data}function ao(e){return t=>{e({data:t})}}function co(e){return e}function lo(e){return e}const Ke=l.createContext(null),Mt=({children:e,nodeDefinitions:t=[],includeDefaults:n=!0})=>{const s={registry:l.useMemo(()=>{const r=no();return n&&(r.register(oo),r.register(so)),t.forEach(i=>r.register(i)),r},[t,n])};return a.jsx(Ke.Provider,{value:s,children:e})},Oe=()=>{const e=l.useContext(Ke);if(!e)throw new Error("useNodeDefinitions must be used within a NodeDefinitionProvider");return e},Me=e=>{const{registry:t}=Oe();return t.get(e)},ze=()=>{const{registry:e}=Oe();return e.getAll()},zt=l.createContext(null),Rt=({children:e,refs:t={}})=>{const n={refs:t};return a.jsx(zt.Provider,{value:n,children:e})},uo=()=>{const e=l.useContext(zt);if(!e)throw new Error("useExternalDataRefs must be used within an ExternalDataProvider");return e},Ze=e=>{const{refs:t}=uo();return t[e]},qe=(e={})=>{const{dispatch:t,actions:n}=X(),{state:o,dispatch:s,actions:r}=W(),{minWidth:i=100,minHeight:c=40,snapToGrid:d=!1,gridSize:u=20}=e,p=l.useCallback((g,f,N,D)=>{const w={width:Math.max(i,f.width+N),height:Math.max(c,f.height+D)};return d&&(w.width=Math.round(w.width/u)*u,w.height=Math.round(w.height/u)*u),w},[i,c,d,u]);l.useEffect(()=>{if(!o.resizeState)return;const{nodeId:g,startPosition:f,startSize:N,handle:D}=o.resizeState,w=m=>{const b=m.clientX-f.x,C=m.clientY-f.y,I=p(D,N,b,C);s(r.updateNodeResize(I))},E=m=>{if(o.resizeState){const{nodeId:b,currentSize:C}=o.resizeState;t(n.updateNode(b,{size:C}))}s(r.endNodeResize())},j=m=>{m.key==="Escape"&&s(r.endNodeResize())};return window.addEventListener("pointermove",w),window.addEventListener("pointerup",E),window.addEventListener("keydown",j),()=>{window.removeEventListener("pointermove",w),window.removeEventListener("pointerup",E),window.removeEventListener("keydown",j)}},[o.resizeState,p,s,r,t,n]);const h=l.useCallback((g,f,N,D)=>{s(r.startNodeResize(g,N,D,f))},[s,r]),x=l.useCallback(g=>{var f;return((f=o.resizeState)==null?void 0:f.nodeId)===g},[o.resizeState]),y=l.useCallback(g=>{var f;return((f=o.resizeState)==null?void 0:f.nodeId)===g?o.resizeState.handle:null},[o.resizeState]),v=l.useCallback(g=>{var f;return((f=o.resizeState)==null?void 0:f.nodeId)===g?o.resizeState.currentSize:null},[o.resizeState]);return{startResize:h,isResizing:x,getResizeHandle:y,getCurrentSize:v}},Ge={width:150,height:50};function Je(e){var t,n;return{width:((t=e.size)==null?void 0:t.width)||Ge.width,height:((n=e.size)==null?void 0:n.height)||Ge.height}}function Ce(e){const{width:t,height:n}=Je(e);return{left:e.position.x,top:e.position.y,right:e.position.x+t,bottom:e.position.y+n,width:t,height:n}}function po(e,t){return{left:e.x,top:e.y,right:e.x+t.width,bottom:e.y+t.height,width:t.width,height:t.height}}function ho(e,t){return!(e.right<t.left||t.right<e.left||e.bottom<t.top||t.bottom<e.top)}function At(e,t){return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom}function go(e,t){const n=new Map;return Object.entries(e).forEach(([o,s])=>{(t?t(o):s.ports||[]).forEach(i=>{n.set(i.id,o)})}),n}function Lt(e){const t=new Map;return Object.entries(e).forEach(([n,o])=>{o.parentId&&(t.has(o.parentId)||t.set(o.parentId,[]),t.get(o.parentId).push(n))}),t}function fo(e){const t=new Map,n=new Map,o=new Map,s=new Map,r=new Map;return Object.values(e).forEach(i=>{t.has(i.fromNodeId)||t.set(i.fromNodeId,[]),n.has(i.toNodeId)||n.set(i.toNodeId,[]),t.get(i.fromNodeId).push(i),n.get(i.toNodeId).push(i),o.has(i.fromPortId)||o.set(i.fromPortId,[]),s.has(i.toPortId)||s.set(i.toPortId,[]),o.get(i.fromPortId).push(i),s.get(i.toPortId).push(i);const c=`${i.fromNodeId}:${i.fromPortId}`,d=`${i.toNodeId}:${i.toPortId}`;r.has(c)||r.set(c,[]),r.has(d)||r.set(d,[]),r.get(c).push(i),r.get(d).push(i)}),{byFromNode:t,byToNode:n,byFromPort:o,byToPort:s,byEndpoint:r}}class mo{constructor(t=200){le(this,"cells",new Map);le(this,"cellSize");this.cellSize=t}getCellKey(t,n){const o=Math.floor(t/this.cellSize),s=Math.floor(n/this.cellSize);return`${o},${s}`}insert(t,n,o){const s=this.getCellKey(n,o);this.cells.has(s)||this.cells.set(s,[]),this.cells.get(s).push(t)}getNearby(t,n,o=1){const s=[],r=Math.ceil(o/this.cellSize),i=Math.floor(t/this.cellSize),c=Math.floor(n/this.cellSize);for(let d=-r;d<=r;d++)for(let u=-r;u<=r;u++){const p=`${i+d},${c+u}`,h=this.cells.get(p);h&&s.push(...h)}return s}clear(){this.cells.clear()}getInArea(t,n,o,s){const r=[],i=Math.floor(t/this.cellSize),c=Math.floor(n/this.cellSize),d=Math.floor(o/this.cellSize),u=Math.floor(s/this.cellSize);for(let p=i;p<=d;p++)for(let h=c;h<=u;h++){const x=`${p},${h}`,y=this.cells.get(x);y&&r.push(...y)}return r}}const yo=(e,t)=>{if(e.id===t.id||e.type==="group")return!1;const n=Ce(e),o=Ce(t);return At(n,o)},Vt=(e,t)=>{const n=Object.values(t).filter(r=>r.type==="group");let o=null,s=1/0;for(const r of n)if(yo(e,r)){const i=Ce(r),c=i.width*i.height;c<s&&(s=c,o=r)}return(o==null?void 0:o.id)||null};let Ie=null,ut=null;const _t=(e,t)=>(ut!==t&&(Ie=Lt(t),ut=t),((Ie==null?void 0:Ie.get(e))||[]).map(o=>t[o]).filter(Boolean)),xo=(e,t)=>{const n=[],o=[e];for(;o.length>0;){const s=o.pop(),r=_t(s,t);n.push(...r),o.push(...r.filter(i=>i.type==="group").map(i=>i.id))}return n},vo=e=>{const t={},n=Object.values(e).filter(o=>o.type!=="group");for(const o of n){const s=Vt(o,e);o.parentId!==s&&(t[o.id]={parentId:s||void 0})}return t},No=(e,t,n)=>{const o=n[e];if(!o||o.type!=="group")return!0;const s={...o,position:t};return Vt(s,n)===null},Qe=(e={})=>{const{state:t,dispatch:n,actions:o}=X(),{state:s}=W(),{autoUpdateMembership:r=!0,membershipUpdateDelay:i=100}=e,c=l.useRef(void 0),d=l.useRef(t.nodes);d.current=t.nodes;const u=l.useCallback(()=>{const f=vo(d.current);Object.keys(f).length>0&&n(o.updateGroupMembership(f))},[]);l.useEffect(()=>r?(c.current&&clearTimeout(c.current),s.dragState!==null||(c.current=window.setTimeout(()=>{u()},i)),()=>{c.current&&clearTimeout(c.current)}):void 0,[r,i,u]);const p=l.useCallback(f=>{const N=d.current[f];return!!(N&&N.parentId)},[d]),h=l.useCallback(f=>{const N=d.current[f];return(N==null?void 0:N.parentId)||null},[]),x=l.useCallback(f=>_t(f,d.current),[]),y=l.useCallback(f=>xo(f,d.current),[]),v=l.useCallback((f,N)=>{n(o.moveGroupWithChildren(f,N))},[n,o]),g=l.useCallback((f,N)=>No(f,N,d.current),[]);return{updateAllGroupMembership:u,isNodeInGroup:p,getNodeParentGroup:h,getGroupChildren:x,getGroupDescendants:y,moveGroupWithChildren:v,isValidGroupMove:g}};function bo(e){const{onStart:t,onMove:n,onEnd:o,scale:s=1,threshold:r=2,disabled:i=!1}=e,[c,d]=l.useState({isDragging:!1,dragStarted:!1,delta:{x:0,y:0}}),u=l.useRef(null),p=l.useRef({x:0,y:0}),h=l.useRef({x:0,y:0}),x=l.useCallback(g=>{if(!u.current)return;const f={x:(g.clientX-p.current.x)/s,y:(g.clientY-p.current.y)/s};h.current=f,c.dragStarted?(d(N=>({...N,delta:f})),n==null||n(g,f,u.current)):Math.sqrt(f.x*f.x+f.y*f.y)>=r&&(d({isDragging:!0,dragStarted:!0,delta:f}),t==null||t(g,u.current))},[s,r,c.dragStarted,t,n]),y=l.useCallback(g=>{if(!u.current)return;const f=c.dragStarted,N=h.current;document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",y),document.removeEventListener("pointercancel",y),d({isDragging:!1,dragStarted:!1,delta:{x:0,y:0}}),f&&(o==null||o(g,N,u.current)),u.current=null,h.current={x:0,y:0}},[c.dragStarted,x,o]),v=l.useCallback((g,f)=>{if(i)return;const N="nativeEvent"in g?g.nativeEvent:g;u.current=f,p.current={x:N.clientX,y:N.clientY};const D=N.target;D!=null&&D.setPointerCapture&&D.setPointerCapture(N.pointerId),document.addEventListener("pointermove",x),document.addEventListener("pointerup",y),document.addEventListener("pointercancel",y),d({isDragging:!0,dragStarted:!1,delta:{x:0,y:0}})},[i,x,y]);return l.useEffect(()=>()=>{document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",y),document.removeEventListener("pointercancel",y)},[x,y]),{startDrag:v,dragState:c}}function Ue({interactionState:e,viewport:t,onPointerMove:n,onPointerUp:o,canvasSelector:s='[role="application"]',pointerMoveOptions:r={passive:!0}}){l.useEffect(()=>{if(!e)return;const i=document.querySelector(s);if(!i)return;const c=u=>{const p=i.getBoundingClientRect(),h=(u.clientX-p.left-t.offset.x)/t.scale,x=(u.clientY-p.top-t.offset.y)/t.scale;n({x:h,y:x},u)},d=u=>{o(u)};return window.addEventListener("pointermove",c,r),window.addEventListener("pointerup",d,{once:!0}),()=>{window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",d)}},[e,t,n,o,s,r])}function $t(e,t){l.useEffect(()=>{if(!e)return;const{onMove:n,onUp:o,onCancel:s}=t;return n&&document.addEventListener("pointermove",n,{passive:!1}),o&&document.addEventListener("pointerup",o),s&&document.addEventListener("pointercancel",s),()=>{n&&document.removeEventListener("pointermove",n),o&&document.removeEventListener("pointerup",o),s&&document.removeEventListener("pointercancel",s)}},[e,t.onMove,t.onUp,t.onCancel])}function Ht(e,t,n){l.useEffect(()=>{const o=e.current;if(!(!t||!o||n===void 0))return o.setPointerCapture(n),()=>{o.hasPointerCapture&&o.hasPointerCapture(n)&&o.releasePointerCapture(n)}},[e,t,n])}function Bt(e,t,n=["pointerdown","pointermove","pointerup"]){l.useEffect(()=>{const o=e.current;if(!t||!o)return;const s=r=>{r.preventDefault()};return n.forEach(r=>{o.addEventListener(r,s,{passive:!1})}),()=>{n.forEach(r=>{o.removeEventListener(r,s)})}},[e,t,n])}function Co(e,t,n){const{onMove:o,onUp:s,onCancel:r,pointerId:i,capturePointer:c=!0,preventDefaults:d=!0}=n;$t(t,{onMove:o,onUp:s,onCancel:r}),Ht(e,t&&c,i),Bt(e,t&&d)}function et(){const{dispatch:e,actions:t}=X();return l.useMemo(()=>({addNode:n=>e(t.addNode(n)),updateNode:(n,o)=>e(t.updateNode(n,o)),deleteNode:n=>e(t.deleteNode(n)),moveNode:(n,o)=>e(t.moveNode(n,o)),moveNodes:n=>e(t.moveNodes(n)),addConnection:n=>e(t.addConnection(n)),deleteConnection:n=>e(t.deleteConnection(n)),setNodeData:n=>e(t.setNodeData(n)),restoreState:n=>e(t.restoreState(n)),duplicateNodes:n=>e(t.duplicateNodes(n)),groupNodes:(n,o)=>e(t.groupNodes(n,o)),ungroupNode:n=>e(t.ungroupNode(n)),updateGroupMembership:n=>e(t.updateGroupMembership(n)),moveGroupWithChildren:(n,o)=>e(t.moveGroupWithChildren(n,o)),autoLayout:(n,o)=>e(t.autoLayout(n,o))}),[e,t])}function So(){const{state:e}=X(),t=et();return{state:e,actions:t}}function tt(){const{dispatch:e,actions:t}=ne();return l.useMemo(()=>({setViewport:n=>e(t.setViewport(n)),panViewport:n=>e(t.panViewport(n)),zoomViewport:(n,o)=>e(t.zoomViewport(n,o)),resetViewport:()=>e(t.resetViewport()),startPan:n=>e(t.startPan(n)),updatePan:n=>e(t.updatePan(n)),endPan:()=>e(t.endPan())}),[e,t])}function wo(){const{state:e}=ne(),t=tt();return{state:e,actions:t}}function nt(){const{dispatch:e,actions:t}=W();return l.useMemo(()=>({selectNode:(n,o)=>e(t.selectNode(n,o)),selectConnection:(n,o)=>e(t.selectConnection(n,o)),clearSelection:()=>e(t.clearSelection()),selectAllNodes:n=>e(t.selectAllNodes(n)),setSelectionBox:n=>e(t.setSelectionBox(n)),startNodeDrag:(n,o,s,r)=>e(t.startNodeDrag(n,o,s,r)),updateNodeDrag:n=>e(t.updateNodeDrag(n)),endNodeDrag:()=>e(t.endNodeDrag()),setHoveredNode:n=>e(t.setHoveredNode(n)),setHoveredConnection:n=>e(t.setHoveredConnection(n)),startConnectionDrag:n=>e(t.startConnectionDrag(n)),updateConnectionDrag:(n,o)=>e(t.updateConnectionDrag(n,o)),endConnectionDrag:()=>e(t.endConnectionDrag()),setHoveredPort:n=>e(t.setHoveredPort(n)),updateConnectedPorts:n=>e(t.updateConnectedPorts(n)),startConnectionDisconnect:(n,o,s,r)=>e(t.startConnectionDisconnect(n,o,s,r)),updateConnectionDisconnect:(n,o)=>e(t.updateConnectionDisconnect(n,o)),endConnectionDisconnect:()=>e(t.endConnectionDisconnect()),startNodeResize:(n,o,s,r)=>e(t.startNodeResize(n,o,s,r)),updateNodeResize:n=>e(t.updateNodeResize(n)),endNodeResize:()=>e(t.endNodeResize()),showContextMenu:(n,o,s)=>e(t.showContextMenu(n,o,s)),hideContextMenu:()=>e(t.hideContextMenu())}),[e,t])}function Eo(){const{state:e}=W(),t=nt();return{state:e,actions:t}}function Gt(){const e=et(),t=tt(),n=nt();return{editor:e,canvas:t,interaction:n}}function Io(){const e=Gt();return{addNode:e.editor.addNode,removeNode:e.editor.deleteNode,updateNode:e.editor.updateNode,duplicateNodes:e.editor.duplicateNodes,addConnection:e.editor.addConnection,removeConnection:e.editor.deleteConnection,selectNode:e.interaction.selectNode,selectAllNodes:e.interaction.selectAllNodes,clearSelection:e.interaction.clearSelection,setViewport:e.canvas.setViewport,panViewport:e.canvas.panViewport,zoomViewport:e.canvas.zoomViewport,resetViewport:e.canvas.resetViewport,showContextMenu:e.interaction.showContextMenu,hideContextMenu:e.interaction.hideContextMenu}}const se={showGrid:!0,showMinimap:!0,showStatusBar:!0,theme:"light",autoSave:!0,autoSaveInterval:30,smoothAnimations:!0,doubleClickToEdit:!0,fontSize:14,gridSize:20,gridOpacity:.3,canvasBackground:"#ffffff"};function Do(e){return typeof e=="string"&&["light","dark","auto"].includes(e)}function me(e,t,n){const o=e.getValue(t);return typeof o=="boolean"?o:n}function De(e,t,n){const o=e.getValue(t);return typeof o=="number"?o:n}function Po(e,t,n){const o=e.getValue(t);return typeof o=="string"?o:n}function jo(e,t,n){const o=e.getValue(t);return Do(o)?o:n}function ot(e){const[t,n]=l.useState(0);return l.useEffect(()=>e?e.on("change",()=>{n(r=>r+1)}):void 0,[e]),l.useMemo(()=>e?{showGrid:me(e,"appearance.showGrid",se.showGrid),showMinimap:me(e,"appearance.showMinimap",se.showMinimap),showStatusBar:me(e,"appearance.showStatusBar",se.showStatusBar),theme:jo(e,"appearance.theme",se.theme),autoSave:me(e,"general.autoSave",se.autoSave),autoSaveInterval:De(e,"general.autoSaveInterval",se.autoSaveInterval),smoothAnimations:me(e,"behavior.smoothAnimations",se.smoothAnimations),doubleClickToEdit:me(e,"behavior.doubleClickToEdit",se.doubleClickToEdit),fontSize:De(e,"appearance.fontSize",se.fontSize),gridSize:De(e,"appearance.gridSize",se.gridSize),gridOpacity:De(e,"appearance.gridOpacity",se.gridOpacity),canvasBackground:Po(e,"appearance.canvasBackground",se.canvasBackground)}:se,[e,t])}const Ut=(e,t=1.5)=>{const{state:n}=ne();return l.useMemo(()=>{const{viewport:o}=n,s=window.innerWidth,r=window.innerHeight,i=Math.max(s,r)*(t-1)/2,c={left:(-o.offset.x-i)/o.scale,top:(-o.offset.y-i)/o.scale,right:(s-o.offset.x+i)/o.scale,bottom:(r-o.offset.y+i)/o.scale};return Object.values(e).filter(d=>{var h,x;const u=((h=d.size)==null?void 0:h.width)||150,p=((x=d.size)==null?void 0:x.height)||50;return d.position.x+u>=c.left&&d.position.x<=c.right&&d.position.y+p>=c.top&&d.position.y<=c.bottom})},[e,n.viewport,t])},ko=(e,t={})=>{const{delay:n=0,maxBatchSize:o=100}=t,[s,r]=l.useState(e),i=l.useRef([]),c=l.useRef(null),d=l.useRef(null),u=l.useCallback(()=>{i.current.length!==0&&(r(x=>{let y=x;for(const v of i.current)y=v(y);return y}),i.current=[],c.current=null,d.current&&(clearTimeout(d.current),d.current=null))},[]),p=l.useCallback(x=>{const y=typeof x=="function"?x:v=>x;if(i.current.push(y),i.current.length>=o){u();return}c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current),n>0?d.current=setTimeout(()=>{c.current=requestAnimationFrame(u)},n):c.current=requestAnimationFrame(u)},[u,n,o]),h=l.useCallback(()=>{c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current),u()},[u]);return l.useEffect(()=>()=>{c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current)},[]),[s,p,h]},Se={visualSize:12,connectionMargin:8,edgePadding:20,relativePadding:.1};function To(e){const t=new Map;for(const n of e){const o=n.position||"right";t.has(o)||t.set(o,[]),t.get(o).push(n)}return t}function Ft(e,t,n){if(t===1)return .5;if(t===2)return[.3333,.6667][e]||.5;const s=(1-n.relativePadding*2)/(t-1),r=n.relativePadding+s*e;return Math.max(.1,Math.min(.9,r))}function Oo(e,t,n,o,s){const r=Ft(t,n,s),i=s.visualSize/2;switch(e.position){case"left":return{x:-i,y:o.height*r,transform:"translateY(-50%)"};case"right":return{x:o.width-i,y:o.height*r,transform:"translateY(-50%)"};case"top":return{x:o.width*r,y:-i,transform:"translateX(-50%)"};case"bottom":return{x:o.width*r,y:o.height-i,transform:"translateX(-50%)"};default:return{x:o.width-i,y:o.height*.5,transform:"translateY(-50%)"}}}function Mo(e,t,n,o,s){const r=Je(o),{left:i,top:c}=Ce(o),d=Ft(t,n,s);switch(e.position){case"left":return{x:i-s.connectionMargin,y:c+r.height*d};case"right":return{x:i+r.width+s.connectionMargin,y:c+r.height*d};case"top":return{x:i+r.width*d,y:c-s.connectionMargin};case"bottom":return{x:i+r.width*d,y:c+r.height+s.connectionMargin};default:return{x:i+r.width+s.connectionMargin,y:c+r.height*.5}}}function we(e,t=Se){const n=new Map,o=e.ports||[];if(o.length===0)return n;const s=Je(e),r=To(o);for(const[i,c]of r)c.forEach((d,u)=>{const p=Oo(d,u,c.length,s,t),h=Mo(d,u,c.length,e,t);n.set(d.id,{portId:d.id,renderPosition:p,connectionPoint:h})});return n}function Xt(e,t=Se){const n=new Map;for(const o of e){const s=we(o,t);s.size>0&&n.set(o.id,s)}return n}function zo(e,t,n=Se){const o=new Map(e);for(const s of t){const r=we(s,n);r.size>0?o.set(s.id,r):o.delete(s.id)}return o}function st(e,t){var s,r,i,c,d,u;const{state:n,getNodePorts:o}=X();return l.useMemo(()=>{const p=n.nodes[e];if(!p)return;const h={...p,ports:o(e)};return we(h).get(t)},[(s=n.nodes[e])==null?void 0:s.position.x,(r=n.nodes[e])==null?void 0:r.position.y,(c=(i=n.nodes[e])==null?void 0:i.size)==null?void 0:c.width,(u=(d=n.nodes[e])==null?void 0:d.size)==null?void 0:u.height,e,t,o])}function fe(e,t){const n=st(e,t);return n==null?void 0:n.connectionPoint}function rt(e,t){if(e.ports)return e.ports;const n=t.ports||[],o=e;return n.map(s=>{var c;const r={id:s.id,type:s.type,label:s.label,nodeId:e.id,position:s.position,dataType:s.dataType,maxConnections:s.maxConnections},i=(c=o.portOverrides)==null?void 0:c.find(d=>d.portId===s.id);if(i){if(i.disabled)return null;i.maxConnections!==void 0&&(r.maxConnections=i.maxConnections),i.allowedNodeTypes&&(r.allowedNodeTypes=i.allowedNodeTypes),i.allowedPortTypes&&(r.allowedPortTypes=i.allowedPortTypes)}return r}).filter(s=>s!==null)}function Ro(e,t,n){return rt(e,n).find(s=>s.id===t)}function Ao(e,t){const n=new Map;for(const o of Object.values(e)){const s=t(o.type);if(!s)continue;const r=rt(o,s);for(const i of r){const c=`${o.id}:${i.id}`;n.set(c,{node:o,port:i})}}return n}function Lo(){const e=new Map,t=new Map;return{getNodePorts(n,o){const s=n.id;if(e.has(s))return e.get(s);const r=rt(n,o);return e.set(s,r),r},getPort(n,o,s){const r=`${n.id}:${o}`;if(t.has(r))return t.get(r);const i=Ro(n,o,s);return t.set(r,i),i},createPortLookupMap(n,o){return Ao(n,o)},clearCache(){e.clear(),t.clear()},clearNodeCache(n){e.delete(n);const o=[];t.forEach((s,r)=>{r.startsWith(`${n}:`)&&o.push(r)}),o.forEach(s=>t.delete(s))}}}const Yt={version:2,portsStorageMethod:"inferred"},Vo={version:1,portsStorageMethod:"embedded"};function _o(e){return e.formatVersion?e.formatVersion.portsStorageMethod==="embedded":!0}function $o(e,t){const n=[];let o=0,s=0,r=0;const i={};for(const[d,u]of Object.entries(e.nodes)){if(o++,!u.ports||u.ports.length===0){i[d]=u;continue}const p=t==null?void 0:t.get(u.type);p||n.push(`Node ${d} (type: ${u.type}) has no definition in registry. Ports will be removed without creating overrides.`);const h=[];if(p&&p.ports)for(const g of u.ports){const f=p.ports.find(w=>w.id===g.id);if(!f){n.push(`Port ${g.id} on node ${d} not found in definition. It will be lost during migration.`);continue}const N={portId:g.id};let D=!1;g.maxConnections!==void 0&&g.maxConnections!==f.maxConnections&&(N.maxConnections=g.maxConnections,D=!0),g.allowedNodeTypes&&(N.allowedNodeTypes=g.allowedNodeTypes,D=!0),g.allowedPortTypes&&(N.allowedPortTypes=g.allowedPortTypes,D=!0),D&&(h.push(N),r++)}const{ports:x,...y}=u;s+=x.length;const v={...y,...h.length>0?{portOverrides:h}:{}};i[d]=v}return{data:{nodes:i,connections:e.connections,formatVersion:Yt},statistics:{nodesProcessed:o,portsRemoved:s,portOverridesCreated:r},warnings:n}}function Ho(e,t=!0){if(!t)return{...e,formatVersion:Vo};const n={};for(const[o,s]of Object.entries(e.nodes)){const{ports:r,...i}=s;n[o]=i}return{nodes:n,connections:e.connections,formatVersion:Yt}}function Bo(e,t,n=!0){if(!_o(e)||!n)return{data:e,migrated:!1};const o=$o(e,t);return{data:o.data,migrated:!0,migrationResult:o}}const pt={useInferredPortsOnly:!1,showMigrationWarnings:!0,autoMigrateOnLoad:!0,saveInNewFormat:!0};function Go(){if(typeof process<"u"&&process.env)return{useInferredPortsOnly:process.env.NODE_EDITOR_USE_INFERRED_PORTS_ONLY==="true",showMigrationWarnings:process.env.NODE_EDITOR_SHOW_MIGRATION_WARNINGS!=="false",autoMigrateOnLoad:process.env.NODE_EDITOR_AUTO_MIGRATE!=="false",saveInNewFormat:process.env.NODE_EDITOR_SAVE_NEW_FORMAT!=="false"};if(typeof window<"u"&&window.localStorage)try{const e=window.localStorage.getItem("nodeEditorFeatureFlags");if(e)return{...pt,...JSON.parse(e)}}catch(e){console.warn("Failed to parse feature flags from localStorage",e)}return pt}const ht=(e,t)=>{switch(t.type){case"ADD_NODE":{const n=Pe(),o={...t.payload.node,id:n};return{...e,nodes:{...e.nodes,[n]:o}}}case"UPDATE_NODE":{const{nodeId:n,updates:o}=t.payload,s=e.nodes[n];return s?{...e,nodes:{...e.nodes,[n]:{...s,...o}}}:e}case"DELETE_NODE":{const{nodeId:n}=t.payload,{[n]:o,...s}=e.nodes,r=Object.entries(e.connections).reduce((i,[c,d])=>(d.fromNodeId!==n&&d.toNodeId!==n&&(i[c]=d),i),{});return{...e,nodes:s,connections:r}}case"MOVE_NODE":{const{nodeId:n,position:o}=t.payload,s=e.nodes[n];return s?{...e,nodes:{...e.nodes,[n]:{...s,position:o}}}:e}case"MOVE_NODES":{const{updates:n}=t.payload,o={...e.nodes};return Object.entries(n).forEach(([s,r])=>{const i=o[s];i&&(o[s]={...i,position:r})}),{...e,nodes:o}}case"ADD_CONNECTION":{const{connection:n}=t.payload,o=Pe(),s=Object.entries(e.connections).filter(([i,c])=>c.toNodeId===n.toNodeId&&c.toPortId===n.toPortId),r={...e.connections};return s.forEach(([i])=>{delete r[i]}),{...e,connections:{...r,[o]:{...n,id:o}}}}case"DELETE_CONNECTION":{const{connectionId:n}=t.payload,{[n]:o,...s}=e.connections;return{...e,connections:s}}case"SET_NODE_DATA":return t.payload.data;case"RESTORE_STATE":return t.payload.data;case"DUPLICATE_NODES":{const{nodeIds:n}=t.payload;if(n.length===0)return e;const o={...e.nodes},s=[];return n.forEach(r=>{const i=e.nodes[r];if(!i)return;const c=Pe();s.push(c);const d={...i,id:c,position:{x:i.position.x+50,y:i.position.y+50},data:{...i.data,title:i.data.title?`${i.data.title} Copy`:"Node Copy",createdAt:Date.now()}};d.type==="group"&&(d.children=[]),o[c]=d}),{...e,nodes:o,lastDuplicatedNodeIds:s}}case"GROUP_NODES":{const{nodeIds:n,groupId:o=Pe()}=t.payload;if(n.length===0)return e;let s=1/0,r=1/0,i=-1/0,c=-1/0;n.forEach(u=>{var h,x;const p=e.nodes[u];p&&(s=Math.min(s,p.position.x),r=Math.min(r,p.position.y),i=Math.max(i,p.position.x+(((h=p.size)==null?void 0:h.width)||100)),c=Math.max(c,p.position.y+(((x=p.size)==null?void 0:x.height)||50)))});const d={id:o,type:"group",position:{x:s-20,y:r-40},size:{width:i-s+40,height:c-r+60},data:{title:"Group"},children:n,expanded:!0};return{...e,nodes:{...e.nodes,[o]:d}}}case"UNGROUP_NODE":{const{groupId:n}=t.payload,o=e.nodes[n];if(!o||o.type!=="group")return e;const{[n]:s,...r}=e.nodes;return{...e,nodes:r}}case"UPDATE_GROUP_MEMBERSHIP":{const{updates:n}=t.payload,o={...e.nodes};return Object.entries(n).forEach(([s,r])=>{const i=o[s];i&&(o[s]={...i,...r})}),{...e,nodes:o}}case"MOVE_GROUP_WITH_CHILDREN":{const{groupId:n,delta:o}=t.payload,s={...e.nodes},r=s[n];return r&&(s[n]={...r,position:{x:r.position.x+o.x,y:r.position.y+o.y}},Object.values(s).forEach(i=>{i.parentId===n&&(s[i.id]={...i,position:{x:i.position.x+o.x,y:i.position.y+o.y}})})),{...e,nodes:s}}case"AUTO_LAYOUT":{const{layoutType:n,selectedOnly:o=!1}=t.payload;return o&&(Object.fromEntries(Object.entries(e.nodes).filter(([s,r])=>!0)),e.connections),e}default:return e}};function Pe(){return Math.random().toString(36).slice(2,10)}const gt={nodes:{},connections:{}},ft={addNode:e=>({type:"ADD_NODE",payload:{node:e}}),updateNode:(e,t)=>({type:"UPDATE_NODE",payload:{nodeId:e,updates:t}}),deleteNode:e=>({type:"DELETE_NODE",payload:{nodeId:e}}),moveNode:(e,t)=>({type:"MOVE_NODE",payload:{nodeId:e,position:t}}),moveNodes:e=>({type:"MOVE_NODES",payload:{updates:e}}),addConnection:e=>({type:"ADD_CONNECTION",payload:{connection:e}}),deleteConnection:e=>({type:"DELETE_CONNECTION",payload:{connectionId:e}}),setNodeData:e=>({type:"SET_NODE_DATA",payload:{data:e}}),restoreState:e=>({type:"RESTORE_STATE",payload:{data:e}}),duplicateNodes:e=>({type:"DUPLICATE_NODES",payload:{nodeIds:e}}),groupNodes:(e,t)=>({type:"GROUP_NODES",payload:{nodeIds:e,groupId:t}}),ungroupNode:e=>({type:"UNGROUP_NODE",payload:{groupId:e}}),updateGroupMembership:e=>({type:"UPDATE_GROUP_MEMBERSHIP",payload:{updates:e}}),moveGroupWithChildren:(e,t)=>({type:"MOVE_GROUP_WITH_CHILDREN",payload:{groupId:e,delta:t}}),autoLayout:(e,t)=>({type:"AUTO_LAYOUT",payload:{layoutType:e,selectedOnly:t}})},Wt=l.createContext(null),Kt=({children:e,initialState:t,controlledData:n,onDataChange:o,onLoad:s,onSave:r,settingsManager:i})=>{const c=l.useContext(Ke),d=c==null?void 0:c.registry,u=l.useMemo(()=>Go(),[]),p=l.useMemo(()=>Lo(),[]),h=l.useMemo(()=>({nodes:(t==null?void 0:t.nodes)||gt.nodes,connections:(t==null?void 0:t.connections)||gt.connections}),[t]),[x,y]=l.useReducer(ht,h),v=n||x,g=l.useRef(o);g.current=o;const f=l.useCallback(P=>{if(!n)y(P);else if(g.current){const k=ht(v,P);g.current(k)}},[n,v]),[N,D]=l.useState(!1),[w,E]=l.useState(!1),j=ot(i),{autoSave:m,autoSaveInterval:b}=j;l.useEffect(()=>{s&&!N&&(D(!0),Promise.resolve(s()).then(P=>{const{data:k,migrated:O,migrationResult:L}=Bo(P,d,u.autoMigrateOnLoad);O&&L&&u.showMigrationWarnings&&(console.log("Node editor data migrated successfully:",L.statistics),L.warnings.length>0&&console.warn("Migration warnings:",L.warnings)),f(ft.setNodeData(k))}).catch(P=>{console.error("Failed to load node editor data:",P)}).finally(()=>{D(!1)}))},[u]);const C=l.useCallback(async()=>{if(r&&!w){E(!0);try{const P=Ho(v,u.saveInNewFormat);await Promise.resolve(r(P))}catch(P){console.error("Failed to save node editor data:",P)}finally{E(!1)}}},[r,v,w]);l.useEffect(()=>{if(!m||!r)return;const P=setInterval(()=>{w||C()},b*1e3);return()=>clearInterval(P)},[m,b,C,w]);const I=l.useCallback(P=>{const k=v.nodes[P];if(!k)return[];if(u.useInferredPortsOnly){if(!d)return console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled"),[];const O=d.get(k.type);return O?p.getNodePorts(k,O):(console.warn(`No definition found for node type: ${k.type}`),[])}if(d){const O=d.get(k.type);if(O)return p.getNodePorts(k,O)}return k.ports||[]},[v.nodes,d,p,u.useInferredPortsOnly]),M=l.useCallback((P,k)=>{var L;const O=v.nodes[P];if(O){if(u.useInferredPortsOnly){if(!d){console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled");return}const A=d.get(O.type);if(!A){console.warn(`No definition found for node type: ${O.type}`);return}return p.getPort(O,k,A)}if(d){const A=d.get(O.type);if(A)return p.getPort(O,k,A)}return(L=O.ports)==null?void 0:L.find(A=>A.id===k)}},[v.nodes,d,p,u.useInferredPortsOnly]),V=l.useMemo(()=>{if(u.useInferredPortsOnly)return d?p.createPortLookupMap(v.nodes,P=>d.get(P)):(console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled"),new Map);if(!d){const P=new Map;for(const k of Object.values(v.nodes)){const O=k.ports||[];for(const L of O){const A=`${k.id}:${L.id}`;P.set(A,{node:k,port:L})}}return P}return p.createPortLookupMap(v.nodes,P=>d.get(P))},[v.nodes,d,p,u.useInferredPortsOnly]);l.useEffect(()=>{p.clearCache()},[v.nodes,p]);const S=l.useMemo(()=>({state:v,dispatch:f,actions:ft,isLoading:N,isSaving:w,handleSave:C,getNodePorts:I,getPort:M,portLookupMap:V}),[v,f,N,w,C,I,M,V]);return a.jsx(Wt.Provider,{value:S,children:e})},X=()=>{const e=l.useContext(Wt);if(!e)throw new Error("useNodeEditor must be used within a NodeEditorProvider");return e},Uo=(e,t)=>{switch(t.type){case"PUSH_ENTRY":{if(!e.isRecording)return e;const{action:n,data:o}=t.payload,s={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),action:n,data:JSON.parse(JSON.stringify(o))},c=[...e.entries.slice(0,e.currentIndex+1),s].slice(-e.maxEntries);return{...e,entries:c,currentIndex:c.length-1}}case"UNDO":return e.currentIndex<=0?e:{...e,currentIndex:e.currentIndex-1};case"REDO":return e.currentIndex>=e.entries.length-1?e:{...e,currentIndex:e.currentIndex+1};case"CLEAR_HISTORY":return{...e,entries:[],currentIndex:-1};case"SET_RECORDING":return{...e,isRecording:t.payload.isRecording};case"SET_MAX_ENTRIES":{const{maxEntries:n}=t.payload,o=e.entries.slice(-n);return{...e,maxEntries:n,entries:o,currentIndex:Math.min(e.currentIndex,o.length-1)}}default:return e}},Fo={entries:[],currentIndex:-1,maxEntries:50,isRecording:!0},je={pushEntry:(e,t)=>({type:"PUSH_ENTRY",payload:{action:e,data:t}}),undo:()=>({type:"UNDO"}),redo:()=>({type:"REDO"}),clearHistory:()=>({type:"CLEAR_HISTORY"}),setRecording:e=>({type:"SET_RECORDING",payload:{isRecording:e}}),setMaxEntries:e=>({type:"SET_MAX_ENTRIES",payload:{maxEntries:e}})},Zt=l.createContext(null),qt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(Uo,{...Fo,...t}),s=n.currentIndex>0,r=n.currentIndex<n.entries.length-1,i=n.currentIndex>=0?n.entries[n.currentIndex]:null,c=l.useCallback((h,x)=>{o(je.pushEntry(h,x))},[o]),d=l.useCallback(()=>s?(o(je.undo()),n.entries[n.currentIndex-1]||null):null,[s,n.entries,n.currentIndex,o]),u=l.useCallback(()=>r?(o(je.redo()),n.entries[n.currentIndex+1]||null):null,[r,n.entries,n.currentIndex,o]),p={state:n,dispatch:o,actions:je,canUndo:s,canRedo:r,currentEntry:i,pushEntry:c,undo:d,redo:u};return a.jsx(Zt.Provider,{value:p,children:e})},Xo=()=>{const e=l.useContext(Zt);if(!e)throw new Error("useHistory must be used within a HistoryProvider");return e},Yo=()=>{const{state:e,dispatch:t,actions:n}=X(),{pushEntry:o,undo:s,redo:r,canUndo:i,canRedo:c}=Xo(),d=l.useRef(e),u=l.useRef(null);l.useEffect(()=>{const y=e,v=d.current;if(v===y||JSON.stringify(v)===JSON.stringify(y))return;const g=u.current||"Unknown Action";o(g,v),d.current=y,u.current=null},[e,o]);const p=l.useCallback(y=>{y&&typeof y=="object"&&y.type&&(u.current=y.type),t(y)},[t]),h=l.useCallback(()=>{if(!i)return!1;const y=s();return y?(u.current=null,d.current=y.data,t(n.restoreState(y.data)),!0):!1},[i,s,t,n]),x=l.useCallback(()=>{if(!c)return!1;const y=r();return y?(u.current=null,d.current=y.data,t(n.restoreState(y.data)),!0):!1},[c,r,t,n]);return{dispatchWithHistory:p,performUndo:h,performRedo:x,canUndo:i,canRedo:c}},Wo={iterations:100,springLength:150,springStrength:.3,repulsionStrength:1e3,dampening:.9,maxForce:50,padding:100};function Ko(e,t={}){const n={...Wo,...t},o=Object.values(e.nodes),s=Object.values(e.connections);if(o.length===0)return{nodePositions:{},iterations:0};if(o.length===1)return{nodePositions:{[o[0].id]:{x:0,y:0}},iterations:0};const r={},i={};o.forEach((p,h)=>{if(p.position)r[p.id]={...p.position};else{const x=h/o.length*2*Math.PI,y=Math.sqrt(o.length)*50;r[p.id]={x:Math.cos(x)*y,y:Math.sin(x)*y}}i[p.id]={x:0,y:0}});const c={};o.forEach(p=>{c[p.id]=new Set}),s.forEach(p=>{c[p.fromNodeId]&&c[p.toNodeId]&&(c[p.fromNodeId].add(p.toNodeId),c[p.toNodeId].add(p.fromNodeId))});let d=0;for(let p=0;p<n.iterations;p++){d++;const h={};o.forEach(v=>{h[v.id]={x:0,y:0}});for(let v=0;v<o.length;v++)for(let g=v+1;g<o.length;g++){const f=o[v],N=o[g],D=r[f.id],w=r[N.id],E=w.x-D.x,j=w.y-D.y,m=Math.sqrt(E*E+j*j);if(m<.01)continue;const b=n.repulsionStrength/(m*m),C=E/m*b,I=j/m*b;h[f.id].x-=C,h[f.id].y-=I,h[N.id].x+=C,h[N.id].y+=I}s.forEach(v=>{const g=r[v.fromNodeId],f=r[v.toNodeId];if(!g||!f)return;const N=f.x-g.x,D=f.y-g.y,w=Math.sqrt(N*N+D*D);if(w<.01)return;const E=n.springStrength*(w-n.springLength),j=N/w*E,m=D/w*E;h[v.fromNodeId].x+=j,h[v.fromNodeId].y+=m,h[v.toNodeId].x-=j,h[v.toNodeId].y-=m});let x=0;if(o.forEach(v=>{const g=h[v.id],f=Math.sqrt(g.x*g.x+g.y*g.y);f>n.maxForce&&(g.x=g.x/f*n.maxForce,g.y=g.y/f*n.maxForce),i[v.id].x=i[v.id].x*n.dampening+g.x,i[v.id].y=i[v.id].y*n.dampening+g.y;const N={...r[v.id]};r[v.id].x+=i[v.id].x,r[v.id].y+=i[v.id].y;const D=Math.sqrt(Math.pow(r[v.id].x-N.x,2)+Math.pow(r[v.id].y-N.y,2));x+=D}),x/o.length<.1)break}const u=Object.keys(r);if(u.length>0){let p=1/0,h=-1/0,x=1/0,y=-1/0;u.forEach(f=>{const N=r[f];p=Math.min(p,N.x),h=Math.max(h,N.x),x=Math.min(x,N.y),y=Math.max(y,N.y)});const v=(p+h)/2,g=(x+y)/2;u.forEach(f=>{r[f].x=r[f].x-v+n.padding,r[f].y=r[f].y-g+n.padding})}return{nodePositions:r,iterations:d}}function Zo(e,t={}){const{spacing:n=200,layerHeight:o=150}=t,s=Object.values(e.nodes),r=Object.values(e.connections);if(s.length===0)return{nodePositions:{},iterations:0};const i={},c={};s.forEach(g=>{i[g.id]=new Set,c[g.id]=new Set}),r.forEach(g=>{i[g.fromNodeId]&&c[g.toNodeId]&&(i[g.fromNodeId].add(g.toNodeId),c[g.toNodeId].add(g.fromNodeId))});const d=s.filter(g=>c[g.id].size===0);if(d.length===0){const g=Math.min(...s.map(f=>c[f.id].size));d.push(...s.filter(f=>c[f.id].size===g))}const u=[],p={},h=new Set;u[0]=d.map(g=>g.id),d.forEach(g=>{p[g.id]=0,h.add(g.id)});let x=0;for(;u[x]&&u[x].length>0;){const g=[];if(u[x].forEach(f=>{i[f].forEach(N=>{h.has(N)||(g.push(N),p[N]=x+1,h.add(N))})}),g.length>0)u[x+1]=g,x++;else break}const y=s.filter(g=>!h.has(g.id));y.length>0&&(u[x+1]||(u[x+1]=[]),u[x+1].push(...y.map(g=>g.id)),y.forEach(g=>{p[g.id]=x+1}));const v={};return u.forEach((g,f)=>{const N=f*o,w=-((g.length-1)*n)/2;g.forEach((E,j)=>{v[E]={x:w+j*n,y:N}})}),{nodePositions:v,iterations:u.length}}function qo(e,t={}){const{spacing:n=200,columns:o}=t,s=Object.values(e.nodes);if(s.length===0)return{nodePositions:{},iterations:0};const r=o||Math.ceil(Math.sqrt(s.length)),i=Math.ceil(s.length/r),c={};return s.forEach((d,u)=>{const p=Math.floor(u/r),h=u%r,x=(r-1)*n,y=(i-1)*n;c[d.id]={x:h*n-x/2,y:p*n-y/2}}),{nodePositions:c,iterations:0}}const Jo=()=>{const{state:e,dispatch:t,actions:n}=X(),{state:o}=W(),s=l.useCallback((d=!1)=>{console.log("Applying force-directed layout");const p={nodes:d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,connections:e.connections},h=Ko(p,{iterations:150,springLength:200,springStrength:.4,repulsionStrength:2e3,dampening:.85});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]),r=l.useCallback((d=!1)=>{console.log("Applying hierarchical layout");const p={nodes:d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,connections:e.connections},h=Zo(p,{spacing:250,layerHeight:200});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]),i=l.useCallback((d=!1)=>{console.log("Applying grid layout");const u=d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,p={nodes:u,connections:e.connections},h=qo(p,{spacing:250,columns:Math.ceil(Math.sqrt(Object.keys(u).length))});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]);return{applyLayout:l.useCallback((d,u=!1)=>{switch(d){case"force":s(u);break;case"hierarchical":r(u);break;case"grid":i(u);break;default:console.warn(`Unknown layout type: ${d}`)}},[s,r,i]),applyForceLayout:s,applyHierarchicalLayout:r,applyGridLayout:i}},Qo=()=>{const{state:e,dispatch:t,actions:n}=X(),{state:o,dispatch:s,actions:r}=W(),{performUndo:i,performRedo:c,canUndo:d,canRedo:u}=Yo(),{applyLayout:p}=Jo();ie({key:"Delete"},l.useCallback(()=>{console.log("Delete shortcut triggered"),o.selectedNodeIds.length>0?(o.selectedNodeIds.forEach(h=>{t(n.deleteNode(h))}),s(r.clearSelection())):o.selectedConnectionIds.length>0&&(o.selectedConnectionIds.forEach(h=>{t(n.deleteConnection(h))}),s(r.clearSelection()))},[o.selectedNodeIds,o.selectedConnectionIds,t,n,s,r])),ie({key:"Backspace"},l.useCallback(()=>{console.log("Backspace shortcut triggered"),o.selectedNodeIds.length>0?(o.selectedNodeIds.forEach(h=>{t(n.deleteNode(h))}),s(r.clearSelection())):o.selectedConnectionIds.length>0&&(o.selectedConnectionIds.forEach(h=>{t(n.deleteConnection(h))}),s(r.clearSelection()))},[o.selectedNodeIds,o.selectedConnectionIds,t,n,s,r])),ie({key:"a",ctrl:!0},l.useCallback(()=>{console.log("Select All shortcut triggered");const h=Object.keys(e.nodes);s(r.selectAllNodes(h))},[e.nodes,s,r])),ie({key:"Escape"},l.useCallback(()=>{console.log("Escape shortcut triggered"),s(r.clearSelection())},[s,r])),ie({key:"n",ctrl:!0},l.useCallback(()=>{console.log("Add Node shortcut triggered");const h=`node-${Date.now()}`,x={title:"New Node",type:"default",position:{x:100,y:100},data:{title:"New Node"},ports:[{id:`port-input-${Date.now()}`,type:"input",label:"Input",position:"left",nodeId:h},{id:`port-output-${Date.now()}`,type:"output",label:"Output",position:"right",nodeId:h}]};t(n.addNode(x))},[t,n])),ie({key:"d",ctrl:!0},l.useCallback(()=>{console.log("Duplicate shortcut triggered"),o.selectedNodeIds.length>0&&t(n.duplicateNodes(o.selectedNodeIds))},[o.selectedNodeIds,t,n])),l.useEffect(()=>{e.lastDuplicatedNodeIds&&e.lastDuplicatedNodeIds.length>0&&(s(r.selectAllNodes(e.lastDuplicatedNodeIds)),t(n.setNodeData({...e,lastDuplicatedNodeIds:void 0})))},[e.lastDuplicatedNodeIds,s,r,t,n,e]),ie({key:"s",ctrl:!0},l.useCallback(h=>{console.log("Save shortcut triggered"),console.log("Save not yet implemented")},[])),ie({key:"l",ctrl:!0},l.useCallback(()=>{console.log("Auto Layout shortcut triggered");const h=o.selectedNodeIds.length>0;p("force",h)},[o.selectedNodeIds,p])),ie({key:"z",ctrl:!0},l.useCallback(()=>{console.log("Undo shortcut triggered"),d&&i()},[d,i])),ie({key:"z",ctrl:!0,shift:!0},l.useCallback(()=>{console.log("Redo shortcut triggered"),u&&c()},[u,c])),ie({key:"y",ctrl:!0},l.useCallback(()=>{console.log("Redo (Ctrl+Y) shortcut triggered"),u&&c()},[u,c]))},es="xtnnddtrnodedibas",ts="xtnnddtrcnt",ns="xtnnddtrcanvas",os="xtnnddtrpanning",ss="xtnnddtrspapan",rs="xtnnddtrnodes",is="xtnnddtrnode",as="xtnnddtrlocked",cs="xtnnddtrsel",ds="xtnnddtrdrg",ls="xtnnddtrnodehdr",us="xtnnddtrintdra",ps="xtnnddtrnod",hs="xtnnddtrlockico",gs="xtnnddtrnodectn",fs="xtnnddtrgrpNode",ms="xtnnddtrcold",ys="xtnnddtrgrpcold",xs="xtnnddtrgrpexped",vs="xtnnddtrnodeinf",Ns="xtnnddtrnodesuc",bs="xtnnddtrnodewrn",Cs="xtnnddtrnodeerr",Ss="xtnnddtrnodedis",ws="xtnnddtrtbr",Es="xtnnddtrtoolbtn",Is="xtnnddtrconmen",Ds="xtnnddtrconmenrax",Ps="xtnnddtrgrid",js="xtnnddtrins",ks="xtnnddtrinscIz",Ts="xtnnddtrinszAn",Os="xtnnddtrinssec",Ms="xtnnddtrinsrow",zs="xtnnddtrediwitins",Rs="xtnnddtredimai",As="xtnnddtrextdat",Ls="xtnnddtrdragui",Vs="xtnnddtrdraguiVp7",_s="xtnnddtrdraguiPHl",$s="xtnnddtrdragui-eW",Hs="xtnnddtrsnatar",Bs="xtnnddtrdis",Gs="xtnnddtrdislin",Us="xtnnddtrstabar",Fs="xtnnddtrstasec",Xs="xtnnddtrsta",Ys="xtnnddtrstaval",Ws="xtnnddtrstamod",Ks="xtnnddtrnodePort",Zs="xtnnddtrportinp",qs="xtnnddtrporout",Js="xtnnddtrporinn",Qs="xtnnddtrportlbl",er="xtnnddtrportLeft",tr="xtnnddtrporrig",nr="xtnnddtrportTop",or="xtnnddtrporbot",sr="xtnnddtrcon",rr="xtnnddtrinstab",ir="xtnnddtrinstab5EW",ar="xtnnddtract",cr="xtnnddtrinsnopad",dr="xtnnddtrinsfie",lr="xtnnddtrinsj42",ur="xtnnddtrinskYN",pr="xtnnddtrinspos",hr="xtnnddtrinsnum",gr="xtnnddtrinsreaonlfie",fr="xtnnddtrinssta",mr="xtnnddtrcan",yr="xtnnddtrboxsel",xr="xtnnddtrgridSvg",vr="xtnnddtredi",Nr="xtnnddtrediA9y",br="xtnnddtrediPTx",Cr="xtnnddtredi-tX",Sr="xtnnddtrtoptbr",wr="xtnnddtrnodlay",Er="xtnnddtrnodeView",Ir="xtnnddtrnodtit",Dr="xtnnddtrnodtitpsF",Pr="xtnnddtrgrpaccdro",jr="xtnnddtrgrpPulse",kr="xtnnddtrgrphaschi",Tr="xtnnddtrnodpor",Or="xtnnddtrport",Mr="xtnnddtrporhov",zr="xtnnddtrporcon",Rr="xtnnddtrpulse",Ar="xtnnddtrporcon7Fy",Lr="xtnnddtrporlef",Vr="xtnnddtrporrigtpL",_r="xtnnddtrportop",$r="xtnnddtrporbotsMk",Hr="xtnnddtrconlay",Br="xtnnddtrconhUO",Gr="xtnnddtrcongay",Ur="xtnnddtrconhov",Fr="xtnnddtrconDHx",Xr="xtnnddtrdracon",Yr="xtnnddtrdasani",Wr="xtnnddtrselbox",Kr="xtnnddtrseldzq",Zr="xtnnddtrldgovr",qr="xtnnddtrldgind",Jr="xtnnddtrcusnod",Qr="xtnnddtrres",ei="xtnnddtrresVnb",ti="xtnnddtrmin",ni="xtnnddtrminimap",oi="xtnnddtrmintit",si="xtnnddtrminont",ri="xtnnddtrminvie",ii="xtnnddtrminnod",ai="xtnnddtrdarthe",ci="xtnnddtrsmoani",di="xtnnddtrstasav",li="xtnnddtruiovrcnt",T={nodeEditorBase:es,container:ts,canvas:ns,panning:os,spacePanning:ss,nodes:rs,node:is,locked:as,selected:cs,dragging:ds,nodeHeader:ls,interactiveDragHandle:us,nodeHeaderInput:ps,lockIcon:hs,nodeContent:gs,groupNode:fs,collapsed:ms,groupCollapsed:ys,groupExpanded:xs,nodeInfo:vs,nodeSuccess:Ns,nodeWarning:bs,nodeError:Cs,nodeDisabled:Ss,toolbar:ws,toolButton:Es,contextMenu:Is,contextMenuItem:Ds,grid:Ps,inspectorPanel:js,inspectorHeader:ks,inspectorContent:Ts,inspectorSection:Os,inspectorRow:Ms,editorWithInspector:zs,editorMain:Rs,externalDataInfo:As,dragGuides:Ls,dragGuide:Vs,dragGuideVertical:_s,dragGuideHorizontal:$s,snapTarget:Hs,distanceIndicator:Bs,distanceLine:Gs,statusBar:Us,statusSection:Fs,statusLabel:Xs,statusValue:Ys,statusMode:Ws,nodePort:Ks,portInput:Zs,portOutput:qs,portInner:Js,portLabel:Qs,portLeft:er,portRight:tr,portTop:nr,portBottom:or,connections:sr,inspectorTabs:rr,inspectorTab:ir,active:ar,inspectorContentNoPadding:cr,inspectorField:dr,inspectorInput:lr,inspectorTextarea:ur,inspectorPositionInputs:pr,inspectorNumberInput:hr,inspectorReadOnlyField:gr,inspectorEmptyState:fr,canvasContainer:mr,boxSelecting:yr,gridSvg:xr,editorLayout:vr,editorToolbar:Nr,editorContent:br,editorSidebar:Cr,topToolbar:Sr,nodeLayer:wr,nodeView:Er,nodeTitle:Ir,nodeTitleInput:Dr,groupAcceptingDrop:Pr,groupPulse:jr,groupHasChildren:kr,nodePorts:Tr,port:Or,portHovered:Mr,portConnecting:zr,pulse:Rr,portConnected:Ar,portLabelLeft:Lr,portLabelRight:Vr,portLabelTop:_r,portLabelBottom:$r,connectionLayer:Hr,connectionGroup:Br,connectionSelected:Gr,connectionHovered:Ur,connectionDragging:Fr,dragConnection:Xr,dashAnimation:Yr,selectionBoxOverlay:Wr,selectionOverlay:Kr,loadingOverlay:Zr,loadingIndicator:qr,customNodeContent:Jr,resizeHandle:Qr,resizeHandleActive:ei,minimapContainer:ti,minimap:ni,minimapTitle:oi,minimapContent:si,minimapViewport:ri,minimapNodes:ii,darkTheme:ai,smoothAnimations:ci,statusSaving:di,uiOverlayContainer:li},Jt=({children:e,className:t,style:n})=>(Qo(),a.jsx("div",{className:_.classNames(T.nodeEditorBase,t),style:n,tabIndex:0,children:e}));Jt.displayName="NodeEditorBase";function Qt(e,t){const n=Me((e==null?void 0:e.type)||""),[o,s]=l.useState({data:void 0,isLoading:!1,error:null}),r=l.useCallback(async()=>{if(!(!e||!t||!(n!=null&&n.loadExternalData))){s(c=>({...c,isLoading:!0,error:null}));try{const c=await Promise.resolve(n.loadExternalData(t));s({data:c,isLoading:!1,error:null})}catch(c){s({data:void 0,isLoading:!1,error:c instanceof Error?c:new Error(String(c))})}}},[e,t,n]);l.useEffect(()=>{r()},[r]);const i=l.useCallback(async c=>{if(!e||!t||!(n!=null&&n.updateExternalData))throw new Error("Cannot update external data: missing requirements");s(d=>({...d,isLoading:!0,error:null}));try{await Promise.resolve(n.updateExternalData(t,c)),s({data:c,isLoading:!1,error:null})}catch(d){throw s(u=>({...u,isLoading:!1,error:d instanceof Error?d:new Error(String(d))})),d}},[e,t,n]);return{...o,refresh:r,update:i}}const en=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M3 2v20h2V2H3zm4 5v2h14V7H7zm0 4v2h10v-2H7zm0 4v2h14v-2H7z"})});en.displayName="AlignLeftIcon";const tn=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M5 7v2h14V7H5zm2 4v2h10v-2H7zm-2 4v2h14v-2H5z"})});tn.displayName="AlignCenterIcon";const nn=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M19 2v20h2V2h-2zM3 7v2h14V7H3zm4 4v2h10v-2H7zm-4 4v2h14v-2H3z"})});nn.displayName="AlignRightIcon";const on=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M2 3v2h20V3H2zm5 4v14h2V7H7zm4 0v10h2V7h-2zm4 0v14h2V7h-2z"})});on.displayName="AlignTopIcon";const sn=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M7 5v14h2V5H7zm4 2v10h2V7h-2zm4-2v14h2V5h-2zM2 11v2h20v-2H2z"})});sn.displayName="AlignMiddleIcon";const rn=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M7 3v14h2V3H7zm4 4v10h2V7h-2zm4-4v14h2V3h-2zM2 19v2h20v-2H2z"})});rn.displayName="AlignBottomIcon";const an=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M4 6v12h3V6H4zm6.5 2v8h3V8h-3zM17 6v12h3V6h-3zM2 3v18h2V3H2zm18 0v18h2V3h-2z"})});an.displayName="DistributeHorizontalIcon";const cn=({size:e,className:t})=>a.jsx("svg",{className:t,fill:"currentColor",width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M6 4h12v3H6V4zm2 6.5h8v3H8v-3zM6 17h12v3H6v-3zM3 2h18v2H3V2zm0 18h18v2H3v-2z"})});cn.displayName="DistributeVerticalIcon";const ui="xtnnddtralncon",pi="xtnnddtralnlbl",hi="xtnnddtralnGrid",gi="xtnnddtralnbtn",ke={alignmentControls:ui,alignmentLabel:pi,alignmentGrid:hi,alignmentButton:gi},dn=l.memo(({value:e,onChange:t,style:n,type:o="text",placeholder:s,id:r,name:i,"aria-label":c})=>a.jsx(_.Input,{type:o,value:e,onChange:d=>t(d.target.value),style:n,placeholder:s,id:r,name:i,"aria-label":c}));dn.displayName="InspectorInput";const ln=l.memo(({value:e,onChange:t,style:n,id:o,name:s,"aria-label":r})=>a.jsx("textarea",{value:e,onChange:i=>t(i.target.value),style:n,id:o,name:s,"aria-label":r}));ln.displayName="InspectorTextarea";const be=l.memo(({value:e,onChange:t,label:n,id:o,name:s,"aria-label":r})=>{const i={display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",padding:"4px 8px",fontSize:"12px"},c={color:"#666",fontSize:"11px",fontWeight:500,minWidth:"12px",textAlign:"center"},d={border:"none",background:"transparent",fontSize:"12px",outline:"none",width:"100%",textAlign:"right"};return a.jsxs("div",{style:i,children:[a.jsx("span",{style:c,children:n}),a.jsx(_.Input,{type:"number",value:e,onChange:u=>t(Number(u.target.value)),style:d,id:o,name:s,"aria-label":r})]})});be.displayName="InspectorNumberInput";const Fe=l.memo(({checked:e,onChange:t,label:n,id:o,name:s})=>a.jsxs("label",{htmlFor:o,style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e,onChange:r=>t(r.target.checked),id:o,name:s}),a.jsx("span",{style:{fontSize:"13px"},children:n})]}));Fe.displayName="InspectorCheckbox";const un=l.memo(({selectedNodes:e,onAlign:t})=>{const n=e.length<2,o=[{type:"align-left",icon:en,title:"Align Left"},{type:"align-center-horizontal",icon:tn,title:"Align Center Horizontal"},{type:"align-right",icon:nn,title:"Align Right"},{type:"align-top",icon:on,title:"Align Top"},{type:"align-center-vertical",icon:sn,title:"Align Center Vertical"},{type:"align-bottom",icon:rn,title:"Align Bottom"},{type:"distribute-horizontal",icon:an,title:"Distribute Horizontally"},{type:"distribute-vertical",icon:cn,title:"Distribute Vertically"}];return a.jsxs("div",{className:ke.alignmentControls,children:[a.jsxs(_.Label,{className:ke.alignmentLabel,children:["Alignment ",e.length>1?`(${e.length} nodes)`:"(select 2+ nodes)",":"]}),a.jsx("div",{className:ke.alignmentGrid,children:o.map(s=>{const r=s.icon;return a.jsx(_.Button,{onClick:()=>!n&&t(s.type),className:ke.alignmentButton,title:n?"Select 2 or more nodes to enable alignment":s.title,disabled:n,children:a.jsx(r,{size:14})},s.type)})})]})});un.displayName="AlignmentControls";const pn=l.memo(({node:e,onUpdateNode:t,onDeleteNode:n,selectedNodes:o=[],onAlignNodes:s})=>{var N,D;const r=l.useMemo(()=>({width:"100%",padding:"4px 8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px"}),[]),i=l.useMemo(()=>({display:"block",marginBottom:"4px",fontSize:"12px",fontWeight:500,color:"#666"}),[]),c=l.useCallback(w=>{t({data:{...e.data,title:w}})},[e.data,t]),d=l.useCallback(w=>{t({data:{...e.data,content:w}})},[e.data,t]),u=l.useCallback(w=>{t({position:{...e.position,x:w}})},[e.position,t]),p=l.useCallback(w=>{t({position:{...e.position,y:w}})},[e.position,t]),h=l.useCallback(w=>{var E;t({size:{...e.size,width:w,height:((E=e.size)==null?void 0:E.height)??0}})},[e.size,t]),x=l.useCallback(w=>{var E;t({size:{...e.size,height:w,width:((E=e.size)==null?void 0:E.width)??0}})},[e.size,t]),y=l.useCallback(w=>{t({locked:w})},[t]),v=l.useCallback(w=>{t({visible:w})},[t]),g=l.useCallback(w=>{!s||o.length<2||s(w,o)},[s,o]),f=l.useMemo(()=>({...r,minHeight:"60px",resize:"vertical"}),[r]);return l.useMemo(()=>({...r,width:"50%"}),[r]),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[a.jsx("h4",{style:{margin:0,fontSize:"14px"},children:"Node Properties"}),a.jsxs("div",{children:[a.jsx(_.Label,{htmlFor:`node-${e.id}-title`,style:i,children:"Title:"}),a.jsx(dn,{id:`node-${e.id}-title`,name:"nodeTitle",value:e.data.title||"",onChange:c,style:r})]}),e.data.content!==void 0&&a.jsxs("div",{children:[a.jsx(_.Label,{htmlFor:`node-${e.id}-content`,style:i,children:"Content:"}),a.jsx(ln,{id:`node-${e.id}-content`,name:"nodeContent",value:String(e.data.content)||"",onChange:d,style:f})]}),a.jsx(un,{selectedNodes:o,onAlign:g}),a.jsxs("div",{children:[a.jsx(_.Label,{style:i,children:"Position & Size:"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px"},children:[a.jsx(be,{label:"X",value:e.position.x,onChange:u,id:`node-${e.id}-pos-x`,name:"nodePosX","aria-label":"X position"}),a.jsx(be,{label:"Y",value:e.position.y,onChange:p,id:`node-${e.id}-pos-y`,name:"nodePosY","aria-label":"Y position"}),a.jsx(be,{label:"W",value:((N=e.size)==null?void 0:N.width)||100,onChange:h,id:`node-${e.id}-width`,name:"nodeWidth","aria-label":"Width"}),a.jsx(be,{label:"H",value:((D=e.size)==null?void 0:D.height)||100,onChange:x,id:`node-${e.id}-height`,name:"nodeHeight","aria-label":"Height"})]})]}),a.jsxs("div",{children:[a.jsx(_.Label,{style:i,children:"Type:"}),a.jsx("div",{style:{padding:"4px 8px",backgroundColor:"#f5f5f5",borderRadius:"4px",fontSize:"13px"},children:e.type})]}),e.type==="group"&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[a.jsx(Fe,{checked:e.locked||!1,onChange:y,label:"Lock Layer"}),a.jsx(Fe,{checked:e.visible!==!1,onChange:v,label:"Visible"})]}),a.jsx("div",{style:{paddingTop:"16px",borderTop:"1px solid #eee"},children:a.jsx(_.Button,{onClick:n,style:{width:"100%"},variant:"danger",children:"Delete Node"})})]})});pn.displayName="DefaultInspectorRenderer";function hn(e){var o,s;const t=((o=e.size)==null?void 0:o.width)||100,n=((s=e.size)==null?void 0:s.height)||100;return{left:e.position.x,top:e.position.y,right:e.position.x+t,bottom:e.position.y+n,width:t,height:n,centerX:e.position.x+t/2,centerY:e.position.y+n/2}}function fi(e){if(e.length===0)return null;const t=e.map(hn),n=Math.min(...t.map(i=>i.left)),o=Math.min(...t.map(i=>i.top)),s=Math.max(...t.map(i=>i.right)),r=Math.max(...t.map(i=>i.bottom));return{left:n,top:o,right:s,bottom:r,width:s-n,height:r-o,centerX:n+(s-n)/2,centerY:o+(r-o)/2}}function gn(e,t){if(e.length<2)return{};const n={},o=e.map(r=>({node:r,bounds:hn(r)})),s=fi(e);if(!s)return{};switch(t){case"align-left":{const r=Math.min(...o.map(i=>i.bounds.left));o.forEach(({node:i})=>{n[i.id]={x:r,y:i.position.y}});break}case"align-center-horizontal":{o.forEach(({node:r,bounds:i})=>{const c=s.centerX-i.width/2;n[r.id]={x:c,y:r.position.y}});break}case"align-right":{const r=Math.max(...o.map(i=>i.bounds.right));o.forEach(({node:i,bounds:c})=>{const d=r-c.width;n[i.id]={x:d,y:i.position.y}});break}case"align-top":{const r=Math.min(...o.map(i=>i.bounds.top));o.forEach(({node:i})=>{n[i.id]={x:i.position.x,y:r}});break}case"align-center-vertical":{o.forEach(({node:r,bounds:i})=>{const c=s.centerY-i.height/2;n[r.id]={x:r.position.x,y:c}});break}case"align-bottom":{const r=Math.max(...o.map(i=>i.bounds.bottom));o.forEach(({node:i,bounds:c})=>{const d=r-c.height;n[i.id]={x:i.position.x,y:d}});break}case"distribute-horizontal":{if(e.length<3)break;const r=o.sort((p,h)=>p.bounds.left-h.bounds.left),i=r[0],u=(r[r.length-1].bounds.left-i.bounds.left)/(r.length-1);r.forEach(({node:p},h)=>{if(h===0||h===r.length-1)n[p.id]={x:p.position.x,y:p.position.y};else{const x=i.bounds.left+u*h;n[p.id]={x,y:p.position.y}}});break}case"distribute-vertical":{if(e.length<3)break;const r=o.sort((p,h)=>p.bounds.top-h.bounds.top),i=r[0],u=(r[r.length-1].bounds.top-i.bounds.top)/(r.length-1);r.forEach(({node:p},h)=>{if(h===0||h===r.length-1)n[p.id]={x:p.position.x,y:p.position.y};else{const x=i.bounds.top+u*h;n[p.id]={x:p.position.x,y:x}}});break}}return n}const it=l.memo(({node:e})=>{const{state:t,dispatch:n,actions:o}=X(),{state:s}=W(),r=Me(e.type),i=Ze(e.id),c=Qt(e,i),d=l.useCallback(v=>{n(o.updateNode(e.id,v))},[e.id,n,o]),u=l.useCallback(async v=>{c.update&&await c.update(v)},[c.update]),p=l.useCallback(()=>{n(o.deleteNode(e.id))},[e.id,n,o]),h=s.selectedNodeIds.map(v=>t.nodes[v]).filter(Boolean),x=l.useCallback((v,g)=>{const f=gn(g,v);Object.keys(f).length>0&&n(o.moveNodes(f))},[n,o]),y=l.useMemo(()=>({node:e,externalData:c.data,isLoadingExternalData:c.isLoading,externalDataError:c.error,onUpdateNode:d,onUpdateExternalData:u,onDeleteNode:p,selectedNodes:h,onAlignNodes:x}),[e,c.data,c.isLoading,c.error,d,u,p,h,x]);return a.jsxs(a.Fragment,{children:[(r==null?void 0:r.renderInspector)&&a.jsx("div",{style:{marginBottom:"16px"},children:r.renderInspector(y)}),a.jsx(pn,{...y})]})},(e,t)=>e.node.id===t.node.id&&e.node.type===t.node.type&&e.node.data===t.node.data&&e.node.position===t.node.position&&e.node.locked===t.node.locked&&e.node.visible===t.node.visible);it.displayName="NodeInspector";const fn=(e,t)=>{const n=t.find(o=>o.type===e);return n!=null&&n.icon?n.icon:mi(e)},mi=e=>{switch(e){case"group":return"";case"input":return"";case"output":return"";case"process":return"";case"code-editor":return"";case"chart":return"";case"form-builder":return"";case"task":return"";case"standard":return"";default:return""}},yi="xtnnddtrnodtrelis",xi="xtnnddtrhdr",vi="xtnnddtrtitle",Ni="xtnnddtrnodcouU5z",bi="xtnnddtrtreecnt",Ci="xtnnddtrempState",Si="xtnnddtrtreeitm",wi="xtnnddtrseligQ",Ei="xtnnddtrnodeNamegua",Ii="xtnnddtrnodeicovQJ",Di="xtnnddtrexpbtn",Pi="xtnnddtrvis",ji="xtnnddtrdel",ki="xtnnddtrdrgvgz",Ti="xtnnddtrdraoveins",Oi="xtnnddtrdropind",Mi="xtnnddtrdropul",J={nodeTreeList:yi,header:xi,title:vi,nodeCount:Ni,treeContainer:bi,emptyState:Ci,treeItem:Si,selected:wi,nodeName:Ei,nodeIcon:Ii,expandButton:Di,visibilityButton:Pi,deleteButton:ji,dragging:ki,dragOverInside:Ti,dropIndicator:Oi,dropIndicatorPulse:Mi},zi=({node:e,level:t,isSelected:n,onSelect:o,onToggleVisibility:s,onToggleExpand:r,onDeleteNode:i,childNodes:c,dragState:d,onNodeDrop:u,onDragStateChange:p})=>{var V;const h=ze(),x=e.type==="group"&&c.length>0,y=e.type==="group"&&e.expanded!==!1,v=e.type==="group",g=d.draggingNodeId===e.id,f=d.dragOverNodeId===e.id,N=f?d.dragOverPosition:null,D=S=>{S.stopPropagation(),o(e.id,S.ctrlKey||S.metaKey)},w=S=>{S.stopPropagation(),r&&x&&r(e.id)},E=S=>{S.stopPropagation(),s&&s(e.id)},j=S=>{S.stopPropagation(),i&&i(e.id)},m=S=>{S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("nodeId",e.id),p({draggingNodeId:e.id})},b=()=>{p({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null})},C=S=>{if(S.preventDefault(),S.stopPropagation(),d.draggingNodeId===e.id)return;const P=S.currentTarget.getBoundingClientRect(),k=S.clientY-P.top,O=P.height;let L;v&&k>O*.25&&k<O*.75?L="inside":k<O/2?L="before":L="after",(d.dragOverNodeId!==e.id||d.dragOverPosition!==L)&&p({dragOverNodeId:e.id,dragOverPosition:L})},I=S=>{S.currentTarget===S.target&&p({dragOverNodeId:null,dragOverPosition:null})},M=S=>{S.preventDefault(),S.stopPropagation();const P=S.dataTransfer.getData("nodeId");P&&d.dragOverPosition&&u(P,e.id,d.dragOverPosition),p({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null})};return a.jsxs(a.Fragment,{children:[f&&N==="before"&&a.jsx("div",{className:J.dropIndicator,style:{marginLeft:`${t*16+8}px`}}),a.jsxs("div",{className:`${J.treeItem} ${n?J.selected:""} ${g?J.dragging:""} ${f&&N==="inside"?J.dragOverInside:""}`,style:{paddingLeft:`${t*16+8}px`},onClick:D,draggable:!0,onDragStart:m,onDragEnd:b,onDragOver:C,onDragLeave:I,onDrop:M,children:[x&&a.jsx("button",{className:J.expandButton,onClick:w,"aria-label":y?"Collapse":"Expand",children:a.jsx("svg",{width:"8",height:"8",viewBox:"0 0 8 8",fill:"currentColor",style:{transform:y?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s"},children:a.jsx("path",{d:"M2 1l4 3-4 3V1z"})})}),a.jsx("span",{className:J.nodeIcon,children:fn(e.type,h)}),a.jsx("span",{className:J.nodeName,children:((V=e.data)==null?void 0:V.title)||e.type}),a.jsx("button",{className:J.visibilityButton,onClick:E,"aria-label":e.visible!==!1?"Hide":"Show",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:e.visible!==!1?a.jsx("path",{d:"M8 3C4.5 3 1.73 5.11 1 8c.73 2.89 3.5 5 7 5s6.27-2.11 7-5c-.73-2.89-3.5-5-7-5zm0 8.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0-5.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"}):a.jsxs(a.Fragment,{children:[a.jsx("path",{d:"M8 3C4.5 3 1.73 5.11 1 8c.73 2.89 3.5 5 7 5s6.27-2.11 7-5c-.73-2.89-3.5-5-7-5zm0 8.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0-5.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4z",opacity:"0.3"}),a.jsx("path",{d:"M2 2l12 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})}),a.jsx("button",{className:J.deleteButton,onClick:j,"aria-label":"Delete node",children:a.jsx(_.CloseIcon,{size:12})})]}),x&&y&&c.map(S=>a.jsx(mn,{nodeId:S.id,level:t+1,dragState:d,onNodeDrop:u,onDragStateChange:p},S.id)),f&&N==="after"&&a.jsx("div",{className:J.dropIndicator,style:{marginLeft:`${t*16+8}px`}})]})},mn=({nodeId:e,level:t,dragState:n,onNodeDrop:o,onDragStateChange:s})=>{const{state:r,dispatch:i,actions:c}=X(),{state:d,dispatch:u,actions:p}=W(),h=r.nodes[e];if(!h)return null;const x=d.selectedNodeIds.includes(e),y=Object.values(r.nodes).filter(D=>D.parentId===e),v=l.useCallback((D,w)=>{u(p.selectNode(D,w))},[u,p]),g=l.useCallback(D=>{const w=r.nodes[D];w&&i(c.updateNode(D,{visible:w.visible===!1}))},[r.nodes,i,c]),f=l.useCallback(D=>{const w=r.nodes[D];w&&w.type==="group"&&i(c.updateNode(D,{expanded:!w.expanded}))},[r.nodes,i,c]),N=l.useCallback(D=>{i(c.deleteNode(D))},[i,c]);return a.jsx(zi,{node:h,level:t,isSelected:x,onSelect:v,onToggleVisibility:g,onToggleExpand:f,onDeleteNode:N,childNodes:y,dragState:n,onNodeDrop:o,onDragStateChange:s})},Ri=({className:e})=>{const{state:t,dispatch:n,actions:o}=X(),{dispatch:s,actions:r}=W(),[i,c]=l.useState({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null}),d=l.useMemo(()=>Object.values(t.nodes).filter(y=>!y.parentId),[t.nodes]),u=l.useMemo(()=>[...d].sort((y,v)=>{var N,D;if(y.type==="group"&&v.type!=="group")return-1;if(y.type!=="group"&&v.type==="group")return 1;const g=((N=y.data)==null?void 0:N.title)||y.type,f=((D=v.data)==null?void 0:D.title)||v.type;return g.localeCompare(f)}),[d]),p=l.useCallback(()=>{s(r.clearSelection())},[s,r]),h=l.useCallback(y=>{c(v=>({...v,...y}))},[]),x=l.useCallback((y,v,g)=>{const f=t.nodes[y],N=t.nodes[v];if(!f||!N)return;const D=(w,E)=>{const j=t.nodes[w];return j?j.parentId===E?!0:j.parentId?D(j.parentId,E):!1:!1};if(!(y===v||D(v,y)))if(g==="inside"&&N.type==="group")n(o.updateNode(y,{parentId:v})),N.expanded||n(o.updateNode(v,{expanded:!0}));else{const w=N.parentId||void 0;n(o.updateNode(y,{parentId:w}))}},[t.nodes,n,o]);return a.jsxs("div",{className:`${J.nodeTreeList} ${e||""}`,children:[a.jsxs("div",{className:J.header,children:[a.jsx("h3",{className:J.title,children:"Layers"}),a.jsxs("div",{className:J.nodeCount,children:[Object.keys(t.nodes).length," nodes"]})]}),a.jsx("div",{className:J.treeContainer,onClick:p,children:u.length===0?a.jsx("div",{className:J.emptyState,children:"No nodes yet"}):u.map(y=>a.jsx(mn,{nodeId:y.id,level:0,dragState:i,onNodeDrop:x,onDragStateChange:h},y.id))})]})},at=({className:e})=>{var y,v;const{state:t,actions:n,dispatch:o}=X(),{state:s}=W(),{state:r,dispatch:i,actions:c}=ne(),[d,u]=l.useState(0),p=["Layers","Properties"],h=s.selectedNodeIds.length>0?t.nodes[s.selectedNodeIds[0]]:null;s.selectedNodeIds.map(g=>t.nodes[g]).filter(Boolean);const x=s.selectedConnectionIds.length>0?t.connections[s.selectedConnectionIds[0]]:null;return l.useCallback((g,f)=>{const N=gn(f,g);Object.keys(N).length>0&&o(n.moveNodes(N))},[o,n]),a.jsxs("div",{className:_.classNames(T.inspectorPanel,e),children:[a.jsx("div",{className:T.inspectorHeader,children:a.jsx(_.Toolbar.Body,{children:a.jsx(_.Toolbar.SegmentedControl,{items:p,defaultSelected:d,onSelect:u})})}),a.jsx("div",{className:_.classNames(T.inspectorContent,d===0&&T.inspectorContentNoPadding),children:d===0?a.jsx(Ri,{}):a.jsxs(a.Fragment,{children:[h&&a.jsx("div",{className:T.inspectorSection,children:a.jsx(it,{node:h})}),x&&a.jsxs("div",{className:T.inspectorSection,children:[a.jsx(_.H4,{children:"Connection Properties"}),a.jsxs("div",{className:T.inspectorField,children:[a.jsx("label",{children:"From:"}),a.jsxs("span",{className:T.inspectorReadOnlyField,children:[((y=t.nodes[x.fromNodeId])==null?void 0:y.data.title)||x.fromNodeId,".",x.fromPortId]})]}),a.jsxs("div",{className:T.inspectorField,children:[a.jsx("label",{children:"To:"}),a.jsxs("span",{className:T.inspectorReadOnlyField,children:[((v=t.nodes[x.toNodeId])==null?void 0:v.data.title)||x.toNodeId,".",x.toPortId]})]})]}),!h&&!x&&a.jsx("div",{className:T.inspectorEmptyState,children:a.jsx("p",{children:"Select a node or connection to view its properties"})}),s.selectedNodeIds.length>1&&a.jsxs("div",{className:T.inspectorSection,children:[a.jsx(_.H4,{children:"Multiple Selection"}),a.jsxs("p",{children:[s.selectedNodeIds.length," nodes selected"]})]}),a.jsxs("div",{className:T.inspectorSection,children:[a.jsx(_.H4,{children:"Grid Settings"}),a.jsx("div",{className:T.inspectorField,children:a.jsxs(_.Label,{children:[a.jsx(_.Input,{id:"grid-show",name:"showGrid",type:"checkbox",checked:r.gridSettings.showGrid,onChange:g=>{i(c.updateGridSettings({showGrid:g.target.checked}))}}),"Show Grid"]})}),a.jsx("div",{className:T.inspectorField,children:a.jsxs(_.Label,{children:[a.jsx(_.Input,{id:"grid-snap",name:"snapToGrid",type:"checkbox",checked:r.gridSettings.snapToGrid,onChange:g=>{i(c.updateGridSettings({snapToGrid:g.target.checked}))}}),"Snap to Grid"]})}),a.jsx("div",{className:T.inspectorField,children:a.jsxs(_.Label,{htmlFor:"grid-size",children:["Grid Size:",a.jsx(_.Input,{id:"grid-size",name:"gridSize",type:"number",className:T.inspectorInput,value:r.gridSettings.size,min:10,max:100,step:5,onChange:g=>{const f=parseInt(g.target.value,10);!isNaN(f)&&f>0&&i(c.updateGridSettings({size:f}))},"aria-label":"Grid size in pixels"})]})}),a.jsx("div",{className:T.inspectorField,children:a.jsxs(_.Label,{htmlFor:"snap-threshold",children:["Snap Threshold:",a.jsx(_.Input,{id:"snap-threshold",name:"snapThreshold",type:"number",className:T.inspectorInput,value:r.gridSettings.snapThreshold,min:1,max:20,step:1,onChange:g=>{const f=parseInt(g.target.value,10);!isNaN(f)&&f>0&&i(c.updateGridSettings({snapThreshold:f}))},"aria-label":"Snap threshold in pixels"})]})})]})]})})]})};at.displayName="InspectorPanel";const Ai="xtnnddtrhzdiv",Li="xtnnddtrdrgBS7",mt={horizontalDivider:Ai,dragging:Li},yt=({onResize:e,className:t})=>{const[n,o]=l.useState(!1),s=l.useRef(0),r=l.useCallback(d=>{d.preventDefault(),o(!0),s.current=d.clientX,d.currentTarget.setPointerCapture(d.pointerId)},[]),i=l.useCallback(d=>{if(!n)return;const u=d.clientX-s.current;s.current=d.clientX,e(u)},[n,e]),c=l.useCallback(d=>{o(!1),d.currentTarget.releasePointerCapture(d.pointerId)},[]);return a.jsx("div",{className:`${mt.horizontalDivider} ${t||""} ${n?mt.dragging:""}`,onPointerDown:r,onPointerMove:i,onPointerUp:c})},Vi="xtnnddtrcollyt",_i="xtnnddtrrightsbr",$i="xtnnddtrleftsbr",Hi="xtnnddtrmainctn",Bi="xtnnddtrleftrsz",Gi="xtnnddtrrightrsz",ye={columnLayout:Vi,rightSidebar:_i,leftSidebar:$i,mainContent:Hi,leftResizer:Bi,rightResizer:Gi},yn=({className:e,children:t,leftSidebar:n,rightSidebar:o,leftSidebarInitialWidth:s=280,rightSidebarInitialWidth:r=280,leftSidebarMinWidth:i=200,rightSidebarMinWidth:c=200,leftSidebarMaxWidth:d=600,rightSidebarMaxWidth:u=600,onLeftSidebarWidthChange:p,onRightSidebarWidthChange:h})=>{const[x,y]=l.useState(s),[v,g]=l.useState(r),f=l.useCallback(D=>{y(w=>{const E=Math.max(i,Math.min(d,w+D));return p==null||p(E),E})},[i,d,p]),N=l.useCallback(D=>{g(w=>{const E=Math.max(c,Math.min(u,w-D));return h==null||h(E),E})},[c,u,h]);return l.useEffect(()=>{y(s)},[s]),l.useEffect(()=>{g(r)},[r]),a.jsxs("div",{className:`${ye.columnLayout} ${e||""}`,children:[n&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:ye.leftSidebar,style:{width:x},children:n}),a.jsx(yt,{onResize:f,className:ye.leftResizer})]}),a.jsx("div",{className:ye.mainContent,children:t}),o&&a.jsxs(a.Fragment,{children:[a.jsx(yt,{onResize:N,className:ye.rightResizer}),a.jsx("div",{className:ye.rightSidebar,style:{width:v},children:o})]})]})},Ui="xtnnddtrselboxiVu",Fi={selectionBoxOverlay:Ui},xn=({className:e})=>{const{state:t}=W();if(!t.selectionBox)return null;const{start:n,end:o}=t.selectionBox,s=Math.min(n.x,o.x),r=Math.min(n.y,o.y),i=Math.abs(o.x-n.x),c=Math.abs(o.y-n.y);return a.jsx("div",{className:_.classNames(Fi.selectionBoxOverlay,e),style:{left:s,top:r,width:i,height:c}})};xn.displayName="SelectionBox";const Xi="xtnnddtrselHd3",Yi={selectionOverlay:Xi},vn=({className:e})=>a.jsx("div",{className:_.classNames(Yi.selectionOverlay,e),children:a.jsx(xn,{})});vn.displayName="SelectionOverlay";const Nn=({children:e,className:t,showGrid:n=!0})=>{const{state:o,dispatch:s,actions:r,canvasRef:i,utils:c}=ne(),{state:d,dispatch:u,actions:p}=W(),{state:h}=X(),x=l.useRef(null),[y,v]=l.useState(!1),g=l.useMemo(()=>{const{offset:m,scale:b}=o.viewport;return`translate(${m.x}px, ${m.y}px) scale(${b})`},[o.viewport]),f=l.useMemo(()=>{if(!o.gridSettings.showGrid)return null;const{size:m}=o.gridSettings,{scale:b,offset:C}=o.viewport,I=m*b,M=C.x%I,V=C.y%I;return a.jsx("defs",{children:a.jsx("pattern",{id:"grid",width:I,height:I,patternUnits:"userSpaceOnUse",x:M,y:V,children:a.jsx("path",{d:`M ${I} 0 L 0 0 0 ${I}`,fill:"none",stroke:" #e0e0e0",strokeWidth:"1",opacity:"0.5"})})})},[o.gridSettings,o.viewport]),N=l.useCallback(m=>{var C;const b=(C=x.current)==null?void 0:C.getBoundingClientRect();if(b)if(m.ctrlKey||m.metaKey){m.preventDefault();const I={x:m.clientX-b.left,y:m.clientY-b.top},M=m.deltaY*-.01,V=o.viewport.scale*(1+M);s(r.zoomViewport(V,I))}else{m.preventDefault();const I=-m.deltaX,M=-m.deltaY;s(r.panViewport({x:I,y:M}))}},[o.viewport.scale,s,r]),D=l.useCallback(m=>{var I,M;if(m.button===1||o.isSpacePanning){m.preventDefault(),s(r.startPan({x:m.clientX,y:m.clientY})),x.current&&x.current.setPointerCapture(m.pointerId);return}const b=m.target,C=(I=b==null?void 0:b.closest)==null?void 0:I.call(b,'.nodeView, .port, .connectionGroup, button, input, textarea, [role="button"]');if(m.button===0&&!C){const V=(M=x.current)==null?void 0:M.getBoundingClientRect();if(!V)return;const S=m.clientX-V.left,P=m.clientY-V.top;v(!0),u(p.setSelectionBox({start:{x:S,y:P},end:{x:S,y:P}})),!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&u(p.clearSelection()),x.current&&x.current.setPointerCapture(m.pointerId)}},[o.isSpacePanning,o.viewport,s,r,u,p]),w=l.useCallback(m=>{var b;if(o.panState.isPanning)s(r.updatePan({x:m.clientX,y:m.clientY}));else if(y&&d.selectionBox){const C=(b=x.current)==null?void 0:b.getBoundingClientRect();if(!C)return;const I=m.clientX-C.left,M=m.clientY-C.top;u(p.setSelectionBox({start:d.selectionBox.start,end:{x:I,y:M}}))}},[o.panState.isPanning,o.viewport,y,d.selectionBox,s,r,u,p]),E=l.useCallback(m=>{var b;if(o.panState.isPanning)s(r.endPan()),x.current&&x.current.releasePointerCapture(m.pointerId);else if(y&&d.selectionBox){v(!1);const{start:C,end:I}=d.selectionBox;if(!((b=x.current)==null?void 0:b.getBoundingClientRect()))return;const V=(C.x-o.viewport.offset.x)/o.viewport.scale,S=(C.y-o.viewport.offset.y)/o.viewport.scale,P=(I.x-o.viewport.offset.x)/o.viewport.scale,k=(I.y-o.viewport.offset.y)/o.viewport.scale,O=Math.min(V,P),L=Math.max(V,P),A=Math.min(S,k),$=Math.max(S,k),U=[];if(Object.values(h.nodes).forEach(H=>{var re,he;const G=((re=H.size)==null?void 0:re.width)||150,K=((he=H.size)==null?void 0:he.height)||50;H.position.x<L&&H.position.x+G>O&&H.position.y<$&&H.position.y+K>A&&U.push(H.id)}),U.length>0)if(m.shiftKey||m.ctrlKey||m.metaKey){const H=[...new Set([...d.selectedNodeIds,...U])];u(p.selectAllNodes(H))}else u(p.selectAllNodes(U));u(p.setSelectionBox(null)),x.current&&x.current.releasePointerCapture(m.pointerId)}},[o.panState.isPanning,y,d.selectionBox,d.selectedNodeIds,h.nodes,s,r,u,p]),j=l.useCallback(m=>{m.preventDefault(),m.stopPropagation();const b=c.screenToCanvas(m.clientX,m.clientY),C={x:m.clientX,y:m.clientY};u(p.showContextMenu(C,void 0,b))},[u,p,c]);return l.useEffect(()=>{const m=C=>{if(C.code==="Space"&&!C.repeat&&!C.ctrlKey&&!C.metaKey&&(C.preventDefault(),s(r.setSpacePanning(!0))),(C.ctrlKey||C.metaKey)&&!C.repeat)switch(C.key){case"0":C.preventDefault(),s(r.resetViewport());break;case"1":C.preventDefault();break;case"=":case"+":C.preventDefault(),s(r.zoomViewport(o.viewport.scale*1.2));break;case"-":C.preventDefault(),s(r.zoomViewport(o.viewport.scale*.8));break}},b=C=>{C.code==="Space"&&(C.preventDefault(),s(r.setSpacePanning(!1)))};return window.addEventListener("keydown",m),window.addEventListener("keyup",b),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",b)}},[s,r,o.viewport.scale]),l.useEffect(()=>{const m=x.current;if(m)return m.addEventListener("wheel",N,{passive:!1}),()=>m.removeEventListener("wheel",N)},[N]),a.jsxs("div",{ref:x,className:_.classNames(T.canvasContainer,o.panState.isPanning&&T.panning,o.isSpacePanning&&T.spacePanning,y&&T.boxSelecting,t),onPointerDown:D,onPointerMove:w,onPointerUp:E,onContextMenu:j,role:"application","aria-label":"Node Editor Canvas",children:[o.gridSettings.showGrid&&a.jsxs("svg",{className:T.gridSvg,children:[f,a.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]}),a.jsx("div",{ref:i,className:T.canvas,style:{transform:g},children:e}),a.jsx(vn,{})]})};Nn.displayName="CanvasBase";const $e=Se.visualSize/2,Wi={DISCONNECT_THRESHOLD:$e,NEW_CONNECTION_THRESHOLD:2,CONNECTION_SNAP_DISTANCE:$e*4,HOVER_DISTANCE:$e*2};function xt(e,t){if(!t.snapToGrid)return e;const{size:n,snapThreshold:o}=t,s=Math.round(e.x/n)*n,r=Math.round(e.y/n)*n,i=Math.abs(e.x-s),c=Math.abs(e.y-r);return{x:i<=o?s:e.x,y:c<=o?r:e.y}}function Ki(e,t,n){if(!t.snapToGrid)return e;const o=e[n];if(!o){const d={};return Object.entries(e).forEach(([u,p])=>{d[u]=xt(p,t)}),d}const s=xt(o,t),r=s.x-o.x,i=s.y-o.y,c={};return Object.entries(e).forEach(([d,u])=>{c[d]={x:u.x+r,y:u.y+i}}),c}const Zi="xtnnddtrportH4B",qi="xtnnddtrportinpJGc",Ji="xtnnddtrporout68f",Qi="xtnnddtrportLeft2Oc",ea="xtnnddtrporrigHwV",ta="xtnnddtrportTopuYu",na="xtnnddtrporbotx0m",oa="xtnnddtrporinnCiS",sa="xtnnddtrporhovI-R",ra="xtnnddtrporconf0-",ia="xtnnddtrpulsexKp",aa="xtnnddtrporcontda",ca="xtnnddtrporcan",da="xtnnddtrporcone8f",la="xtnnddtrportlblMh9",ua="xtnnddtrporlefTQ3",pa="xtnnddtrporrigj3t",ha="xtnnddtrportop2o0",ga="xtnnddtrporbot6kJ",ae={port:Zi,portInput:qi,portOutput:Ji,portLeft:Qi,portRight:ea,portTop:ta,portBottom:na,portInner:oa,portHovered:sa,portConnecting:ra,pulse:ia,portConnectable:aa,portCandidate:ca,portConnected:da,portLabel:la,portLabelLeft:ua,portLabelRight:pa,portLabelTop:ha,portLabelBottom:ga},bn=({port:e,onPointerDown:t,onPointerUp:n,onPointerEnter:o,onPointerLeave:s,isConnecting:r=!1,isConnectable:i=!1,isCandidate:c=!1,isHovered:d=!1,isConnected:u=!1})=>{const p=st(e.nodeId,e.id),h=()=>{if(!p)return{left:0,top:0,position:"absolute"};const{renderPosition:f}=p;return{left:f.x,top:f.y,transform:f.transform,position:"absolute"}},x=f=>{f.stopPropagation(),t==null||t(f,e)},y=f=>{f.stopPropagation(),n==null||n(f,e)},v=f=>{o==null||o(f,e)},g=f=>{s==null||s(f,e)};return a.jsxs("div",{className:_.classNames(ae.port,ae[`port${e.type.charAt(0).toUpperCase()}${e.type.slice(1)}`],ae[`port${e.position.charAt(0).toUpperCase()}${e.position.slice(1)}`],r&&ae.portConnecting,i&&ae.portConnectable,c&&ae.portCandidate,d&&ae.portHovered,u&&ae.portConnected),style:h(),onPointerDown:x,onPointerUp:y,onPointerEnter:v,onPointerLeave:g,"data-port-id":e.id,"data-port-type":e.type,"data-node-id":e.nodeId,title:e.label,children:[a.jsx("div",{className:ae.portInner}),e.label&&a.jsx("span",{className:_.classNames(ae.portLabel,ae[`portLabel${e.position.charAt(0).toUpperCase()}${e.position.slice(1)}`]),children:e.label})]})};bn.displayName="PortView";const fa="xtnnddtrresMQd",ma="xtnnddtrresvis",ya="xtnnddtrresnOA",He={resizeHandle:fa,resizeHandleVisible:ma,resizeHandleActive:ya},Cn=({position:e,onResizeStart:t,isResizing:n=!1,isVisible:o=!1})=>{const s=l.useCallback(i=>{i.stopPropagation(),i.preventDefault(),t(i,e)},[t,e]),r=()=>({bottom:-2,right:-2,cursor:"se-resize",width:10,height:10});return a.jsx("div",{className:_.classNames(He.resizeHandle,o&&He.resizeHandleVisible,n&&He.resizeHandleActive),style:{position:"absolute",zIndex:10,...r()},onPointerDown:s,"data-resize-handle":e})};Cn.displayName="ResizeHandle";const xa=({node:e,isSelected:t,isDragging:n,dragOffset:o,onPointerDown:s,onContextMenu:r,onPortPointerDown:i,onPortPointerUp:c,onPortPointerEnter:d,onPortPointerLeave:u,connectingPort:p,hoveredPort:h,connectedPorts:x,nodeRenderer:y,externalData:v,onUpdateNode:g})=>{const{dispatch:f,actions:N,getNodePorts:D}=X(),{state:w}=W(),{isEditing:E,startEditing:j,updateValue:m,confirmEdit:b,cancelEdit:C,state:I}=Ot(),M=qe(),V=Qe({autoUpdateMembership:!1}),S=Me(e.type),P=Ze(e.id),k=Qt(e,P),O=l.useRef(null),L=M.isResizing(e.id),A=M.getResizeHandle(e.id),$=e.type==="group"?V.getGroupChildren(e.id):[],U=$.length>0,H=l.useMemo(()=>({x:e.position.x,y:e.position.y}),[e.position.x,e.position.y]);l.useLayoutEffect(()=>{if(!O.current)return;let R=H.x,B=H.y;if(n&&o)R+=o.x,B+=o.y;else if(w.dragState){const{affectedChildNodes:F,offset:q}=w.dragState;Object.entries(F).some(([ge,ce])=>ce.includes(e.id))&&(R+=q.x,B+=q.y)}O.current.style.transform=`translate(${R}px, ${B}px)`},[H,n,o,w.dragState,e.id]);const G=l.useMemo(()=>{var F,q;const R={width:((F=e.size)==null?void 0:F.width)||150,height:((q=e.size)==null?void 0:q.height)||50},B=M.getCurrentSize(e.id);return L&&B?B:R},[e.size,L,M,e.id]),K=l.useMemo(()=>{switch(e.data.visualState){case"info":return T.nodeInfo;case"success":return T.nodeSuccess;case"warning":return T.nodeWarning;case"error":return T.nodeError;case"disabled":return T.nodeDisabled;default:return null}},[e.data.visualState]),ee=l.useCallback(R=>{if(R.stopPropagation(),!e.locked){const B=e.data.title||`Node ${e.id.slice(0,6)}`;j(e.id,"title",B)}},[e.id,e.data.title,e.locked,j]),re=l.useCallback(R=>{m(R.target.value)},[m]),he=l.useCallback(R=>{R.key==="Enter"?(R.preventDefault(),R.stopPropagation(),f(N.updateNode(e.id,{data:{...e.data,title:I.currentValue}})),b()):R.key==="Escape"&&(R.preventDefault(),R.stopPropagation(),C())},[I.currentValue,e.id,e.data,f,N,b,C]),Ee=l.useCallback(()=>{f(N.updateNode(e.id,{data:{...e.data,title:I.currentValue}})),b()},[I.currentValue,e.id,e.data,f,N,b]),ve=l.useCallback(R=>{f(N.updateNode(e.id,R))},[e.id,f,N]),Re=l.useCallback((R,B)=>{var q,oe;if(R.stopPropagation(),R.preventDefault(),e.locked)return;const F={width:((q=e.size)==null?void 0:q.width)||150,height:((oe=e.size)==null?void 0:oe.height)||50};M.startResize(e.id,B,{x:R.clientX,y:R.clientY},F)},[e.id,e.size,e.locked,M]),Ae=(S==null?void 0:S.renderNode)&&!E(e.id,"title"),Le=l.useMemo(()=>({node:e,isSelected:t,isDragging:n,isEditing:E(e.id,"title"),externalData:k.data,isLoadingExternalData:k.isLoading,externalDataError:k.error,onStartEdit:()=>j(e.id,"title",e.data.title||""),onUpdateNode:ve}),[e,t,n,k,j,ve,E]),Ve=l.useMemo(()=>{if(!w.dragState)return!1;const{affectedChildNodes:R}=w.dragState;return Object.entries(R).some(([B,F])=>F.includes(e.id))},[w.dragState,e.id]),Z=l.useCallback(R=>{if((S==null?void 0:S.interactive)&&!t){const q=R.target.closest('[data-drag-handle="true"]');s(R,e.id,!!q)}else s(R,e.id,!0)},[S==null?void 0:S.interactive,e.id,t,s]);return a.jsxs("div",{ref:O,className:_.classNames(T.nodeView,e.type==="group"&&T.groupNode,e.type==="group"&&U&&T.groupHasChildren,t&&T.selected,(n||Ve)&&T.dragging,L&&T.resizing,e.locked&&T.locked,K||void 0),style:{width:G.width,height:G.height,zIndex:n||L?1e3:e.type==="group"?1:2},onPointerDown:Z,onContextMenu:R=>r(R,e.id),"data-node-id":e.id,children:[Ae&&(S!=null&&S.renderNode)?a.jsx("div",{className:T.customNodeContent,children:S.renderNode(Le)}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:_.classNames(T.nodeHeader,(S==null?void 0:S.interactive)&&!t&&T.interactiveDragHandle),"data-drag-handle":S!=null&&S.interactive?"true":"false",children:[e.locked&&a.jsx("span",{className:T.lockIcon,children:""}),E(e.id,"title")?a.jsx("input",{id:`node-title-${e.id}`,name:"nodeTitle",className:T.nodeTitleInput,type:"text",value:I.currentValue,onChange:re,onKeyDown:he,onBlur:Ee,autoFocus:!0,onClick:R=>R.stopPropagation(),"aria-label":"Node title"}):a.jsx("span",{className:T.nodeTitle,onDoubleClick:ee,children:e.data.title||`Node ${e.id.slice(0,6)}`})]}),a.jsx("div",{className:T.nodeContent,children:e.type==="group"?a.jsx(va,{node:e,childCount:$.length}):e.data.content||"Empty node"})]}),(()=>{const R=D(e.id);return!R||R.length===0?null:(R.reduce((B,F)=>(B[F.position]||(B[F.position]=[]),B[F.position].push(F),B),{}),a.jsx("div",{className:T.nodePorts,children:R.map(B=>{var F,q,oe;return a.jsx(bn,{port:B,onPointerDown:i,onPointerUp:c,onPointerEnter:d,onPointerLeave:u,isConnecting:((F=w.connectionDragState)==null?void 0:F.fromPort.id)===B.id,isConnectable:w.connectablePortIds.has(B.id),isCandidate:((oe=(q=w.connectionDragState)==null?void 0:q.candidatePort)==null?void 0:oe.id)===B.id,isHovered:(h==null?void 0:h.id)===B.id,isConnected:x==null?void 0:x.has(B.id)},B.id)})}))})(),t&&!e.locked&&a.jsx(Cn,{position:"se",onResizeStart:Re,isResizing:A==="se"})]})},va=({node:e,childCount:t})=>e.expanded?a.jsx("div",{className:T.groupExpanded,children:t>0?`Contains ${t} nodes`:"Empty group - Drop nodes here"}):a.jsx("div",{className:T.groupCollapsed,children:t>0?`${t} nodes - Click to expand`:"Empty group - Drop nodes here"}),Na=(e,t)=>{var n,o,s,r,i,c,d,u,p,h,x,y,v,g;if(e.node.id!==t.node.id||e.isSelected!==t.isSelected||e.isDragging!==t.isDragging||e.isResizing!==t.isResizing||e.node.position.x!==t.node.position.x||e.node.position.y!==t.node.position.y||((n=e.node.size)==null?void 0:n.width)!==((o=t.node.size)==null?void 0:o.width)||((s=e.node.size)==null?void 0:s.height)!==((r=t.node.size)==null?void 0:r.height)||e.node.locked!==t.node.locked||e.node.data!==t.node.data||((i=e.dragOffset)==null?void 0:i.x)!==((c=t.dragOffset)==null?void 0:c.x)||((d=e.dragOffset)==null?void 0:d.y)!==((u=t.dragOffset)==null?void 0:u.y)||((p=e.connectingPort)==null?void 0:p.id)!==((h=t.connectingPort)==null?void 0:h.id)||((x=e.hoveredPort)==null?void 0:x.id)!==((y=t.hoveredPort)==null?void 0:y.id))return!1;if(e.node.ports)for(const f of e.node.ports){const N=((v=e.connectedPorts)==null?void 0:v.has(f.id))??!1,D=((g=t.connectedPorts)==null?void 0:g.has(f.id))??!1;if(N!==D)return!1}return!0},Sn=l.memo(xa,Na);Sn.displayName="NodeView";function ba(e,t){return Object.values(t).filter(n=>n.fromPortId===e.id&&n.fromNodeId===e.nodeId||n.toPortId===e.id&&n.toNodeId===e.nodeId)}function Ca(e,t,n,o,s,r){const i=o[e];if(!i||i.locked)return[];if(s&&!r&&!n.includes(e))return[];let c;if(n.includes(e))c=n.filter(d=>{const u=o[d];return!(!u||u.locked||u.parentId&&n.includes(u.parentId))});else if(t){const d=[...n,e];c=d.filter(u=>{const p=o[u];return!(!p||p.locked||p.parentId&&d.includes(p.parentId))})}else{if(s&&!r)return[];c=[e]}return c}function vt(e,t){return e.type===t.type||e.nodeId===t.nodeId?null:e.type==="output"?{fromNodeId:e.nodeId,fromPortId:e.id,toNodeId:t.nodeId,toPortId:t.id}:{fromNodeId:t.nodeId,fromPortId:t.id,toNodeId:e.nodeId,toPortId:e.id}}function Sa(e,t){const n=e.type!==t.type,o=e.nodeId===t.nodeId;return n&&!o}function wa(e,t,n){const o={},s={};return e.forEach(r=>{const i=t[r];if(i&&(o[r]={...i.position},i.type==="group")){const c=n(r);s[r]=c.map(d=>d.id),c.forEach(d=>{o[d.id]={...d.position}})}}),{initialPositions:o,affectedChildNodes:s}}function Ea(e,t,n){const o={};return e.forEach(s=>{const r=t[s];r&&(o[s]={x:r.x+n.x,y:r.y+n.y})}),o}function Ia(e,t,n,o,s){const r=e.filter(c=>{const d=t[c];return d&&d.type==="group"});if(r.length===0)return n;r.forEach(c=>{const d=o[c],u=n[c];if(d&&u){const p={x:u.x-d.x,y:u.y-d.y};s(c,p)}});const i={};return e.forEach(c=>{const d=t[c];d&&d.type!=="group"&&n[c]&&(i[c]=n[c])}),i}function Da(e,t,n,o){const s=e.fromPortId===t.id&&e.fromNodeId===t.nodeId,r=s?e.toNodeId:e.fromNodeId,i=s?e.toPortId:e.fromPortId,c=n[r];if(!c)return null;const u=o(r).find(p=>p.id===i);return u?{otherNode:c,otherPort:u,isFromPort:s}:null}const wn=({className:e,doubleClickToEdit:t=!0})=>{const{state:n,dispatch:o,actions:s,getNodePorts:r}=X(),{state:i,dispatch:c,actions:d}=W(),{state:u}=ne(),p=Oe();qe({minWidth:100,minHeight:40,snapToGrid:u.gridSettings.snapToGrid,gridSize:u.gridSettings.size});const h=Qe({autoUpdateMembership:!0,membershipUpdateDelay:200}),x=Ut(n.nodes),y=l.useMemo(()=>x.sort((m,b)=>m.type==="group"&&b.type!=="group"?-1:m.type!=="group"&&b.type==="group"?1:0),[x]),v=l.useMemo(()=>{const m=new Set;return Object.values(n.connections).forEach(b=>{m.add(b.fromPortId),m.add(b.toPortId)}),m},[n.connections]);l.useEffect(()=>{c(d.updateConnectedPorts(v))},[v,c,d]);const g=l.useCallback((m,b)=>{m.preventDefault(),m.stopPropagation();const C={x:m.clientX,y:m.clientY};c(d.showContextMenu(C,b))},[c,d]),f=l.useCallback((m,b,C=!0)=>{if(m.button!==0)return;m.stopPropagation();const I=n.nodes[b],M=m.shiftKey||m.metaKey||m.ctrlKey;if(I!=null&&I.locked){c(d.selectNode(b,M));return}const V=I?p.registry.get(I.type):void 0,S=(V==null?void 0:V.interactive)||!1;if(S&&!C&&!i.selectedNodeIds.includes(b)){c(d.selectNode(b,M));return}const P=Ca(b,M,i.selectedNodeIds,n.nodes,S,C);if(i.selectedNodeIds.includes(b)||c(d.selectNode(b,M)),P.length===0)return;const k={x:m.clientX,y:m.clientY},{initialPositions:O,affectedChildNodes:L}=wa(P,n.nodes,h.getGroupChildren);c(d.startNodeDrag(P,k,O,L))},[c,d,i.selectedNodeIds,n.nodes,h,p]),N=l.useRef(null),D=l.useCallback((m,b)=>{m.stopPropagation();const C=n.nodes[b.nodeId];if(!C)return;const I={...C,ports:r(b.nodeId)},V=we(I).get(b.id),S=(V==null?void 0:V.connectionPoint)||{x:C.position.x,y:C.position.y},P=ba(b,n.connections);if(N.current={x:m.clientX,y:m.clientY,port:b,hasConnection:P.length>0},P.length===0){const A={id:b.id,nodeId:b.nodeId,type:b.type,label:b.label,position:b.position};c(d.startConnectionDrag(A)),c(d.updateConnectionDrag(S,null));return}const k=A=>{if(!N.current)return;const $=A.clientX-N.current.x,U=A.clientY-N.current.y;Math.sqrt($*$+U*U)>Wi.DISCONNECT_THRESHOLD&&(document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",O),L())},O=()=>{N.current=null,document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",O)},L=()=>{const A=P[0],$=Da(A,b,n.nodes,r);if(!$)return;const{otherNode:U,otherPort:H,isFromPort:G}=$,K={id:H.id,nodeId:U.id,type:H.type,label:H.label,position:H.position};c(d.startConnectionDisconnect({id:A.id,fromNodeId:A.fromNodeId,fromPortId:A.fromPortId,toNodeId:A.toNodeId,toPortId:A.toPortId},G?"from":"to",K,S)),o(s.deleteConnection(A.id)),N.current=null};document.addEventListener("pointermove",k),document.addEventListener("pointerup",O)},[n.connections,n.nodes,c,d,o,s,r]),w=l.useCallback((m,b)=>{if(m.stopPropagation(),i.connectionDisconnectState){const V=i.connectionDisconnectState.fixedPort;if(Sa(V,b)){const S=vt(V,b);S&&o(s.addConnection(S))}c(d.endConnectionDisconnect());return}if(!i.connectionDragState)return;const C=i.connectionDragState.fromPort,I=vt(C,b);I&&o(s.addConnection(I)),c(d.endConnectionDrag())},[i.connectionDragState,i.connectionDisconnectState,c,d,o,s]),E=l.useCallback((m,b)=>{const C={id:b.id,nodeId:b.nodeId,type:b.type,label:b.label,position:b.position};c(d.setHoveredPort(C))},[c,d]),j=l.useCallback(()=>{c(d.setHoveredPort(null))},[c,d]);return l.useEffect(()=>{if(!i.dragState)return;const m=C=>{if(!i.dragState)return;const I=(C.clientX-i.dragState.startPosition.x)/u.viewport.scale,M=(C.clientY-i.dragState.startPosition.y)/u.viewport.scale;c(d.updateNodeDrag({x:I,y:M}))},b=()=>{if(!i.dragState)return;const{nodeIds:C,initialPositions:I,offset:M}=i.dragState,V=Ea(C,I,M),S=u.gridSettings.snapToGrid?Ki(V,u.gridSettings,C[0]):V,P=Ia(C,n.nodes,S,I,h.moveGroupWithChildren);Object.keys(P).length>0&&o(s.moveNodes(P)),c(d.endNodeDrag())};return window.addEventListener("pointermove",m,{passive:!0}),window.addEventListener("pointerup",b,{once:!0}),()=>{window.removeEventListener("pointermove",m),window.removeEventListener("pointerup",b)}},[i.dragState,u.viewport.scale,u.gridSettings,c,d,o,s,n.nodes,h]),Ue({interactionState:i.connectionDragState,viewport:u.viewport,onPointerMove:m=>{c(d.updateConnectionDrag(m,null))},onPointerUp:()=>{c(d.endConnectionDrag())}}),Ue({interactionState:i.connectionDisconnectState,viewport:u.viewport,onPointerMove:m=>{c(d.updateConnectionDisconnect(m,null))},onPointerUp:()=>{c(d.endConnectionDisconnect())}}),a.jsx("div",{className:_.classNames(T.nodeLayer,e),children:y.map(m=>{var b,C,I;return a.jsx(Sn,{node:m,isSelected:i.selectedNodeIds.includes(m.id),isDragging:((b=i.dragState)==null?void 0:b.nodeIds.includes(m.id))??!1,dragOffset:(C=i.dragState)!=null&&C.nodeIds.includes(m.id)?i.dragState.offset:void 0,onPointerDown:f,onContextMenu:g,onPortPointerDown:D,onPortPointerUp:w,onPortPointerEnter:E,onPortPointerLeave:j,connectingPort:(I=i.connectionDragState)!=null&&I.fromPort?{id:i.connectionDragState.fromPort.id,type:i.connectionDragState.fromPort.type,label:i.connectionDragState.fromPort.label,nodeId:i.connectionDragState.fromPort.nodeId,position:i.connectionDragState.fromPort.position}:void 0,hoveredPort:i.hoveredPort?{id:i.hoveredPort.id,type:i.hoveredPort.type,label:i.hoveredPort.label,nodeId:i.hoveredPort.nodeId,position:i.hoveredPort.position}:void 0,connectedPorts:v},m.id)})})};wn.displayName="NodeLayer";function En(e,t){const n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function Pa(e,t){const n=t.x-e.x,o=t.y-e.y,s=Math.sqrt(n*n+o*o);return{dx:n,dy:o,distance:s}}function ja(e,t){return{x:e.x+t.x,y:e.y+t.y}}function ka(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ta(e,t){return{x:e.x*t,y:e.y*t}}const Nt=e=>({left:"right",right:"left",top:"bottom",bottom:"top"})[e]||"left",Xe=(e,t,n,o)=>{const s=En(e,t);let c=Math.max(40,Math.min(120,s*.5));(n==="right"&&o==="left"||n==="left"&&o==="right"||n==="top"&&o==="bottom"||n==="bottom"&&o==="top")&&(c=Math.max(c,s*.4));let u=e.x,p=e.y,h=t.x,x=t.y;switch(n){case"left":u=e.x-c;break;case"right":u=e.x+c;break;case"top":p=e.y-c;break;case"bottom":p=e.y+c;break;default:u=e.x+c}switch(o){case"left":h=t.x-c;break;case"right":h=t.x+c;break;case"top":x=t.y-c;break;case"bottom":x=t.y+c;break;default:h=t.x-c}return`M ${e.x} ${e.y} C ${u} ${p}, ${h} ${x}, ${t.x} ${t.y}`},Oa=({connection:e,fromNode:t,toNode:n,fromPort:o,toPort:s,isSelected:r,isHovered:i,isDragging:c,dragProgress:d=0,fromNodePosition:u,toNodePosition:p,fromNodeSize:h,toNodeSize:x,onPointerDown:y,onPointerEnter:v,onPointerLeave:g})=>{const f=fe(t.id,o.id),N=fe(n.id,s.id),D=l.useMemo(()=>{if(!f)return{x:t.position.x,y:t.position.y};if(u){const I=u.x-t.position.x,M=u.y-t.position.y;return{x:f.x+I,y:f.y+M}}return f},[f,t.position.x,t.position.y,u==null?void 0:u.x,u==null?void 0:u.y]),w=l.useMemo(()=>{if(!N)return{x:n.position.x,y:n.position.y};if(p){const I=p.x-n.position.x,M=p.y-n.position.y;return{x:N.x+I,y:N.y+M}}return N},[N,n.position.x,n.position.y,p==null?void 0:p.x,p==null?void 0:p.y]),E=l.useMemo(()=>Xe(D,w,o.position,s.position),[D.x,D.y,w.x,w.y,o.position,s.position]),j=l.useMemo(()=>c&&d>0?d>.5?"var(--cautionColor, #ff3b30)":"var(--connectionColor, #999)":r?"var(--accentColor, #0066cc)":i?"var(--connectionHoverColor, #666)":"var(--connectionColor, #999)",[c,d,r,i]),m=I=>{I.stopPropagation(),y==null||y(I,e.id)},b=I=>{v==null||v(I,e.id)},C=I=>{g==null||g(I,e.id)};return a.jsxs("g",{className:_.classNames(T.connectionGroup,r&&T.connectionSelected,i&&T.connectionHovered,c&&T.connectionDragging),"data-connection-id":e.id,children:[a.jsx("path",{d:E,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"},onPointerDown:m,onPointerEnter:b,onPointerLeave:C}),a.jsx("path",{d:E,fill:"none",stroke:j,strokeWidth:r||i?3:2,strokeLinecap:"round",strokeLinejoin:"round",style:{transition:"stroke 0.2s, stroke-width 0.2s",pointerEvents:"none"}}),a.jsx("defs",{children:a.jsx("marker",{id:`arrow-${e.id}`,viewBox:"0 0 10 10",refX:"9",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto",children:a.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:j,style:{transition:"fill 0.2s"}})})}),a.jsx("path",{d:E,fill:"none",stroke:"transparent",markerEnd:`url(#arrow-${e.id})`,style:{pointerEvents:"none"}})]})},Ma=(e,t)=>{var n,o,s,r,i,c,d,u,p,h,x,y,v,g,f,N,D,w,E,j,m,b,C,I;return!(e.connection.id!==t.connection.id||e.isSelected!==t.isSelected||e.isHovered!==t.isHovered||e.isDragging!==t.isDragging||e.dragProgress!==t.dragProgress||e.fromNode.position.x!==t.fromNode.position.x||e.fromNode.position.y!==t.fromNode.position.y||e.toNode.position.x!==t.toNode.position.x||e.toNode.position.y!==t.toNode.position.y||((n=e.fromNodePosition)==null?void 0:n.x)!==((o=t.fromNodePosition)==null?void 0:o.x)||((s=e.fromNodePosition)==null?void 0:s.y)!==((r=t.fromNodePosition)==null?void 0:r.y)||((i=e.toNodePosition)==null?void 0:i.x)!==((c=t.toNodePosition)==null?void 0:c.x)||((d=e.toNodePosition)==null?void 0:d.y)!==((u=t.toNodePosition)==null?void 0:u.y)||((p=e.fromNode.size)==null?void 0:p.width)!==((h=t.fromNode.size)==null?void 0:h.width)||((x=e.fromNode.size)==null?void 0:x.height)!==((y=t.fromNode.size)==null?void 0:y.height)||((v=e.toNode.size)==null?void 0:v.width)!==((g=t.toNode.size)==null?void 0:g.width)||((f=e.toNode.size)==null?void 0:f.height)!==((N=t.toNode.size)==null?void 0:N.height)||((D=e.fromNodeSize)==null?void 0:D.width)!==((w=t.fromNodeSize)==null?void 0:w.width)||((E=e.fromNodeSize)==null?void 0:E.height)!==((j=t.fromNodeSize)==null?void 0:j.height)||((m=e.toNodeSize)==null?void 0:m.width)!==((b=t.toNodeSize)==null?void 0:b.width)||((C=e.toNodeSize)==null?void 0:C.height)!==((I=t.toNodeSize)==null?void 0:I.height)||e.fromPort.position!==t.fromPort.position||e.toPort.position!==t.toPort.position)},In=l.memo(Oa,Ma);In.displayName="ConnectionView";const Dn=({className:e})=>{const{state:t}=X();return a.jsxs("svg",{className:_.classNames(T.connectionLayer,e),children:[Object.values(t.connections).map(n=>a.jsx(Ra,{connection:n},n.id)),a.jsx(za,{})]})};Dn.displayName="ConnectionLayer";const za=l.memo(()=>{var u,p,h,x;const{state:e}=W(),{state:t,getPort:n}=X(),o=(u=e.connectionDragState)==null?void 0:u.fromPort.id,s=(p=e.connectionDragState)==null?void 0:p.fromPort.nodeId,r=(h=e.connectionDisconnectState)==null?void 0:h.fixedPort.id,i=(x=e.connectionDisconnectState)==null?void 0:x.fixedPort.nodeId,c=fe(s||"",o||""),d=fe(i||"",r||"");if(e.connectionDragState){const y=e.connectionDragState.fromPort;if(!t.nodes[y.nodeId])return null;const g=n(y.nodeId,y.id);if(!g||!c)return null;const f=e.connectionDragState.toPosition,N=Xe(c,f,g.position,Nt(g.position));return a.jsx("g",{className:T.dragConnection,children:a.jsx("path",{d:N,fill:"none",stroke:"var(--accentColor, #0066cc)",strokeWidth:2,strokeDasharray:"5,5",strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}})})}if(e.connectionDisconnectState){const y=e.connectionDisconnectState;if(!t.nodes[y.fixedPort.nodeId])return null;const g=n(y.fixedPort.nodeId,y.fixedPort.id);if(!g||!d)return null;const f=y.draggingPosition,N=Xe(d,f,g.position,Nt(g.position));return a.jsx("g",{className:T.dragConnection,children:a.jsx("path",{d:N,fill:"none",stroke:"var(--cautionColor, #ff3b30)",strokeWidth:3,strokeDasharray:"8,4",strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}})})}return null}),Ra=({connection:e})=>{const{state:t,getPort:n}=X(),{state:o,dispatch:s,actions:r}=W(),{state:i}=ne(),c=fe(e.fromNodeId,e.fromPortId),d=fe(e.toNodeId,e.toPortId),u=l.useCallback((w,E)=>{var P;const j=t.nodes[e.fromNodeId],m=t.nodes[e.toNodeId],b=n(e.fromNodeId,e.fromPortId),C=n(e.toNodeId,e.toPortId);if(!j||!m||!b||!C||!c||!d)return;const I=c,M=d;(I.x+M.x)/2,(I.y+M.y)/2;const V=(P=w.currentTarget.closest("svg"))==null?void 0:P.getBoundingClientRect();if(!V)return;(w.clientX-V.left)/i.viewport.scale-i.viewport.offset.x,(w.clientY-V.top)/i.viewport.scale-i.viewport.offset.y,Math.sqrt(Math.pow(M.x-I.x,2)+Math.pow(M.y-I.y,2));const S=w.shiftKey||w.metaKey||w.ctrlKey;s(r.selectConnection(E,S))},[e,t,n,s,r,i.viewport]),p=l.useCallback((w,E)=>{s(r.setHoveredConnection(E))},[s,r]),h=l.useCallback((w,E)=>{s(r.setHoveredConnection(null))},[s,r]),x=t.nodes[e.fromNodeId],y=t.nodes[e.toNodeId],v=n(e.fromNodeId,e.fromPortId),g=n(e.toNodeId,e.toPortId);if(!x||!y||!v||!g||x.visible===!1||y.visible===!1)return null;const f=(w,E)=>{let j=null,m=null;if(o.dragState){const{nodeIds:b,offset:C,affectedChildNodes:I}=o.dragState;b.includes(E)?j={x:w.position.x+C.x,y:w.position.y+C.y}:Object.entries(I).some(([V,S])=>S.includes(E))&&(j={x:w.position.x+C.x,y:w.position.y+C.y})}return o.resizeState&&o.resizeState.nodeId===E&&(m=o.resizeState.currentSize),{previewPosition:j,previewSize:m}},N=f(x,e.fromNodeId),D=f(y,e.toNodeId);return a.jsx(In,{connection:e,fromNode:x,toNode:y,fromPort:v,toPort:g,fromNodePosition:N.previewPosition||void 0,toNodePosition:D.previewPosition||void 0,fromNodeSize:N.previewSize||void 0,toNodeSize:D.previewSize||void 0,isSelected:o.selectedConnectionIds.includes(e.id),isHovered:o.hoveredConnectionId===e.id,onPointerDown:u,onPointerEnter:p,onPointerLeave:h},e.id)},Aa="xtnnddtrstasecqAz",La="xtnnddtrstaE3x",Va="xtnnddtrstavalKN5",_a="xtnnddtrstamod3Xj",$a="xtnnddtrstasavozp",Te={statusSection:Aa,statusLabel:La,statusValue:Va,statusMode:_a,statusSaving:$a},ue=({label:e,value:t,className:n,labelClassName:o,valueClassName:s})=>a.jsxs("div",{className:_.classNames(Te.statusSection,n),children:[a.jsxs("span",{className:_.classNames(Te.statusLabel,o),children:[e,":"]}),a.jsx("span",{className:_.classNames(Te.statusValue,s),children:t})]});ue.displayName="StatusSection";const bt=Te,Ha="xtnnddtrfltcnt",Ba="xtnnddtrtop",Ga="xtnnddtrbottom",Ua="xtnnddtrtopLeft",Fa="xtnnddtrtopRight",Xa="xtnnddtrbotlef",Ya="xtnnddtrbotrig",pe={floatingContainer:Ha,top:Ba,bottom:Ga,topLeft:Ua,topRight:Fa,bottomLeft:Xa,bottomRight:Ya},ct=({position:e="top",className:t,children:n})=>{const o=l.useMemo(()=>{switch(e){case"top":return pe.top;case"bottom":return pe.bottom;case"top-left":return pe.topLeft;case"top-right":return pe.topRight;case"bottom-left":return pe.bottomLeft;case"bottom-right":return pe.bottomRight;default:return pe.top}},[e]);return a.jsx("div",{className:`${pe.floatingContainer} ${o} ${t||""}`,children:n})},Pn=({className:e,autoSave:t,isSaving:n,settingsManager:o})=>{const{state:s}=X(),{state:r}=W(),{state:i}=ne(),c=r.selectedNodeIds.length,d=r.selectedConnectionIds.length,u=Object.keys(s.nodes).length,p=Object.keys(s.connections).length,h=Math.round(i.viewport.scale*100),y=r.dragState?"Moving":r.selectionBox?"Selecting":r.connectionDragState?"Connecting":i.isSpacePanning||i.panState.isPanning?"Panning":"Ready",v=()=>r.dragState?`Offset: (${Math.round(r.dragState.offset.x)}, ${Math.round(r.dragState.offset.y)})`:`Canvas: (${Math.round(i.viewport.offset.x)}, ${Math.round(i.viewport.offset.y)})`;return a.jsxs("div",{className:_.classNames(T.statusBar,e),"data-testid":"status-bar",children:[a.jsx(ue,{label:"Selection",value:a.jsxs(a.Fragment,{children:[c>0&&`${c} node${c!==1?"s":""}`,c>0&&d>0&&", ",d>0&&`${d} connection${d!==1?"s":""}`,c===0&&d===0&&"None"]})}),a.jsx(ue,{label:"Total",value:`${u} nodes, ${p} connections`}),a.jsx(ue,{label:"Mode",value:y,valueClassName:bt.statusMode}),a.jsx(ue,{label:"Zoom",value:`${h}%`}),a.jsx(ue,{label:"Position",value:v()}),i.gridSettings.showGrid&&a.jsx(ue,{label:"Grid",value:a.jsxs(a.Fragment,{children:[i.gridSettings.size,"px",i.gridSettings.snapToGrid&&" (Snap ON)"]})}),t&&a.jsx(ue,{label:"Auto-save",value:n?"Saving...":"ON",valueClassName:n?bt.statusSaving:void 0}),o&&a.jsx(ue,{label:"Theme",value:o.getValue("appearance.theme")||"light"})]})};Pn.displayName="StatusBar";function jn(){return typeof window>"u"?{x:0,y:0,width:0,height:0}:{x:window.scrollX,y:window.scrollY,width:window.innerWidth,height:window.innerHeight}}function Wa(e,t,n,o,s=jn(),r=4){const c=s.width-e-r,d=e-r,u=s.height-t-r,p=t-r;let h;c>=n+8?h=e+r:d>=n+8?h=e-n-r:h=Math.max(8,Math.min(s.width-n-8,e-n/2));let x;return u>=o+8?x=t+r:p>=o+8?x=t-o-r:x=s.height-o-8,h=Math.max(8,Math.min(h,s.width-n-8)),x=Math.max(8,Math.min(x,s.height-o-8)),{x:h,y:x}}const Ka="xtnnddtrnodseamen",Za="xtnnddtrnodseamen2we",qa="xtnnddtrmenfadin",Ja="xtnnddtrsea",Qa="xtnnddtrseaFFM",ec="xtnnddtrseahin",tc="xtnnddtrseares",nc="xtnnddtrcatlis",oc="xtnnddtrcat",sc="xtnnddtrcatLLn",rc="xtnnddtrselcat",ic="xtnnddtrcatnam",ac="xtnnddtrnodcou",cc="xtnnddtrnodeList",dc="xtnnddtrnodeitm",lc="xtnnddtrselNode",uc="xtnnddtrnodeico",pc="xtnnddtrnodeinfGlE",hc="xtnnddtrnodeName",gc="xtnnddtrnoddes",fc="xtnnddtrnodeType",mc="xtnnddtrnores",yc="xtnnddtrnoresB5e",xc="xtnnddtrsealRp",vc="xtnnddtrselHCh",Y={nodeSearchMenuContainer:Ka,nodeSearchMenu:Za,menuFadeIn:qa,searchHeader:Ja,searchInput:Qa,searchHint:ec,searchResults:tc,categoryList:nc,categoryGroup:oc,categoryHeader:sc,selectedCategory:rc,categoryName:ic,nodeCount:ac,nodeList:cc,nodeItem:dc,selectedNode:lc,nodeIcon:uc,nodeInfo:pc,nodeName:hc,nodeDescription:gc,nodeType:fc,noResults:mc,noResultsIcon:yc,searchFooter:xc,selectionInfo:vc},kn=({position:e,nodeDefinitions:t,onCreateNode:n,onClose:o,visible:s})=>{const[r,i]=l.useState(""),[c,d]=l.useState(0),[u,p]=l.useState(null),[h,x]=l.useState({x:e.x,y:e.y}),y=l.useRef(null),v=l.useRef(null),g=l.useMemo(()=>{const E=new Map;return t.forEach(j=>{const m=j.category||"Other";E.has(m)||E.set(m,[]),E.get(m).push(j)}),Array.from(E.entries()).map(([j,m])=>({name:j,nodes:m.sort((b,C)=>b.displayName.localeCompare(C.displayName))}))},[t]),f=l.useMemo(()=>{if(!r.trim())return u?g.filter(m=>m.name===u):g;const E=r.toLowerCase(),j=[];return g.forEach(m=>{const b=m.nodes.filter(C=>{var I;return C.displayName.toLowerCase().includes(E)||((I=C.description)==null?void 0:I.toLowerCase().includes(E))||C.type.toLowerCase().includes(E)||m.name.toLowerCase().includes(E)});b.length>0&&j.push({name:m.name,nodes:b})}),j},[r,g,u]),N=l.useMemo(()=>{const E=[];return f.forEach(j=>{j.nodes.forEach(m=>{E.push({category:j.name,node:m})})}),E},[f]);l.useEffect(()=>{s&&y.current&&y.current.focus()},[s]),l.useEffect(()=>{s&&(i(""),d(0),p(null),setTimeout(()=>{if(v.current){const E=v.current.getBoundingClientRect(),j=jn(),m=Wa(e.x,e.y,E.width,E.height,j);x(m)}},0))},[s,e]);const D=l.useCallback(E=>{var j;switch(E.key){case"ArrowDown":E.preventDefault(),d(C=>Math.min(C+1,N.length-1));break;case"ArrowUp":E.preventDefault(),d(C=>Math.max(C-1,0));break;case"Enter":if(E.preventDefault(),N[c]){const C=N[c].node;n(C.type,e),o()}break;case"Escape":E.preventDefault(),o();break;case"Tab":E.preventDefault();const b=(g.findIndex(C=>C.name===u)+1)%g.length;p(((j=g[b])==null?void 0:j.name)||null),d(0);break}},[N,c,n,e,o,g,u]),w=l.useCallback(E=>{n(E,e),o()},[n,e,o]);return l.useEffect(()=>{const E=j=>{if(s&&j.target instanceof Element){const m=document.querySelector("[data-node-search-menu]");m&&!m.contains(j.target)&&o()}};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[s,o]),s?a.jsxs("div",{ref:v,className:_.classNames(Y.nodeSearchMenu,Y.nodeSearchMenuContainer),style:{left:h.x,top:h.y},"data-node-search-menu":!0,onKeyDown:D,children:[a.jsxs("div",{className:Y.searchHeader,children:[a.jsx("input",{ref:y,id:"node-search",name:"nodeSearch",type:"text",placeholder:"Search nodes...",value:r,onChange:E=>i(E.target.value),className:Y.searchInput,"aria-label":"Search for nodes","aria-describedby":"search-hint"}),a.jsxs("div",{id:"search-hint",className:Y.searchHint,children:[a.jsx("kbd",{children:""})," Navigate  ",a.jsx("kbd",{children:""})," Create  ",a.jsx("kbd",{children:""})," Category  ",a.jsx("kbd",{children:""})," Close"]})]}),a.jsx("div",{className:Y.searchResults,children:f.length===0?a.jsxs("div",{className:Y.noResults,children:[a.jsx("div",{className:Y.noResultsIcon,children:""}),a.jsxs("div",{children:['No nodes found for "',r,'"']})]}):a.jsx("div",{className:Y.categoryList,children:f.map((E,j)=>a.jsxs("div",{className:Y.categoryGroup,children:[a.jsxs("div",{className:_.classNames(Y.categoryHeader,u===E.name&&Y.selectedCategory),onClick:()=>p(u===E.name?null:E.name),children:[a.jsx("span",{className:Y.categoryName,children:E.name}),a.jsx("span",{className:Y.nodeCount,children:E.nodes.length})]}),a.jsx("div",{className:Y.nodeList,children:E.nodes.map((m,b)=>{const C=N.findIndex(M=>M.node.type===m.type),I=C===c;return a.jsxs("div",{className:_.classNames(Y.nodeItem,I&&Y.selectedNode),onClick:()=>w(m.type),onMouseEnter:()=>d(C),children:[a.jsx("div",{className:Y.nodeIcon,children:fn(m.type,t)}),a.jsxs("div",{className:Y.nodeInfo,children:[a.jsx("div",{className:Y.nodeName,children:m.displayName}),m.description&&a.jsx("div",{className:Y.nodeDescription,children:m.description})]}),a.jsx("div",{className:Y.nodeType,children:m.type})]},m.type)})})]},E.name))})}),N.length>0&&a.jsx("div",{className:Y.searchFooter,children:a.jsxs("div",{className:Y.selectionInfo,children:[c+1," of ",N.length,"  ",f.length," categories"]})})]}):null};kn.displayName="NodeSearchMenu";const Tn=l.createContext(null),On=({portPositions:e,children:t})=>{const n=l.useMemo(()=>({portPositions:e,getPortPosition:(o,s)=>{var r;return(r=e.get(o))==null?void 0:r.get(s)},getNodePortPositions:o=>e.get(o),computePortPosition:(o,s)=>{var i;const r=(i=e.get(o.id))==null?void 0:i.get(s.id);return r||{portId:s.id,renderPosition:{x:0,y:0},connectionPoint:{x:o.position.x,y:o.position.y}}}}),[e]);return a.jsx(Tn.Provider,{value:n,children:t})};function dt(){const e=l.useContext(Tn);if(!e)throw new Error("usePortPositions must be used within a PortPositionProvider");return e}function Nc(e,t){const{getPortPosition:n}=dt();return l.useMemo(()=>n(e,t),[n,e,t])}function bc(e){const{getNodePortPositions:t}=dt();return l.useMemo(()=>t(e),[t,e])}const Mn=({initialData:e,data:t,onDataChange:n,onSave:o,onLoad:s,className:r,nodeDefinitions:i,includeDefaultDefinitions:c=!0,externalDataRefs:d,overlayLayers:u,backgroundLayers:p,uiOverlayLayers:h,settingsManager:x,toolbar:y,leftSidebar:v,rightSidebar:g,leftSidebarInitialWidth:f,rightSidebarInitialWidth:N,leftSidebarMinWidth:D,rightSidebarMinWidth:w,leftSidebarMaxWidth:E,rightSidebarMaxWidth:j,onLeftSidebarWidthChange:m,onRightSidebarWidthChange:b})=>a.jsx(Mt,{nodeDefinitions:i,includeDefaults:c,children:a.jsx(Rt,{refs:d,children:a.jsx(Kt,{initialState:e,controlledData:t,onDataChange:n,onSave:o,onLoad:s,settingsManager:x,children:a.jsx(jt,{children:a.jsx(Dt,{children:a.jsx(qt,{children:a.jsx(Tt,{children:a.jsx(Et,{children:a.jsx(Cc,{className:r,overlayLayers:u,backgroundLayers:p,uiOverlayLayers:h,settingsManager:x,toolbar:y,leftSidebar:v,rightSidebar:g,leftSidebarInitialWidth:f,rightSidebarInitialWidth:N,leftSidebarMinWidth:D,rightSidebarMinWidth:w,leftSidebarMaxWidth:E,rightSidebarMaxWidth:j,onLeftSidebarWidthChange:m,onRightSidebarWidthChange:b})})})})})})})})}),Cc=({className:e,overlayLayers:t,backgroundLayers:n,uiOverlayLayers:o,settingsManager:s,toolbar:r,leftSidebar:i,rightSidebar:c,leftSidebarInitialWidth:d,rightSidebarInitialWidth:u,leftSidebarMinWidth:p,rightSidebarMinWidth:h,leftSidebarMaxWidth:x,rightSidebarMaxWidth:y,onLeftSidebarWidthChange:v,onRightSidebarWidthChange:g})=>{const{state:f,handleSave:N,dispatch:D,actions:w,isLoading:E,isSaving:j,getNodePorts:m}=X(),{state:b,dispatch:C,actions:I}=W(),{utils:M}=ne(),V=ze(),[S,P]=l.useState(()=>new Map),k=l.useRef(f.nodes);l.useEffect(()=>{var B,F,q,oe;if(!f.nodes)return;const Z=k.current;let R=!1;if(!Z||Object.keys(Z).length!==Object.keys(f.nodes).length)R=!0;else for(const ge in f.nodes){const ce=f.nodes[ge],de=Z[ge];if(!de||ce.position.x!==de.position.x||ce.position.y!==de.position.y||((B=ce.size)==null?void 0:B.width)!==((F=de.size)==null?void 0:F.width)||((q=ce.size)==null?void 0:q.height)!==((oe=de.size)==null?void 0:oe.height)){R=!0;break}}if(R){const ge=Object.values(f.nodes).map(de=>({...de,ports:m(de.id)})),ce=Xt(ge);P(ce),k.current=f.nodes}},[f.nodes,m]);const O=ot(s),{showGrid:L,showMinimap:A,showStatusBar:$,theme:U,autoSave:H,autoSaveInterval:G,smoothAnimations:K,doubleClickToEdit:ee,fontSize:re,gridSize:he,gridOpacity:Ee,canvasBackground:ve}=O,Re=l.useMemo(()=>({"--editor-font-size":`${re}px`,"--editor-grid-size":`${he}px`,"--editor-grid-opacity":`${Ee}`,"--editor-canvas-background":ve}),[re,he,Ee,ve]),Ae=l.useCallback((Z,R)=>{const B=V.find(de=>de.type===Z);if(!B){console.warn(`Node definition not found for type: ${Z}`);return}let F=b.contextMenu.canvasPosition;F||(F=M.screenToCanvas(R.x,R.y));const q=`${Z}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,oe=B.defaultSize||{width:150,height:50},ge={x:F.x-oe.width/2,y:F.y-oe.height/2},ce={id:q,type:Z,position:ge,size:oe,data:B.defaultData||{title:B.displayName}};D(w.addNode(ce)),C(I.selectNode(q,!1)),C(I.hideContextMenu())},[V,D,w,C,I,b.contextMenu.canvasPosition,M]);l.useEffect(()=>{const Z=R=>{(R.ctrlKey||R.metaKey)&&R.key==="s"&&(R.preventDefault(),N()),R.key==="Escape"&&C(I.hideContextMenu())};return document.addEventListener("keydown",Z),()=>document.removeEventListener("keydown",Z)},[N,C,I]);const Le=i,Ve=c===void 0?a.jsx(at,{}):c;return a.jsxs(Jt,{className:_.classNames(e,U==="dark"&&T.darkTheme,K&&T.smoothAnimations),style:Re,"data-theme":U,children:[a.jsxs("div",{className:T.editorLayout,children:[r&&a.jsx("div",{className:T.editorToolbar,children:r}),a.jsx("div",{className:T.editorContent,children:a.jsx(yn,{leftSidebar:Le,rightSidebar:Ve,leftSidebarInitialWidth:d,rightSidebarInitialWidth:u,leftSidebarMinWidth:p,rightSidebarMinWidth:h,leftSidebarMaxWidth:x,rightSidebarMaxWidth:y,onLeftSidebarWidthChange:v,onRightSidebarWidthChange:g,children:a.jsxs("div",{className:T.editorMain,children:[a.jsx(Nn,{showGrid:L,children:a.jsxs(On,{portPositions:S,children:[n==null?void 0:n.map((Z,R)=>a.jsx(l.Fragment,{children:Z},`background-layer-${R}`)),a.jsx(Dn,{}),a.jsx(wn,{doubleClickToEdit:ee}),t==null?void 0:t.map((Z,R)=>a.jsx(l.Fragment,{children:Z},`overlay-layer-${R}`))]})}),$&&a.jsx(Pn,{autoSave:H,isSaving:j,settingsManager:s})]})})})]}),(E||j)&&a.jsx("div",{className:T.loadingOverlay,children:a.jsx("div",{className:T.loadingIndicator,children:E?"Loading...":"Saving..."})}),a.jsx(kn,{position:b.contextMenu.position,nodeDefinitions:V,onCreateNode:Ae,onClose:()=>C(I.hideContextMenu()),visible:b.contextMenu.visible}),o&&o.length>0&&a.jsx("div",{className:T.uiOverlayContainer,children:o.map((Z,R)=>a.jsx(l.Fragment,{children:Z},`ui-overlay-layer-${R}`))})]})};Mn.displayName="NodeEditor";const Sc="xtnnddtrminimapNm_",wc="xtnnddtrminxip",Ec="xtnnddtrtopLeftyMq",Ic="xtnnddtrtopRights48",Dc="xtnnddtrbotlef8be",Pc="xtnnddtrbotrigo0n",jc="xtnnddtrtopleft",kc="xtnnddtrtopright",Tc="xtnnddtrbot",Oc="xtnnddtrbotBB1",Mc="xtnnddtrminudL",zc="xtnnddtrminzoo",Rc="xtnnddtrmintitGxO",Ac="xtnnddtrminsta",Lc="xtnnddtrmincan",Vc="xtnnddtrmincan45s",_c="xtnnddtrminvieSyB",$c="xtnnddtrminnodljv",Hc="xtnnddtrminnodn73",Bc="xtnnddtrmincon",Gc="xtnnddtrmincon7Oy",Uc="xtnnddtrminvieS6m",te={minimap:Sc,minimapContainer:wc,topLeft:Ec,topRight:Ic,bottomLeft:Dc,bottomRight:Pc,topleft:jc,topright:kc,bottomleft:Tc,bottomright:Oc,minimapHeader:Mc,minimapZoom:zc,minimapTitle:Rc,minimapStats:Ac,minimapCanvas:Lc,minimapCanvasDragging:Vc,minimapViewport:_c,minimapNode:$c,minimapGroupNode:Hc,minimapConnections:Bc,minimapConnection:Gc,minimapViewportDragging:Uc},zn=({width:e=200,height:t=150,position:n="top-right",className:o,visible:s=!0,scale:r=.1})=>{const{state:i}=X(),{state:c,dispatch:d,actions:u}=ne(),p=l.useRef(null),[h,x]=l.useState(!1),[y,v]=l.useState(null),[g,f]=l.useState(!1),N=l.useMemo(()=>{const S=Object.values(i.nodes);if(S.length===0)return{minX:0,minY:0,maxX:1e3,maxY:1e3};let P=1/0,k=1/0,O=-1/0,L=-1/0;S.forEach($=>{var ee,re;const U=$.position.x,H=$.position.y,G=((ee=$.size)==null?void 0:ee.width)||150,K=((re=$.size)==null?void 0:re.height)||100;P=Math.min(P,U),k=Math.min(k,H),O=Math.max(O,U+G),L=Math.max(L,H+K)});const A=100;return{minX:P-A,minY:k-A,maxX:O+A,maxY:L+A}},[i.nodes]),D=l.useMemo(()=>{const S=N.maxX-N.minX,P=N.maxY-N.minY,k=(e-20)/S,O=(t-40)/P;return Math.min(k,O,r)},[N,e,t]),w=l.useCallback((S,P)=>({x:(S-N.minX)*D+10,y:(P-N.minY)*D+30}),[N,D]),E=l.useCallback((S,P)=>({x:(S-10)/D+N.minX,y:(P-30)/D+N.minY}),[N,D]),j=l.useMemo(()=>{const S=c.viewport,P=window.innerWidth/S.scale,k=window.innerHeight/S.scale,O={x:-S.offset.x/S.scale,y:-S.offset.y/S.scale},L={x:O.x+P,y:O.y+k},A=w(O.x,O.y),$=w(L.x,L.y);return{x:A.x,y:A.y,width:Math.max(1,$.x-A.x),height:Math.max(1,$.y-A.y)}},[c.viewport,w]),m=l.useCallback((S,P)=>{if(!p.current)return;const k=p.current.getBoundingClientRect(),O=S-k.left,L=P-k.top,A=E(O,L),$=c.viewport,U=O/e*window.innerWidth,H=(L-30)/(t-30)*window.innerHeight,G=U-A.x*$.scale,K=H-A.y*$.scale;d(u.setViewport({...$,offset:{x:G,y:K}}))},[c.viewport,d,u,E,e,t]),b=l.useCallback(S=>{S.preventDefault(),x(!0),f(!1),v({x:S.clientX,y:S.clientY,viewportOffset:{...c.viewport.offset}}),p.current&&p.current.setPointerCapture(S.pointerId)},[c.viewport.offset]),C=l.useCallback(S=>{if(!h||!y)return;S.preventDefault();const P=S.clientX-y.x,k=S.clientY-y.y,O=3;!g&&(Math.abs(P)>O||Math.abs(k)>O)&&f(!0);const L=N.maxX-N.minX,A=N.maxY-N.minY,$=e-20,U=t-60,H=P/$*L,G=k/U*A,K=c.viewport,ee=y.viewportOffset.x-H*K.scale,re=y.viewportOffset.y-G*K.scale;d(u.setViewport({...K,offset:{x:ee,y:re}}))},[h,y,g,c.viewport,d,u,N,e,t]),I=l.useCallback(S=>{x(!1),v(null),p.current&&p.current.releasePointerCapture(S.pointerId),setTimeout(()=>{f(!1)},0)},[]),M=l.useCallback(S=>{!g&&!h&&!y&&m(S.clientX,S.clientY)},[g,h,y,m]),V=n.replace("-","");return s?a.jsxs("div",{className:`${te.minimapContainer} ${te[V]} ${o||""}`,style:{width:e,height:t},children:[a.jsxs("div",{className:te.minimapHeader,children:[a.jsx("span",{className:te.minimapTitle,children:"Minimap"}),a.jsxs("span",{className:te.minimapStats,children:[Object.keys(i.nodes).length," nodes"]}),a.jsxs("span",{className:te.minimapZoom,children:[Math.round(c.viewport.scale*100),"%"]})]}),a.jsxs("div",{ref:p,className:`${te.minimapCanvas} ${h?te.minimapCanvasDragging:""}`,onPointerDown:b,onPointerMove:C,onPointerUp:I,onClick:M,style:{width:e,height:t-30,cursor:h?"grabbing":"grab"},children:[a.jsx("svg",{className:te.minimapConnections,viewBox:`0 0 ${e} ${t-30}`,children:Object.values(i.connections||{}).map(S=>{var A,$,U,H;const P=i.nodes[S.fromNodeId],k=i.nodes[S.toNodeId];if(!P||!k)return null;const O=w(P.position.x+(((A=P.size)==null?void 0:A.width)||150)/2,P.position.y+((($=P.size)==null?void 0:$.height)||100)/2),L=w(k.position.x+(((U=k.size)==null?void 0:U.width)||150)/2,k.position.y+(((H=k.size)==null?void 0:H.height)||100)/2);return a.jsx("line",{x1:O.x,y1:O.y-30,x2:L.x,y2:L.y-30,className:te.minimapConnection},S.id)})}),Object.values(i.nodes).map(S=>{var L,A;const P=w(S.position.x,S.position.y),k={width:(((L=S.size)==null?void 0:L.width)||150)*D,height:(((A=S.size)==null?void 0:A.height)||100)*D},O=S.type==="group";return a.jsx("div",{className:`${te.minimapNode} ${O?te.minimapGroupNode:""}`,style:{left:P.x,top:P.y,width:Math.max(2,k.width),height:Math.max(2,k.height)},"data-node-type":S.type},S.id)}),a.jsx("div",{className:`${te.minimapViewport} ${h?te.minimapViewportDragging:""}`,style:{left:j.x,top:j.y,width:j.width,height:j.height}})]})]}):null};zn.displayName="Minimap";const Fc="xtnnddtrdebugovr",Xc="xtnnddtrtopLeftXGk",Yc="xtnnddtrtopRightHbt",Wc="xtnnddtrbotlefhr9",Kc="xtnnddtrbotrigW2u",Zc="xtnnddtrcold7Bg",qc="xtnnddtrdebughdr",Jc="xtnnddtrdebtit",Qc="xtnnddtrcolbtn",ed="xtnnddtrdebugctn",td="xtnnddtrdebsec",nd="xtnnddtrsectit",od="xtnnddtrdebugitm",sd="xtnnddtrlbl",rd="xtnnddtrvalue",z={debugOverlay:Fc,topLeft:Xc,topRight:Yc,bottomLeft:Wc,bottomRight:Kc,collapsed:Zc,debugHeader:qc,debugTitle:Jc,collapseButton:Qc,debugContent:ed,debugSection:td,sectionTitle:nd,debugItem:od,label:sd,value:rd},Rn=({position:e="top-left",className:t,visible:n=!0,showSections:o={viewport:!0,nodes:!0,connections:!0,actions:!0,performance:!1}})=>{const{state:s}=X(),{state:r}=ne(),{state:i}=W(),[c,d]=l.useState(!1),[u,p]=l.useState({renderCount:0,lastRenderTime:0});if(l.useEffect(()=>{o.performance&&p(g=>({renderCount:g.renderCount+1,lastRenderTime:Date.now()-(g.lastRenderTime||Date.now())}))},[o.performance]),!n)return null;const h={"top-left":z.topLeft,"top-right":z.topRight,"bottom-left":z.bottomLeft,"bottom-right":z.bottomRight}[e],x=Object.keys(s.nodes).length,y=Object.keys(s.connections).length,v=i.selectedNodeIds.length;return a.jsxs("div",{className:_.classNames(z.debugOverlay,h,c&&z.collapsed,t),children:[a.jsxs("div",{className:z.debugHeader,children:[a.jsx("span",{className:z.debugTitle,children:"Debug Info"}),a.jsx("button",{className:z.collapseButton,onClick:()=>d(!c),"aria-label":c?"Expand debug info":"Collapse debug info",children:c?"+":""})]}),!c&&a.jsxs("div",{className:z.debugContent,children:[o.viewport&&a.jsxs("div",{className:z.debugSection,children:[a.jsx("div",{className:z.sectionTitle,children:"Viewport"}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Offset:"}),a.jsxs("span",{className:z.value,children:[Math.round(r.viewport.offset.x),", ",Math.round(r.viewport.offset.y)]})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Scale:"}),a.jsxs("span",{className:z.value,children:[r.viewport.scale.toFixed(2),"x"]})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Grid:"}),a.jsxs("span",{className:z.value,children:[r.gridSettings.enabled?"On":"Off",r.gridSettings.enabled&&` (${r.gridSettings.size}px)`]})]})]}),o.nodes&&a.jsxs("div",{className:z.debugSection,children:[a.jsx("div",{className:z.sectionTitle,children:"Nodes"}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Total:"}),a.jsx("span",{className:z.value,children:x})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Selected:"}),a.jsx("span",{className:z.value,children:v})]}),Object.entries(Object.values(s.nodes).reduce((g,f)=>(g[f.type]=(g[f.type]||0)+1,g),{})).map(([g,f])=>a.jsxs("div",{className:z.debugItem,children:[a.jsxs("span",{className:z.label,children:[g,":"]}),a.jsx("span",{className:z.value,children:f})]},g))]}),o.connections&&a.jsxs("div",{className:z.debugSection,children:[a.jsx("div",{className:z.sectionTitle,children:"Connections"}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Total:"}),a.jsx("span",{className:z.value,children:y})]})]}),o.actions&&a.jsxs("div",{className:z.debugSection,children:[a.jsx("div",{className:z.sectionTitle,children:"Actions"}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Dragging:"}),a.jsx("span",{className:z.value,children:i.dragState?`${i.dragState.nodeIds.length} nodes`:"None"})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Resizing:"}),a.jsx("span",{className:z.value,children:i.resizeState?i.resizeState.nodeId:"None"})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Connecting:"}),a.jsx("span",{className:z.value,children:i.connectionDragState?"Active":"None"})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Panning:"}),a.jsx("span",{className:z.value,children:r.panState.isPanning?"Active":"None"})]})]}),o.performance&&a.jsxs("div",{className:z.debugSection,children:[a.jsx("div",{className:z.sectionTitle,children:"Performance"}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Renders:"}),a.jsx("span",{className:z.value,children:u.renderCount})]}),a.jsxs("div",{className:z.debugItem,children:[a.jsx("span",{className:z.label,children:"Last render:"}),a.jsxs("span",{className:z.value,children:[u.lastRenderTime.toFixed(2),"ms"]})]})]})]})]})};Rn.displayName="DebugOverlay";const id="xtnnddtrtbru6T",ad="xtnnddtrtbrsec",cd="xtnnddtrtoolbtn7BP",dd="xtnnddtractD7C",ld="xtnnddtrsep",ud="xtnnddtrzoodis",pd="xtnnddtrzoosel",hd="xtnnddtrtbrspa",gd="xtnnddtrstaAUh",fd="xtnnddtrstaXT3",md="xtnnddtrstaval87E",Q={toolbar:id,toolbarSection:ad,toolButton:cd,active:dd,separator:ld,zoomDisplay:ud,zoomSelect:pd,toolbarSpacer:hd,statusIndicator:gd,statusLabel:fd,statusValue:md},Ct=[5,10,25,50,100,200,400,800],xe=l.memo(({onClick:e,title:t,ariaLabel:n,disabled:o,children:s})=>a.jsx("button",{className:Q.toolButton,onClick:e,title:t,"aria-label":n,disabled:o,children:s}));xe.displayName="ZoomButton";const Ye=l.memo(({active:e,onClick:t,title:n,ariaLabel:o,children:s})=>a.jsx("button",{className:`${Q.toolButton} ${e?Q.active:""}`,onClick:t,title:n,"aria-label":o,children:s}));Ye.displayName="ToggleButton";const We=l.memo(({label:e,value:t})=>a.jsxs("div",{className:Q.statusIndicator,children:[a.jsxs("span",{className:Q.statusLabel,children:[e,":"]}),a.jsx("span",{className:Q.statusValue,children:t})]}));We.displayName="StatusIndicator";const An=l.memo(({className:e,useFloatingContainer:t=!1,position:n="bottom"})=>{const{state:o,actions:s,dispatch:r}=ne(),{state:i}=X(),{state:c}=W(),d=l.useMemo(()=>Math.round(o.viewport.scale*100),[o.viewport.scale]),u=l.useMemo(()=>Object.keys(i.nodes).length,[i.nodes]),p=l.useMemo(()=>Object.keys(i.connections).length,[i.connections]),h=l.useMemo(()=>c.selectedNodeIds.length,[c.selectedNodeIds]),x=l.useCallback(()=>{const m=Math.min(o.viewport.scale*1.25,10);r(s.setViewport({...o.viewport,scale:m}))},[o.viewport,r,s]),y=l.useCallback(()=>{const m=Math.max(o.viewport.scale*.8,.1);r(s.setViewport({...o.viewport,scale:m}))},[o.viewport,r,s]),v=l.useCallback(()=>{r(s.setViewport({...o.viewport,scale:1}))},[o.viewport,r,s]),g=l.useCallback(()=>{const m=Object.values(i.nodes);if(m.length===0)return;let b=1/0,C=1/0,I=-1/0,M=-1/0;m.forEach(G=>{var K,ee;b=Math.min(b,G.position.x),C=Math.min(C,G.position.y),I=Math.max(I,G.position.x+(((K=G.size)==null?void 0:K.width)??150)),M=Math.max(M,G.position.y+(((ee=G.size)==null?void 0:ee.height)??50))});const V=50,S=I-b+V*2,P=M-C+V*2,k=window.innerWidth,O=window.innerHeight,L=k/S,A=O/P,$=Math.min(L,A,1),U=(b+I)/2,H=(C+M)/2;r(s.setViewport({scale:$,offset:{x:-(U*$-k/2),y:-(H*$-O/2)}}))},[i.nodes,r,s]),f=l.useCallback(()=>{if(h===0)return;const m=c.selectedNodeIds.map(G=>i.nodes[G]).filter(G=>G!=null);if(m.length===0)return;let b=1/0,C=1/0,I=-1/0,M=-1/0;m.forEach(G=>{var K,ee;b=Math.min(b,G.position.x),C=Math.min(C,G.position.y),I=Math.max(I,G.position.x+(((K=G.size)==null?void 0:K.width)??150)),M=Math.max(M,G.position.y+(((ee=G.size)==null?void 0:ee.height)??50))});const V=50,S=I-b+V*2,P=M-C+V*2,k=window.innerWidth,O=window.innerHeight,L=k/S,A=O/P,$=Math.min(L,A,2),U=(b+I)/2,H=(C+M)/2;r(s.setViewport({scale:$,offset:{x:-(U*$-k/2),y:-(H*$-O/2)}}))},[i.nodes,c.selectedNodeIds,h,r,s]),N=l.useCallback(m=>{r(s.setViewport({...o.viewport,scale:m/100}))},[o.viewport,r,s]),D=l.useCallback(()=>{r(s.updateGridSettings({showGrid:!o.gridSettings.showGrid}))},[o.gridSettings.showGrid,r,s]),w=l.useCallback(()=>{r(s.updateGridSettings({snapToGrid:!o.gridSettings.snapToGrid}))},[o.gridSettings.snapToGrid,r,s]),E=l.useMemo(()=>{const m=Ct.map(b=>a.jsxs("option",{value:b,children:[b,"%"]},b));return Ct.includes(d)||m.push(a.jsxs("option",{value:d,children:[d,"%"]},d)),m},[d]),j=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:Q.toolbarSection,children:[a.jsx(xe,{onClick:y,title:"Zoom Out (Cmd -)",ariaLabel:"Zoom Out",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"})})}),a.jsx("div",{className:Q.zoomDisplay,children:a.jsx("select",{className:Q.zoomSelect,value:d,onChange:m=>N(Number(m.target.value)),children:E})}),a.jsx(xe,{onClick:x,title:"Zoom In (Cmd +)",ariaLabel:"Zoom In",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5V7.5H11.5a.5.5 0 0 1 0 1H8.5V11.5a.5.5 0 0 1-1 0V8.5H4.5a.5.5 0 0 1 0-1H7.5V4.5A.5.5 0 0 1 8 4z"})})})]}),a.jsx("div",{className:Q.separator}),a.jsxs("div",{className:Q.toolbarSection,children:[a.jsx(xe,{onClick:g,title:"Zoom to Fit All (Shift 1)",ariaLabel:"Zoom to Fit All",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M3.5 2.5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1h-9zm0 1h9v9h-9v-9z"}),a.jsx("path",{d:"M6 6h4v4H6V6z",opacity:"0.5"})]})}),a.jsx(xe,{onClick:f,title:"Zoom to Selection (Shift 2)",ariaLabel:"Zoom to Selection",disabled:h===0,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M6 6h4v4H6V6z"}),a.jsx("path",{d:"M3.5 2.5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1h-9zm0 1h9v9h-9v-9z",opacity:"0.5"})]})}),a.jsx(xe,{onClick:v,title:"Reset Zoom (Cmd 0)",ariaLabel:"Reset Zoom",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("text",{x:"8",y:"12",textAnchor:"middle",fontSize:"10",fontWeight:"600",children:"1:1"})})})]}),a.jsx("div",{className:Q.separator}),a.jsxs("div",{className:Q.toolbarSection,children:[a.jsx(Ye,{active:o.gridSettings.showGrid,onClick:D,title:"Toggle Grid (Cmd ')",ariaLabel:"Toggle Grid",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M2 2h2v2H2V2zm4 0h2v2H6V2zm4 0h2v2h-2V2zm4 0h2v2h-2V2zM2 6h2v2H2V6zm4 0h2v2H6V6zm4 0h2v2h-2V6zm4 0h2v2h-2V6zM2 10h2v2H2v-2zm4 0h2v2H6v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zM2 14h2v2H2v-2zm4 0h2v2H6v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2z",opacity:"0.6"})})}),a.jsx(Ye,{active:o.gridSettings.snapToGrid,onClick:w,title:"Toggle Snap to Grid",ariaLabel:"Toggle Snap to Grid",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M8 2v12M2 8h12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.4"}),a.jsx("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})]})})]}),a.jsx("div",{className:Q.toolbarSpacer}),a.jsxs("div",{className:Q.toolbarSection,children:[a.jsx(We,{label:"Nodes",value:u}),a.jsx(We,{label:"Connections",value:p})]})]});return t?a.jsx(ct,{position:n,className:e,children:j}):a.jsx("div",{className:`${Q.toolbar} ${e||""}`,children:j})});An.displayName="GridToolbox";const yd="xtnnddtrtbrico",xd="xtnnddtrtbrdKk",vd="xtnnddtrtbrsep",Be={toolbarIcon:yd,toolbarIconText:xd,toolbarSeparator:vd},Nd=({className:e,floating:t=!1,position:n="top"})=>{const o=ze(),{actions:s,dispatch:r}=W(),{state:i}=ne(),{dispatch:c,actions:d}=X(),u=l.useMemo(()=>o.filter(y=>["standard","input","output","process","group"].includes(y.type)).slice(0,5),[o]),p=l.useCallback(y=>{const v=o.find(E=>E.type===y);if(!v){console.warn(`Node definition not found for type: ${y}`);return}const g=i.viewport,f=(-g.offset.x+window.innerWidth/2)/g.scale,N=(-g.offset.y+window.innerHeight/2)/g.scale,D=`${y}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,w={id:D,type:y,position:{x:f,y:N},size:v.defaultSize||{width:150,height:50},data:v.defaultData||{title:v.displayName}};c(d.addNode(w)),r(s.selectNode(D,!1))},[o,i.viewport,c,d,r,s]),h=l.useCallback(()=>{const y=i.viewport,v=window.innerWidth/2,g=window.innerHeight/2,f=(-y.offset.x+v)/y.scale,N=(-y.offset.y+g)/y.scale;r(s.showContextMenu({x:v,y:g},void 0,{x:f,y:N}))},[i.viewport,r,s]),x=a.jsxs(a.Fragment,{children:[u.map(y=>a.jsx(_.Button,{className:T.toolButton,onClick:()=>p(y.type),title:`Add ${y.displayName}`,"aria-label":`Add ${y.displayName}`,children:y.icon?a.jsx("span",{className:Be.toolbarIcon,children:y.icon}):a.jsx("span",{className:Be.toolbarIconText,children:y.displayName.charAt(0).toUpperCase()})},y.type)),u.length>0&&a.jsx("div",{className:Be.toolbarSeparator}),a.jsx(_.Button,{className:T.toolButton,onClick:h,title:"Add Node...","aria-label":"Add Node...",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M8 3a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2H9v3a1 1 0 1 1-2 0V9H4a1 1 0 0 1 0-2h3V4a1 1 0 0 1 1-1z"})})})]});return t?a.jsx(ct,{position:n,className:e,children:x}):a.jsx("div",{className:`${T.topToolbar} ${e||""}`,children:x})};function bd(e){if(!e)return{};const t={};return e.nodeIds.forEach(n=>{t[n]=e.offset}),Object.entries(e.affectedChildNodes).forEach(([n,o])=>{o.forEach(s=>{t[s]=e.offset})}),t}function Cd(e,t,n={x:0,y:0}){if(e.length===0)return null;let o=1/0,s=1/0,r=-1/0,i=-1/0;return e.forEach(c=>{var y,v;const d=t[c];if(!d)return;const u=d.position.x+n.x,p=d.position.y+n.y,h=((y=d.size)==null?void 0:y.width)||150,x=((v=d.size)==null?void 0:v.height)||50;o=Math.min(o,u),s=Math.min(s,p),r=Math.max(r,u+h),i=Math.max(i,p+x)}),{minX:o,minY:s,maxX:r,maxY:i}}class Ln{constructor(){le(this,"listeners",new Map)}on(t,n){return this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n),()=>{const o=this.listeners.get(t);if(o){const s=o.indexOf(n);s>-1&&o.splice(s,1)}}}emit(t,n){const o=this.listeners.get(t);o&&o.forEach(s=>{try{s(n)}catch(r){console.error(`Error in settings event handler for ${t}:`,r)}})}removeAllListeners(){this.listeners.clear()}}class Vn{constructor(t="node-editor-settings"){le(this,"prefix");le(this,"eventEmitter",new Ln);this.prefix=t}getStorageKey(t){return`${this.prefix}-${t}`}get(t){try{const n=localStorage.getItem(this.getStorageKey(t));return n?JSON.parse(n):void 0}catch{return}}set(t,n){try{localStorage.setItem(this.getStorageKey(t),JSON.stringify(n)),this.eventEmitter.emit("change",{key:t,value:n})}catch(o){console.warn(`Failed to save setting ${t}:`,o)}}delete(t){localStorage.removeItem(this.getStorageKey(t)),this.eventEmitter.emit("change",{key:t,value:void 0})}clear(){this.keys().forEach(n=>{localStorage.removeItem(this.getStorageKey(n))})}keys(){const t=[],n=`${this.prefix}-`;for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&s.startsWith(n)&&t.push(s.substring(n.length))}return t}getMany(t){const n={};return t.forEach(o=>{const s=this.get(o);s!==void 0&&(n[o]=s)}),n}setMany(t){Object.entries(t).forEach(([n,o])=>{this.set(n,o)})}on(t,n){return this.eventEmitter.on(t,o=>n(o.key,o.value))}}const St={general:{key:"general",label:"General",description:"General editor settings",order:1},appearance:{key:"appearance",label:"Appearance",description:"Visual appearance and theming",order:2},behavior:{key:"behavior",label:"Behavior",description:"Editor behavior and interactions",order:3},performance:{key:"performance",label:"Performance",description:"Performance and optimization settings",order:4},keyboard:{key:"keyboard",label:"Keyboard",description:"Keyboard shortcuts and bindings",order:5},plugins:{key:"plugins",label:"Plugins",description:"Plugin management and configuration",order:6},advanced:{key:"advanced",label:"Advanced",description:"Advanced settings for power users",order:7}};class Sd extends Ln{constructor(n){super();le(this,"settings",new Map);le(this,"categories",new Map);le(this,"values",new Map);le(this,"storage");this.storage=n||new Vn,Object.values(St).forEach(o=>{this.registerCategory(o)}),this.loadFromStorage()}registerSetting(n){if(!n.key)throw new Error("Setting key is required");if(!n.category)throw new Error("Setting category is required");this.categories.has(n.category)||this.registerCategory({key:n.category,label:n.category.charAt(0).toUpperCase()+n.category.slice(1)}),this.settings.set(n.key,n),this.values.has(n.key)||this.values.set(n.key,n.defaultValue),this.emit("setting-registered",{setting:n})}unregisterSetting(n){this.settings.delete(n),this.values.delete(n),this.emit("setting-unregistered",{key:n})}getSetting(n){return this.settings.get(n)}getAllSettings(){return Object.fromEntries(this.settings)}getSettingsByCategory(n){return Array.from(this.settings.values()).filter(o=>o.category===n).sort((o,s)=>(o.order||0)-(s.order||0))}registerCategory(n){this.categories.set(n.key,n),this.emit("category-registered",{category:n})}unregisterCategory(n){this.categories.delete(n),this.emit("category-unregistered",{key:n})}getCategory(n){return this.categories.get(n)}getAllCategories(){return Array.from(this.categories.values()).sort((n,o)=>(n.order||0)-(o.order||0))}getValue(n){return this.values.get(n)}setValue(n,o){const s=this.settings.get(n);if(!s){console.warn(`Setting ${n} is not registered`);return}const r=this.validateSetting(n,o);if(r)throw new Error(`Invalid value for setting ${n}: ${r}`);const i=this.values.get(n);this.values.set(n,o),s.persistent!==!1&&this.storage.set(n,o);const c={key:n,value:o,previousValue:i,category:s.category};this.emit("change",c)}setValues(n){Object.entries(n).forEach(([o,s])=>{s!==void 0&&this.setValue(o,s)})}getAllValues(){return Object.fromEntries(this.values)}resetToDefaults(n){const o=n||Array.from(this.settings.keys());o.forEach(s=>{const r=this.settings.get(s);r&&this.setValue(s,r.defaultValue)}),this.emit("reset",{keys:o})}validateSetting(n,o){const s=this.settings.get(n);if(!s)return"Setting not found";if(s.required&&(o==null||o===""))return"This setting is required";if(o!=null)switch(s.type){case"number":case"range":if(typeof o!="number")return"Value must be a number";if(s.min!==void 0&&o<s.min)return`Value must be at least ${s.min}`;if(s.max!==void 0&&o>s.max)return`Value must be at most ${s.max}`;break;case"text":case"textarea":case"email":case"url":case"password":if(typeof o!="string")return"Value must be a string";if(s.minLength!==void 0&&o.length<s.minLength)return`Value must be at least ${s.minLength} characters long`;if(s.maxLength!==void 0&&o.length>s.maxLength)return`Value must be at most ${s.maxLength} characters long`;if(s.pattern&&!new RegExp(s.pattern).test(o))return"Value does not match required pattern";break;case"boolean":if(typeof o!="boolean")return"Value must be a boolean";break;case"select":if(s.options&&!s.options.map(i=>i.value).includes(o))return"Value must be one of the valid options";break;case"multiselect":if(!Array.isArray(o))return"Value must be an array";if(s.options){const r=s.options.map(i=>i.value);for(const i of o)if(!r.includes(i))return"All values must be valid options"}break}return s.validator?s.validator(o):null}validateAll(){const n={},o={};return this.settings.forEach((s,r)=>{const i=this.values.get(r),c=this.validateSetting(r,i);c&&(n[r]=c)}),{isValid:Object.keys(n).length===0,errors:n,warnings:o}}async save(){try{this.settings.forEach((n,o)=>{if(n.persistent!==!1){const s=this.values.get(o);s!==void 0&&this.storage.set(o,s)}}),this.emit("save",{timestamp:new Date().toISOString()})}catch(n){throw this.emit("save-error",{error:n}),n}}async load(){try{this.loadFromStorage(),this.emit("load",{timestamp:new Date().toISOString()})}catch(n){throw this.emit("load-error",{error:n}),n}}export(){const n={version:"1.0.0",timestamp:new Date().toISOString(),settings:this.getAllValues(),metadata:{editorVersion:"1.0.0",platform:typeof window<"u"?navigator.platform:"unknown"}};return JSON.stringify(n,null,2)}import(n){try{const o=JSON.parse(n);if(!o.settings)throw new Error("Invalid settings data");this.setValues(o.settings),this.emit("import",{data:o})}catch(o){throw this.emit("import-error",{error:o}),o}}getSchema(){const n={type:"object",properties:{},required:[]};return this.settings.forEach((o,s)=>{const r={title:o.label,description:o.description,default:o.defaultValue};switch(o.type){case"text":case"textarea":case"email":case"url":case"password":r.type="string",o.minLength&&(r.minLength=o.minLength),o.maxLength&&(r.maxLength=o.maxLength),o.pattern&&(r.pattern=o.pattern);break;case"number":case"range":r.type="number",o.min!==void 0&&(r.minimum=o.min),o.max!==void 0&&(r.maximum=o.max);break;case"boolean":r.type="boolean";break;case"select":r.type="string",o.options&&(r.enum=o.options.map(i=>i.value));break;case"multiselect":r.type="array",o.options&&(r.items={type:"string",enum:o.options.map(i=>i.value)});break;default:r.type="string"}n.properties[s]=r,o.required&&n.required.push(s)}),n}reset(){this.settings.clear(),this.categories.clear(),this.values.clear(),this.storage.clear(),Object.values(St).forEach(n=>{this.registerCategory(n)}),this.emit("reset-all",{})}loadFromStorage(){this.settings.forEach((n,o)=>{if(n.persistent!==!1){const s=this.storage.get(o);s!==void 0?this.values.set(o,s):this.values.set(o,n.defaultValue)}else this.values.set(o,n.defaultValue)})}}const wd=[{key:"general.language",label:"Language",description:"Interface language",category:"general",type:"select",defaultValue:"en",options:[{value:"en",label:"English"},{value:"ja",label:""},{value:"zh",label:""},{value:"ko",label:""},{value:"es",label:"Espaol"},{value:"fr",label:"Franais"},{value:"de",label:"Deutsch"}],order:1},{key:"general.autoSave",label:"Auto Save",description:"Automatically save changes",category:"general",type:"boolean",defaultValue:!0,order:2},{key:"general.autoSaveInterval",label:"Auto Save Interval",description:"Auto save interval in seconds",category:"general",type:"number",defaultValue:30,min:5,max:300,dependsOn:"general.autoSave",showWhen:e=>e["general.autoSave"]===!0,order:3},{key:"general.confirmBeforeExit",label:"Confirm Before Exit",description:"Show confirmation dialog before closing",category:"general",type:"boolean",defaultValue:!0,order:4},{key:"appearance.theme",label:"Theme",description:"Visual theme",category:"appearance",type:"select",defaultValue:"light",options:[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto (System)"}],order:1},{key:"appearance.fontSize",label:"Font Size",description:"Base font size in pixels",category:"appearance",type:"range",defaultValue:14,min:10,max:24,step:1,order:2},{key:"appearance.fontFamily",label:"Font Family",description:"Font family for the interface",category:"appearance",type:"select",defaultValue:"system",options:[{value:"system",label:"System Default"},{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Arial",label:"Arial"},{value:"monospace",label:"Monospace"}],order:3},{key:"appearance.showGrid",label:"Show Grid",description:"Display grid lines on canvas",category:"appearance",type:"boolean",defaultValue:!0,order:4},{key:"appearance.gridSize",label:"Grid Size",description:"Grid size in pixels",category:"appearance",type:"number",defaultValue:20,min:5,max:100,dependsOn:"appearance.showGrid",showWhen:e=>e["appearance.showGrid"]===!0,order:5},{key:"appearance.gridOpacity",label:"Grid Opacity",description:"Grid line opacity",category:"appearance",type:"range",defaultValue:.3,min:.1,max:1,step:.1,dependsOn:"appearance.showGrid",showWhen:e=>e["appearance.showGrid"]===!0,order:6},{key:"appearance.snapToGrid",label:"Snap to Grid",description:"Snap nodes to grid when moving",category:"appearance",type:"boolean",defaultValue:!1,order:7},{key:"appearance.showMinimap",label:"Show Minimap",description:"Display minimap overlay",category:"appearance",type:"boolean",defaultValue:!0,order:8},{key:"appearance.showStatusBar",label:"Show Status Bar",description:"Display status bar at bottom",category:"appearance",type:"boolean",defaultValue:!0,order:9},{key:"appearance.showToolbar",label:"Show Toolbar",description:"Display toolbar",category:"appearance",type:"boolean",defaultValue:!0,order:10},{key:"appearance.canvasBackground",label:"Canvas Background",description:"Canvas background color",category:"appearance",type:"color",defaultValue:"#ffffff",order:11},{key:"behavior.doubleClickToEdit",label:"Double Click to Edit",description:"Double click nodes to edit properties",category:"behavior",type:"boolean",defaultValue:!0,order:1},{key:"behavior.autoConnect",label:"Auto Connect",description:"Automatically connect compatible ports when dragging",category:"behavior",type:"boolean",defaultValue:!0,order:2},{key:"behavior.smoothAnimations",label:"Smooth Animations",description:"Enable smooth animations for transitions",category:"behavior",type:"boolean",defaultValue:!0,order:3},{key:"behavior.dragThreshold",label:"Drag Threshold",description:"Minimum distance to start dragging (pixels)",category:"behavior",type:"number",defaultValue:5,min:1,max:20,order:4},{key:"behavior.connectionStyle",label:"Connection Style",description:"Style of connection lines",category:"behavior",type:"select",defaultValue:"curved",options:[{value:"straight",label:"Straight"},{value:"curved",label:"Curved"},{value:"orthogonal",label:"Orthogonal"}],order:5},{key:"behavior.selectionMode",label:"Selection Mode",description:"How to select multiple nodes",category:"behavior",type:"select",defaultValue:"click",options:[{value:"click",label:"Click with Modifier"},{value:"drag",label:"Drag Selection Box"}],order:6},{key:"behavior.wheelZoomSensitivity",label:"Zoom Sensitivity",description:"Mouse wheel zoom sensitivity",category:"behavior",type:"range",defaultValue:1,min:.1,max:3,step:.1,order:7},{key:"performance.maxHistorySteps",label:"Max History Steps",description:"Maximum number of undo/redo steps",category:"performance",type:"number",defaultValue:50,min:10,max:200,order:1},{key:"performance.renderOptimization",label:"Render Optimization",description:"Enable render optimization techniques",category:"performance",type:"boolean",defaultValue:!0,order:2},{key:"performance.lazyLoading",label:"Lazy Loading",description:"Load nodes and connections lazily",category:"performance",type:"boolean",defaultValue:!0,order:3},{key:"performance.virtualScrolling",label:"Virtual Scrolling",description:"Use virtual scrolling for large node lists",category:"performance",type:"boolean",defaultValue:!0,order:4},{key:"performance.maxVisibleNodes",label:"Max Visible Nodes",description:"Maximum number of nodes to render at once",category:"performance",type:"number",defaultValue:1e3,min:100,max:5e3,order:5},{key:"keyboard.undo",label:"Undo",description:"Keyboard shortcut for undo",category:"keyboard",type:"text",defaultValue:"Ctrl+Z",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:1},{key:"keyboard.redo",label:"Redo",description:"Keyboard shortcut for redo",category:"keyboard",type:"text",defaultValue:"Ctrl+Y",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:2},{key:"keyboard.selectAll",label:"Select All",description:"Keyboard shortcut for select all",category:"keyboard",type:"text",defaultValue:"Ctrl+A",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:3},{key:"keyboard.delete",label:"Delete",description:"Keyboard shortcut for delete",category:"keyboard",type:"text",defaultValue:"Delete",order:4},{key:"keyboard.copy",label:"Copy",description:"Keyboard shortcut for copy",category:"keyboard",type:"text",defaultValue:"Ctrl+C",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:5},{key:"keyboard.paste",label:"Paste",description:"Keyboard shortcut for paste",category:"keyboard",type:"text",defaultValue:"Ctrl+V",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:6},{key:"keyboard.duplicate",label:"Duplicate",description:"Keyboard shortcut for duplicate",category:"keyboard",type:"text",defaultValue:"Ctrl+D",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:7},{key:"keyboard.group",label:"Group",description:"Keyboard shortcut for group nodes",category:"keyboard",type:"text",defaultValue:"Ctrl+G",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:8},{key:"keyboard.save",label:"Save",description:"Keyboard shortcut for save",category:"keyboard",type:"text",defaultValue:"Ctrl+S",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:9},{key:"plugins.autoUpdate",label:"Auto Update Plugins",description:"Automatically update plugins when available",category:"plugins",type:"boolean",defaultValue:!1,order:1},{key:"plugins.allowUnsafe",label:"Allow Unsafe Plugins",description:"Allow loading plugins without security verification",category:"plugins",type:"boolean",defaultValue:!1,order:2},{key:"plugins.maxMemoryUsage",label:"Max Memory Usage",description:"Maximum memory usage for plugins (MB)",category:"plugins",type:"number",defaultValue:100,min:10,max:1e3,order:3},{key:"advanced.debugMode",label:"Debug Mode",description:"Enable debug mode with additional logging",category:"advanced",type:"boolean",defaultValue:!1,order:1},{key:"advanced.showPerformanceMetrics",label:"Show Performance Metrics",description:"Display performance metrics in the UI",category:"advanced",type:"boolean",defaultValue:!1,order:2},{key:"advanced.logLevel",label:"Log Level",description:"Minimum log level to display",category:"advanced",type:"select",defaultValue:"info",options:[{value:"debug",label:"Debug"},{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"}],order:3},{key:"advanced.experimentalFeatures",label:"Experimental Features",description:"Enable experimental features (may be unstable)",category:"advanced",type:"boolean",defaultValue:!1,order:4},{key:"advanced.customCSS",label:"Custom CSS",description:"Custom CSS to apply to the editor",category:"advanced",type:"textarea",defaultValue:"",placeholder:"/* Enter custom CSS here */",order:5}];exports.ColumnLayout=yn;exports.DEFAULT_NODE_SIZE=Ge;exports.DEFAULT_PORT_POSITION_CONFIG=Se;exports.DebugOverlay=Rn;exports.EditorActionStateProvider=jt;exports.ExternalDataProvider=Rt;exports.FloatingContainer=ct;exports.GridToolbox=An;exports.HistoryProvider=qt;exports.InlineEditingProvider=Tt;exports.InspectorPanel=at;exports.KeyboardShortcutProvider=Et;exports.LocalSettingsStorage=Vn;exports.Minimap=zn;exports.NodeCanvasProvider=Dt;exports.NodeDefinitionProvider=Mt;exports.NodeEditor=Mn;exports.NodeEditorProvider=Kt;exports.NodeInspector=it;exports.PortPositionProvider=On;exports.SettingsManager=Sd;exports.SpatialGrid=mo;exports.Toolbar=Nd;exports.addVectors=ja;exports.asOriginalInspectorRender=lo;exports.asOriginalNodeRender=co;exports.calculateNodeDragOffsets=bd;exports.computeAllPortPositions=Xt;exports.computeNodePortPositions=we;exports.createBoundingBox=po;exports.createConnectionLookupMaps=fo;exports.createNodeDataUpdater=ao;exports.createNodeDefinition=ro;exports.createParentToChildrenMap=Lt;exports.createPortToNodeMap=go;exports.defaultSettings=wd;exports.doRectanglesIntersect=ho;exports.getDistance=En;exports.getDraggedNodesBounds=Cd;exports.getNodeBoundingBox=Ce;exports.getTypedNodeData=io;exports.getVector=Pa;exports.isRectangleInsideAnother=At;exports.scaleVector=Ta;exports.subtractVectors=ka;exports.updatePortPositions=zo;exports.useActionState=Eo;exports.useActionStateActions=nt;exports.useBatchedUpdates=ko;exports.useCanvasActions=tt;exports.useCanvasState=wo;exports.useCommonActions=Io;exports.useDocumentPointerEvents=$t;exports.useDragPointerEvents=Co;exports.useDynamicConnectionPoint=fe;exports.useDynamicPortPosition=st;exports.useEditorActionState=W;exports.useEditorActions=Gt;exports.useExternalDataRef=Ze;exports.useGroupManagement=Qe;exports.useInlineEditing=Ot;exports.useNodeCanvas=ne;exports.useNodeDefinition=Me;exports.useNodeDefinitionList=ze;exports.useNodeDefinitions=Oe;exports.useNodeEditor=X;exports.useNodeEditorActions=et;exports.useNodeEditorState=So;exports.useNodePortPositions=bc;exports.useNodeResize=qe;exports.usePointerCapture=Ht;exports.usePointerDrag=bo;exports.usePointerInteraction=Ue;exports.usePortPosition=Nc;exports.usePortPositions=dt;exports.usePreventPointerDefaults=Bt;exports.useSettings=ot;exports.useVisibleNodes=Ut;
