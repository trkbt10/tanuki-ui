"use strict";var Ln=Object.defineProperty;var Vn=(e,t,n)=>t in e?Ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ue=(e,t,n)=>Vn(e,typeof t!="symbol"?t+"":t,n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("react/jsx-runtime"),jt=require("react");function _n(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const l=_n(jt),Re=({variant:e="primary",size:t="medium",className:n="",children:o,...s})=>{const r="ne-button",i=`ne-button--${e}`,c=`ne-button--${t}`,d=[r,i,c,n].filter(Boolean).join(" ");return a.jsx("button",{className:d,...s,children:o})},Ne=({error:e=!1,variant:t="default",className:n="",...o})=>{const s="ne-input",r=`ne-input--${t}`,c=[s,r,e?"ne-input--error":"",n].filter(Boolean).join(" ");return a.jsx("input",{className:c,...o})},he=({required:e=!1,disabled:t=!1,className:n="",children:o,...s})=>{const c=["ne-label",t?"ne-label--disabled":"",n].filter(Boolean).join(" ");return a.jsxs("label",{className:c,...s,children:[o,e&&a.jsx("span",{className:"ne-label__required",children:"*"})]})},$n=({error:e=!1,variant:t="default",resize:n="vertical",className:o="",...s})=>{const r="ne-textarea",i=`ne-textarea--${t}`,c=e?"ne-textarea--error":"",d=`ne-textarea--resize-${n}`,u=[r,i,c,d,o].filter(Boolean).join(" ");return a.jsx("textarea",{className:u,...s})},Hn=({level:e=1,size:t,weight:n="semibold",color:o="primary",className:s="",children:r,...i})=>{const c=`h${e}`,d="ne-heading",u=`ne-heading--h${e}`,p=t?`ne-heading--${t}`:"",h=`ne-heading--${n}`,x=`ne-heading--${o}`,y=[d,u,p,h,x,s].filter(Boolean).join(" ");return a.jsx(c,{className:y,...i,children:r})},Ge=e=>a.jsx(Hn,{level:4,...e}),Z=(e,t="0 0 24 24")=>jt.forwardRef(({size:n=16,color:o="currentColor",className:s="",...r},i)=>a.jsx("svg",{ref:i,className:`ne-icon ${s}`,width:n,height:n,viewBox:t,fill:"none",stroke:o,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",...r,children:typeof e=="string"?a.jsx("path",{d:e}):e})),Bn=Z("M17 10H3M21 6H3M21 14H3M17 18H3"),Gn=Z("M18 10H6M21 6H3M21 14H3M18 18H6"),Un=Z("M21 10H7M21 6H3M21 14H3M21 18H7"),Xn=Z("M3 3H21M8 8V21M16 8V21M12 8V21"),Fn=Z("M3 12H21M8 3V21M16 3V21M12 3V21"),Yn=Z("M3 21H21M8 3V16M16 3V16M12 3V16"),Wn=Z("M3 3V21M21 3V21M8 6H16M8 12H16M8 18H16"),Kn=Z("M3 3H21M3 21H21M6 8V16M12 8V16M18 8V16"),Zn=Z("M18 6L6 18M6 6L18 18");Z("M20 6L9 17L4 12");Z("M6 9L12 15L18 9");Z("M18 15L12 9L6 15");Z("M15 18L9 12L15 6");Z("M9 18L15 12L9 6");Z("M12 5V19M5 12H19");Z("M5 12H19");Z("M11 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H16A2 2 0 0 0 18 18V11M18.5 2.5A2.121 2.121 0 0 1 21 5L5.5 20.5L2 22L3.5 18.5L18.5 2.5Z");Z("M3 6H5H21M8 6V4A2 2 0 0 1 10 2H14A2 2 0 0 1 16 4V6M19 6V20A2 2 0 0 1 17 22H7A2 2 0 0 1 5 20V6H19Z");Z("M21 21L16.514 16.506L21 21ZM18 10.5A7.5 7.5 0 1 1 3 10.5A7.5 7.5 0 0 1 18 10.5Z");Z("M12 15A3 3 0 1 0 12 9A3 3 0 0 0 12 15ZM19.4 15A1.65 1.65 0 0 0 19.04 13.36L20.55 12L19.04 10.64A1.65 1.65 0 0 0 19.4 9L18.76 7.4A1.65 1.65 0 0 0 17.45 6.63L15.55 7.1A7.1 7.1 0 0 0 14.12 6.16L13.91 4.23A1.65 1.65 0 0 0 12.29 3H11.71A1.65 1.65 0 0 0 10.09 4.23L9.88 6.16A7.1 7.1 0 0 0 8.45 7.1L6.55 6.63A1.65 1.65 0 0 0 5.24 7.4L4.6 9A1.65 1.65 0 0 0 4.96 10.64L3.45 12L4.96 13.36A1.65 1.65 0 0 0 4.6 15L5.24 16.6A1.65 1.65 0 0 0 6.55 17.37L8.45 16.9A7.1 7.1 0 0 0 9.88 17.84L10.09 19.77A1.65 1.65 0 0 0 11.71 21H12.29A1.65 1.65 0 0 0 13.91 19.77L14.12 17.84A7.1 7.1 0 0 0 15.55 16.9L17.45 17.37A1.65 1.65 0 0 0 18.76 16.6L19.4 15Z");function U(...e){const t=[];for(const n of e){if(!n)continue;const o=typeof n;if(o==="string"||o==="number")t.push(String(n));else if(Array.isArray(n)){const s=U(...n);s&&t.push(s)}else if(o==="object"){const s=n;for(const r in s)s[r]&&t.push(r)}}return t.join(" ")}function qn(){return{width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY}}function Jn(e,t,n,o,s){let r=e,i=t;return e+n>s.width&&(r=Math.max(0,s.width-n)),t+o>s.height&&(i=Math.max(0,s.height-o)),r<0&&(r=0),i<0&&(i=0),{x:r,y:i}}const gt=e=>{const t=[];return e.ctrl&&t.push("ctrl"),e.shift&&t.push("shift"),e.alt&&t.push("alt"),e.meta&&t.push("meta"),t.push(e.key.toLowerCase()),t.join("+")},Qn=(e,t)=>e.key.toLowerCase()===t.key.toLowerCase()&&!!e.ctrlKey==!!t.ctrl&&!!e.shiftKey==!!t.shift&&!!e.altKey==!!t.alt&&!!e.metaKey==!!t.meta,eo=(e,t)=>{switch(t.type){case"REGISTER_SHORTCUT":{const n=gt(t.payload.shortcut),o=new Map(e.shortcuts);return o.set(n,t.payload.handler),{...e,shortcuts:o}}case"UNREGISTER_SHORTCUT":{const n=gt(t.payload.shortcut),o=new Map(e.shortcuts);return o.delete(n),{...e,shortcuts:o}}case"ENABLE_SHORTCUTS":return{...e,isEnabled:!0};case"DISABLE_SHORTCUTS":return{...e,isEnabled:!1};default:return e}},to={shortcuts:new Map,isEnabled:!0},Ue={registerShortcut:(e,t)=>({type:"REGISTER_SHORTCUT",payload:{shortcut:e,handler:t}}),unregisterShortcut:e=>({type:"UNREGISTER_SHORTCUT",payload:{shortcut:e}}),enableShortcuts:()=>({type:"ENABLE_SHORTCUTS"}),disableShortcuts:()=>({type:"DISABLE_SHORTCUTS"})},kt=l.createContext(null),Mt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(eo,{...to,...t});l.useEffect(()=>{const c=d=>{if(!n.isEnabled)return;const u=d.target;if(!(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable))for(const[p,h]of n.shortcuts){const x=p.split("+"),y=x[x.length-1],v=x.slice(0,-1),f={key:y,ctrl:v.includes("ctrl"),shift:v.includes("shift"),alt:v.includes("alt"),meta:v.includes("meta")};if(Qn(d,f)){d.preventDefault(),d.stopPropagation(),h(d);break}}};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[n.shortcuts,n.isEnabled]);const s=l.useCallback((c,d)=>{o(Ue.registerShortcut(c,d))},[o]),r=l.useCallback(c=>{o(Ue.unregisterShortcut(c))},[o]),i={state:n,dispatch:o,actions:Ue,registerShortcut:s,unregisterShortcut:r};return a.jsx(kt.Provider,{value:i,children:e})},no=()=>{const e=l.useContext(kt);if(!e)throw new Error("useKeyboardShortcut must be used within a KeyboardShortcutProvider");return e},ae=(e,t,n=[])=>{const{registerShortcut:o,unregisterShortcut:s}=no();l.useEffect(()=>(o(e,t),()=>s(e)),[o,s,...n])},oo=(e,t)=>{switch(t.type){case"SET_VIEWPORT":return{...e,viewport:t.payload.viewport};case"PAN_VIEWPORT":{const{delta:n}=t.payload;return{...e,viewport:{...e.viewport,offset:{x:e.viewport.offset.x+n.x,y:e.viewport.offset.y+n.y}}}}case"ZOOM_VIEWPORT":{const{scale:n,center:o}=t.payload,s=Math.max(.01,Math.min(64,n));if(o){const r=s/e.viewport.scale,i={x:o.x-(o.x-e.viewport.offset.x)*r,y:o.y-(o.y-e.viewport.offset.y)*r};return{...e,viewport:{offset:i,scale:s}}}return{...e,viewport:{...e.viewport,scale:s}}}case"RESET_VIEWPORT":return{...e,viewport:{offset:{x:0,y:0},scale:1}};case"UPDATE_GRID_SETTINGS":return{...e,gridSettings:{...e.gridSettings,...t.payload.settings}};case"SET_SPACE_PANNING":return{...e,isSpacePanning:t.payload.isSpacePanning};case"START_PAN":return{...e,panState:{isPanning:!0,startPosition:t.payload.position}};case"UPDATE_PAN":{if(!e.panState.isPanning||!e.panState.startPosition)return e;const n=t.payload.position.x-e.panState.startPosition.x,o=t.payload.position.y-e.panState.startPosition.y;return{...e,viewport:{...e.viewport,offset:{x:e.viewport.offset.x+n,y:e.viewport.offset.y+o}},panState:{...e.panState,startPosition:t.payload.position}}}case"END_PAN":return{...e,panState:{isPanning:!1,startPosition:null}};default:return e}},so={viewport:{offset:{x:0,y:0},scale:1},gridSettings:{enabled:!1,size:20,showGrid:!0,snapToGrid:!1,snapThreshold:8},isSpacePanning:!1,panState:{isPanning:!1,startPosition:null}},ro={setViewport:e=>({type:"SET_VIEWPORT",payload:{viewport:e}}),panViewport:e=>({type:"PAN_VIEWPORT",payload:{delta:e}}),zoomViewport:(e,t)=>({type:"ZOOM_VIEWPORT",payload:{scale:e,center:t}}),resetViewport:()=>({type:"RESET_VIEWPORT"}),updateGridSettings:e=>({type:"UPDATE_GRID_SETTINGS",payload:{settings:e}}),setSpacePanning:e=>({type:"SET_SPACE_PANNING",payload:{isSpacePanning:e}}),startPan:e=>({type:"START_PAN",payload:{position:e}}),updatePan:e=>({type:"UPDATE_PAN",payload:{position:e}}),endPan:()=>({type:"END_PAN"})},io=(e,t)=>({screenToCanvas:(n,o)=>{if(!e.current)return console.warn("Canvas ref is not available for coordinate conversion"),{x:n,y:o};const s=e.current.getBoundingClientRect();return{x:(n-s.left-t.offset.x)/t.scale,y:(o-s.top-t.offset.y)/t.scale}},canvasToScreen:(n,o)=>{if(!e.current)return console.warn("Canvas ref is not available for coordinate conversion"),{x:n,y:o};const s=e.current.getBoundingClientRect();return{x:n*t.scale+t.offset.x+s.left,y:o*t.scale+t.offset.y+s.top}}}),Tt=l.createContext(null),Ot=({children:e,initialState:t})=>{const[n,o]=l.useReducer(oo,{...so,...t}),s=l.useRef(null),r=l.useMemo(()=>io(s,n.viewport),[n.viewport]),i={state:n,dispatch:o,actions:ro,canvasRef:s,utils:r};return a.jsx(Tt.Provider,{value:i,children:e})},oe=()=>{const e=l.useContext(Tt);if(!e)throw new Error("useNodeCanvas must be used within a NodeCanvasProvider");return e},ao=(e,t)=>{switch(t.type){case"SELECT_NODE":{const{nodeId:n,multiple:o}=t.payload;if(o){const s=e.selectedNodeIds.includes(n);return{...e,selectedNodeIds:s?e.selectedNodeIds.filter(r=>r!==n):[...e.selectedNodeIds,n]}}return{...e,selectedNodeIds:[n],selectedConnectionIds:[]}}case"SELECT_CONNECTION":{const{connectionId:n,multiple:o}=t.payload;if(o){const s=e.selectedConnectionIds.includes(n);return{...e,selectedConnectionIds:s?e.selectedConnectionIds.filter(r=>r!==n):[...e.selectedConnectionIds,n]}}return{...e,selectedConnectionIds:[n],selectedNodeIds:[]}}case"CLEAR_SELECTION":return{...e,selectedNodeIds:[],selectedConnectionIds:[],selectionBox:null};case"SELECT_ALL_NODES":return{...e,selectedNodeIds:t.payload.nodeIds,selectedConnectionIds:[]};case"SET_SELECTION_BOX":return{...e,selectionBox:t.payload.box};case"START_NODE_DRAG":{const{nodeIds:n,startPosition:o,initialPositions:s,affectedChildNodes:r}=t.payload;return{...e,dragState:{nodeIds:n,startPosition:o,offset:{x:0,y:0},initialPositions:s,affectedChildNodes:r}}}case"UPDATE_NODE_DRAG":return e.dragState?{...e,dragState:{...e.dragState,offset:t.payload.offset}}:e;case"END_NODE_DRAG":return{...e,dragState:null};case"SET_HOVERED_NODE":return{...e,hoveredNodeId:t.payload.nodeId};case"SET_HOVERED_CONNECTION":return{...e,hoveredConnectionId:t.payload.connectionId};case"START_CONNECTION_DRAG":return{...e,connectionDragState:{fromPort:t.payload.fromPort,toPosition:{x:0,y:0},validTarget:null,candidatePort:null}};case"UPDATE_CONNECTION_DRAG":return e.connectionDragState?{...e,connectionDragState:{...e.connectionDragState,toPosition:t.payload.toPosition,candidatePort:t.payload.candidatePort}}:e;case"END_CONNECTION_DRAG":return{...e,connectionDragState:null};case"START_CONNECTION_DISCONNECT":return{...e,connectionDisconnectState:{connectionId:t.payload.originalConnection.id,fixedPort:t.payload.fixedPort,draggingEnd:t.payload.disconnectedEnd,draggingPosition:t.payload.draggingPosition,originalConnection:t.payload.originalConnection,disconnectedEnd:t.payload.disconnectedEnd,candidatePort:null}};case"UPDATE_CONNECTION_DISCONNECT":return e.connectionDisconnectState?{...e,connectionDisconnectState:{...e.connectionDisconnectState,draggingPosition:t.payload.draggingPosition,candidatePort:t.payload.candidatePort}}:e;case"END_CONNECTION_DISCONNECT":return{...e,connectionDisconnectState:null};case"SET_HOVERED_PORT":return{...e,hoveredPort:t.payload.port};case"UPDATE_CONNECTED_PORTS":return{...e,connectedPorts:t.payload.connectedPorts};case"UPDATE_CONNECTABLE_PORTS":return{...e,connectablePortIds:t.payload.connectablePortIds};case"START_NODE_RESIZE":{const{nodeId:n,startPosition:o,startSize:s,handle:r}=t.payload;return{...e,resizeState:{nodeId:n,startPosition:o,startSize:s,currentSize:s,currentPosition:o,handle:r}}}case"UPDATE_NODE_RESIZE":return e.resizeState?{...e,resizeState:{...e.resizeState,currentSize:t.payload.currentSize}}:e;case"END_NODE_RESIZE":return{...e,resizeState:null};case"SHOW_CONTEXT_MENU":return{...e,contextMenu:{visible:!0,position:t.payload.position,canvasPosition:t.payload.canvasPosition,nodeId:t.payload.nodeId}};case"HIDE_CONTEXT_MENU":return{...e,contextMenu:{visible:!1,position:{x:0,y:0},canvasPosition:void 0,nodeId:void 0}};default:return e}},co={selectedNodeIds:[],selectedConnectionIds:[],selectionBox:null,dragState:null,resizeState:null,hoveredNodeId:null,hoveredConnectionId:null,connectionDragState:null,connectionDisconnectState:null,hoveredPort:null,connectedPorts:new Set,connectablePortIds:new Set,contextMenu:{visible:!1,position:{x:0,y:0},canvasPosition:void 0,nodeId:void 0}},lo={selectNode:(e,t=!1)=>({type:"SELECT_NODE",payload:{nodeId:e,multiple:t}}),selectConnection:(e,t=!1)=>({type:"SELECT_CONNECTION",payload:{connectionId:e,multiple:t}}),clearSelection:()=>({type:"CLEAR_SELECTION"}),selectAllNodes:e=>({type:"SELECT_ALL_NODES",payload:{nodeIds:e}}),setSelectionBox:e=>({type:"SET_SELECTION_BOX",payload:{box:e}}),startNodeDrag:(e,t,n,o)=>({type:"START_NODE_DRAG",payload:{nodeIds:e,startPosition:t,initialPositions:n,affectedChildNodes:o}}),updateNodeDrag:e=>({type:"UPDATE_NODE_DRAG",payload:{offset:e}}),endNodeDrag:()=>({type:"END_NODE_DRAG"}),setHoveredNode:e=>({type:"SET_HOVERED_NODE",payload:{nodeId:e}}),setHoveredConnection:e=>({type:"SET_HOVERED_CONNECTION",payload:{connectionId:e}}),startConnectionDrag:e=>({type:"START_CONNECTION_DRAG",payload:{fromPort:e}}),updateConnectionDrag:(e,t)=>({type:"UPDATE_CONNECTION_DRAG",payload:{toPosition:e,candidatePort:t}}),endConnectionDrag:()=>({type:"END_CONNECTION_DRAG"}),setHoveredPort:e=>({type:"SET_HOVERED_PORT",payload:{port:e}}),updateConnectedPorts:e=>({type:"UPDATE_CONNECTED_PORTS",payload:{connectedPorts:e}}),updateConnectablePorts:e=>({type:"UPDATE_CONNECTABLE_PORTS",payload:{connectablePortIds:e}}),startConnectionDisconnect:(e,t,n,o)=>({type:"START_CONNECTION_DISCONNECT",payload:{originalConnection:e,disconnectedEnd:t,fixedPort:n,draggingPosition:o}}),updateConnectionDisconnect:(e,t)=>({type:"UPDATE_CONNECTION_DISCONNECT",payload:{draggingPosition:e,candidatePort:t}}),endConnectionDisconnect:()=>({type:"END_CONNECTION_DISCONNECT"}),startNodeResize:(e,t,n,o)=>({type:"START_NODE_RESIZE",payload:{nodeId:e,startPosition:t,startSize:n,handle:o}}),updateNodeResize:e=>({type:"UPDATE_NODE_RESIZE",payload:{currentSize:e}}),endNodeResize:()=>({type:"END_NODE_RESIZE"}),showContextMenu:(e,t,n)=>({type:"SHOW_CONTEXT_MENU",payload:{position:e,nodeId:t,canvasPosition:n}}),hideContextMenu:()=>({type:"HIDE_CONTEXT_MENU"})},At=l.createContext(null),Rt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(ao,{...co,...t}),s={state:n,dispatch:o,actions:lo};return a.jsx(At.Provider,{value:s,children:e})},W=()=>{const e=l.useContext(At);if(!e)throw new Error("useEditorActionState must be used within an EditorActionStateProvider");return e},uo=(e,t)=>{switch(t.type){case"START_EDITING":{const{nodeId:n,field:o,value:s}=t.payload;return{editingNodeId:n,editingField:o,originalValue:s,currentValue:s,isActive:!0}}case"UPDATE_VALUE":return e.isActive?{...e,currentValue:t.payload.value}:e;case"CONFIRM_EDIT":case"CANCEL_EDIT":case"END_EDITING":return{editingNodeId:null,editingField:null,originalValue:"",currentValue:"",isActive:!1};default:return e}},po={editingNodeId:null,editingField:null,originalValue:"",currentValue:"",isActive:!1},Se={startEditing:(e,t,n)=>({type:"START_EDITING",payload:{nodeId:e,field:t,value:n}}),updateValue:e=>({type:"UPDATE_VALUE",payload:{value:e}}),confirmEdit:()=>({type:"CONFIRM_EDIT"}),cancelEdit:()=>({type:"CANCEL_EDIT"}),endEditing:()=>({type:"END_EDITING"})},zt=l.createContext(null),Lt=({children:e,initialState:t})=>{const[n,o]=l.useReducer(uo,{...po,...t}),s=l.useCallback((p,h)=>!(!n.isActive||n.editingNodeId!==p||h&&n.editingField!==h),[n.isActive,n.editingNodeId,n.editingField]),r=l.useCallback((p,h,x)=>{o(Se.startEditing(p,h,x))},[o]),i=l.useCallback(p=>{o(Se.updateValue(p))},[o]),c=l.useCallback(()=>{o(Se.confirmEdit())},[o]),d=l.useCallback(()=>{o(Se.cancelEdit())},[o]),u={state:n,dispatch:o,actions:Se,isEditing:s,startEditing:r,updateValue:i,confirmEdit:c,cancelEdit:d};return a.jsx(zt.Provider,{value:u,children:e})},Vt=()=>{const e=l.useContext(zt);if(!e)throw new Error("useInlineEditing must be used within an InlineEditingProvider");return e};function ho(){const e=new Map;return{definitions:e,register(t){e.set(t.type,t)},unregister(t){e.delete(t)},get(t){return e.get(t)},getAll(){return Array.from(e.values())},getByCategory(t){return Array.from(e.values()).filter(n=>n.category===t)}}}const fo={type:"standard",displayName:"Standard Node",description:"A basic node with customizable properties",category:"Basic",defaultData:{title:"New Node",content:""},defaultSize:{width:200,height:100},ports:[{id:"input",type:"input",label:"Input",position:"left"},{id:"output",type:"output",label:"Output",position:"right"}]},go={type:"group",displayName:"Group",description:"A container node that can hold other nodes",category:"Structure",defaultData:{title:"Group"},defaultSize:{width:300,height:200},supportsChildren:!0,visualState:"info"};function mo(e){return e}function yo(e){return e.data}function xo(e){return t=>{e({data:t})}}function vo(e){return e}function bo(e){return e}const et=l.createContext(null),_t=({children:e,nodeDefinitions:t=[],includeDefaults:n=!0})=>{const s={registry:l.useMemo(()=>{const r=ho();return n&&(r.register(fo),r.register(go)),t.forEach(i=>r.register(i)),r},[t,n])};return a.jsx(et.Provider,{value:s,children:e})},ze=()=>{const e=l.useContext(et);if(!e)throw new Error("useNodeDefinitions must be used within a NodeDefinitionProvider");return e},Le=e=>{const{registry:t}=ze();return t.get(e)},Ve=()=>{const{registry:e}=ze();return e.getAll()},$t=l.createContext(null),Ht=({children:e,refs:t={}})=>{const n={refs:t};return a.jsx($t.Provider,{value:n,children:e})},No=()=>{const e=l.useContext($t);if(!e)throw new Error("useExternalDataRefs must be used within an ExternalDataProvider");return e},tt=e=>{const{refs:t}=No();return t[e]},nt=(e={})=>{const{dispatch:t,actions:n}=F(),{state:o,dispatch:s,actions:r}=W(),{minWidth:i=100,minHeight:c=40,snapToGrid:d=!1,gridSize:u=20}=e,p=l.useCallback((f,g,b,D)=>{const E={width:Math.max(i,g.width+b),height:Math.max(c,g.height+D)};return d&&(E.width=Math.round(E.width/u)*u,E.height=Math.round(E.height/u)*u),E},[i,c,d,u]);l.useEffect(()=>{if(!o.resizeState)return;const{nodeId:f,startPosition:g,startSize:b,handle:D}=o.resizeState,E=m=>{const N=m.clientX-g.x,C=m.clientY-g.y,I=p(D,b,N,C);s(r.updateNodeResize(I))},w=m=>{if(o.resizeState){const{nodeId:N,currentSize:C}=o.resizeState;t(n.updateNode(N,{size:C}))}s(r.endNodeResize())},j=m=>{m.key==="Escape"&&s(r.endNodeResize())};return window.addEventListener("pointermove",E),window.addEventListener("pointerup",w),window.addEventListener("keydown",j),()=>{window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",w),window.removeEventListener("keydown",j)}},[o.resizeState,p,s,r,t,n]);const h=l.useCallback((f,g,b,D)=>{s(r.startNodeResize(f,b,D,g))},[s,r]),x=l.useCallback(f=>{var g;return((g=o.resizeState)==null?void 0:g.nodeId)===f},[o.resizeState]),y=l.useCallback(f=>{var g;return((g=o.resizeState)==null?void 0:g.nodeId)===f?o.resizeState.handle:null},[o.resizeState]),v=l.useCallback(f=>{var g;return((g=o.resizeState)==null?void 0:g.nodeId)===f?o.resizeState.currentSize:null},[o.resizeState]);return{startResize:h,isResizing:x,getResizeHandle:y,getCurrentSize:v}},We={width:150,height:50};function ot(e){var t,n;return{width:((t=e.size)==null?void 0:t.width)||We.width,height:((n=e.size)==null?void 0:n.height)||We.height}}function we(e){const{width:t,height:n}=ot(e);return{left:e.position.x,top:e.position.y,right:e.position.x+t,bottom:e.position.y+n,width:t,height:n}}function Co(e,t){return{left:e.x,top:e.y,right:e.x+t.width,bottom:e.y+t.height,width:t.width,height:t.height}}function So(e,t){return!(e.right<t.left||t.right<e.left||e.bottom<t.top||t.bottom<e.top)}function Bt(e,t){return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom}function Eo(e,t){const n=new Map;return Object.entries(e).forEach(([o,s])=>{(t?t(o):s.ports||[]).forEach(i=>{n.set(i.id,o)})}),n}function Gt(e){const t=new Map;return Object.entries(e).forEach(([n,o])=>{o.parentId&&(t.has(o.parentId)||t.set(o.parentId,[]),t.get(o.parentId).push(n))}),t}function wo(e){const t=new Map,n=new Map,o=new Map,s=new Map,r=new Map;return Object.values(e).forEach(i=>{t.has(i.fromNodeId)||t.set(i.fromNodeId,[]),n.has(i.toNodeId)||n.set(i.toNodeId,[]),t.get(i.fromNodeId).push(i),n.get(i.toNodeId).push(i),o.has(i.fromPortId)||o.set(i.fromPortId,[]),s.has(i.toPortId)||s.set(i.toPortId,[]),o.get(i.fromPortId).push(i),s.get(i.toPortId).push(i);const c=`${i.fromNodeId}:${i.fromPortId}`,d=`${i.toNodeId}:${i.toPortId}`;r.has(c)||r.set(c,[]),r.has(d)||r.set(d,[]),r.get(c).push(i),r.get(d).push(i)}),{byFromNode:t,byToNode:n,byFromPort:o,byToPort:s,byEndpoint:r}}class Io{constructor(t=200){ue(this,"cells",new Map);ue(this,"cellSize");this.cellSize=t}getCellKey(t,n){const o=Math.floor(t/this.cellSize),s=Math.floor(n/this.cellSize);return`${o},${s}`}insert(t,n,o){const s=this.getCellKey(n,o);this.cells.has(s)||this.cells.set(s,[]),this.cells.get(s).push(t)}getNearby(t,n,o=1){const s=[],r=Math.ceil(o/this.cellSize),i=Math.floor(t/this.cellSize),c=Math.floor(n/this.cellSize);for(let d=-r;d<=r;d++)for(let u=-r;u<=r;u++){const p=`${i+d},${c+u}`,h=this.cells.get(p);h&&s.push(...h)}return s}clear(){this.cells.clear()}getInArea(t,n,o,s){const r=[],i=Math.floor(t/this.cellSize),c=Math.floor(n/this.cellSize),d=Math.floor(o/this.cellSize),u=Math.floor(s/this.cellSize);for(let p=i;p<=d;p++)for(let h=c;h<=u;h++){const x=`${p},${h}`,y=this.cells.get(x);y&&r.push(...y)}return r}}const Do=(e,t)=>{if(e.id===t.id||e.type==="group")return!1;const n=we(e),o=we(t);return Bt(n,o)},Ut=(e,t)=>{const n=Object.values(t).filter(r=>r.type==="group");let o=null,s=1/0;for(const r of n)if(Do(e,r)){const i=we(r),c=i.width*i.height;c<s&&(s=c,o=r)}return(o==null?void 0:o.id)||null};let je=null,mt=null;const Xt=(e,t)=>(mt!==t&&(je=Gt(t),mt=t),((je==null?void 0:je.get(e))||[]).map(o=>t[o]).filter(Boolean)),Po=(e,t)=>{const n=[],o=[e];for(;o.length>0;){const s=o.pop(),r=Xt(s,t);n.push(...r),o.push(...r.filter(i=>i.type==="group").map(i=>i.id))}return n},jo=e=>{const t={},n=Object.values(e).filter(o=>o.type!=="group");for(const o of n){const s=Ut(o,e);o.parentId!==s&&(t[o.id]={parentId:s||void 0})}return t},ko=(e,t,n)=>{const o=n[e];if(!o||o.type!=="group")return!0;const s={...o,position:t};return Ut(s,n)===null},st=(e={})=>{const{state:t,dispatch:n,actions:o}=F(),{state:s}=W(),{autoUpdateMembership:r=!0,membershipUpdateDelay:i=100}=e,c=l.useRef(void 0),d=l.useRef(t.nodes);d.current=t.nodes;const u=l.useCallback(()=>{const g=jo(d.current);Object.keys(g).length>0&&n(o.updateGroupMembership(g))},[]);l.useEffect(()=>r?(c.current&&clearTimeout(c.current),s.dragState!==null||(c.current=window.setTimeout(()=>{u()},i)),()=>{c.current&&clearTimeout(c.current)}):void 0,[r,i,u]);const p=l.useCallback(g=>{const b=d.current[g];return!!(b&&b.parentId)},[d]),h=l.useCallback(g=>{const b=d.current[g];return(b==null?void 0:b.parentId)||null},[]),x=l.useCallback(g=>Xt(g,d.current),[]),y=l.useCallback(g=>Po(g,d.current),[]),v=l.useCallback((g,b)=>{n(o.moveGroupWithChildren(g,b))},[n,o]),f=l.useCallback((g,b)=>ko(g,b,d.current),[]);return{updateAllGroupMembership:u,isNodeInGroup:p,getNodeParentGroup:h,getGroupChildren:x,getGroupDescendants:y,moveGroupWithChildren:v,isValidGroupMove:f}};function Mo(e){const{onStart:t,onMove:n,onEnd:o,scale:s=1,threshold:r=2,disabled:i=!1}=e,[c,d]=l.useState({isDragging:!1,dragStarted:!1,delta:{x:0,y:0}}),u=l.useRef(null),p=l.useRef({x:0,y:0}),h=l.useRef({x:0,y:0}),x=l.useCallback(f=>{if(!u.current)return;const g={x:(f.clientX-p.current.x)/s,y:(f.clientY-p.current.y)/s};h.current=g,c.dragStarted?(d(b=>({...b,delta:g})),n==null||n(f,g,u.current)):Math.sqrt(g.x*g.x+g.y*g.y)>=r&&(d({isDragging:!0,dragStarted:!0,delta:g}),t==null||t(f,u.current))},[s,r,c.dragStarted,t,n]),y=l.useCallback(f=>{if(!u.current)return;const g=c.dragStarted,b=h.current;document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",y),document.removeEventListener("pointercancel",y),d({isDragging:!1,dragStarted:!1,delta:{x:0,y:0}}),g&&(o==null||o(f,b,u.current)),u.current=null,h.current={x:0,y:0}},[c.dragStarted,x,o]),v=l.useCallback((f,g)=>{if(i)return;const b="nativeEvent"in f?f.nativeEvent:f;u.current=g,p.current={x:b.clientX,y:b.clientY};const D=b.target;D!=null&&D.setPointerCapture&&D.setPointerCapture(b.pointerId),document.addEventListener("pointermove",x),document.addEventListener("pointerup",y),document.addEventListener("pointercancel",y),d({isDragging:!0,dragStarted:!1,delta:{x:0,y:0}})},[i,x,y]);return l.useEffect(()=>()=>{document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",y),document.removeEventListener("pointercancel",y)},[x,y]),{startDrag:v,dragState:c}}function Ke({interactionState:e,viewport:t,onPointerMove:n,onPointerUp:o,canvasSelector:s='[role="application"]',pointerMoveOptions:r={passive:!0}}){l.useEffect(()=>{if(!e)return;const i=document.querySelector(s);if(!i)return;const c=u=>{const p=i.getBoundingClientRect(),h=(u.clientX-p.left-t.offset.x)/t.scale,x=(u.clientY-p.top-t.offset.y)/t.scale;n({x:h,y:x},u)},d=u=>{o(u)};return window.addEventListener("pointermove",c,r),window.addEventListener("pointerup",d,{once:!0}),()=>{window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",d)}},[e,t,n,o,s,r])}function Ft(e,t){l.useEffect(()=>{if(!e)return;const{onMove:n,onUp:o,onCancel:s}=t;return n&&document.addEventListener("pointermove",n,{passive:!1}),o&&document.addEventListener("pointerup",o),s&&document.addEventListener("pointercancel",s),()=>{n&&document.removeEventListener("pointermove",n),o&&document.removeEventListener("pointerup",o),s&&document.removeEventListener("pointercancel",s)}},[e,t.onMove,t.onUp,t.onCancel])}function Yt(e,t,n){l.useEffect(()=>{const o=e.current;if(!(!t||!o||n===void 0))return o.setPointerCapture(n),()=>{o.hasPointerCapture&&o.hasPointerCapture(n)&&o.releasePointerCapture(n)}},[e,t,n])}function Wt(e,t,n=["pointerdown","pointermove","pointerup"]){l.useEffect(()=>{const o=e.current;if(!t||!o)return;const s=r=>{r.preventDefault()};return n.forEach(r=>{o.addEventListener(r,s,{passive:!1})}),()=>{n.forEach(r=>{o.removeEventListener(r,s)})}},[e,t,n])}function To(e,t,n){const{onMove:o,onUp:s,onCancel:r,pointerId:i,capturePointer:c=!0,preventDefaults:d=!0}=n;Ft(t,{onMove:o,onUp:s,onCancel:r}),Yt(e,t&&c,i),Wt(e,t&&d)}function rt(){const{dispatch:e,actions:t}=F();return l.useMemo(()=>({addNode:n=>e(t.addNode(n)),updateNode:(n,o)=>e(t.updateNode(n,o)),deleteNode:n=>e(t.deleteNode(n)),moveNode:(n,o)=>e(t.moveNode(n,o)),moveNodes:n=>e(t.moveNodes(n)),addConnection:n=>e(t.addConnection(n)),deleteConnection:n=>e(t.deleteConnection(n)),setNodeData:n=>e(t.setNodeData(n)),restoreState:n=>e(t.restoreState(n)),duplicateNodes:n=>e(t.duplicateNodes(n)),groupNodes:(n,o)=>e(t.groupNodes(n,o)),ungroupNode:n=>e(t.ungroupNode(n)),updateGroupMembership:n=>e(t.updateGroupMembership(n)),moveGroupWithChildren:(n,o)=>e(t.moveGroupWithChildren(n,o)),autoLayout:(n,o)=>e(t.autoLayout(n,o))}),[e,t])}function Oo(){const{state:e}=F(),t=rt();return{state:e,actions:t}}function it(){const{dispatch:e,actions:t}=oe();return l.useMemo(()=>({setViewport:n=>e(t.setViewport(n)),panViewport:n=>e(t.panViewport(n)),zoomViewport:(n,o)=>e(t.zoomViewport(n,o)),resetViewport:()=>e(t.resetViewport()),startPan:n=>e(t.startPan(n)),updatePan:n=>e(t.updatePan(n)),endPan:()=>e(t.endPan())}),[e,t])}function Ao(){const{state:e}=oe(),t=it();return{state:e,actions:t}}function at(){const{dispatch:e,actions:t}=W();return l.useMemo(()=>({selectNode:(n,o)=>e(t.selectNode(n,o)),selectConnection:(n,o)=>e(t.selectConnection(n,o)),clearSelection:()=>e(t.clearSelection()),selectAllNodes:n=>e(t.selectAllNodes(n)),setSelectionBox:n=>e(t.setSelectionBox(n)),startNodeDrag:(n,o,s,r)=>e(t.startNodeDrag(n,o,s,r)),updateNodeDrag:n=>e(t.updateNodeDrag(n)),endNodeDrag:()=>e(t.endNodeDrag()),setHoveredNode:n=>e(t.setHoveredNode(n)),setHoveredConnection:n=>e(t.setHoveredConnection(n)),startConnectionDrag:n=>e(t.startConnectionDrag(n)),updateConnectionDrag:(n,o)=>e(t.updateConnectionDrag(n,o)),endConnectionDrag:()=>e(t.endConnectionDrag()),setHoveredPort:n=>e(t.setHoveredPort(n)),updateConnectedPorts:n=>e(t.updateConnectedPorts(n)),startConnectionDisconnect:(n,o,s,r)=>e(t.startConnectionDisconnect(n,o,s,r)),updateConnectionDisconnect:(n,o)=>e(t.updateConnectionDisconnect(n,o)),endConnectionDisconnect:()=>e(t.endConnectionDisconnect()),startNodeResize:(n,o,s,r)=>e(t.startNodeResize(n,o,s,r)),updateNodeResize:n=>e(t.updateNodeResize(n)),endNodeResize:()=>e(t.endNodeResize()),showContextMenu:(n,o,s)=>e(t.showContextMenu(n,o,s)),hideContextMenu:()=>e(t.hideContextMenu())}),[e,t])}function Ro(){const{state:e}=W(),t=at();return{state:e,actions:t}}function Kt(){const e=rt(),t=it(),n=at();return{editor:e,canvas:t,interaction:n}}function zo(){const e=Kt();return{addNode:e.editor.addNode,removeNode:e.editor.deleteNode,updateNode:e.editor.updateNode,duplicateNodes:e.editor.duplicateNodes,addConnection:e.editor.addConnection,removeConnection:e.editor.deleteConnection,selectNode:e.interaction.selectNode,selectAllNodes:e.interaction.selectAllNodes,clearSelection:e.interaction.clearSelection,setViewport:e.canvas.setViewport,panViewport:e.canvas.panViewport,zoomViewport:e.canvas.zoomViewport,resetViewport:e.canvas.resetViewport,showContextMenu:e.interaction.showContextMenu,hideContextMenu:e.interaction.hideContextMenu}}const re={showGrid:!0,showMinimap:!0,showStatusBar:!0,theme:"light",autoSave:!0,autoSaveInterval:30,smoothAnimations:!0,doubleClickToEdit:!0,fontSize:14,gridSize:20,gridOpacity:.3,canvasBackground:"#ffffff"};function Lo(e){return typeof e=="string"&&["light","dark","auto"].includes(e)}function xe(e,t,n){const o=e.getValue(t);return typeof o=="boolean"?o:n}function ke(e,t,n){const o=e.getValue(t);return typeof o=="number"?o:n}function Vo(e,t,n){const o=e.getValue(t);return typeof o=="string"?o:n}function _o(e,t,n){const o=e.getValue(t);return Lo(o)?o:n}function ct(e){const[t,n]=l.useState(0);return l.useEffect(()=>e?e.on("change",()=>{n(r=>r+1)}):void 0,[e]),l.useMemo(()=>e?{showGrid:xe(e,"appearance.showGrid",re.showGrid),showMinimap:xe(e,"appearance.showMinimap",re.showMinimap),showStatusBar:xe(e,"appearance.showStatusBar",re.showStatusBar),theme:_o(e,"appearance.theme",re.theme),autoSave:xe(e,"general.autoSave",re.autoSave),autoSaveInterval:ke(e,"general.autoSaveInterval",re.autoSaveInterval),smoothAnimations:xe(e,"behavior.smoothAnimations",re.smoothAnimations),doubleClickToEdit:xe(e,"behavior.doubleClickToEdit",re.doubleClickToEdit),fontSize:ke(e,"appearance.fontSize",re.fontSize),gridSize:ke(e,"appearance.gridSize",re.gridSize),gridOpacity:ke(e,"appearance.gridOpacity",re.gridOpacity),canvasBackground:Vo(e,"appearance.canvasBackground",re.canvasBackground)}:re,[e,t])}const Zt=(e,t=1.5)=>{const{state:n}=oe();return l.useMemo(()=>{const{viewport:o}=n,s=window.innerWidth,r=window.innerHeight,i=Math.max(s,r)*(t-1)/2,c={left:(-o.offset.x-i)/o.scale,top:(-o.offset.y-i)/o.scale,right:(s-o.offset.x+i)/o.scale,bottom:(r-o.offset.y+i)/o.scale};return Object.values(e).filter(d=>{var h,x;const u=((h=d.size)==null?void 0:h.width)||150,p=((x=d.size)==null?void 0:x.height)||50;return d.position.x+u>=c.left&&d.position.x<=c.right&&d.position.y+p>=c.top&&d.position.y<=c.bottom})},[e,n.viewport,t])},$o=(e,t={})=>{const{delay:n=0,maxBatchSize:o=100}=t,[s,r]=l.useState(e),i=l.useRef([]),c=l.useRef(null),d=l.useRef(null),u=l.useCallback(()=>{i.current.length!==0&&(r(x=>{let y=x;for(const v of i.current)y=v(y);return y}),i.current=[],c.current=null,d.current&&(clearTimeout(d.current),d.current=null))},[]),p=l.useCallback(x=>{const y=typeof x=="function"?x:v=>x;if(i.current.push(y),i.current.length>=o){u();return}c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current),n>0?d.current=setTimeout(()=>{c.current=requestAnimationFrame(u)},n):c.current=requestAnimationFrame(u)},[u,n,o]),h=l.useCallback(()=>{c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current),u()},[u]);return l.useEffect(()=>()=>{c.current!==null&&cancelAnimationFrame(c.current),d.current!==null&&clearTimeout(d.current)},[]),[s,p,h]},Ie={visualSize:12,connectionMargin:8,edgePadding:20,relativePadding:.1};function Ho(e){const t=new Map;for(const n of e){const o=n.position||"right";t.has(o)||t.set(o,[]),t.get(o).push(n)}return t}function qt(e,t,n){if(t===1)return .5;if(t===2)return[.3333,.6667][e]||.5;const s=(1-n.relativePadding*2)/(t-1),r=n.relativePadding+s*e;return Math.max(.1,Math.min(.9,r))}function Bo(e,t,n,o,s){const r=qt(t,n,s),i=s.visualSize/2;switch(e.position){case"left":return{x:-i,y:o.height*r,transform:"translateY(-50%)"};case"right":return{x:o.width-i,y:o.height*r,transform:"translateY(-50%)"};case"top":return{x:o.width*r,y:-i,transform:"translateX(-50%)"};case"bottom":return{x:o.width*r,y:o.height-i,transform:"translateX(-50%)"};default:return{x:o.width-i,y:o.height*.5,transform:"translateY(-50%)"}}}function Go(e,t,n,o,s){const r=ot(o),{left:i,top:c}=we(o),d=qt(t,n,s);switch(e.position){case"left":return{x:i-s.connectionMargin,y:c+r.height*d};case"right":return{x:i+r.width+s.connectionMargin,y:c+r.height*d};case"top":return{x:i+r.width*d,y:c-s.connectionMargin};case"bottom":return{x:i+r.width*d,y:c+r.height+s.connectionMargin};default:return{x:i+r.width+s.connectionMargin,y:c+r.height*.5}}}function De(e,t=Ie){const n=new Map,o=e.ports||[];if(o.length===0)return n;const s=ot(e),r=Ho(o);for(const[i,c]of r)c.forEach((d,u)=>{const p=Bo(d,u,c.length,s,t),h=Go(d,u,c.length,e,t);n.set(d.id,{portId:d.id,renderPosition:p,connectionPoint:h})});return n}function Jt(e,t=Ie){const n=new Map;for(const o of e){const s=De(o,t);s.size>0&&n.set(o.id,s)}return n}function Uo(e,t,n=Ie){const o=new Map(e);for(const s of t){const r=De(s,n);r.size>0?o.set(s.id,r):o.delete(s.id)}return o}function dt(e,t){var s,r,i,c,d,u;const{state:n,getNodePorts:o}=F();return l.useMemo(()=>{const p=n.nodes[e];if(!p)return;const h={...p,ports:o(e)};return De(h).get(t)},[(s=n.nodes[e])==null?void 0:s.position.x,(r=n.nodes[e])==null?void 0:r.position.y,(c=(i=n.nodes[e])==null?void 0:i.size)==null?void 0:c.width,(u=(d=n.nodes[e])==null?void 0:d.size)==null?void 0:u.height,e,t,o])}function ye(e,t){const n=dt(e,t);return n==null?void 0:n.connectionPoint}function lt(e,t){if(e.ports)return e.ports;const n=t.ports||[],o=e;return n.map(s=>{var c;const r={id:s.id,type:s.type,label:s.label,nodeId:e.id,position:s.position,dataType:s.dataType,maxConnections:s.maxConnections},i=(c=o.portOverrides)==null?void 0:c.find(d=>d.portId===s.id);if(i){if(i.disabled)return null;i.maxConnections!==void 0&&(r.maxConnections=i.maxConnections),i.allowedNodeTypes&&(r.allowedNodeTypes=i.allowedNodeTypes),i.allowedPortTypes&&(r.allowedPortTypes=i.allowedPortTypes)}return r}).filter(s=>s!==null)}function Xo(e,t,n){return lt(e,n).find(s=>s.id===t)}function Fo(e,t){const n=new Map;for(const o of Object.values(e)){const s=t(o.type);if(!s)continue;const r=lt(o,s);for(const i of r){const c=`${o.id}:${i.id}`;n.set(c,{node:o,port:i})}}return n}function Yo(){const e=new Map,t=new Map;return{getNodePorts(n,o){const s=n.id;if(e.has(s))return e.get(s);const r=lt(n,o);return e.set(s,r),r},getPort(n,o,s){const r=`${n.id}:${o}`;if(t.has(r))return t.get(r);const i=Xo(n,o,s);return t.set(r,i),i},createPortLookupMap(n,o){return Fo(n,o)},clearCache(){e.clear(),t.clear()},clearNodeCache(n){e.delete(n);const o=[];t.forEach((s,r)=>{r.startsWith(`${n}:`)&&o.push(r)}),o.forEach(s=>t.delete(s))}}}const Qt={version:2,portsStorageMethod:"inferred"},Wo={version:1,portsStorageMethod:"embedded"};function Ko(e){return e.formatVersion?e.formatVersion.portsStorageMethod==="embedded":!0}function Zo(e,t){const n=[];let o=0,s=0,r=0;const i={};for(const[d,u]of Object.entries(e.nodes)){if(o++,!u.ports||u.ports.length===0){i[d]=u;continue}const p=t==null?void 0:t.get(u.type);p||n.push(`Node ${d} (type: ${u.type}) has no definition in registry. Ports will be removed without creating overrides.`);const h=[];if(p&&p.ports)for(const f of u.ports){const g=p.ports.find(E=>E.id===f.id);if(!g){n.push(`Port ${f.id} on node ${d} not found in definition. It will be lost during migration.`);continue}const b={portId:f.id};let D=!1;f.maxConnections!==void 0&&f.maxConnections!==g.maxConnections&&(b.maxConnections=f.maxConnections,D=!0),f.allowedNodeTypes&&(b.allowedNodeTypes=f.allowedNodeTypes,D=!0),f.allowedPortTypes&&(b.allowedPortTypes=f.allowedPortTypes,D=!0),D&&(h.push(b),r++)}const{ports:x,...y}=u;s+=x.length;const v={...y,...h.length>0?{portOverrides:h}:{}};i[d]=v}return{data:{nodes:i,connections:e.connections,formatVersion:Qt},statistics:{nodesProcessed:o,portsRemoved:s,portOverridesCreated:r},warnings:n}}function qo(e,t=!0){if(!t)return{...e,formatVersion:Wo};const n={};for(const[o,s]of Object.entries(e.nodes)){const{ports:r,...i}=s;n[o]=i}return{nodes:n,connections:e.connections,formatVersion:Qt}}function Jo(e,t,n=!0){if(!Ko(e)||!n)return{data:e,migrated:!1};const o=Zo(e,t);return{data:o.data,migrated:!0,migrationResult:o}}const yt={useInferredPortsOnly:!1,showMigrationWarnings:!0,autoMigrateOnLoad:!0,saveInNewFormat:!0};function Qo(){if(typeof process<"u"&&process.env)return{useInferredPortsOnly:process.env.NODE_EDITOR_USE_INFERRED_PORTS_ONLY==="true",showMigrationWarnings:process.env.NODE_EDITOR_SHOW_MIGRATION_WARNINGS!=="false",autoMigrateOnLoad:process.env.NODE_EDITOR_AUTO_MIGRATE!=="false",saveInNewFormat:process.env.NODE_EDITOR_SAVE_NEW_FORMAT!=="false"};if(typeof window<"u"&&window.localStorage)try{const e=window.localStorage.getItem("nodeEditorFeatureFlags");if(e)return{...yt,...JSON.parse(e)}}catch(e){console.warn("Failed to parse feature flags from localStorage",e)}return yt}const xt=(e,t)=>{switch(t.type){case"ADD_NODE":{const n=Me(),o={...t.payload.node,id:n};return{...e,nodes:{...e.nodes,[n]:o}}}case"UPDATE_NODE":{const{nodeId:n,updates:o}=t.payload,s=e.nodes[n];return s?{...e,nodes:{...e.nodes,[n]:{...s,...o}}}:e}case"DELETE_NODE":{const{nodeId:n}=t.payload,{[n]:o,...s}=e.nodes,r=Object.entries(e.connections).reduce((i,[c,d])=>(d.fromNodeId!==n&&d.toNodeId!==n&&(i[c]=d),i),{});return{...e,nodes:s,connections:r}}case"MOVE_NODE":{const{nodeId:n,position:o}=t.payload,s=e.nodes[n];return s?{...e,nodes:{...e.nodes,[n]:{...s,position:o}}}:e}case"MOVE_NODES":{const{updates:n}=t.payload,o={...e.nodes};return Object.entries(n).forEach(([s,r])=>{const i=o[s];i&&(o[s]={...i,position:r})}),{...e,nodes:o}}case"ADD_CONNECTION":{const{connection:n}=t.payload,o=Me(),s=Object.entries(e.connections).filter(([i,c])=>c.toNodeId===n.toNodeId&&c.toPortId===n.toPortId),r={...e.connections};return s.forEach(([i])=>{delete r[i]}),{...e,connections:{...r,[o]:{...n,id:o}}}}case"DELETE_CONNECTION":{const{connectionId:n}=t.payload,{[n]:o,...s}=e.connections;return{...e,connections:s}}case"SET_NODE_DATA":return t.payload.data;case"RESTORE_STATE":return t.payload.data;case"DUPLICATE_NODES":{const{nodeIds:n}=t.payload;if(n.length===0)return e;const o={...e.nodes},s=[];return n.forEach(r=>{const i=e.nodes[r];if(!i)return;const c=Me();s.push(c);const d={...i,id:c,position:{x:i.position.x+50,y:i.position.y+50},data:{...i.data,title:i.data.title?`${i.data.title} Copy`:"Node Copy",createdAt:Date.now()}};d.type==="group"&&(d.children=[]),o[c]=d}),{...e,nodes:o,lastDuplicatedNodeIds:s}}case"GROUP_NODES":{const{nodeIds:n,groupId:o=Me()}=t.payload;if(n.length===0)return e;let s=1/0,r=1/0,i=-1/0,c=-1/0;n.forEach(u=>{var h,x;const p=e.nodes[u];p&&(s=Math.min(s,p.position.x),r=Math.min(r,p.position.y),i=Math.max(i,p.position.x+(((h=p.size)==null?void 0:h.width)||100)),c=Math.max(c,p.position.y+(((x=p.size)==null?void 0:x.height)||50)))});const d={id:o,type:"group",position:{x:s-20,y:r-40},size:{width:i-s+40,height:c-r+60},data:{title:"Group"},children:n,expanded:!0};return{...e,nodes:{...e.nodes,[o]:d}}}case"UNGROUP_NODE":{const{groupId:n}=t.payload,o=e.nodes[n];if(!o||o.type!=="group")return e;const{[n]:s,...r}=e.nodes;return{...e,nodes:r}}case"UPDATE_GROUP_MEMBERSHIP":{const{updates:n}=t.payload,o={...e.nodes};return Object.entries(n).forEach(([s,r])=>{const i=o[s];i&&(o[s]={...i,...r})}),{...e,nodes:o}}case"MOVE_GROUP_WITH_CHILDREN":{const{groupId:n,delta:o}=t.payload,s={...e.nodes},r=s[n];return r&&(s[n]={...r,position:{x:r.position.x+o.x,y:r.position.y+o.y}},Object.values(s).forEach(i=>{i.parentId===n&&(s[i.id]={...i,position:{x:i.position.x+o.x,y:i.position.y+o.y}})})),{...e,nodes:s}}case"AUTO_LAYOUT":{const{layoutType:n,selectedOnly:o=!1}=t.payload;return o&&(Object.fromEntries(Object.entries(e.nodes).filter(([s,r])=>!0)),e.connections),e}default:return e}};function Me(){return Math.random().toString(36).slice(2,10)}const vt={nodes:{},connections:{}},bt={addNode:e=>({type:"ADD_NODE",payload:{node:e}}),updateNode:(e,t)=>({type:"UPDATE_NODE",payload:{nodeId:e,updates:t}}),deleteNode:e=>({type:"DELETE_NODE",payload:{nodeId:e}}),moveNode:(e,t)=>({type:"MOVE_NODE",payload:{nodeId:e,position:t}}),moveNodes:e=>({type:"MOVE_NODES",payload:{updates:e}}),addConnection:e=>({type:"ADD_CONNECTION",payload:{connection:e}}),deleteConnection:e=>({type:"DELETE_CONNECTION",payload:{connectionId:e}}),setNodeData:e=>({type:"SET_NODE_DATA",payload:{data:e}}),restoreState:e=>({type:"RESTORE_STATE",payload:{data:e}}),duplicateNodes:e=>({type:"DUPLICATE_NODES",payload:{nodeIds:e}}),groupNodes:(e,t)=>({type:"GROUP_NODES",payload:{nodeIds:e,groupId:t}}),ungroupNode:e=>({type:"UNGROUP_NODE",payload:{groupId:e}}),updateGroupMembership:e=>({type:"UPDATE_GROUP_MEMBERSHIP",payload:{updates:e}}),moveGroupWithChildren:(e,t)=>({type:"MOVE_GROUP_WITH_CHILDREN",payload:{groupId:e,delta:t}}),autoLayout:(e,t)=>({type:"AUTO_LAYOUT",payload:{layoutType:e,selectedOnly:t}})},en=l.createContext(null),tn=({children:e,initialState:t,controlledData:n,onDataChange:o,onLoad:s,onSave:r,settingsManager:i})=>{const c=l.useContext(et),d=c==null?void 0:c.registry,u=l.useMemo(()=>Qo(),[]),p=l.useMemo(()=>Yo(),[]),h=l.useMemo(()=>({nodes:(t==null?void 0:t.nodes)||vt.nodes,connections:(t==null?void 0:t.connections)||vt.connections}),[t]),[x,y]=l.useReducer(xt,h),v=n||x,f=l.useRef(o);f.current=o;const g=l.useCallback(P=>{if(!n)y(P);else if(f.current){const M=xt(v,P);f.current(M)}},[n,v]),[b,D]=l.useState(!1),[E,w]=l.useState(!1),j=ct(i),{autoSave:m,autoSaveInterval:N}=j;l.useEffect(()=>{s&&!b&&(D(!0),Promise.resolve(s()).then(P=>{const{data:M,migrated:T,migrationResult:L}=Jo(P,d,u.autoMigrateOnLoad);T&&L&&u.showMigrationWarnings&&(console.log("Node editor data migrated successfully:",L.statistics),L.warnings.length>0&&console.warn("Migration warnings:",L.warnings)),g(bt.setNodeData(M))}).catch(P=>{console.error("Failed to load node editor data:",P)}).finally(()=>{D(!1)}))},[u]);const C=l.useCallback(async()=>{if(r&&!E){w(!0);try{const P=qo(v,u.saveInNewFormat);await Promise.resolve(r(P))}catch(P){console.error("Failed to save node editor data:",P)}finally{w(!1)}}},[r,v,E]);l.useEffect(()=>{if(!m||!r)return;const P=setInterval(()=>{E||C()},N*1e3);return()=>clearInterval(P)},[m,N,C,E]);const I=l.useCallback(P=>{const M=v.nodes[P];if(!M)return[];if(u.useInferredPortsOnly){if(!d)return console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled"),[];const T=d.get(M.type);return T?p.getNodePorts(M,T):(console.warn(`No definition found for node type: ${M.type}`),[])}if(d){const T=d.get(M.type);if(T)return p.getNodePorts(M,T)}return M.ports||[]},[v.nodes,d,p,u.useInferredPortsOnly]),O=l.useCallback((P,M)=>{var L;const T=v.nodes[P];if(T){if(u.useInferredPortsOnly){if(!d){console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled");return}const z=d.get(T.type);if(!z){console.warn(`No definition found for node type: ${T.type}`);return}return p.getPort(T,M,z)}if(d){const z=d.get(T.type);if(z)return p.getPort(T,M,z)}return(L=T.ports)==null?void 0:L.find(z=>z.id===M)}},[v.nodes,d,p,u.useInferredPortsOnly]),V=l.useMemo(()=>{if(u.useInferredPortsOnly)return d?p.createPortLookupMap(v.nodes,P=>d.get(P)):(console.error("NodeDefinitionRegistry is required when useInferredPortsOnly is enabled"),new Map);if(!d){const P=new Map;for(const M of Object.values(v.nodes)){const T=M.ports||[];for(const L of T){const z=`${M.id}:${L.id}`;P.set(z,{node:M,port:L})}}return P}return p.createPortLookupMap(v.nodes,P=>d.get(P))},[v.nodes,d,p,u.useInferredPortsOnly]);l.useEffect(()=>{p.clearCache()},[v.nodes,p]);const S=l.useMemo(()=>({state:v,dispatch:g,actions:bt,isLoading:b,isSaving:E,handleSave:C,getNodePorts:I,getPort:O,portLookupMap:V}),[v,g,b,E,C,I,O,V]);return a.jsx(en.Provider,{value:S,children:e})},F=()=>{const e=l.useContext(en);if(!e)throw new Error("useNodeEditor must be used within a NodeEditorProvider");return e},es=(e,t)=>{switch(t.type){case"PUSH_ENTRY":{if(!e.isRecording)return e;const{action:n,data:o}=t.payload,s={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),action:n,data:JSON.parse(JSON.stringify(o))},c=[...e.entries.slice(0,e.currentIndex+1),s].slice(-e.maxEntries);return{...e,entries:c,currentIndex:c.length-1}}case"UNDO":return e.currentIndex<=0?e:{...e,currentIndex:e.currentIndex-1};case"REDO":return e.currentIndex>=e.entries.length-1?e:{...e,currentIndex:e.currentIndex+1};case"CLEAR_HISTORY":return{...e,entries:[],currentIndex:-1};case"SET_RECORDING":return{...e,isRecording:t.payload.isRecording};case"SET_MAX_ENTRIES":{const{maxEntries:n}=t.payload,o=e.entries.slice(-n);return{...e,maxEntries:n,entries:o,currentIndex:Math.min(e.currentIndex,o.length-1)}}default:return e}},ts={entries:[],currentIndex:-1,maxEntries:50,isRecording:!0},Te={pushEntry:(e,t)=>({type:"PUSH_ENTRY",payload:{action:e,data:t}}),undo:()=>({type:"UNDO"}),redo:()=>({type:"REDO"}),clearHistory:()=>({type:"CLEAR_HISTORY"}),setRecording:e=>({type:"SET_RECORDING",payload:{isRecording:e}}),setMaxEntries:e=>({type:"SET_MAX_ENTRIES",payload:{maxEntries:e}})},nn=l.createContext(null),on=({children:e,initialState:t})=>{const[n,o]=l.useReducer(es,{...ts,...t}),s=n.currentIndex>0,r=n.currentIndex<n.entries.length-1,i=n.currentIndex>=0?n.entries[n.currentIndex]:null,c=l.useCallback((h,x)=>{o(Te.pushEntry(h,x))},[o]),d=l.useCallback(()=>s?(o(Te.undo()),n.entries[n.currentIndex-1]||null):null,[s,n.entries,n.currentIndex,o]),u=l.useCallback(()=>r?(o(Te.redo()),n.entries[n.currentIndex+1]||null):null,[r,n.entries,n.currentIndex,o]),p={state:n,dispatch:o,actions:Te,canUndo:s,canRedo:r,currentEntry:i,pushEntry:c,undo:d,redo:u};return a.jsx(nn.Provider,{value:p,children:e})},ns=()=>{const e=l.useContext(nn);if(!e)throw new Error("useHistory must be used within a HistoryProvider");return e},os=()=>{const{state:e,dispatch:t,actions:n}=F(),{pushEntry:o,undo:s,redo:r,canUndo:i,canRedo:c}=ns(),d=l.useRef(e),u=l.useRef(null);l.useEffect(()=>{const y=e,v=d.current;if(v===y||JSON.stringify(v)===JSON.stringify(y))return;const f=u.current||"Unknown Action";o(f,v),d.current=y,u.current=null},[e,o]);const p=l.useCallback(y=>{y&&typeof y=="object"&&y.type&&(u.current=y.type),t(y)},[t]),h=l.useCallback(()=>{if(!i)return!1;const y=s();return y?(u.current=null,d.current=y.data,t(n.restoreState(y.data)),!0):!1},[i,s,t,n]),x=l.useCallback(()=>{if(!c)return!1;const y=r();return y?(u.current=null,d.current=y.data,t(n.restoreState(y.data)),!0):!1},[c,r,t,n]);return{dispatchWithHistory:p,performUndo:h,performRedo:x,canUndo:i,canRedo:c}},ss={iterations:100,springLength:150,springStrength:.3,repulsionStrength:1e3,dampening:.9,maxForce:50,padding:100};function rs(e,t={}){const n={...ss,...t},o=Object.values(e.nodes),s=Object.values(e.connections);if(o.length===0)return{nodePositions:{},iterations:0};if(o.length===1)return{nodePositions:{[o[0].id]:{x:0,y:0}},iterations:0};const r={},i={};o.forEach((p,h)=>{if(p.position)r[p.id]={...p.position};else{const x=h/o.length*2*Math.PI,y=Math.sqrt(o.length)*50;r[p.id]={x:Math.cos(x)*y,y:Math.sin(x)*y}}i[p.id]={x:0,y:0}});const c={};o.forEach(p=>{c[p.id]=new Set}),s.forEach(p=>{c[p.fromNodeId]&&c[p.toNodeId]&&(c[p.fromNodeId].add(p.toNodeId),c[p.toNodeId].add(p.fromNodeId))});let d=0;for(let p=0;p<n.iterations;p++){d++;const h={};o.forEach(v=>{h[v.id]={x:0,y:0}});for(let v=0;v<o.length;v++)for(let f=v+1;f<o.length;f++){const g=o[v],b=o[f],D=r[g.id],E=r[b.id],w=E.x-D.x,j=E.y-D.y,m=Math.sqrt(w*w+j*j);if(m<.01)continue;const N=n.repulsionStrength/(m*m),C=w/m*N,I=j/m*N;h[g.id].x-=C,h[g.id].y-=I,h[b.id].x+=C,h[b.id].y+=I}s.forEach(v=>{const f=r[v.fromNodeId],g=r[v.toNodeId];if(!f||!g)return;const b=g.x-f.x,D=g.y-f.y,E=Math.sqrt(b*b+D*D);if(E<.01)return;const w=n.springStrength*(E-n.springLength),j=b/E*w,m=D/E*w;h[v.fromNodeId].x+=j,h[v.fromNodeId].y+=m,h[v.toNodeId].x-=j,h[v.toNodeId].y-=m});let x=0;if(o.forEach(v=>{const f=h[v.id],g=Math.sqrt(f.x*f.x+f.y*f.y);g>n.maxForce&&(f.x=f.x/g*n.maxForce,f.y=f.y/g*n.maxForce),i[v.id].x=i[v.id].x*n.dampening+f.x,i[v.id].y=i[v.id].y*n.dampening+f.y;const b={...r[v.id]};r[v.id].x+=i[v.id].x,r[v.id].y+=i[v.id].y;const D=Math.sqrt(Math.pow(r[v.id].x-b.x,2)+Math.pow(r[v.id].y-b.y,2));x+=D}),x/o.length<.1)break}const u=Object.keys(r);if(u.length>0){let p=1/0,h=-1/0,x=1/0,y=-1/0;u.forEach(g=>{const b=r[g];p=Math.min(p,b.x),h=Math.max(h,b.x),x=Math.min(x,b.y),y=Math.max(y,b.y)});const v=(p+h)/2,f=(x+y)/2;u.forEach(g=>{r[g].x=r[g].x-v+n.padding,r[g].y=r[g].y-f+n.padding})}return{nodePositions:r,iterations:d}}function is(e,t={}){const{spacing:n=200,layerHeight:o=150}=t,s=Object.values(e.nodes),r=Object.values(e.connections);if(s.length===0)return{nodePositions:{},iterations:0};const i={},c={};s.forEach(f=>{i[f.id]=new Set,c[f.id]=new Set}),r.forEach(f=>{i[f.fromNodeId]&&c[f.toNodeId]&&(i[f.fromNodeId].add(f.toNodeId),c[f.toNodeId].add(f.fromNodeId))});const d=s.filter(f=>c[f.id].size===0);if(d.length===0){const f=Math.min(...s.map(g=>c[g.id].size));d.push(...s.filter(g=>c[g.id].size===f))}const u=[],p={},h=new Set;u[0]=d.map(f=>f.id),d.forEach(f=>{p[f.id]=0,h.add(f.id)});let x=0;for(;u[x]&&u[x].length>0;){const f=[];if(u[x].forEach(g=>{i[g].forEach(b=>{h.has(b)||(f.push(b),p[b]=x+1,h.add(b))})}),f.length>0)u[x+1]=f,x++;else break}const y=s.filter(f=>!h.has(f.id));y.length>0&&(u[x+1]||(u[x+1]=[]),u[x+1].push(...y.map(f=>f.id)),y.forEach(f=>{p[f.id]=x+1}));const v={};return u.forEach((f,g)=>{const b=g*o,E=-((f.length-1)*n)/2;f.forEach((w,j)=>{v[w]={x:E+j*n,y:b}})}),{nodePositions:v,iterations:u.length}}function as(e,t={}){const{spacing:n=200,columns:o}=t,s=Object.values(e.nodes);if(s.length===0)return{nodePositions:{},iterations:0};const r=o||Math.ceil(Math.sqrt(s.length)),i=Math.ceil(s.length/r),c={};return s.forEach((d,u)=>{const p=Math.floor(u/r),h=u%r,x=(r-1)*n,y=(i-1)*n;c[d.id]={x:h*n-x/2,y:p*n-y/2}}),{nodePositions:c,iterations:0}}const cs=()=>{const{state:e,dispatch:t,actions:n}=F(),{state:o}=W(),s=l.useCallback((d=!1)=>{console.log("Applying force-directed layout");const p={nodes:d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,connections:e.connections},h=rs(p,{iterations:150,springLength:200,springStrength:.4,repulsionStrength:2e3,dampening:.85});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]),r=l.useCallback((d=!1)=>{console.log("Applying hierarchical layout");const p={nodes:d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,connections:e.connections},h=is(p,{spacing:250,layerHeight:200});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]),i=l.useCallback((d=!1)=>{console.log("Applying grid layout");const u=d?Object.fromEntries(Object.entries(e.nodes).filter(([x])=>o.selectedNodeIds.includes(x))):e.nodes,p={nodes:u,connections:e.connections},h=as(p,{spacing:250,columns:Math.ceil(Math.sqrt(Object.keys(u).length))});Object.keys(h.nodePositions).length>0&&t(n.moveNodes(h.nodePositions))},[e,o.selectedNodeIds,t,n]);return{applyLayout:l.useCallback((d,u=!1)=>{switch(d){case"force":s(u);break;case"hierarchical":r(u);break;case"grid":i(u);break;default:console.warn(`Unknown layout type: ${d}`)}},[s,r,i]),applyForceLayout:s,applyHierarchicalLayout:r,applyGridLayout:i}},ds=()=>{const{state:e,dispatch:t,actions:n}=F(),{state:o,dispatch:s,actions:r}=W(),{performUndo:i,performRedo:c,canUndo:d,canRedo:u}=os(),{applyLayout:p}=cs();ae({key:"Delete"},l.useCallback(()=>{console.log("Delete shortcut triggered"),o.selectedNodeIds.length>0?(o.selectedNodeIds.forEach(h=>{t(n.deleteNode(h))}),s(r.clearSelection())):o.selectedConnectionIds.length>0&&(o.selectedConnectionIds.forEach(h=>{t(n.deleteConnection(h))}),s(r.clearSelection()))},[o.selectedNodeIds,o.selectedConnectionIds,t,n,s,r])),ae({key:"Backspace"},l.useCallback(()=>{console.log("Backspace shortcut triggered"),o.selectedNodeIds.length>0?(o.selectedNodeIds.forEach(h=>{t(n.deleteNode(h))}),s(r.clearSelection())):o.selectedConnectionIds.length>0&&(o.selectedConnectionIds.forEach(h=>{t(n.deleteConnection(h))}),s(r.clearSelection()))},[o.selectedNodeIds,o.selectedConnectionIds,t,n,s,r])),ae({key:"a",ctrl:!0},l.useCallback(()=>{console.log("Select All shortcut triggered");const h=Object.keys(e.nodes);s(r.selectAllNodes(h))},[e.nodes,s,r])),ae({key:"Escape"},l.useCallback(()=>{console.log("Escape shortcut triggered"),s(r.clearSelection())},[s,r])),ae({key:"n",ctrl:!0},l.useCallback(()=>{console.log("Add Node shortcut triggered");const h=`node-${Date.now()}`,x={title:"New Node",type:"default",position:{x:100,y:100},data:{title:"New Node"},ports:[{id:`port-input-${Date.now()}`,type:"input",label:"Input",position:"left",nodeId:h},{id:`port-output-${Date.now()}`,type:"output",label:"Output",position:"right",nodeId:h}]};t(n.addNode(x))},[t,n])),ae({key:"d",ctrl:!0},l.useCallback(()=>{console.log("Duplicate shortcut triggered"),o.selectedNodeIds.length>0&&t(n.duplicateNodes(o.selectedNodeIds))},[o.selectedNodeIds,t,n])),l.useEffect(()=>{e.lastDuplicatedNodeIds&&e.lastDuplicatedNodeIds.length>0&&(s(r.selectAllNodes(e.lastDuplicatedNodeIds)),t(n.setNodeData({...e,lastDuplicatedNodeIds:void 0})))},[e.lastDuplicatedNodeIds,s,r,t,n,e]),ae({key:"s",ctrl:!0},l.useCallback(h=>{console.log("Save shortcut triggered"),console.log("Save not yet implemented")},[])),ae({key:"l",ctrl:!0},l.useCallback(()=>{console.log("Auto Layout shortcut triggered");const h=o.selectedNodeIds.length>0;p("force",h)},[o.selectedNodeIds,p])),ae({key:"z",ctrl:!0},l.useCallback(()=>{console.log("Undo shortcut triggered"),d&&i()},[d,i])),ae({key:"z",ctrl:!0,shift:!0},l.useCallback(()=>{console.log("Redo shortcut triggered"),u&&c()},[u,c])),ae({key:"y",ctrl:!0},l.useCallback(()=>{console.log("Redo (Ctrl+Y) shortcut triggered"),u&&c()},[u,c]))},ls="xtnnddtrnodedibas",us="xtnnddtrcnt",ps="xtnnddtrcanvas",hs="xtnnddtrpanning",fs="xtnnddtrspapan",gs="xtnnddtrnodes",ms="xtnnddtrnode",ys="xtnnddtrlocked",xs="xtnnddtrsel",vs="xtnnddtrdrg",bs="xtnnddtrnodehdr",Ns="xtnnddtrintdra",Cs="xtnnddtrnod",Ss="xtnnddtrlockico",Es="xtnnddtrnodectn",ws="xtnnddtrgrpNode",Is="xtnnddtrcold",Ds="xtnnddtrgrpcold",Ps="xtnnddtrgrpexped",js="xtnnddtrnodeinf",ks="xtnnddtrnodesuc",Ms="xtnnddtrnodewrn",Ts="xtnnddtrnodeerr",Os="xtnnddtrnodedis",As="xtnnddtrtbr",Rs="xtnnddtrtoolbtn",zs="xtnnddtrconmen",Ls="xtnnddtrconmenrax",Vs="xtnnddtrgrid",_s="xtnnddtrins",$s="xtnnddtrinscIz",Hs="xtnnddtrinszAn",Bs="xtnnddtrinssec",Gs="xtnnddtrinsrow",Us="xtnnddtrediwitins",Xs="xtnnddtredimai",Fs="xtnnddtrextdat",Ys="xtnnddtrdragui",Ws="xtnnddtrdraguiVp7",Ks="xtnnddtrdraguiPHl",Zs="xtnnddtrdragui-eW",qs="xtnnddtrsnatar",Js="xtnnddtrdis",Qs="xtnnddtrdislin",er="xtnnddtrstabar",tr="xtnnddtrstasec",nr="xtnnddtrsta",or="xtnnddtrstaval",sr="xtnnddtrstamod",rr="xtnnddtrnodePort",ir="xtnnddtrportinp",ar="xtnnddtrporout",cr="xtnnddtrporinn",dr="xtnnddtrportlbl",lr="xtnnddtrportLeft",ur="xtnnddtrporrig",pr="xtnnddtrportTop",hr="xtnnddtrporbot",fr="xtnnddtrcon",gr="xtnnddtrinstab",mr="xtnnddtrinstab5EW",yr="xtnnddtract",xr="xtnnddtrinsnopad",vr="xtnnddtrinsfie",br="xtnnddtrinsj42",Nr="xtnnddtrinskYN",Cr="xtnnddtrinspos",Sr="xtnnddtrinsnum",Er="xtnnddtrinsreaonlfie",wr="xtnnddtrinssta",Ir="xtnnddtrcan",Dr="xtnnddtrboxsel",Pr="xtnnddtrgridSvg",jr="xtnnddtredi",kr="xtnnddtrediA9y",Mr="xtnnddtrediPTx",Tr="xtnnddtredi-tX",Or="xtnnddtrtoptbr",Ar="xtnnddtrnodlay",Rr="xtnnddtrnodeView",zr="xtnnddtrnodtit",Lr="xtnnddtrnodtitpsF",Vr="xtnnddtrgrpaccdro",_r="xtnnddtrgrpPulse",$r="xtnnddtrgrphaschi",Hr="xtnnddtrnodpor",Br="xtnnddtrport",Gr="xtnnddtrporhov",Ur="xtnnddtrporcon",Xr="xtnnddtrpulse",Fr="xtnnddtrporcon7Fy",Yr="xtnnddtrporlef",Wr="xtnnddtrporrigtpL",Kr="xtnnddtrportop",Zr="xtnnddtrporbotsMk",qr="xtnnddtrconlay",Jr="xtnnddtrconhUO",Qr="xtnnddtrcongay",ei="xtnnddtrconhov",ti="xtnnddtrconDHx",ni="xtnnddtrdracon",oi="xtnnddtrdasani",si="xtnnddtrselbox",ri="xtnnddtrseldzq",ii="xtnnddtrldgovr",ai="xtnnddtrldgind",ci="xtnnddtrcusnod",di="xtnnddtrres",li="xtnnddtrresVnb",ui="xtnnddtrmin",pi="xtnnddtrminimap",hi="xtnnddtrmintit",fi="xtnnddtrminont",gi="xtnnddtrminvie",mi="xtnnddtrminnod",yi="xtnnddtrdarthe",xi="xtnnddtrsmoani",vi="xtnnddtrstasav",bi="xtnnddtruiovrcnt",Ni="xtnnddtrtabNav",Ci="xtnnddtrtabbtn",Si="xtnnddtrtab",k={nodeEditorBase:ls,container:us,canvas:ps,panning:hs,spacePanning:fs,nodes:gs,node:ms,locked:ys,selected:xs,dragging:vs,nodeHeader:bs,interactiveDragHandle:Ns,nodeHeaderInput:Cs,lockIcon:Ss,nodeContent:Es,groupNode:ws,collapsed:Is,groupCollapsed:Ds,groupExpanded:Ps,nodeInfo:js,nodeSuccess:ks,nodeWarning:Ms,nodeError:Ts,nodeDisabled:Os,toolbar:As,toolButton:Rs,contextMenu:zs,contextMenuItem:Ls,grid:Vs,inspectorPanel:_s,inspectorHeader:$s,inspectorContent:Hs,inspectorSection:Bs,inspectorRow:Gs,editorWithInspector:Us,editorMain:Xs,externalDataInfo:Fs,dragGuides:Ys,dragGuide:Ws,dragGuideVertical:Ks,dragGuideHorizontal:Zs,snapTarget:qs,distanceIndicator:Js,distanceLine:Qs,statusBar:er,statusSection:tr,statusLabel:nr,statusValue:or,statusMode:sr,nodePort:rr,portInput:ir,portOutput:ar,portInner:cr,portLabel:dr,portLeft:lr,portRight:ur,portTop:pr,portBottom:hr,connections:fr,inspectorTabs:gr,inspectorTab:mr,active:yr,inspectorContentNoPadding:xr,inspectorField:vr,inspectorInput:br,inspectorTextarea:Nr,inspectorPositionInputs:Cr,inspectorNumberInput:Sr,inspectorReadOnlyField:Er,inspectorEmptyState:wr,canvasContainer:Ir,boxSelecting:Dr,gridSvg:Pr,editorLayout:jr,editorToolbar:kr,editorContent:Mr,editorSidebar:Tr,topToolbar:Or,nodeLayer:Ar,nodeView:Rr,nodeTitle:zr,nodeTitleInput:Lr,groupAcceptingDrop:Vr,groupPulse:_r,groupHasChildren:$r,nodePorts:Hr,port:Br,portHovered:Gr,portConnecting:Ur,pulse:Xr,portConnected:Fr,portLabelLeft:Yr,portLabelRight:Wr,portLabelTop:Kr,portLabelBottom:Zr,connectionLayer:qr,connectionGroup:Jr,connectionSelected:Qr,connectionHovered:ei,connectionDragging:ti,dragConnection:ni,dashAnimation:oi,selectionBoxOverlay:si,selectionOverlay:ri,loadingOverlay:ii,loadingIndicator:ai,customNodeContent:ci,resizeHandle:di,resizeHandleActive:li,minimapContainer:ui,minimap:pi,minimapTitle:hi,minimapContent:fi,minimapViewport:gi,minimapNodes:mi,darkTheme:yi,smoothAnimations:xi,statusSaving:vi,uiOverlayContainer:bi,tabNav:Ni,tabButton:Ci,tabButtonActive:Si},sn=({children:e,className:t,style:n})=>(ds(),a.jsx("div",{className:U(k.nodeEditorBase,t),style:n,tabIndex:0,children:e}));sn.displayName="NodeEditorBase";function rn(e,t){const n=Le((e==null?void 0:e.type)||""),[o,s]=l.useState({data:void 0,isLoading:!1,error:null}),r=l.useCallback(async()=>{if(!(!e||!t||!(n!=null&&n.loadExternalData))){s(c=>({...c,isLoading:!0,error:null}));try{const c=await Promise.resolve(n.loadExternalData(t));s({data:c,isLoading:!1,error:null})}catch(c){s({data:void 0,isLoading:!1,error:c instanceof Error?c:new Error(String(c))})}}},[e,t,n]);l.useEffect(()=>{r()},[r]);const i=l.useCallback(async c=>{if(!e||!t||!(n!=null&&n.updateExternalData))throw new Error("Cannot update external data: missing requirements");s(d=>({...d,isLoading:!0,error:null}));try{await Promise.resolve(n.updateExternalData(t,c)),s({data:c,isLoading:!1,error:null})}catch(d){throw s(u=>({...u,isLoading:!1,error:d instanceof Error?d:new Error(String(d))})),d}},[e,t,n]);return{...o,refresh:r,update:i}}const Ei="xtnnddtralncon",wi="xtnnddtralnlbl",Ii="xtnnddtralnGrid",Di="xtnnddtralnbtn",Oe={alignmentControls:Ei,alignmentLabel:wi,alignmentGrid:Ii,alignmentButton:Di},an=l.memo(({value:e,onChange:t,style:n,type:o="text",placeholder:s,id:r,name:i,"aria-label":c})=>a.jsx(Ne,{type:o,value:e,onChange:d=>t(d.target.value),style:n,placeholder:s,id:r,name:i,"aria-label":c}));an.displayName="InspectorInput";const cn=l.memo(({value:e,onChange:t,style:n,id:o,name:s,"aria-label":r})=>a.jsx($n,{value:e,onChange:i=>t(i.target.value),style:n,id:o,name:s,"aria-label":r}));cn.displayName="InspectorTextarea";const Ee=l.memo(({value:e,onChange:t,label:n,id:o,name:s,"aria-label":r})=>{const i={display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",padding:"4px 8px",fontSize:"12px"},c={color:"#666",fontSize:"11px",fontWeight:500,minWidth:"12px",textAlign:"center"},d={border:"none",background:"transparent",fontSize:"12px",outline:"none",width:"100%",textAlign:"right"};return a.jsxs("div",{style:i,children:[a.jsx("span",{style:c,children:n}),a.jsx(Ne,{type:"number",value:e,onChange:u=>t(Number(u.target.value)),style:d,id:o,name:s,"aria-label":r})]})});Ee.displayName="InspectorNumberInput";const Ze=l.memo(({checked:e,onChange:t,label:n,id:o,name:s})=>a.jsxs("label",{htmlFor:o,style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e,onChange:r=>t(r.target.checked),id:o,name:s}),a.jsx("span",{style:{fontSize:"13px"},children:n})]}));Ze.displayName="InspectorCheckbox";const dn=l.memo(({selectedNodes:e,onAlign:t})=>{const n=e.length<2,o=[{type:"align-left",icon:Bn,title:"Align Left"},{type:"align-center-horizontal",icon:Gn,title:"Align Center Horizontal"},{type:"align-right",icon:Un,title:"Align Right"},{type:"align-top",icon:Xn,title:"Align Top"},{type:"align-center-vertical",icon:Fn,title:"Align Center Vertical"},{type:"align-bottom",icon:Yn,title:"Align Bottom"},{type:"distribute-horizontal",icon:Wn,title:"Distribute Horizontally"},{type:"distribute-vertical",icon:Kn,title:"Distribute Vertically"}];return a.jsxs("div",{className:Oe.alignmentControls,children:[a.jsxs(he,{className:Oe.alignmentLabel,children:["Alignment ",e.length>1?`(${e.length} nodes)`:"(select 2+ nodes)",":"]}),a.jsx("div",{className:Oe.alignmentGrid,children:o.map(s=>{const r=s.icon;return a.jsx(Re,{onClick:()=>!n&&t(s.type),className:Oe.alignmentButton,title:n?"Select 2 or more nodes to enable alignment":s.title,disabled:n,children:a.jsx(r,{size:14})},s.type)})})]})});dn.displayName="AlignmentControls";const ln=l.memo(({node:e,onUpdateNode:t,onDeleteNode:n,selectedNodes:o=[],onAlignNodes:s})=>{var b,D;const r=l.useMemo(()=>({width:"100%",padding:"4px 8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px"}),[]),i=l.useMemo(()=>({display:"block",marginBottom:"4px",fontSize:"12px",fontWeight:500,color:"#666"}),[]),c=l.useCallback(E=>{t({data:{...e.data,title:E}})},[e.data,t]),d=l.useCallback(E=>{t({data:{...e.data,content:E}})},[e.data,t]),u=l.useCallback(E=>{t({position:{...e.position,x:E}})},[e.position,t]),p=l.useCallback(E=>{t({position:{...e.position,y:E}})},[e.position,t]),h=l.useCallback(E=>{var w;t({size:{...e.size,width:E,height:((w=e.size)==null?void 0:w.height)??0}})},[e.size,t]),x=l.useCallback(E=>{var w;t({size:{...e.size,height:E,width:((w=e.size)==null?void 0:w.width)??0}})},[e.size,t]),y=l.useCallback(E=>{t({locked:E})},[t]),v=l.useCallback(E=>{t({visible:E})},[t]),f=l.useCallback(E=>{!s||o.length<2||s(E,o)},[s,o]),g=l.useMemo(()=>({...r,minHeight:"60px",resize:"vertical"}),[r]);return l.useMemo(()=>({...r,width:"50%"}),[r]),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[a.jsx("h4",{style:{margin:0,fontSize:"14px"},children:"Node Properties"}),a.jsxs("div",{children:[a.jsx(he,{htmlFor:`node-${e.id}-title`,style:i,children:"Title:"}),a.jsx(an,{id:`node-${e.id}-title`,name:"nodeTitle",value:e.data.title||"",onChange:c,style:r})]}),e.data.content!==void 0&&a.jsxs("div",{children:[a.jsx(he,{htmlFor:`node-${e.id}-content`,style:i,children:"Content:"}),a.jsx(cn,{id:`node-${e.id}-content`,name:"nodeContent",value:String(e.data.content)||"",onChange:d,style:g})]}),a.jsx(dn,{selectedNodes:o,onAlign:f}),a.jsxs("div",{children:[a.jsx(he,{style:i,children:"Position & Size:"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px"},children:[a.jsx(Ee,{label:"X",value:e.position.x,onChange:u,id:`node-${e.id}-pos-x`,name:"nodePosX","aria-label":"X position"}),a.jsx(Ee,{label:"Y",value:e.position.y,onChange:p,id:`node-${e.id}-pos-y`,name:"nodePosY","aria-label":"Y position"}),a.jsx(Ee,{label:"W",value:((b=e.size)==null?void 0:b.width)||100,onChange:h,id:`node-${e.id}-width`,name:"nodeWidth","aria-label":"Width"}),a.jsx(Ee,{label:"H",value:((D=e.size)==null?void 0:D.height)||100,onChange:x,id:`node-${e.id}-height`,name:"nodeHeight","aria-label":"Height"})]})]}),a.jsxs("div",{children:[a.jsx(he,{style:i,children:"Type:"}),a.jsx("div",{style:{padding:"4px 8px",backgroundColor:"#f5f5f5",borderRadius:"4px",fontSize:"13px"},children:e.type})]}),e.type==="group"&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[a.jsx(Ze,{checked:e.locked||!1,onChange:y,label:"Lock Layer"}),a.jsx(Ze,{checked:e.visible!==!1,onChange:v,label:"Visible"})]}),a.jsx("div",{style:{paddingTop:"16px",borderTop:"1px solid #eee"},children:a.jsx(Re,{onClick:n,style:{width:"100%"},variant:"danger",children:"Delete Node"})})]})});ln.displayName="DefaultInspectorRenderer";function un(e){var o,s;const t=((o=e.size)==null?void 0:o.width)||100,n=((s=e.size)==null?void 0:s.height)||100;return{left:e.position.x,top:e.position.y,right:e.position.x+t,bottom:e.position.y+n,width:t,height:n,centerX:e.position.x+t/2,centerY:e.position.y+n/2}}function Pi(e){if(e.length===0)return null;const t=e.map(un),n=Math.min(...t.map(i=>i.left)),o=Math.min(...t.map(i=>i.top)),s=Math.max(...t.map(i=>i.right)),r=Math.max(...t.map(i=>i.bottom));return{left:n,top:o,right:s,bottom:r,width:s-n,height:r-o,centerX:n+(s-n)/2,centerY:o+(r-o)/2}}function pn(e,t){if(e.length<2)return{};const n={},o=e.map(r=>({node:r,bounds:un(r)})),s=Pi(e);if(!s)return{};switch(t){case"align-left":{const r=Math.min(...o.map(i=>i.bounds.left));o.forEach(({node:i})=>{n[i.id]={x:r,y:i.position.y}});break}case"align-center-horizontal":{o.forEach(({node:r,bounds:i})=>{const c=s.centerX-i.width/2;n[r.id]={x:c,y:r.position.y}});break}case"align-right":{const r=Math.max(...o.map(i=>i.bounds.right));o.forEach(({node:i,bounds:c})=>{const d=r-c.width;n[i.id]={x:d,y:i.position.y}});break}case"align-top":{const r=Math.min(...o.map(i=>i.bounds.top));o.forEach(({node:i})=>{n[i.id]={x:i.position.x,y:r}});break}case"align-center-vertical":{o.forEach(({node:r,bounds:i})=>{const c=s.centerY-i.height/2;n[r.id]={x:r.position.x,y:c}});break}case"align-bottom":{const r=Math.max(...o.map(i=>i.bounds.bottom));o.forEach(({node:i,bounds:c})=>{const d=r-c.height;n[i.id]={x:i.position.x,y:d}});break}case"distribute-horizontal":{if(e.length<3)break;const r=o.sort((p,h)=>p.bounds.left-h.bounds.left),i=r[0],u=(r[r.length-1].bounds.left-i.bounds.left)/(r.length-1);r.forEach(({node:p},h)=>{if(h===0||h===r.length-1)n[p.id]={x:p.position.x,y:p.position.y};else{const x=i.bounds.left+u*h;n[p.id]={x,y:p.position.y}}});break}case"distribute-vertical":{if(e.length<3)break;const r=o.sort((p,h)=>p.bounds.top-h.bounds.top),i=r[0],u=(r[r.length-1].bounds.top-i.bounds.top)/(r.length-1);r.forEach(({node:p},h)=>{if(h===0||h===r.length-1)n[p.id]={x:p.position.x,y:p.position.y};else{const x=i.bounds.top+u*h;n[p.id]={x:p.position.x,y:x}}});break}}return n}const ut=l.memo(({node:e})=>{const{state:t,dispatch:n,actions:o}=F(),{state:s}=W(),r=Le(e.type),i=tt(e.id),c=rn(e,i),d=l.useCallback(v=>{n(o.updateNode(e.id,v))},[e.id,n,o]),u=l.useCallback(async v=>{c.update&&await c.update(v)},[c.update]),p=l.useCallback(()=>{n(o.deleteNode(e.id))},[e.id,n,o]),h=s.selectedNodeIds.map(v=>t.nodes[v]).filter(Boolean),x=l.useCallback((v,f)=>{const g=pn(f,v);Object.keys(g).length>0&&n(o.moveNodes(g))},[n,o]),y=l.useMemo(()=>({node:e,externalData:c.data,isLoadingExternalData:c.isLoading,externalDataError:c.error,onUpdateNode:d,onUpdateExternalData:u,onDeleteNode:p,selectedNodes:h,onAlignNodes:x}),[e,c.data,c.isLoading,c.error,d,u,p,h,x]);return a.jsxs(a.Fragment,{children:[(r==null?void 0:r.renderInspector)&&a.jsx("div",{style:{marginBottom:"16px"},children:r.renderInspector(y)}),a.jsx(ln,{...y})]})},(e,t)=>e.node.id===t.node.id&&e.node.type===t.node.type&&e.node.data===t.node.data&&e.node.position===t.node.position&&e.node.locked===t.node.locked&&e.node.visible===t.node.visible);ut.displayName="NodeInspector";const hn=(e,t)=>{const n=t.find(o=>o.type===e);return n!=null&&n.icon?n.icon:ji(e)},ji=e=>{switch(e){case"group":return"📁";case"input":return"📥";case"output":return"📤";case"process":return"⚙️";case"code-editor":return"💻";case"chart":return"📊";case"form-builder":return"📝";case"task":return"✅";case"standard":return"🔗";default:return"📦"}},ki="xtnnddtrnodtrelis",Mi="xtnnddtrhdr",Ti="xtnnddtrtitle",Oi="xtnnddtrnodcouU5z",Ai="xtnnddtrtreecnt",Ri="xtnnddtrempState",zi="xtnnddtrtreeitm",Li="xtnnddtrseligQ",Vi="xtnnddtrnodeNamegua",_i="xtnnddtrnodeicovQJ",$i="xtnnddtrexpbtn",Hi="xtnnddtrvis",Bi="xtnnddtrdel",Gi="xtnnddtrdrgvgz",Ui="xtnnddtrdraoveins",Xi="xtnnddtrdropind",Fi="xtnnddtrdropul",Q={nodeTreeList:ki,header:Mi,title:Ti,nodeCount:Oi,treeContainer:Ai,emptyState:Ri,treeItem:zi,selected:Li,nodeName:Vi,nodeIcon:_i,expandButton:$i,visibilityButton:Hi,deleteButton:Bi,dragging:Gi,dragOverInside:Ui,dropIndicator:Xi,dropIndicatorPulse:Fi},Yi=({node:e,level:t,isSelected:n,onSelect:o,onToggleVisibility:s,onToggleExpand:r,onDeleteNode:i,childNodes:c,dragState:d,onNodeDrop:u,onDragStateChange:p})=>{var V;const h=Ve(),x=e.type==="group"&&c.length>0,y=e.type==="group"&&e.expanded!==!1,v=e.type==="group",f=d.draggingNodeId===e.id,g=d.dragOverNodeId===e.id,b=g?d.dragOverPosition:null,D=S=>{S.stopPropagation(),o(e.id,S.ctrlKey||S.metaKey)},E=S=>{S.stopPropagation(),r&&x&&r(e.id)},w=S=>{S.stopPropagation(),s&&s(e.id)},j=S=>{S.stopPropagation(),i&&i(e.id)},m=S=>{S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("nodeId",e.id),p({draggingNodeId:e.id})},N=()=>{p({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null})},C=S=>{if(S.preventDefault(),S.stopPropagation(),d.draggingNodeId===e.id)return;const P=S.currentTarget.getBoundingClientRect(),M=S.clientY-P.top,T=P.height;let L;v&&M>T*.25&&M<T*.75?L="inside":M<T/2?L="before":L="after",(d.dragOverNodeId!==e.id||d.dragOverPosition!==L)&&p({dragOverNodeId:e.id,dragOverPosition:L})},I=S=>{S.currentTarget===S.target&&p({dragOverNodeId:null,dragOverPosition:null})},O=S=>{S.preventDefault(),S.stopPropagation();const P=S.dataTransfer.getData("nodeId");P&&d.dragOverPosition&&u(P,e.id,d.dragOverPosition),p({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null})};return a.jsxs(a.Fragment,{children:[g&&b==="before"&&a.jsx("div",{className:Q.dropIndicator,style:{marginLeft:`${t*16+8}px`}}),a.jsxs("div",{className:`${Q.treeItem} ${n?Q.selected:""} ${f?Q.dragging:""} ${g&&b==="inside"?Q.dragOverInside:""}`,style:{paddingLeft:`${t*16+8}px`},onClick:D,draggable:!0,onDragStart:m,onDragEnd:N,onDragOver:C,onDragLeave:I,onDrop:O,children:[x&&a.jsx("button",{className:Q.expandButton,onClick:E,"aria-label":y?"Collapse":"Expand",children:a.jsx("svg",{width:"8",height:"8",viewBox:"0 0 8 8",fill:"currentColor",style:{transform:y?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s"},children:a.jsx("path",{d:"M2 1l4 3-4 3V1z"})})}),a.jsx("span",{className:Q.nodeIcon,children:hn(e.type,h)}),a.jsx("span",{className:Q.nodeName,children:((V=e.data)==null?void 0:V.title)||e.type}),a.jsx("button",{className:Q.visibilityButton,onClick:w,"aria-label":e.visible!==!1?"Hide":"Show",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:e.visible!==!1?a.jsx("path",{d:"M8 3C4.5 3 1.73 5.11 1 8c.73 2.89 3.5 5 7 5s6.27-2.11 7-5c-.73-2.89-3.5-5-7-5zm0 8.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0-5.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"}):a.jsxs(a.Fragment,{children:[a.jsx("path",{d:"M8 3C4.5 3 1.73 5.11 1 8c.73 2.89 3.5 5 7 5s6.27-2.11 7-5c-.73-2.89-3.5-5-7-5zm0 8.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0-5.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4z",opacity:"0.3"}),a.jsx("path",{d:"M2 2l12 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})}),a.jsx("button",{className:Q.deleteButton,onClick:j,"aria-label":"Delete node",children:a.jsx(Zn,{size:12})})]}),x&&y&&c.map(S=>a.jsx(fn,{nodeId:S.id,level:t+1,dragState:d,onNodeDrop:u,onDragStateChange:p},S.id)),g&&b==="after"&&a.jsx("div",{className:Q.dropIndicator,style:{marginLeft:`${t*16+8}px`}})]})},fn=({nodeId:e,level:t,dragState:n,onNodeDrop:o,onDragStateChange:s})=>{const{state:r,dispatch:i,actions:c}=F(),{state:d,dispatch:u,actions:p}=W(),h=r.nodes[e];if(!h)return null;const x=d.selectedNodeIds.includes(e),y=Object.values(r.nodes).filter(D=>D.parentId===e),v=l.useCallback((D,E)=>{u(p.selectNode(D,E))},[u,p]),f=l.useCallback(D=>{const E=r.nodes[D];E&&i(c.updateNode(D,{visible:E.visible===!1}))},[r.nodes,i,c]),g=l.useCallback(D=>{const E=r.nodes[D];E&&E.type==="group"&&i(c.updateNode(D,{expanded:!E.expanded}))},[r.nodes,i,c]),b=l.useCallback(D=>{i(c.deleteNode(D))},[i,c]);return a.jsx(Yi,{node:h,level:t,isSelected:x,onSelect:v,onToggleVisibility:f,onToggleExpand:g,onDeleteNode:b,childNodes:y,dragState:n,onNodeDrop:o,onDragStateChange:s})},Wi=({className:e})=>{const{state:t,dispatch:n,actions:o}=F(),{dispatch:s,actions:r}=W(),[i,c]=l.useState({draggingNodeId:null,dragOverNodeId:null,dragOverPosition:null}),d=l.useMemo(()=>Object.values(t.nodes).filter(y=>!y.parentId),[t.nodes]),u=l.useMemo(()=>[...d].sort((y,v)=>{var b,D;if(y.type==="group"&&v.type!=="group")return-1;if(y.type!=="group"&&v.type==="group")return 1;const f=((b=y.data)==null?void 0:b.title)||y.type,g=((D=v.data)==null?void 0:D.title)||v.type;return f.localeCompare(g)}),[d]),p=l.useCallback(()=>{s(r.clearSelection())},[s,r]),h=l.useCallback(y=>{c(v=>({...v,...y}))},[]),x=l.useCallback((y,v,f)=>{const g=t.nodes[y],b=t.nodes[v];if(!g||!b)return;const D=(E,w)=>{const j=t.nodes[E];return j?j.parentId===w?!0:j.parentId?D(j.parentId,w):!1:!1};if(!(y===v||D(v,y)))if(f==="inside"&&b.type==="group")n(o.updateNode(y,{parentId:v})),b.expanded||n(o.updateNode(v,{expanded:!0}));else{const E=b.parentId||void 0;n(o.updateNode(y,{parentId:E}))}},[t.nodes,n,o]);return a.jsxs("div",{className:`${Q.nodeTreeList} ${e||""}`,children:[a.jsxs("div",{className:Q.header,children:[a.jsx("h3",{className:Q.title,children:"Layers"}),a.jsxs("div",{className:Q.nodeCount,children:[Object.keys(t.nodes).length," nodes"]})]}),a.jsx("div",{className:Q.treeContainer,onClick:p,children:u.length===0?a.jsx("div",{className:Q.emptyState,children:"No nodes yet"}):u.map(y=>a.jsx(fn,{nodeId:y.id,level:0,dragState:i,onNodeDrop:x,onDragStateChange:h},y.id))})]})},gn=({tabs:e,activeTabIndex:t,onTabChange:n,className:o})=>a.jsx("div",{className:U(k.tabNav,o),children:e.map((s,r)=>a.jsx("button",{className:U(k.tabButton,r===t&&k.tabButtonActive),onClick:()=>n(r),type:"button",children:s},r))});gn.displayName="TabNav";const pt=({className:e})=>{var y,v;const{state:t,actions:n,dispatch:o}=F(),{state:s}=W(),{state:r,dispatch:i,actions:c}=oe(),[d,u]=l.useState(0),p=["Layers","Properties"],h=s.selectedNodeIds.length>0?t.nodes[s.selectedNodeIds[0]]:null;s.selectedNodeIds.map(f=>t.nodes[f]).filter(Boolean);const x=s.selectedConnectionIds.length>0?t.connections[s.selectedConnectionIds[0]]:null;return l.useCallback((f,g)=>{const b=pn(g,f);Object.keys(b).length>0&&o(n.moveNodes(b))},[o,n]),a.jsxs("div",{className:U(k.inspectorPanel,e),children:[a.jsx("div",{className:k.inspectorHeader,children:a.jsx(gn,{tabs:p,activeTabIndex:d,onTabChange:u})}),a.jsx("div",{className:U(k.inspectorContent,d===0&&k.inspectorContentNoPadding),children:d===0?a.jsx(Wi,{}):a.jsxs(a.Fragment,{children:[h&&a.jsx("div",{className:k.inspectorSection,children:a.jsx(ut,{node:h})}),x&&a.jsxs("div",{className:k.inspectorSection,children:[a.jsx(Ge,{children:"Connection Properties"}),a.jsxs("div",{className:k.inspectorField,children:[a.jsx("label",{children:"From:"}),a.jsxs("span",{className:k.inspectorReadOnlyField,children:[((y=t.nodes[x.fromNodeId])==null?void 0:y.data.title)||x.fromNodeId,".",x.fromPortId]})]}),a.jsxs("div",{className:k.inspectorField,children:[a.jsx("label",{children:"To:"}),a.jsxs("span",{className:k.inspectorReadOnlyField,children:[((v=t.nodes[x.toNodeId])==null?void 0:v.data.title)||x.toNodeId,".",x.toPortId]})]})]}),!h&&!x&&a.jsx("div",{className:k.inspectorEmptyState,children:a.jsx("p",{children:"Select a node or connection to view its properties"})}),s.selectedNodeIds.length>1&&a.jsxs("div",{className:k.inspectorSection,children:[a.jsx(Ge,{children:"Multiple Selection"}),a.jsxs("p",{children:[s.selectedNodeIds.length," nodes selected"]})]}),a.jsxs("div",{className:k.inspectorSection,children:[a.jsx(Ge,{children:"Grid Settings"}),a.jsx("div",{className:k.inspectorField,children:a.jsxs(he,{children:[a.jsx(Ne,{id:"grid-show",name:"showGrid",type:"checkbox",checked:r.gridSettings.showGrid,onChange:f=>{i(c.updateGridSettings({showGrid:f.target.checked}))}}),"Show Grid"]})}),a.jsx("div",{className:k.inspectorField,children:a.jsxs(he,{children:[a.jsx(Ne,{id:"grid-snap",name:"snapToGrid",type:"checkbox",checked:r.gridSettings.snapToGrid,onChange:f=>{i(c.updateGridSettings({snapToGrid:f.target.checked}))}}),"Snap to Grid"]})}),a.jsx("div",{className:k.inspectorField,children:a.jsxs(he,{htmlFor:"grid-size",children:["Grid Size:",a.jsx(Ne,{id:"grid-size",name:"gridSize",type:"number",className:k.inspectorInput,value:r.gridSettings.size,min:10,max:100,step:5,onChange:f=>{const g=parseInt(f.target.value,10);!isNaN(g)&&g>0&&i(c.updateGridSettings({size:g}))},"aria-label":"Grid size in pixels"})]})}),a.jsx("div",{className:k.inspectorField,children:a.jsxs(he,{htmlFor:"snap-threshold",children:["Snap Threshold:",a.jsx(Ne,{id:"snap-threshold",name:"snapThreshold",type:"number",className:k.inspectorInput,value:r.gridSettings.snapThreshold,min:1,max:20,step:1,onChange:f=>{const g=parseInt(f.target.value,10);!isNaN(g)&&g>0&&i(c.updateGridSettings({snapThreshold:g}))},"aria-label":"Snap threshold in pixels"})]})})]})]})})]})};pt.displayName="InspectorPanel";const Ki="xtnnddtrhzdiv",Zi="xtnnddtrdrgBS7",Nt={horizontalDivider:Ki,dragging:Zi},Ct=({onResize:e,className:t})=>{const[n,o]=l.useState(!1),s=l.useRef(0),r=l.useCallback(d=>{d.preventDefault(),o(!0),s.current=d.clientX,d.currentTarget.setPointerCapture(d.pointerId)},[]),i=l.useCallback(d=>{if(!n)return;const u=d.clientX-s.current;s.current=d.clientX,e(u)},[n,e]),c=l.useCallback(d=>{o(!1),d.currentTarget.releasePointerCapture(d.pointerId)},[]);return a.jsx("div",{className:`${Nt.horizontalDivider} ${t||""} ${n?Nt.dragging:""}`,onPointerDown:r,onPointerMove:i,onPointerUp:c})},qi="xtnnddtrcollyt",Ji="xtnnddtrrightsbr",Qi="xtnnddtrleftsbr",ea="xtnnddtrmainctn",ta="xtnnddtrleftrsz",na="xtnnddtrrightrsz",ve={columnLayout:qi,rightSidebar:Ji,leftSidebar:Qi,mainContent:ea,leftResizer:ta,rightResizer:na},mn=({className:e,children:t,leftSidebar:n,rightSidebar:o,leftSidebarInitialWidth:s=280,rightSidebarInitialWidth:r=280,leftSidebarMinWidth:i=200,rightSidebarMinWidth:c=200,leftSidebarMaxWidth:d=600,rightSidebarMaxWidth:u=600,onLeftSidebarWidthChange:p,onRightSidebarWidthChange:h})=>{const[x,y]=l.useState(s),[v,f]=l.useState(r),g=l.useCallback(D=>{y(E=>{const w=Math.max(i,Math.min(d,E+D));return p==null||p(w),w})},[i,d,p]),b=l.useCallback(D=>{f(E=>{const w=Math.max(c,Math.min(u,E-D));return h==null||h(w),w})},[c,u,h]);return l.useEffect(()=>{y(s)},[s]),l.useEffect(()=>{f(r)},[r]),a.jsxs("div",{className:`${ve.columnLayout} ${e||""}`,children:[n&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:ve.leftSidebar,style:{width:x},children:n}),a.jsx(Ct,{onResize:g,className:ve.leftResizer})]}),a.jsx("div",{className:ve.mainContent,children:t}),o&&a.jsxs(a.Fragment,{children:[a.jsx(Ct,{onResize:b,className:ve.rightResizer}),a.jsx("div",{className:ve.rightSidebar,style:{width:v},children:o})]})]})},oa="xtnnddtrselboxiVu",sa={selectionBoxOverlay:oa},yn=({className:e})=>{const{state:t}=W();if(!t.selectionBox)return null;const{start:n,end:o}=t.selectionBox,s=Math.min(n.x,o.x),r=Math.min(n.y,o.y),i=Math.abs(o.x-n.x),c=Math.abs(o.y-n.y);return a.jsx("div",{className:U(sa.selectionBoxOverlay,e),style:{left:s,top:r,width:i,height:c}})};yn.displayName="SelectionBox";const ra="xtnnddtrselHd3",ia={selectionOverlay:ra},xn=({className:e})=>a.jsx("div",{className:U(ia.selectionOverlay,e),children:a.jsx(yn,{})});xn.displayName="SelectionOverlay";const vn=({children:e,className:t,showGrid:n=!0})=>{const{state:o,dispatch:s,actions:r,canvasRef:i,utils:c}=oe(),{state:d,dispatch:u,actions:p}=W(),{state:h}=F(),x=l.useRef(null),[y,v]=l.useState(!1),f=l.useMemo(()=>{const{offset:m,scale:N}=o.viewport;return`translate(${m.x}px, ${m.y}px) scale(${N})`},[o.viewport]),g=l.useMemo(()=>{if(!o.gridSettings.showGrid)return null;const{size:m}=o.gridSettings,{scale:N,offset:C}=o.viewport,I=m*N,O=C.x%I,V=C.y%I;return a.jsx("defs",{children:a.jsx("pattern",{id:"grid",width:I,height:I,patternUnits:"userSpaceOnUse",x:O,y:V,children:a.jsx("path",{d:`M ${I} 0 L 0 0 0 ${I}`,fill:"none",stroke:" #e0e0e0",strokeWidth:"1",opacity:"0.5"})})})},[o.gridSettings,o.viewport]),b=l.useCallback(m=>{var C;const N=(C=x.current)==null?void 0:C.getBoundingClientRect();if(N)if(m.ctrlKey||m.metaKey){m.preventDefault();const I={x:m.clientX-N.left,y:m.clientY-N.top},O=m.deltaY*-.01,V=o.viewport.scale*(1+O);s(r.zoomViewport(V,I))}else{m.preventDefault();const I=-m.deltaX,O=-m.deltaY;s(r.panViewport({x:I,y:O}))}},[o.viewport.scale,s,r]),D=l.useCallback(m=>{var I,O;if(m.button===1||o.isSpacePanning){m.preventDefault(),s(r.startPan({x:m.clientX,y:m.clientY})),x.current&&x.current.setPointerCapture(m.pointerId);return}const N=m.target,C=(I=N==null?void 0:N.closest)==null?void 0:I.call(N,'.nodeView, .port, .connectionGroup, button, input, textarea, [role="button"]');if(m.button===0&&!C){const V=(O=x.current)==null?void 0:O.getBoundingClientRect();if(!V)return;const S=m.clientX-V.left,P=m.clientY-V.top;v(!0),u(p.setSelectionBox({start:{x:S,y:P},end:{x:S,y:P}})),!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&u(p.clearSelection()),x.current&&x.current.setPointerCapture(m.pointerId)}},[o.isSpacePanning,o.viewport,s,r,u,p]),E=l.useCallback(m=>{var N;if(o.panState.isPanning)s(r.updatePan({x:m.clientX,y:m.clientY}));else if(y&&d.selectionBox){const C=(N=x.current)==null?void 0:N.getBoundingClientRect();if(!C)return;const I=m.clientX-C.left,O=m.clientY-C.top;u(p.setSelectionBox({start:d.selectionBox.start,end:{x:I,y:O}}))}},[o.panState.isPanning,o.viewport,y,d.selectionBox,s,r,u,p]),w=l.useCallback(m=>{var N;if(o.panState.isPanning)s(r.endPan()),x.current&&x.current.releasePointerCapture(m.pointerId);else if(y&&d.selectionBox){v(!1);const{start:C,end:I}=d.selectionBox;if(!((N=x.current)==null?void 0:N.getBoundingClientRect()))return;const V=(C.x-o.viewport.offset.x)/o.viewport.scale,S=(C.y-o.viewport.offset.y)/o.viewport.scale,P=(I.x-o.viewport.offset.x)/o.viewport.scale,M=(I.y-o.viewport.offset.y)/o.viewport.scale,T=Math.min(V,P),L=Math.max(V,P),z=Math.min(S,M),_=Math.max(S,M),G=[];if(Object.values(h.nodes).forEach($=>{var ie,ge;const B=((ie=$.size)==null?void 0:ie.width)||150,K=((ge=$.size)==null?void 0:ge.height)||50;$.position.x<L&&$.position.x+B>T&&$.position.y<_&&$.position.y+K>z&&G.push($.id)}),G.length>0)if(m.shiftKey||m.ctrlKey||m.metaKey){const $=[...new Set([...d.selectedNodeIds,...G])];u(p.selectAllNodes($))}else u(p.selectAllNodes(G));u(p.setSelectionBox(null)),x.current&&x.current.releasePointerCapture(m.pointerId)}},[o.panState.isPanning,y,d.selectionBox,d.selectedNodeIds,h.nodes,s,r,u,p]),j=l.useCallback(m=>{m.preventDefault(),m.stopPropagation();const N=c.screenToCanvas(m.clientX,m.clientY),C={x:m.clientX,y:m.clientY};u(p.showContextMenu(C,void 0,N))},[u,p,c]);return l.useEffect(()=>{const m=C=>{if(C.code==="Space"&&!C.repeat&&!C.ctrlKey&&!C.metaKey&&(C.preventDefault(),s(r.setSpacePanning(!0))),(C.ctrlKey||C.metaKey)&&!C.repeat)switch(C.key){case"0":C.preventDefault(),s(r.resetViewport());break;case"1":C.preventDefault();break;case"=":case"+":C.preventDefault(),s(r.zoomViewport(o.viewport.scale*1.2));break;case"-":C.preventDefault(),s(r.zoomViewport(o.viewport.scale*.8));break}},N=C=>{C.code==="Space"&&(C.preventDefault(),s(r.setSpacePanning(!1)))};return window.addEventListener("keydown",m),window.addEventListener("keyup",N),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",N)}},[s,r,o.viewport.scale]),l.useEffect(()=>{const m=x.current;if(m)return m.addEventListener("wheel",b,{passive:!1}),()=>m.removeEventListener("wheel",b)},[b]),a.jsxs("div",{ref:x,className:U(k.canvasContainer,o.panState.isPanning&&k.panning,o.isSpacePanning&&k.spacePanning,y&&k.boxSelecting,t),onPointerDown:D,onPointerMove:E,onPointerUp:w,onContextMenu:j,role:"application","aria-label":"Node Editor Canvas",children:[o.gridSettings.showGrid&&a.jsxs("svg",{className:k.gridSvg,children:[g,a.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]}),a.jsx("div",{ref:i,className:k.canvas,style:{transform:f},children:e}),a.jsx(xn,{})]})};vn.displayName="CanvasBase";const Xe=Ie.visualSize/2,aa={DISCONNECT_THRESHOLD:Xe,NEW_CONNECTION_THRESHOLD:2,CONNECTION_SNAP_DISTANCE:Xe*4,HOVER_DISTANCE:Xe*2};function St(e,t){if(!t.snapToGrid)return e;const{size:n,snapThreshold:o}=t,s=Math.round(e.x/n)*n,r=Math.round(e.y/n)*n,i=Math.abs(e.x-s),c=Math.abs(e.y-r);return{x:i<=o?s:e.x,y:c<=o?r:e.y}}function ca(e,t,n){if(!t.snapToGrid)return e;const o=e[n];if(!o){const d={};return Object.entries(e).forEach(([u,p])=>{d[u]=St(p,t)}),d}const s=St(o,t),r=s.x-o.x,i=s.y-o.y,c={};return Object.entries(e).forEach(([d,u])=>{c[d]={x:u.x+r,y:u.y+i}}),c}const da="xtnnddtrportH4B",la="xtnnddtrportinpJGc",ua="xtnnddtrporout68f",pa="xtnnddtrportLeft2Oc",ha="xtnnddtrporrigHwV",fa="xtnnddtrportTopuYu",ga="xtnnddtrporbotx0m",ma="xtnnddtrporinnCiS",ya="xtnnddtrporhovI-R",xa="xtnnddtrporconf0-",va="xtnnddtrpulsexKp",ba="xtnnddtrporcontda",Na="xtnnddtrporcan",Ca="xtnnddtrporcone8f",Sa="xtnnddtrportlblMh9",Ea="xtnnddtrporlefTQ3",wa="xtnnddtrporrigj3t",Ia="xtnnddtrportop2o0",Da="xtnnddtrporbot6kJ",ce={port:da,portInput:la,portOutput:ua,portLeft:pa,portRight:ha,portTop:fa,portBottom:ga,portInner:ma,portHovered:ya,portConnecting:xa,pulse:va,portConnectable:ba,portCandidate:Na,portConnected:Ca,portLabel:Sa,portLabelLeft:Ea,portLabelRight:wa,portLabelTop:Ia,portLabelBottom:Da},bn=({port:e,onPointerDown:t,onPointerUp:n,onPointerEnter:o,onPointerLeave:s,isConnecting:r=!1,isConnectable:i=!1,isCandidate:c=!1,isHovered:d=!1,isConnected:u=!1})=>{const p=dt(e.nodeId,e.id),h=()=>{if(!p)return{left:0,top:0,position:"absolute"};const{renderPosition:g}=p;return{left:g.x,top:g.y,transform:g.transform,position:"absolute"}},x=g=>{g.stopPropagation(),t==null||t(g,e)},y=g=>{g.stopPropagation(),n==null||n(g,e)},v=g=>{o==null||o(g,e)},f=g=>{s==null||s(g,e)};return a.jsxs("div",{className:U(ce.port,ce[`port${e.type.charAt(0).toUpperCase()}${e.type.slice(1)}`],ce[`port${e.position.charAt(0).toUpperCase()}${e.position.slice(1)}`],r&&ce.portConnecting,i&&ce.portConnectable,c&&ce.portCandidate,d&&ce.portHovered,u&&ce.portConnected),style:h(),onPointerDown:x,onPointerUp:y,onPointerEnter:v,onPointerLeave:f,"data-port-id":e.id,"data-port-type":e.type,"data-node-id":e.nodeId,title:e.label,children:[a.jsx("div",{className:ce.portInner}),e.label&&a.jsx("span",{className:U(ce.portLabel,ce[`portLabel${e.position.charAt(0).toUpperCase()}${e.position.slice(1)}`]),children:e.label})]})};bn.displayName="PortView";const Pa="xtnnddtrresMQd",ja="xtnnddtrresvis",ka="xtnnddtrresnOA",Fe={resizeHandle:Pa,resizeHandleVisible:ja,resizeHandleActive:ka},Nn=({position:e,onResizeStart:t,isResizing:n=!1,isVisible:o=!1})=>{const s=l.useCallback(i=>{i.stopPropagation(),i.preventDefault(),t(i,e)},[t,e]),r=()=>({bottom:-2,right:-2,cursor:"se-resize",width:10,height:10});return a.jsx("div",{className:U(Fe.resizeHandle,o&&Fe.resizeHandleVisible,n&&Fe.resizeHandleActive),style:{position:"absolute",zIndex:10,...r()},onPointerDown:s,"data-resize-handle":e})};Nn.displayName="ResizeHandle";const Ma=({node:e,isSelected:t,isDragging:n,dragOffset:o,onPointerDown:s,onContextMenu:r,onPortPointerDown:i,onPortPointerUp:c,onPortPointerEnter:d,onPortPointerLeave:u,connectingPort:p,hoveredPort:h,connectedPorts:x,nodeRenderer:y,externalData:v,onUpdateNode:f})=>{const{dispatch:g,actions:b,getNodePorts:D}=F(),{state:E}=W(),{isEditing:w,startEditing:j,updateValue:m,confirmEdit:N,cancelEdit:C,state:I}=Vt(),O=nt(),V=st({autoUpdateMembership:!1}),S=Le(e.type),P=tt(e.id),M=rn(e,P),T=l.useRef(null),L=O.isResizing(e.id),z=O.getResizeHandle(e.id),_=e.type==="group"?V.getGroupChildren(e.id):[],G=_.length>0,$=l.useMemo(()=>({x:e.position.x,y:e.position.y}),[e.position.x,e.position.y]);l.useLayoutEffect(()=>{if(!T.current)return;let R=$.x,H=$.y;if(n&&o)R+=o.x,H+=o.y;else if(E.dragState){const{affectedChildNodes:X,offset:J}=E.dragState;Object.entries(X).some(([me,de])=>de.includes(e.id))&&(R+=J.x,H+=J.y)}T.current.style.transform=`translate(${R}px, ${H}px)`},[$,n,o,E.dragState,e.id]);const B=l.useMemo(()=>{var X,J;const R={width:((X=e.size)==null?void 0:X.width)||150,height:((J=e.size)==null?void 0:J.height)||50},H=O.getCurrentSize(e.id);return L&&H?H:R},[e.size,L,O,e.id]),K=l.useMemo(()=>{switch(e.data.visualState){case"info":return k.nodeInfo;case"success":return k.nodeSuccess;case"warning":return k.nodeWarning;case"error":return k.nodeError;case"disabled":return k.nodeDisabled;default:return null}},[e.data.visualState]),te=l.useCallback(R=>{if(R.stopPropagation(),!e.locked){const H=e.data.title||`Node ${e.id.slice(0,6)}`;j(e.id,"title",H)}},[e.id,e.data.title,e.locked,j]),ie=l.useCallback(R=>{m(R.target.value)},[m]),ge=l.useCallback(R=>{R.key==="Enter"?(R.preventDefault(),R.stopPropagation(),g(b.updateNode(e.id,{data:{...e.data,title:I.currentValue}})),N()):R.key==="Escape"&&(R.preventDefault(),R.stopPropagation(),C())},[I.currentValue,e.id,e.data,g,b,N,C]),Pe=l.useCallback(()=>{g(b.updateNode(e.id,{data:{...e.data,title:I.currentValue}})),N()},[I.currentValue,e.id,e.data,g,b,N]),Ce=l.useCallback(R=>{g(b.updateNode(e.id,R))},[e.id,g,b]),_e=l.useCallback((R,H)=>{var J,se;if(R.stopPropagation(),R.preventDefault(),e.locked)return;const X={width:((J=e.size)==null?void 0:J.width)||150,height:((se=e.size)==null?void 0:se.height)||50};O.startResize(e.id,H,{x:R.clientX,y:R.clientY},X)},[e.id,e.size,e.locked,O]),$e=(S==null?void 0:S.renderNode)&&!w(e.id,"title"),He=l.useMemo(()=>({node:e,isSelected:t,isDragging:n,isEditing:w(e.id,"title"),externalData:M.data,isLoadingExternalData:M.isLoading,externalDataError:M.error,onStartEdit:()=>j(e.id,"title",e.data.title||""),onUpdateNode:Ce}),[e,t,n,M,j,Ce,w]),Be=l.useMemo(()=>{if(!E.dragState)return!1;const{affectedChildNodes:R}=E.dragState;return Object.entries(R).some(([H,X])=>X.includes(e.id))},[E.dragState,e.id]),q=l.useCallback(R=>{if((S==null?void 0:S.interactive)&&!t){const J=R.target.closest('[data-drag-handle="true"]');s(R,e.id,!!J)}else s(R,e.id,!0)},[S==null?void 0:S.interactive,e.id,t,s]);return a.jsxs("div",{ref:T,className:U(k.nodeView,e.type==="group"&&k.groupNode,e.type==="group"&&G&&k.groupHasChildren,t&&k.selected,(n||Be)&&k.dragging,L&&k.resizing,e.locked&&k.locked,K||void 0),style:{width:B.width,height:B.height,zIndex:n||L?1e3:e.type==="group"?1:2},onPointerDown:q,onContextMenu:R=>r(R,e.id),"data-node-id":e.id,children:[$e&&(S!=null&&S.renderNode)?a.jsx("div",{className:k.customNodeContent,children:S.renderNode(He)}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:U(k.nodeHeader,(S==null?void 0:S.interactive)&&!t&&k.interactiveDragHandle),"data-drag-handle":S!=null&&S.interactive?"true":"false",children:[e.locked&&a.jsx("span",{className:k.lockIcon,children:"🔒"}),w(e.id,"title")?a.jsx("input",{id:`node-title-${e.id}`,name:"nodeTitle",className:k.nodeTitleInput,type:"text",value:I.currentValue,onChange:ie,onKeyDown:ge,onBlur:Pe,autoFocus:!0,onClick:R=>R.stopPropagation(),"aria-label":"Node title"}):a.jsx("span",{className:k.nodeTitle,onDoubleClick:te,children:e.data.title||`Node ${e.id.slice(0,6)}`})]}),a.jsx("div",{className:k.nodeContent,children:e.type==="group"?a.jsx(Ta,{node:e,childCount:_.length}):e.data.content||"Empty node"})]}),(()=>{const R=D(e.id);return!R||R.length===0?null:(R.reduce((H,X)=>(H[X.position]||(H[X.position]=[]),H[X.position].push(X),H),{}),a.jsx("div",{className:k.nodePorts,children:R.map(H=>{var X,J,se;return a.jsx(bn,{port:H,onPointerDown:i,onPointerUp:c,onPointerEnter:d,onPointerLeave:u,isConnecting:((X=E.connectionDragState)==null?void 0:X.fromPort.id)===H.id,isConnectable:E.connectablePortIds.has(H.id),isCandidate:((se=(J=E.connectionDragState)==null?void 0:J.candidatePort)==null?void 0:se.id)===H.id,isHovered:(h==null?void 0:h.id)===H.id,isConnected:x==null?void 0:x.has(H.id)},H.id)})}))})(),t&&!e.locked&&a.jsx(Nn,{position:"se",onResizeStart:_e,isResizing:z==="se"})]})},Ta=({node:e,childCount:t})=>e.expanded?a.jsx("div",{className:k.groupExpanded,children:t>0?`Contains ${t} nodes`:"Empty group - Drop nodes here"}):a.jsx("div",{className:k.groupCollapsed,children:t>0?`${t} nodes - Click to expand`:"Empty group - Drop nodes here"}),Oa=(e,t)=>{var n,o,s,r,i,c,d,u,p,h,x,y,v,f;if(e.node.id!==t.node.id||e.isSelected!==t.isSelected||e.isDragging!==t.isDragging||e.isResizing!==t.isResizing||e.node.position.x!==t.node.position.x||e.node.position.y!==t.node.position.y||((n=e.node.size)==null?void 0:n.width)!==((o=t.node.size)==null?void 0:o.width)||((s=e.node.size)==null?void 0:s.height)!==((r=t.node.size)==null?void 0:r.height)||e.node.locked!==t.node.locked||e.node.data!==t.node.data||((i=e.dragOffset)==null?void 0:i.x)!==((c=t.dragOffset)==null?void 0:c.x)||((d=e.dragOffset)==null?void 0:d.y)!==((u=t.dragOffset)==null?void 0:u.y)||((p=e.connectingPort)==null?void 0:p.id)!==((h=t.connectingPort)==null?void 0:h.id)||((x=e.hoveredPort)==null?void 0:x.id)!==((y=t.hoveredPort)==null?void 0:y.id))return!1;if(e.node.ports)for(const g of e.node.ports){const b=((v=e.connectedPorts)==null?void 0:v.has(g.id))??!1,D=((f=t.connectedPorts)==null?void 0:f.has(g.id))??!1;if(b!==D)return!1}return!0},Cn=l.memo(Ma,Oa);Cn.displayName="NodeView";function Aa(e,t){return Object.values(t).filter(n=>n.fromPortId===e.id&&n.fromNodeId===e.nodeId||n.toPortId===e.id&&n.toNodeId===e.nodeId)}function Ra(e,t,n,o,s,r){const i=o[e];if(!i||i.locked)return[];if(s&&!r&&!n.includes(e))return[];let c;if(n.includes(e))c=n.filter(d=>{const u=o[d];return!(!u||u.locked||u.parentId&&n.includes(u.parentId))});else if(t){const d=[...n,e];c=d.filter(u=>{const p=o[u];return!(!p||p.locked||p.parentId&&d.includes(p.parentId))})}else{if(s&&!r)return[];c=[e]}return c}function Et(e,t){return e.type===t.type||e.nodeId===t.nodeId?null:e.type==="output"?{fromNodeId:e.nodeId,fromPortId:e.id,toNodeId:t.nodeId,toPortId:t.id}:{fromNodeId:t.nodeId,fromPortId:t.id,toNodeId:e.nodeId,toPortId:e.id}}function za(e,t){const n=e.type!==t.type,o=e.nodeId===t.nodeId;return n&&!o}function La(e,t,n){const o={},s={};return e.forEach(r=>{const i=t[r];if(i&&(o[r]={...i.position},i.type==="group")){const c=n(r);s[r]=c.map(d=>d.id),c.forEach(d=>{o[d.id]={...d.position}})}}),{initialPositions:o,affectedChildNodes:s}}function Va(e,t,n){const o={};return e.forEach(s=>{const r=t[s];r&&(o[s]={x:r.x+n.x,y:r.y+n.y})}),o}function _a(e,t,n,o,s){const r=e.filter(c=>{const d=t[c];return d&&d.type==="group"});if(r.length===0)return n;r.forEach(c=>{const d=o[c],u=n[c];if(d&&u){const p={x:u.x-d.x,y:u.y-d.y};s(c,p)}});const i={};return e.forEach(c=>{const d=t[c];d&&d.type!=="group"&&n[c]&&(i[c]=n[c])}),i}function $a(e,t,n,o){const s=e.fromPortId===t.id&&e.fromNodeId===t.nodeId,r=s?e.toNodeId:e.fromNodeId,i=s?e.toPortId:e.fromPortId,c=n[r];if(!c)return null;const u=o(r).find(p=>p.id===i);return u?{otherNode:c,otherPort:u,isFromPort:s}:null}const Sn=({className:e,doubleClickToEdit:t=!0})=>{const{state:n,dispatch:o,actions:s,getNodePorts:r}=F(),{state:i,dispatch:c,actions:d}=W(),{state:u}=oe(),p=ze();nt({minWidth:100,minHeight:40,snapToGrid:u.gridSettings.snapToGrid,gridSize:u.gridSettings.size});const h=st({autoUpdateMembership:!0,membershipUpdateDelay:200}),x=Zt(n.nodes),y=l.useMemo(()=>x.sort((m,N)=>m.type==="group"&&N.type!=="group"?-1:m.type!=="group"&&N.type==="group"?1:0),[x]),v=l.useMemo(()=>{const m=new Set;return Object.values(n.connections).forEach(N=>{m.add(N.fromPortId),m.add(N.toPortId)}),m},[n.connections]);l.useEffect(()=>{c(d.updateConnectedPorts(v))},[v,c,d]);const f=l.useCallback((m,N)=>{m.preventDefault(),m.stopPropagation();const C={x:m.clientX,y:m.clientY};c(d.showContextMenu(C,N))},[c,d]),g=l.useCallback((m,N,C=!0)=>{if(m.button!==0)return;m.stopPropagation();const I=n.nodes[N],O=m.shiftKey||m.metaKey||m.ctrlKey;if(I!=null&&I.locked){c(d.selectNode(N,O));return}const V=I?p.registry.get(I.type):void 0,S=(V==null?void 0:V.interactive)||!1;if(S&&!C&&!i.selectedNodeIds.includes(N)){c(d.selectNode(N,O));return}const P=Ra(N,O,i.selectedNodeIds,n.nodes,S,C);if(i.selectedNodeIds.includes(N)||c(d.selectNode(N,O)),P.length===0)return;const M={x:m.clientX,y:m.clientY},{initialPositions:T,affectedChildNodes:L}=La(P,n.nodes,h.getGroupChildren);c(d.startNodeDrag(P,M,T,L))},[c,d,i.selectedNodeIds,n.nodes,h,p]),b=l.useRef(null),D=l.useCallback((m,N)=>{m.stopPropagation();const C=n.nodes[N.nodeId];if(!C)return;const I={...C,ports:r(N.nodeId)},V=De(I).get(N.id),S=(V==null?void 0:V.connectionPoint)||{x:C.position.x,y:C.position.y},P=Aa(N,n.connections);if(b.current={x:m.clientX,y:m.clientY,port:N,hasConnection:P.length>0},P.length===0){const z={id:N.id,nodeId:N.nodeId,type:N.type,label:N.label,position:N.position};c(d.startConnectionDrag(z)),c(d.updateConnectionDrag(S,null));return}const M=z=>{if(!b.current)return;const _=z.clientX-b.current.x,G=z.clientY-b.current.y;Math.sqrt(_*_+G*G)>aa.DISCONNECT_THRESHOLD&&(document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",T),L())},T=()=>{b.current=null,document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",T)},L=()=>{const z=P[0],_=$a(z,N,n.nodes,r);if(!_)return;const{otherNode:G,otherPort:$,isFromPort:B}=_,K={id:$.id,nodeId:G.id,type:$.type,label:$.label,position:$.position};c(d.startConnectionDisconnect({id:z.id,fromNodeId:z.fromNodeId,fromPortId:z.fromPortId,toNodeId:z.toNodeId,toPortId:z.toPortId},B?"from":"to",K,S)),o(s.deleteConnection(z.id)),b.current=null};document.addEventListener("pointermove",M),document.addEventListener("pointerup",T)},[n.connections,n.nodes,c,d,o,s,r]),E=l.useCallback((m,N)=>{if(m.stopPropagation(),i.connectionDisconnectState){const V=i.connectionDisconnectState.fixedPort;if(za(V,N)){const S=Et(V,N);S&&o(s.addConnection(S))}c(d.endConnectionDisconnect());return}if(!i.connectionDragState)return;const C=i.connectionDragState.fromPort,I=Et(C,N);I&&o(s.addConnection(I)),c(d.endConnectionDrag())},[i.connectionDragState,i.connectionDisconnectState,c,d,o,s]),w=l.useCallback((m,N)=>{const C={id:N.id,nodeId:N.nodeId,type:N.type,label:N.label,position:N.position};c(d.setHoveredPort(C))},[c,d]),j=l.useCallback(()=>{c(d.setHoveredPort(null))},[c,d]);return l.useEffect(()=>{if(!i.dragState)return;const m=C=>{if(!i.dragState)return;const I=(C.clientX-i.dragState.startPosition.x)/u.viewport.scale,O=(C.clientY-i.dragState.startPosition.y)/u.viewport.scale;c(d.updateNodeDrag({x:I,y:O}))},N=()=>{if(!i.dragState)return;const{nodeIds:C,initialPositions:I,offset:O}=i.dragState,V=Va(C,I,O),S=u.gridSettings.snapToGrid?ca(V,u.gridSettings,C[0]):V,P=_a(C,n.nodes,S,I,h.moveGroupWithChildren);Object.keys(P).length>0&&o(s.moveNodes(P)),c(d.endNodeDrag())};return window.addEventListener("pointermove",m,{passive:!0}),window.addEventListener("pointerup",N,{once:!0}),()=>{window.removeEventListener("pointermove",m),window.removeEventListener("pointerup",N)}},[i.dragState,u.viewport.scale,u.gridSettings,c,d,o,s,n.nodes,h]),Ke({interactionState:i.connectionDragState,viewport:u.viewport,onPointerMove:m=>{c(d.updateConnectionDrag(m,null))},onPointerUp:()=>{c(d.endConnectionDrag())}}),Ke({interactionState:i.connectionDisconnectState,viewport:u.viewport,onPointerMove:m=>{c(d.updateConnectionDisconnect(m,null))},onPointerUp:()=>{c(d.endConnectionDisconnect())}}),a.jsx("div",{className:U(k.nodeLayer,e),children:y.map(m=>{var N,C,I;return a.jsx(Cn,{node:m,isSelected:i.selectedNodeIds.includes(m.id),isDragging:((N=i.dragState)==null?void 0:N.nodeIds.includes(m.id))??!1,dragOffset:(C=i.dragState)!=null&&C.nodeIds.includes(m.id)?i.dragState.offset:void 0,onPointerDown:g,onContextMenu:f,onPortPointerDown:D,onPortPointerUp:E,onPortPointerEnter:w,onPortPointerLeave:j,connectingPort:(I=i.connectionDragState)!=null&&I.fromPort?{id:i.connectionDragState.fromPort.id,type:i.connectionDragState.fromPort.type,label:i.connectionDragState.fromPort.label,nodeId:i.connectionDragState.fromPort.nodeId,position:i.connectionDragState.fromPort.position}:void 0,hoveredPort:i.hoveredPort?{id:i.hoveredPort.id,type:i.hoveredPort.type,label:i.hoveredPort.label,nodeId:i.hoveredPort.nodeId,position:i.hoveredPort.position}:void 0,connectedPorts:v},m.id)})})};Sn.displayName="NodeLayer";function En(e,t){const n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function Ha(e,t){const n=t.x-e.x,o=t.y-e.y,s=Math.sqrt(n*n+o*o);return{dx:n,dy:o,distance:s}}function Ba(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Ga(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ua(e,t){return{x:e.x*t,y:e.y*t}}const wt=e=>({left:"right",right:"left",top:"bottom",bottom:"top"})[e]||"left",qe=(e,t,n,o)=>{const s=En(e,t);let c=Math.max(40,Math.min(120,s*.5));(n==="right"&&o==="left"||n==="left"&&o==="right"||n==="top"&&o==="bottom"||n==="bottom"&&o==="top")&&(c=Math.max(c,s*.4));let u=e.x,p=e.y,h=t.x,x=t.y;switch(n){case"left":u=e.x-c;break;case"right":u=e.x+c;break;case"top":p=e.y-c;break;case"bottom":p=e.y+c;break;default:u=e.x+c}switch(o){case"left":h=t.x-c;break;case"right":h=t.x+c;break;case"top":x=t.y-c;break;case"bottom":x=t.y+c;break;default:h=t.x-c}return`M ${e.x} ${e.y} C ${u} ${p}, ${h} ${x}, ${t.x} ${t.y}`},Xa=({connection:e,fromNode:t,toNode:n,fromPort:o,toPort:s,isSelected:r,isHovered:i,isDragging:c,dragProgress:d=0,fromNodePosition:u,toNodePosition:p,fromNodeSize:h,toNodeSize:x,onPointerDown:y,onPointerEnter:v,onPointerLeave:f})=>{const g=ye(t.id,o.id),b=ye(n.id,s.id),D=l.useMemo(()=>{if(!g)return{x:t.position.x,y:t.position.y};if(u){const I=u.x-t.position.x,O=u.y-t.position.y;return{x:g.x+I,y:g.y+O}}return g},[g,t.position.x,t.position.y,u==null?void 0:u.x,u==null?void 0:u.y]),E=l.useMemo(()=>{if(!b)return{x:n.position.x,y:n.position.y};if(p){const I=p.x-n.position.x,O=p.y-n.position.y;return{x:b.x+I,y:b.y+O}}return b},[b,n.position.x,n.position.y,p==null?void 0:p.x,p==null?void 0:p.y]),w=l.useMemo(()=>qe(D,E,o.position,s.position),[D.x,D.y,E.x,E.y,o.position,s.position]),j=l.useMemo(()=>c&&d>0?d>.5?"var(--cautionColor, #ff3b30)":"var(--connectionColor, #999)":r?"var(--accentColor, #0066cc)":i?"var(--connectionHoverColor, #666)":"var(--connectionColor, #999)",[c,d,r,i]),m=I=>{I.stopPropagation(),y==null||y(I,e.id)},N=I=>{v==null||v(I,e.id)},C=I=>{f==null||f(I,e.id)};return a.jsxs("g",{className:U(k.connectionGroup,r&&k.connectionSelected,i&&k.connectionHovered,c&&k.connectionDragging),"data-connection-id":e.id,children:[a.jsx("path",{d:w,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"},onPointerDown:m,onPointerEnter:N,onPointerLeave:C}),a.jsx("path",{d:w,fill:"none",stroke:j,strokeWidth:r||i?3:2,strokeLinecap:"round",strokeLinejoin:"round",style:{transition:"stroke 0.2s, stroke-width 0.2s",pointerEvents:"none"}}),a.jsx("defs",{children:a.jsx("marker",{id:`arrow-${e.id}`,viewBox:"0 0 10 10",refX:"9",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto",children:a.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:j,style:{transition:"fill 0.2s"}})})}),a.jsx("path",{d:w,fill:"none",stroke:"transparent",markerEnd:`url(#arrow-${e.id})`,style:{pointerEvents:"none"}})]})},Fa=(e,t)=>{var n,o,s,r,i,c,d,u,p,h,x,y,v,f,g,b,D,E,w,j,m,N,C,I;return!(e.connection.id!==t.connection.id||e.isSelected!==t.isSelected||e.isHovered!==t.isHovered||e.isDragging!==t.isDragging||e.dragProgress!==t.dragProgress||e.fromNode.position.x!==t.fromNode.position.x||e.fromNode.position.y!==t.fromNode.position.y||e.toNode.position.x!==t.toNode.position.x||e.toNode.position.y!==t.toNode.position.y||((n=e.fromNodePosition)==null?void 0:n.x)!==((o=t.fromNodePosition)==null?void 0:o.x)||((s=e.fromNodePosition)==null?void 0:s.y)!==((r=t.fromNodePosition)==null?void 0:r.y)||((i=e.toNodePosition)==null?void 0:i.x)!==((c=t.toNodePosition)==null?void 0:c.x)||((d=e.toNodePosition)==null?void 0:d.y)!==((u=t.toNodePosition)==null?void 0:u.y)||((p=e.fromNode.size)==null?void 0:p.width)!==((h=t.fromNode.size)==null?void 0:h.width)||((x=e.fromNode.size)==null?void 0:x.height)!==((y=t.fromNode.size)==null?void 0:y.height)||((v=e.toNode.size)==null?void 0:v.width)!==((f=t.toNode.size)==null?void 0:f.width)||((g=e.toNode.size)==null?void 0:g.height)!==((b=t.toNode.size)==null?void 0:b.height)||((D=e.fromNodeSize)==null?void 0:D.width)!==((E=t.fromNodeSize)==null?void 0:E.width)||((w=e.fromNodeSize)==null?void 0:w.height)!==((j=t.fromNodeSize)==null?void 0:j.height)||((m=e.toNodeSize)==null?void 0:m.width)!==((N=t.toNodeSize)==null?void 0:N.width)||((C=e.toNodeSize)==null?void 0:C.height)!==((I=t.toNodeSize)==null?void 0:I.height)||e.fromPort.position!==t.fromPort.position||e.toPort.position!==t.toPort.position)},wn=l.memo(Xa,Fa);wn.displayName="ConnectionView";const In=({className:e})=>{const{state:t}=F();return a.jsxs("svg",{className:U(k.connectionLayer,e),children:[Object.values(t.connections).map(n=>a.jsx(Wa,{connection:n},n.id)),a.jsx(Ya,{})]})};In.displayName="ConnectionLayer";const Ya=l.memo(()=>{var u,p,h,x;const{state:e}=W(),{state:t,getPort:n}=F(),o=(u=e.connectionDragState)==null?void 0:u.fromPort.id,s=(p=e.connectionDragState)==null?void 0:p.fromPort.nodeId,r=(h=e.connectionDisconnectState)==null?void 0:h.fixedPort.id,i=(x=e.connectionDisconnectState)==null?void 0:x.fixedPort.nodeId,c=ye(s||"",o||""),d=ye(i||"",r||"");if(e.connectionDragState){const y=e.connectionDragState.fromPort;if(!t.nodes[y.nodeId])return null;const f=n(y.nodeId,y.id);if(!f||!c)return null;const g=e.connectionDragState.toPosition,b=qe(c,g,f.position,wt(f.position));return a.jsx("g",{className:k.dragConnection,children:a.jsx("path",{d:b,fill:"none",stroke:"var(--accentColor, #0066cc)",strokeWidth:2,strokeDasharray:"5,5",strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}})})}if(e.connectionDisconnectState){const y=e.connectionDisconnectState;if(!t.nodes[y.fixedPort.nodeId])return null;const f=n(y.fixedPort.nodeId,y.fixedPort.id);if(!f||!d)return null;const g=y.draggingPosition,b=qe(d,g,f.position,wt(f.position));return a.jsx("g",{className:k.dragConnection,children:a.jsx("path",{d:b,fill:"none",stroke:"var(--cautionColor, #ff3b30)",strokeWidth:3,strokeDasharray:"8,4",strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}})})}return null}),Wa=({connection:e})=>{const{state:t,getPort:n}=F(),{state:o,dispatch:s,actions:r}=W(),{state:i}=oe(),c=ye(e.fromNodeId,e.fromPortId),d=ye(e.toNodeId,e.toPortId),u=l.useCallback((E,w)=>{var P;const j=t.nodes[e.fromNodeId],m=t.nodes[e.toNodeId],N=n(e.fromNodeId,e.fromPortId),C=n(e.toNodeId,e.toPortId);if(!j||!m||!N||!C||!c||!d)return;const I=c,O=d;(I.x+O.x)/2,(I.y+O.y)/2;const V=(P=E.currentTarget.closest("svg"))==null?void 0:P.getBoundingClientRect();if(!V)return;(E.clientX-V.left)/i.viewport.scale-i.viewport.offset.x,(E.clientY-V.top)/i.viewport.scale-i.viewport.offset.y,Math.sqrt(Math.pow(O.x-I.x,2)+Math.pow(O.y-I.y,2));const S=E.shiftKey||E.metaKey||E.ctrlKey;s(r.selectConnection(w,S))},[e,t,n,s,r,i.viewport]),p=l.useCallback((E,w)=>{s(r.setHoveredConnection(w))},[s,r]),h=l.useCallback((E,w)=>{s(r.setHoveredConnection(null))},[s,r]),x=t.nodes[e.fromNodeId],y=t.nodes[e.toNodeId],v=n(e.fromNodeId,e.fromPortId),f=n(e.toNodeId,e.toPortId);if(!x||!y||!v||!f||x.visible===!1||y.visible===!1)return null;const g=(E,w)=>{let j=null,m=null;if(o.dragState){const{nodeIds:N,offset:C,affectedChildNodes:I}=o.dragState;N.includes(w)?j={x:E.position.x+C.x,y:E.position.y+C.y}:Object.entries(I).some(([V,S])=>S.includes(w))&&(j={x:E.position.x+C.x,y:E.position.y+C.y})}return o.resizeState&&o.resizeState.nodeId===w&&(m=o.resizeState.currentSize),{previewPosition:j,previewSize:m}},b=g(x,e.fromNodeId),D=g(y,e.toNodeId);return a.jsx(wn,{connection:e,fromNode:x,toNode:y,fromPort:v,toPort:f,fromNodePosition:b.previewPosition||void 0,toNodePosition:D.previewPosition||void 0,fromNodeSize:b.previewSize||void 0,toNodeSize:D.previewSize||void 0,isSelected:o.selectedConnectionIds.includes(e.id),isHovered:o.hoveredConnectionId===e.id,onPointerDown:u,onPointerEnter:p,onPointerLeave:h},e.id)},Ka="xtnnddtrstasecqAz",Za="xtnnddtrstaE3x",qa="xtnnddtrstavalKN5",Ja="xtnnddtrstamod3Xj",Qa="xtnnddtrstasavozp",Ae={statusSection:Ka,statusLabel:Za,statusValue:qa,statusMode:Ja,statusSaving:Qa},pe=({label:e,value:t,className:n,labelClassName:o,valueClassName:s})=>a.jsxs("div",{className:U(Ae.statusSection,n),children:[a.jsxs("span",{className:U(Ae.statusLabel,o),children:[e,":"]}),a.jsx("span",{className:U(Ae.statusValue,s),children:t})]});pe.displayName="StatusSection";const It=Ae,ec="xtnnddtrfltcnt",tc="xtnnddtrtop",nc="xtnnddtrbottom",oc="xtnnddtrtopLeft",sc="xtnnddtrtopRight",rc="xtnnddtrbotlef",ic="xtnnddtrbotrig",fe={floatingContainer:ec,top:tc,bottom:nc,topLeft:oc,topRight:sc,bottomLeft:rc,bottomRight:ic},ht=({position:e="top",className:t,children:n})=>{const o=l.useMemo(()=>{switch(e){case"top":return fe.top;case"bottom":return fe.bottom;case"top-left":return fe.topLeft;case"top-right":return fe.topRight;case"bottom-left":return fe.bottomLeft;case"bottom-right":return fe.bottomRight;default:return fe.top}},[e]);return a.jsx("div",{className:`${fe.floatingContainer} ${o} ${t||""}`,children:n})},Dn=({className:e,autoSave:t,isSaving:n,settingsManager:o})=>{const{state:s}=F(),{state:r}=W(),{state:i}=oe(),c=r.selectedNodeIds.length,d=r.selectedConnectionIds.length,u=Object.keys(s.nodes).length,p=Object.keys(s.connections).length,h=Math.round(i.viewport.scale*100),y=r.dragState?"Moving":r.selectionBox?"Selecting":r.connectionDragState?"Connecting":i.isSpacePanning||i.panState.isPanning?"Panning":"Ready",v=()=>r.dragState?`Offset: (${Math.round(r.dragState.offset.x)}, ${Math.round(r.dragState.offset.y)})`:`Canvas: (${Math.round(i.viewport.offset.x)}, ${Math.round(i.viewport.offset.y)})`;return a.jsxs("div",{className:U(k.statusBar,e),"data-testid":"status-bar",children:[a.jsx(pe,{label:"Selection",value:a.jsxs(a.Fragment,{children:[c>0&&`${c} node${c!==1?"s":""}`,c>0&&d>0&&", ",d>0&&`${d} connection${d!==1?"s":""}`,c===0&&d===0&&"None"]})}),a.jsx(pe,{label:"Total",value:`${u} nodes, ${p} connections`}),a.jsx(pe,{label:"Mode",value:y,valueClassName:It.statusMode}),a.jsx(pe,{label:"Zoom",value:`${h}%`}),a.jsx(pe,{label:"Position",value:v()}),i.gridSettings.showGrid&&a.jsx(pe,{label:"Grid",value:a.jsxs(a.Fragment,{children:[i.gridSettings.size,"px",i.gridSettings.snapToGrid&&" (Snap ON)"]})}),t&&a.jsx(pe,{label:"Auto-save",value:n?"Saving...":"ON",valueClassName:n?It.statusSaving:void 0}),o&&a.jsx(pe,{label:"Theme",value:o.getValue("appearance.theme")||"light"})]})};Dn.displayName="StatusBar";const ac="xtnnddtrnodseamen",cc="xtnnddtrnodseamen2we",dc="xtnnddtrmenfadin",lc="xtnnddtrsea",uc="xtnnddtrseaFFM",pc="xtnnddtrseahin",hc="xtnnddtrseares",fc="xtnnddtrcatlis",gc="xtnnddtrcat",mc="xtnnddtrcatLLn",yc="xtnnddtrselcat",xc="xtnnddtrcatnam",vc="xtnnddtrnodcou",bc="xtnnddtrnodeList",Nc="xtnnddtrnodeitm",Cc="xtnnddtrselNode",Sc="xtnnddtrnodeico",Ec="xtnnddtrnodeinfGlE",wc="xtnnddtrnodeName",Ic="xtnnddtrnoddes",Dc="xtnnddtrnodeType",Pc="xtnnddtrnores",jc="xtnnddtrnoresB5e",kc="xtnnddtrsealRp",Mc="xtnnddtrselHCh",Y={nodeSearchMenuContainer:ac,nodeSearchMenu:cc,menuFadeIn:dc,searchHeader:lc,searchInput:uc,searchHint:pc,searchResults:hc,categoryList:fc,categoryGroup:gc,categoryHeader:mc,selectedCategory:yc,categoryName:xc,nodeCount:vc,nodeList:bc,nodeItem:Nc,selectedNode:Cc,nodeIcon:Sc,nodeInfo:Ec,nodeName:wc,nodeDescription:Ic,nodeType:Dc,noResults:Pc,noResultsIcon:jc,searchFooter:kc,selectionInfo:Mc},Pn=({position:e,nodeDefinitions:t,onCreateNode:n,onClose:o,visible:s})=>{const[r,i]=l.useState(""),[c,d]=l.useState(0),[u,p]=l.useState(null),[h,x]=l.useState({x:e.x,y:e.y}),y=l.useRef(null),v=l.useRef(null),f=l.useMemo(()=>{const w=new Map;return t.forEach(j=>{const m=j.category||"Other";w.has(m)||w.set(m,[]),w.get(m).push(j)}),Array.from(w.entries()).map(([j,m])=>({name:j,nodes:m.sort((N,C)=>N.displayName.localeCompare(C.displayName))}))},[t]),g=l.useMemo(()=>{if(!r.trim())return u?f.filter(m=>m.name===u):f;const w=r.toLowerCase(),j=[];return f.forEach(m=>{const N=m.nodes.filter(C=>{var I;return C.displayName.toLowerCase().includes(w)||((I=C.description)==null?void 0:I.toLowerCase().includes(w))||C.type.toLowerCase().includes(w)||m.name.toLowerCase().includes(w)});N.length>0&&j.push({name:m.name,nodes:N})}),j},[r,f,u]),b=l.useMemo(()=>{const w=[];return g.forEach(j=>{j.nodes.forEach(m=>{w.push({category:j.name,node:m})})}),w},[g]);l.useEffect(()=>{s&&y.current&&y.current.focus()},[s]),l.useEffect(()=>{s&&(i(""),d(0),p(null),setTimeout(()=>{if(v.current){const w=v.current.getBoundingClientRect(),j=qn(),m=Jn(e.x,e.y,w.width,w.height,j);x(m)}},0))},[s,e]);const D=l.useCallback(w=>{var j;switch(w.key){case"ArrowDown":w.preventDefault(),d(C=>Math.min(C+1,b.length-1));break;case"ArrowUp":w.preventDefault(),d(C=>Math.max(C-1,0));break;case"Enter":if(w.preventDefault(),b[c]){const C=b[c].node;n(C.type,e),o()}break;case"Escape":w.preventDefault(),o();break;case"Tab":w.preventDefault();const N=(f.findIndex(C=>C.name===u)+1)%f.length;p(((j=f[N])==null?void 0:j.name)||null),d(0);break}},[b,c,n,e,o,f,u]),E=l.useCallback(w=>{n(w,e),o()},[n,e,o]);return l.useEffect(()=>{const w=j=>{if(s&&j.target instanceof Element){const m=document.querySelector("[data-node-search-menu]");m&&!m.contains(j.target)&&o()}};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[s,o]),s?a.jsxs("div",{ref:v,className:U(Y.nodeSearchMenu,Y.nodeSearchMenuContainer),style:{left:h.x,top:h.y},"data-node-search-menu":!0,onKeyDown:D,children:[a.jsxs("div",{className:Y.searchHeader,children:[a.jsx("input",{ref:y,id:"node-search",name:"nodeSearch",type:"text",placeholder:"Search nodes...",value:r,onChange:w=>i(w.target.value),className:Y.searchInput,"aria-label":"Search for nodes","aria-describedby":"search-hint"}),a.jsxs("div",{id:"search-hint",className:Y.searchHint,children:[a.jsx("kbd",{children:"↑↓"})," Navigate • ",a.jsx("kbd",{children:"⏎"})," Create • ",a.jsx("kbd",{children:"⇥"})," Category • ",a.jsx("kbd",{children:"⎋"})," Close"]})]}),a.jsx("div",{className:Y.searchResults,children:g.length===0?a.jsxs("div",{className:Y.noResults,children:[a.jsx("div",{className:Y.noResultsIcon,children:"🔍"}),a.jsxs("div",{children:['No nodes found for "',r,'"']})]}):a.jsx("div",{className:Y.categoryList,children:g.map((w,j)=>a.jsxs("div",{className:Y.categoryGroup,children:[a.jsxs("div",{className:U(Y.categoryHeader,u===w.name&&Y.selectedCategory),onClick:()=>p(u===w.name?null:w.name),children:[a.jsx("span",{className:Y.categoryName,children:w.name}),a.jsx("span",{className:Y.nodeCount,children:w.nodes.length})]}),a.jsx("div",{className:Y.nodeList,children:w.nodes.map((m,N)=>{const C=b.findIndex(O=>O.node.type===m.type),I=C===c;return a.jsxs("div",{className:U(Y.nodeItem,I&&Y.selectedNode),onClick:()=>E(m.type),onMouseEnter:()=>d(C),children:[a.jsx("div",{className:Y.nodeIcon,children:hn(m.type,t)}),a.jsxs("div",{className:Y.nodeInfo,children:[a.jsx("div",{className:Y.nodeName,children:m.displayName}),m.description&&a.jsx("div",{className:Y.nodeDescription,children:m.description})]}),a.jsx("div",{className:Y.nodeType,children:m.type})]},m.type)})})]},w.name))})}),b.length>0&&a.jsx("div",{className:Y.searchFooter,children:a.jsxs("div",{className:Y.selectionInfo,children:[c+1," of ",b.length," • ",g.length," categories"]})})]}):null};Pn.displayName="NodeSearchMenu";const jn=l.createContext(null),kn=({portPositions:e,children:t})=>{const n=l.useMemo(()=>({portPositions:e,getPortPosition:(o,s)=>{var r;return(r=e.get(o))==null?void 0:r.get(s)},getNodePortPositions:o=>e.get(o),computePortPosition:(o,s)=>{var i;const r=(i=e.get(o.id))==null?void 0:i.get(s.id);return r||{portId:s.id,renderPosition:{x:0,y:0},connectionPoint:{x:o.position.x,y:o.position.y}}}}),[e]);return a.jsx(jn.Provider,{value:n,children:t})};function ft(){const e=l.useContext(jn);if(!e)throw new Error("usePortPositions must be used within a PortPositionProvider");return e}function Tc(e,t){const{getPortPosition:n}=ft();return l.useMemo(()=>n(e,t),[n,e,t])}function Oc(e){const{getNodePortPositions:t}=ft();return l.useMemo(()=>t(e),[t,e])}const Mn=({initialData:e,data:t,onDataChange:n,onSave:o,onLoad:s,className:r,nodeDefinitions:i,includeDefaultDefinitions:c=!0,externalDataRefs:d,overlayLayers:u,backgroundLayers:p,uiOverlayLayers:h,settingsManager:x,toolbar:y,leftSidebar:v,rightSidebar:f,leftSidebarInitialWidth:g,rightSidebarInitialWidth:b,leftSidebarMinWidth:D,rightSidebarMinWidth:E,leftSidebarMaxWidth:w,rightSidebarMaxWidth:j,onLeftSidebarWidthChange:m,onRightSidebarWidthChange:N})=>a.jsx(_t,{nodeDefinitions:i,includeDefaults:c,children:a.jsx(Ht,{refs:d,children:a.jsx(tn,{initialState:e,controlledData:t,onDataChange:n,onSave:o,onLoad:s,settingsManager:x,children:a.jsx(Rt,{children:a.jsx(Ot,{children:a.jsx(on,{children:a.jsx(Lt,{children:a.jsx(Mt,{children:a.jsx(Ac,{className:r,overlayLayers:u,backgroundLayers:p,uiOverlayLayers:h,settingsManager:x,toolbar:y,leftSidebar:v,rightSidebar:f,leftSidebarInitialWidth:g,rightSidebarInitialWidth:b,leftSidebarMinWidth:D,rightSidebarMinWidth:E,leftSidebarMaxWidth:w,rightSidebarMaxWidth:j,onLeftSidebarWidthChange:m,onRightSidebarWidthChange:N})})})})})})})})}),Ac=({className:e,overlayLayers:t,backgroundLayers:n,uiOverlayLayers:o,settingsManager:s,toolbar:r,leftSidebar:i,rightSidebar:c,leftSidebarInitialWidth:d,rightSidebarInitialWidth:u,leftSidebarMinWidth:p,rightSidebarMinWidth:h,leftSidebarMaxWidth:x,rightSidebarMaxWidth:y,onLeftSidebarWidthChange:v,onRightSidebarWidthChange:f})=>{const{state:g,handleSave:b,dispatch:D,actions:E,isLoading:w,isSaving:j,getNodePorts:m}=F(),{state:N,dispatch:C,actions:I}=W(),{utils:O}=oe(),V=Ve(),[S,P]=l.useState(()=>new Map),M=l.useRef(g.nodes);l.useEffect(()=>{var H,X,J,se;if(!g.nodes)return;const q=M.current;let R=!1;if(!q||Object.keys(q).length!==Object.keys(g.nodes).length)R=!0;else for(const me in g.nodes){const de=g.nodes[me],le=q[me];if(!le||de.position.x!==le.position.x||de.position.y!==le.position.y||((H=de.size)==null?void 0:H.width)!==((X=le.size)==null?void 0:X.width)||((J=de.size)==null?void 0:J.height)!==((se=le.size)==null?void 0:se.height)){R=!0;break}}if(R){const me=Object.values(g.nodes).map(le=>({...le,ports:m(le.id)})),de=Jt(me);P(de),M.current=g.nodes}},[g.nodes,m]);const T=ct(s),{showGrid:L,showMinimap:z,showStatusBar:_,theme:G,autoSave:$,autoSaveInterval:B,smoothAnimations:K,doubleClickToEdit:te,fontSize:ie,gridSize:ge,gridOpacity:Pe,canvasBackground:Ce}=T,_e=l.useMemo(()=>({"--editor-font-size":`${ie}px`,"--editor-grid-size":`${ge}px`,"--editor-grid-opacity":`${Pe}`,"--editor-canvas-background":Ce}),[ie,ge,Pe,Ce]),$e=l.useCallback((q,R)=>{const H=V.find(le=>le.type===q);if(!H){console.warn(`Node definition not found for type: ${q}`);return}let X=N.contextMenu.canvasPosition;X||(X=O.screenToCanvas(R.x,R.y));const J=`${q}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,se=H.defaultSize||{width:150,height:50},me={x:X.x-se.width/2,y:X.y-se.height/2},de={id:J,type:q,position:me,size:se,data:H.defaultData||{title:H.displayName}};D(E.addNode(de)),C(I.selectNode(J,!1)),C(I.hideContextMenu())},[V,D,E,C,I,N.contextMenu.canvasPosition,O]);l.useEffect(()=>{const q=R=>{(R.ctrlKey||R.metaKey)&&R.key==="s"&&(R.preventDefault(),b()),R.key==="Escape"&&C(I.hideContextMenu())};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[b,C,I]);const He=i,Be=c===void 0?a.jsx(pt,{}):c;return a.jsxs(sn,{className:U(e,G==="dark"&&k.darkTheme,K&&k.smoothAnimations),style:_e,"data-theme":G,children:[a.jsxs("div",{className:k.editorLayout,children:[r&&a.jsx("div",{className:k.editorToolbar,children:r}),a.jsx("div",{className:k.editorContent,children:a.jsx(mn,{leftSidebar:He,rightSidebar:Be,leftSidebarInitialWidth:d,rightSidebarInitialWidth:u,leftSidebarMinWidth:p,rightSidebarMinWidth:h,leftSidebarMaxWidth:x,rightSidebarMaxWidth:y,onLeftSidebarWidthChange:v,onRightSidebarWidthChange:f,children:a.jsxs("div",{className:k.editorMain,children:[a.jsx(vn,{showGrid:L,children:a.jsxs(kn,{portPositions:S,children:[n==null?void 0:n.map((q,R)=>a.jsx(l.Fragment,{children:q},`background-layer-${R}`)),a.jsx(In,{}),a.jsx(Sn,{doubleClickToEdit:te}),t==null?void 0:t.map((q,R)=>a.jsx(l.Fragment,{children:q},`overlay-layer-${R}`))]})}),_&&a.jsx(Dn,{autoSave:$,isSaving:j,settingsManager:s})]})})})]}),(w||j)&&a.jsx("div",{className:k.loadingOverlay,children:a.jsx("div",{className:k.loadingIndicator,children:w?"Loading...":"Saving..."})}),a.jsx(Pn,{position:N.contextMenu.position,nodeDefinitions:V,onCreateNode:$e,onClose:()=>C(I.hideContextMenu()),visible:N.contextMenu.visible}),o&&o.length>0&&a.jsx("div",{className:k.uiOverlayContainer,children:o.map((q,R)=>a.jsx(l.Fragment,{children:q},`ui-overlay-layer-${R}`))})]})};Mn.displayName="NodeEditor";const Rc="xtnnddtrminimapNm_",zc="xtnnddtrminxip",Lc="xtnnddtrtopLeftyMq",Vc="xtnnddtrtopRights48",_c="xtnnddtrbotlef8be",$c="xtnnddtrbotrigo0n",Hc="xtnnddtrtopleft",Bc="xtnnddtrtopright",Gc="xtnnddtrbot",Uc="xtnnddtrbotBB1",Xc="xtnnddtrminudL",Fc="xtnnddtrminzoo",Yc="xtnnddtrmintitGxO",Wc="xtnnddtrminsta",Kc="xtnnddtrmincan",Zc="xtnnddtrmincan45s",qc="xtnnddtrminvieSyB",Jc="xtnnddtrminnodljv",Qc="xtnnddtrminnodn73",ed="xtnnddtrmincon",td="xtnnddtrmincon7Oy",nd="xtnnddtrminvieS6m",ne={minimap:Rc,minimapContainer:zc,topLeft:Lc,topRight:Vc,bottomLeft:_c,bottomRight:$c,topleft:Hc,topright:Bc,bottomleft:Gc,bottomright:Uc,minimapHeader:Xc,minimapZoom:Fc,minimapTitle:Yc,minimapStats:Wc,minimapCanvas:Kc,minimapCanvasDragging:Zc,minimapViewport:qc,minimapNode:Jc,minimapGroupNode:Qc,minimapConnections:ed,minimapConnection:td,minimapViewportDragging:nd},Tn=({width:e=200,height:t=150,position:n="top-right",className:o,visible:s=!0,scale:r=.1})=>{const{state:i}=F(),{state:c,dispatch:d,actions:u}=oe(),p=l.useRef(null),[h,x]=l.useState(!1),[y,v]=l.useState(null),[f,g]=l.useState(!1),b=l.useMemo(()=>{const S=Object.values(i.nodes);if(S.length===0)return{minX:0,minY:0,maxX:1e3,maxY:1e3};let P=1/0,M=1/0,T=-1/0,L=-1/0;S.forEach(_=>{var te,ie;const G=_.position.x,$=_.position.y,B=((te=_.size)==null?void 0:te.width)||150,K=((ie=_.size)==null?void 0:ie.height)||100;P=Math.min(P,G),M=Math.min(M,$),T=Math.max(T,G+B),L=Math.max(L,$+K)});const z=100;return{minX:P-z,minY:M-z,maxX:T+z,maxY:L+z}},[i.nodes]),D=l.useMemo(()=>{const S=b.maxX-b.minX,P=b.maxY-b.minY,M=(e-20)/S,T=(t-40)/P;return Math.min(M,T,r)},[b,e,t]),E=l.useCallback((S,P)=>({x:(S-b.minX)*D+10,y:(P-b.minY)*D+30}),[b,D]),w=l.useCallback((S,P)=>({x:(S-10)/D+b.minX,y:(P-30)/D+b.minY}),[b,D]),j=l.useMemo(()=>{const S=c.viewport,P=window.innerWidth/S.scale,M=window.innerHeight/S.scale,T={x:-S.offset.x/S.scale,y:-S.offset.y/S.scale},L={x:T.x+P,y:T.y+M},z=E(T.x,T.y),_=E(L.x,L.y);return{x:z.x,y:z.y,width:Math.max(1,_.x-z.x),height:Math.max(1,_.y-z.y)}},[c.viewport,E]),m=l.useCallback((S,P)=>{if(!p.current)return;const M=p.current.getBoundingClientRect(),T=S-M.left,L=P-M.top,z=w(T,L),_=c.viewport,G=T/e*window.innerWidth,$=(L-30)/(t-30)*window.innerHeight,B=G-z.x*_.scale,K=$-z.y*_.scale;d(u.setViewport({..._,offset:{x:B,y:K}}))},[c.viewport,d,u,w,e,t]),N=l.useCallback(S=>{S.preventDefault(),x(!0),g(!1),v({x:S.clientX,y:S.clientY,viewportOffset:{...c.viewport.offset}}),p.current&&p.current.setPointerCapture(S.pointerId)},[c.viewport.offset]),C=l.useCallback(S=>{if(!h||!y)return;S.preventDefault();const P=S.clientX-y.x,M=S.clientY-y.y,T=3;!f&&(Math.abs(P)>T||Math.abs(M)>T)&&g(!0);const L=b.maxX-b.minX,z=b.maxY-b.minY,_=e-20,G=t-60,$=P/_*L,B=M/G*z,K=c.viewport,te=y.viewportOffset.x-$*K.scale,ie=y.viewportOffset.y-B*K.scale;d(u.setViewport({...K,offset:{x:te,y:ie}}))},[h,y,f,c.viewport,d,u,b,e,t]),I=l.useCallback(S=>{x(!1),v(null),p.current&&p.current.releasePointerCapture(S.pointerId),setTimeout(()=>{g(!1)},0)},[]),O=l.useCallback(S=>{!f&&!h&&!y&&m(S.clientX,S.clientY)},[f,h,y,m]),V=n.replace("-","");return s?a.jsxs("div",{className:`${ne.minimapContainer} ${ne[V]} ${o||""}`,style:{width:e,height:t},children:[a.jsxs("div",{className:ne.minimapHeader,children:[a.jsx("span",{className:ne.minimapTitle,children:"Minimap"}),a.jsxs("span",{className:ne.minimapStats,children:[Object.keys(i.nodes).length," nodes"]}),a.jsxs("span",{className:ne.minimapZoom,children:[Math.round(c.viewport.scale*100),"%"]})]}),a.jsxs("div",{ref:p,className:`${ne.minimapCanvas} ${h?ne.minimapCanvasDragging:""}`,onPointerDown:N,onPointerMove:C,onPointerUp:I,onClick:O,style:{width:e,height:t-30,cursor:h?"grabbing":"grab"},children:[a.jsx("svg",{className:ne.minimapConnections,viewBox:`0 0 ${e} ${t-30}`,children:Object.values(i.connections||{}).map(S=>{var z,_,G,$;const P=i.nodes[S.fromNodeId],M=i.nodes[S.toNodeId];if(!P||!M)return null;const T=E(P.position.x+(((z=P.size)==null?void 0:z.width)||150)/2,P.position.y+(((_=P.size)==null?void 0:_.height)||100)/2),L=E(M.position.x+(((G=M.size)==null?void 0:G.width)||150)/2,M.position.y+((($=M.size)==null?void 0:$.height)||100)/2);return a.jsx("line",{x1:T.x,y1:T.y-30,x2:L.x,y2:L.y-30,className:ne.minimapConnection},S.id)})}),Object.values(i.nodes).map(S=>{var L,z;const P=E(S.position.x,S.position.y),M={width:(((L=S.size)==null?void 0:L.width)||150)*D,height:(((z=S.size)==null?void 0:z.height)||100)*D},T=S.type==="group";return a.jsx("div",{className:`${ne.minimapNode} ${T?ne.minimapGroupNode:""}`,style:{left:P.x,top:P.y,width:Math.max(2,M.width),height:Math.max(2,M.height)},"data-node-type":S.type},S.id)}),a.jsx("div",{className:`${ne.minimapViewport} ${h?ne.minimapViewportDragging:""}`,style:{left:j.x,top:j.y,width:j.width,height:j.height}})]})]}):null};Tn.displayName="Minimap";const od="xtnnddtrdebugovr",sd="xtnnddtrtopLeftXGk",rd="xtnnddtrtopRightHbt",id="xtnnddtrbotlefhr9",ad="xtnnddtrbotrigW2u",cd="xtnnddtrcold7Bg",dd="xtnnddtrdebughdr",ld="xtnnddtrdebtit",ud="xtnnddtrcolbtn",pd="xtnnddtrdebugctn",hd="xtnnddtrdebsec",fd="xtnnddtrsectit",gd="xtnnddtrdebugitm",md="xtnnddtrlbl",yd="xtnnddtrvalue",A={debugOverlay:od,topLeft:sd,topRight:rd,bottomLeft:id,bottomRight:ad,collapsed:cd,debugHeader:dd,debugTitle:ld,collapseButton:ud,debugContent:pd,debugSection:hd,sectionTitle:fd,debugItem:gd,label:md,value:yd},On=({position:e="top-left",className:t,visible:n=!0,showSections:o={viewport:!0,nodes:!0,connections:!0,actions:!0,performance:!1}})=>{const{state:s}=F(),{state:r}=oe(),{state:i}=W(),[c,d]=l.useState(!1),[u,p]=l.useState({renderCount:0,lastRenderTime:0});if(l.useEffect(()=>{o.performance&&p(f=>({renderCount:f.renderCount+1,lastRenderTime:Date.now()-(f.lastRenderTime||Date.now())}))},[o.performance]),!n)return null;const h={"top-left":A.topLeft,"top-right":A.topRight,"bottom-left":A.bottomLeft,"bottom-right":A.bottomRight}[e],x=Object.keys(s.nodes).length,y=Object.keys(s.connections).length,v=i.selectedNodeIds.length;return a.jsxs("div",{className:U(A.debugOverlay,h,c&&A.collapsed,t),children:[a.jsxs("div",{className:A.debugHeader,children:[a.jsx("span",{className:A.debugTitle,children:"Debug Info"}),a.jsx("button",{className:A.collapseButton,onClick:()=>d(!c),"aria-label":c?"Expand debug info":"Collapse debug info",children:c?"+":"−"})]}),!c&&a.jsxs("div",{className:A.debugContent,children:[o.viewport&&a.jsxs("div",{className:A.debugSection,children:[a.jsx("div",{className:A.sectionTitle,children:"Viewport"}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Offset:"}),a.jsxs("span",{className:A.value,children:[Math.round(r.viewport.offset.x),", ",Math.round(r.viewport.offset.y)]})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Scale:"}),a.jsxs("span",{className:A.value,children:[r.viewport.scale.toFixed(2),"x"]})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Grid:"}),a.jsxs("span",{className:A.value,children:[r.gridSettings.enabled?"On":"Off",r.gridSettings.enabled&&` (${r.gridSettings.size}px)`]})]})]}),o.nodes&&a.jsxs("div",{className:A.debugSection,children:[a.jsx("div",{className:A.sectionTitle,children:"Nodes"}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Total:"}),a.jsx("span",{className:A.value,children:x})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Selected:"}),a.jsx("span",{className:A.value,children:v})]}),Object.entries(Object.values(s.nodes).reduce((f,g)=>(f[g.type]=(f[g.type]||0)+1,f),{})).map(([f,g])=>a.jsxs("div",{className:A.debugItem,children:[a.jsxs("span",{className:A.label,children:[f,":"]}),a.jsx("span",{className:A.value,children:g})]},f))]}),o.connections&&a.jsxs("div",{className:A.debugSection,children:[a.jsx("div",{className:A.sectionTitle,children:"Connections"}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Total:"}),a.jsx("span",{className:A.value,children:y})]})]}),o.actions&&a.jsxs("div",{className:A.debugSection,children:[a.jsx("div",{className:A.sectionTitle,children:"Actions"}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Dragging:"}),a.jsx("span",{className:A.value,children:i.dragState?`${i.dragState.nodeIds.length} nodes`:"None"})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Resizing:"}),a.jsx("span",{className:A.value,children:i.resizeState?i.resizeState.nodeId:"None"})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Connecting:"}),a.jsx("span",{className:A.value,children:i.connectionDragState?"Active":"None"})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Panning:"}),a.jsx("span",{className:A.value,children:r.panState.isPanning?"Active":"None"})]})]}),o.performance&&a.jsxs("div",{className:A.debugSection,children:[a.jsx("div",{className:A.sectionTitle,children:"Performance"}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Renders:"}),a.jsx("span",{className:A.value,children:u.renderCount})]}),a.jsxs("div",{className:A.debugItem,children:[a.jsx("span",{className:A.label,children:"Last render:"}),a.jsxs("span",{className:A.value,children:[u.lastRenderTime.toFixed(2),"ms"]})]})]})]})]})};On.displayName="DebugOverlay";const xd="xtnnddtrtbru6T",vd="xtnnddtrtbrsec",bd="xtnnddtrtoolbtn7BP",Nd="xtnnddtractD7C",Cd="xtnnddtrsep",Sd="xtnnddtrzoodis",Ed="xtnnddtrzoosel",wd="xtnnddtrtbrspa",Id="xtnnddtrstaAUh",Dd="xtnnddtrstaXT3",Pd="xtnnddtrstaval87E",ee={toolbar:xd,toolbarSection:vd,toolButton:bd,active:Nd,separator:Cd,zoomDisplay:Sd,zoomSelect:Ed,toolbarSpacer:wd,statusIndicator:Id,statusLabel:Dd,statusValue:Pd},Dt=[5,10,25,50,100,200,400,800],be=l.memo(({onClick:e,title:t,ariaLabel:n,disabled:o,children:s})=>a.jsx("button",{className:ee.toolButton,onClick:e,title:t,"aria-label":n,disabled:o,children:s}));be.displayName="ZoomButton";const Je=l.memo(({active:e,onClick:t,title:n,ariaLabel:o,children:s})=>a.jsx("button",{className:`${ee.toolButton} ${e?ee.active:""}`,onClick:t,title:n,"aria-label":o,children:s}));Je.displayName="ToggleButton";const Qe=l.memo(({label:e,value:t})=>a.jsxs("div",{className:ee.statusIndicator,children:[a.jsxs("span",{className:ee.statusLabel,children:[e,":"]}),a.jsx("span",{className:ee.statusValue,children:t})]}));Qe.displayName="StatusIndicator";const An=l.memo(({className:e,useFloatingContainer:t=!1,position:n="bottom"})=>{const{state:o,actions:s,dispatch:r}=oe(),{state:i}=F(),{state:c}=W(),d=l.useMemo(()=>Math.round(o.viewport.scale*100),[o.viewport.scale]),u=l.useMemo(()=>Object.keys(i.nodes).length,[i.nodes]),p=l.useMemo(()=>Object.keys(i.connections).length,[i.connections]),h=l.useMemo(()=>c.selectedNodeIds.length,[c.selectedNodeIds]),x=l.useCallback(()=>{const m=Math.min(o.viewport.scale*1.25,10);r(s.setViewport({...o.viewport,scale:m}))},[o.viewport,r,s]),y=l.useCallback(()=>{const m=Math.max(o.viewport.scale*.8,.1);r(s.setViewport({...o.viewport,scale:m}))},[o.viewport,r,s]),v=l.useCallback(()=>{r(s.setViewport({...o.viewport,scale:1}))},[o.viewport,r,s]),f=l.useCallback(()=>{const m=Object.values(i.nodes);if(m.length===0)return;let N=1/0,C=1/0,I=-1/0,O=-1/0;m.forEach(B=>{var K,te;N=Math.min(N,B.position.x),C=Math.min(C,B.position.y),I=Math.max(I,B.position.x+(((K=B.size)==null?void 0:K.width)??150)),O=Math.max(O,B.position.y+(((te=B.size)==null?void 0:te.height)??50))});const V=50,S=I-N+V*2,P=O-C+V*2,M=window.innerWidth,T=window.innerHeight,L=M/S,z=T/P,_=Math.min(L,z,1),G=(N+I)/2,$=(C+O)/2;r(s.setViewport({scale:_,offset:{x:-(G*_-M/2),y:-($*_-T/2)}}))},[i.nodes,r,s]),g=l.useCallback(()=>{if(h===0)return;const m=c.selectedNodeIds.map(B=>i.nodes[B]).filter(B=>B!=null);if(m.length===0)return;let N=1/0,C=1/0,I=-1/0,O=-1/0;m.forEach(B=>{var K,te;N=Math.min(N,B.position.x),C=Math.min(C,B.position.y),I=Math.max(I,B.position.x+(((K=B.size)==null?void 0:K.width)??150)),O=Math.max(O,B.position.y+(((te=B.size)==null?void 0:te.height)??50))});const V=50,S=I-N+V*2,P=O-C+V*2,M=window.innerWidth,T=window.innerHeight,L=M/S,z=T/P,_=Math.min(L,z,2),G=(N+I)/2,$=(C+O)/2;r(s.setViewport({scale:_,offset:{x:-(G*_-M/2),y:-($*_-T/2)}}))},[i.nodes,c.selectedNodeIds,h,r,s]),b=l.useCallback(m=>{r(s.setViewport({...o.viewport,scale:m/100}))},[o.viewport,r,s]),D=l.useCallback(()=>{r(s.updateGridSettings({showGrid:!o.gridSettings.showGrid}))},[o.gridSettings.showGrid,r,s]),E=l.useCallback(()=>{r(s.updateGridSettings({snapToGrid:!o.gridSettings.snapToGrid}))},[o.gridSettings.snapToGrid,r,s]),w=l.useMemo(()=>{const m=Dt.map(N=>a.jsxs("option",{value:N,children:[N,"%"]},N));return Dt.includes(d)||m.push(a.jsxs("option",{value:d,children:[d,"%"]},d)),m},[d]),j=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:ee.toolbarSection,children:[a.jsx(be,{onClick:y,title:"Zoom Out (Cmd -)",ariaLabel:"Zoom Out",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"})})}),a.jsx("div",{className:ee.zoomDisplay,children:a.jsx("select",{className:ee.zoomSelect,value:d,onChange:m=>b(Number(m.target.value)),children:w})}),a.jsx(be,{onClick:x,title:"Zoom In (Cmd +)",ariaLabel:"Zoom In",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5V7.5H11.5a.5.5 0 0 1 0 1H8.5V11.5a.5.5 0 0 1-1 0V8.5H4.5a.5.5 0 0 1 0-1H7.5V4.5A.5.5 0 0 1 8 4z"})})})]}),a.jsx("div",{className:ee.separator}),a.jsxs("div",{className:ee.toolbarSection,children:[a.jsx(be,{onClick:f,title:"Zoom to Fit All (Shift 1)",ariaLabel:"Zoom to Fit All",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M3.5 2.5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1h-9zm0 1h9v9h-9v-9z"}),a.jsx("path",{d:"M6 6h4v4H6V6z",opacity:"0.5"})]})}),a.jsx(be,{onClick:g,title:"Zoom to Selection (Shift 2)",ariaLabel:"Zoom to Selection",disabled:h===0,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M6 6h4v4H6V6z"}),a.jsx("path",{d:"M3.5 2.5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1h-9zm0 1h9v9h-9v-9z",opacity:"0.5"})]})}),a.jsx(be,{onClick:v,title:"Reset Zoom (Cmd 0)",ariaLabel:"Reset Zoom",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("text",{x:"8",y:"12",textAnchor:"middle",fontSize:"10",fontWeight:"600",children:"1:1"})})})]}),a.jsx("div",{className:ee.separator}),a.jsxs("div",{className:ee.toolbarSection,children:[a.jsx(Je,{active:o.gridSettings.showGrid,onClick:D,title:"Toggle Grid (Cmd ')",ariaLabel:"Toggle Grid",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M2 2h2v2H2V2zm4 0h2v2H6V2zm4 0h2v2h-2V2zm4 0h2v2h-2V2zM2 6h2v2H2V6zm4 0h2v2H6V6zm4 0h2v2h-2V6zm4 0h2v2h-2V6zM2 10h2v2H2v-2zm4 0h2v2H6v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zM2 14h2v2H2v-2zm4 0h2v2H6v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2z",opacity:"0.6"})})}),a.jsx(Je,{active:o.gridSettings.snapToGrid,onClick:E,title:"Toggle Snap to Grid",ariaLabel:"Toggle Snap to Grid",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[a.jsx("path",{d:"M8 2v12M2 8h12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.4"}),a.jsx("circle",{cx:"8",cy:"8",r:"2",fill:"currentColor"})]})})]}),a.jsx("div",{className:ee.toolbarSpacer}),a.jsxs("div",{className:ee.toolbarSection,children:[a.jsx(Qe,{label:"Nodes",value:u}),a.jsx(Qe,{label:"Connections",value:p})]})]});return t?a.jsx(ht,{position:n,className:e,children:j}):a.jsx("div",{className:`${ee.toolbar} ${e||""}`,children:j})});An.displayName="GridToolbox";const jd="xtnnddtrtbrico",kd="xtnnddtrtbrdKk",Md="xtnnddtrtbrsep",Ye={toolbarIcon:jd,toolbarIconText:kd,toolbarSeparator:Md},Td=({className:e,floating:t=!1,position:n="top"})=>{const o=Ve(),{actions:s,dispatch:r}=W(),{state:i}=oe(),{dispatch:c,actions:d}=F(),u=l.useMemo(()=>o.filter(y=>["standard","input","output","process","group"].includes(y.type)).slice(0,5),[o]),p=l.useCallback(y=>{const v=o.find(w=>w.type===y);if(!v){console.warn(`Node definition not found for type: ${y}`);return}const f=i.viewport,g=(-f.offset.x+window.innerWidth/2)/f.scale,b=(-f.offset.y+window.innerHeight/2)/f.scale,D=`${y}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,E={id:D,type:y,position:{x:g,y:b},size:v.defaultSize||{width:150,height:50},data:v.defaultData||{title:v.displayName}};c(d.addNode(E)),r(s.selectNode(D,!1))},[o,i.viewport,c,d,r,s]),h=l.useCallback(()=>{const y=i.viewport,v=window.innerWidth/2,f=window.innerHeight/2,g=(-y.offset.x+v)/y.scale,b=(-y.offset.y+f)/y.scale;r(s.showContextMenu({x:v,y:f},void 0,{x:g,y:b}))},[i.viewport,r,s]),x=a.jsxs(a.Fragment,{children:[u.map(y=>a.jsx(Re,{className:k.toolButton,onClick:()=>p(y.type),title:`Add ${y.displayName}`,"aria-label":`Add ${y.displayName}`,children:y.icon?a.jsx("span",{className:Ye.toolbarIcon,children:y.icon}):a.jsx("span",{className:Ye.toolbarIconText,children:y.displayName.charAt(0).toUpperCase()})},y.type)),u.length>0&&a.jsx("div",{className:Ye.toolbarSeparator}),a.jsx(Re,{className:k.toolButton,onClick:h,title:"Add Node...","aria-label":"Add Node...",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:a.jsx("path",{d:"M8 3a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2H9v3a1 1 0 1 1-2 0V9H4a1 1 0 0 1 0-2h3V4a1 1 0 0 1 1-1z"})})})]});return t?a.jsx(ht,{position:n,className:e,children:x}):a.jsx("div",{className:`${k.topToolbar} ${e||""}`,children:x})};function Od(e){if(!e)return{};const t={};return e.nodeIds.forEach(n=>{t[n]=e.offset}),Object.entries(e.affectedChildNodes).forEach(([n,o])=>{o.forEach(s=>{t[s]=e.offset})}),t}function Ad(e,t,n={x:0,y:0}){if(e.length===0)return null;let o=1/0,s=1/0,r=-1/0,i=-1/0;return e.forEach(c=>{var y,v;const d=t[c];if(!d)return;const u=d.position.x+n.x,p=d.position.y+n.y,h=((y=d.size)==null?void 0:y.width)||150,x=((v=d.size)==null?void 0:v.height)||50;o=Math.min(o,u),s=Math.min(s,p),r=Math.max(r,u+h),i=Math.max(i,p+x)}),{minX:o,minY:s,maxX:r,maxY:i}}class Rn{constructor(){ue(this,"listeners",new Map)}on(t,n){return this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n),()=>{const o=this.listeners.get(t);if(o){const s=o.indexOf(n);s>-1&&o.splice(s,1)}}}emit(t,n){const o=this.listeners.get(t);o&&o.forEach(s=>{try{s(n)}catch(r){console.error(`Error in settings event handler for ${t}:`,r)}})}removeAllListeners(){this.listeners.clear()}}class zn{constructor(t="node-editor-settings"){ue(this,"prefix");ue(this,"eventEmitter",new Rn);this.prefix=t}getStorageKey(t){return`${this.prefix}-${t}`}get(t){try{const n=localStorage.getItem(this.getStorageKey(t));return n?JSON.parse(n):void 0}catch{return}}set(t,n){try{localStorage.setItem(this.getStorageKey(t),JSON.stringify(n)),this.eventEmitter.emit("change",{key:t,value:n})}catch(o){console.warn(`Failed to save setting ${t}:`,o)}}delete(t){localStorage.removeItem(this.getStorageKey(t)),this.eventEmitter.emit("change",{key:t,value:void 0})}clear(){this.keys().forEach(n=>{localStorage.removeItem(this.getStorageKey(n))})}keys(){const t=[],n=`${this.prefix}-`;for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&s.startsWith(n)&&t.push(s.substring(n.length))}return t}getMany(t){const n={};return t.forEach(o=>{const s=this.get(o);s!==void 0&&(n[o]=s)}),n}setMany(t){Object.entries(t).forEach(([n,o])=>{this.set(n,o)})}on(t,n){return this.eventEmitter.on(t,o=>n(o.key,o.value))}}const Pt={general:{key:"general",label:"General",description:"General editor settings",order:1},appearance:{key:"appearance",label:"Appearance",description:"Visual appearance and theming",order:2},behavior:{key:"behavior",label:"Behavior",description:"Editor behavior and interactions",order:3},performance:{key:"performance",label:"Performance",description:"Performance and optimization settings",order:4},keyboard:{key:"keyboard",label:"Keyboard",description:"Keyboard shortcuts and bindings",order:5},plugins:{key:"plugins",label:"Plugins",description:"Plugin management and configuration",order:6},advanced:{key:"advanced",label:"Advanced",description:"Advanced settings for power users",order:7}};class Rd extends Rn{constructor(n){super();ue(this,"settings",new Map);ue(this,"categories",new Map);ue(this,"values",new Map);ue(this,"storage");this.storage=n||new zn,Object.values(Pt).forEach(o=>{this.registerCategory(o)}),this.loadFromStorage()}registerSetting(n){if(!n.key)throw new Error("Setting key is required");if(!n.category)throw new Error("Setting category is required");this.categories.has(n.category)||this.registerCategory({key:n.category,label:n.category.charAt(0).toUpperCase()+n.category.slice(1)}),this.settings.set(n.key,n),this.values.has(n.key)||this.values.set(n.key,n.defaultValue),this.emit("setting-registered",{setting:n})}unregisterSetting(n){this.settings.delete(n),this.values.delete(n),this.emit("setting-unregistered",{key:n})}getSetting(n){return this.settings.get(n)}getAllSettings(){return Object.fromEntries(this.settings)}getSettingsByCategory(n){return Array.from(this.settings.values()).filter(o=>o.category===n).sort((o,s)=>(o.order||0)-(s.order||0))}registerCategory(n){this.categories.set(n.key,n),this.emit("category-registered",{category:n})}unregisterCategory(n){this.categories.delete(n),this.emit("category-unregistered",{key:n})}getCategory(n){return this.categories.get(n)}getAllCategories(){return Array.from(this.categories.values()).sort((n,o)=>(n.order||0)-(o.order||0))}getValue(n){return this.values.get(n)}setValue(n,o){const s=this.settings.get(n);if(!s){console.warn(`Setting ${n} is not registered`);return}const r=this.validateSetting(n,o);if(r)throw new Error(`Invalid value for setting ${n}: ${r}`);const i=this.values.get(n);this.values.set(n,o),s.persistent!==!1&&this.storage.set(n,o);const c={key:n,value:o,previousValue:i,category:s.category};this.emit("change",c)}setValues(n){Object.entries(n).forEach(([o,s])=>{s!==void 0&&this.setValue(o,s)})}getAllValues(){return Object.fromEntries(this.values)}resetToDefaults(n){const o=n||Array.from(this.settings.keys());o.forEach(s=>{const r=this.settings.get(s);r&&this.setValue(s,r.defaultValue)}),this.emit("reset",{keys:o})}validateSetting(n,o){const s=this.settings.get(n);if(!s)return"Setting not found";if(s.required&&(o==null||o===""))return"This setting is required";if(o!=null)switch(s.type){case"number":case"range":if(typeof o!="number")return"Value must be a number";if(s.min!==void 0&&o<s.min)return`Value must be at least ${s.min}`;if(s.max!==void 0&&o>s.max)return`Value must be at most ${s.max}`;break;case"text":case"textarea":case"email":case"url":case"password":if(typeof o!="string")return"Value must be a string";if(s.minLength!==void 0&&o.length<s.minLength)return`Value must be at least ${s.minLength} characters long`;if(s.maxLength!==void 0&&o.length>s.maxLength)return`Value must be at most ${s.maxLength} characters long`;if(s.pattern&&!new RegExp(s.pattern).test(o))return"Value does not match required pattern";break;case"boolean":if(typeof o!="boolean")return"Value must be a boolean";break;case"select":if(s.options&&!s.options.map(i=>i.value).includes(o))return"Value must be one of the valid options";break;case"multiselect":if(!Array.isArray(o))return"Value must be an array";if(s.options){const r=s.options.map(i=>i.value);for(const i of o)if(!r.includes(i))return"All values must be valid options"}break}return s.validator?s.validator(o):null}validateAll(){const n={},o={};return this.settings.forEach((s,r)=>{const i=this.values.get(r),c=this.validateSetting(r,i);c&&(n[r]=c)}),{isValid:Object.keys(n).length===0,errors:n,warnings:o}}async save(){try{this.settings.forEach((n,o)=>{if(n.persistent!==!1){const s=this.values.get(o);s!==void 0&&this.storage.set(o,s)}}),this.emit("save",{timestamp:new Date().toISOString()})}catch(n){throw this.emit("save-error",{error:n}),n}}async load(){try{this.loadFromStorage(),this.emit("load",{timestamp:new Date().toISOString()})}catch(n){throw this.emit("load-error",{error:n}),n}}export(){const n={version:"1.0.0",timestamp:new Date().toISOString(),settings:this.getAllValues(),metadata:{editorVersion:"1.0.0",platform:typeof window<"u"?navigator.platform:"unknown"}};return JSON.stringify(n,null,2)}import(n){try{const o=JSON.parse(n);if(!o.settings)throw new Error("Invalid settings data");this.setValues(o.settings),this.emit("import",{data:o})}catch(o){throw this.emit("import-error",{error:o}),o}}getSchema(){const n={type:"object",properties:{},required:[]};return this.settings.forEach((o,s)=>{const r={title:o.label,description:o.description,default:o.defaultValue};switch(o.type){case"text":case"textarea":case"email":case"url":case"password":r.type="string",o.minLength&&(r.minLength=o.minLength),o.maxLength&&(r.maxLength=o.maxLength),o.pattern&&(r.pattern=o.pattern);break;case"number":case"range":r.type="number",o.min!==void 0&&(r.minimum=o.min),o.max!==void 0&&(r.maximum=o.max);break;case"boolean":r.type="boolean";break;case"select":r.type="string",o.options&&(r.enum=o.options.map(i=>i.value));break;case"multiselect":r.type="array",o.options&&(r.items={type:"string",enum:o.options.map(i=>i.value)});break;default:r.type="string"}n.properties[s]=r,o.required&&n.required.push(s)}),n}reset(){this.settings.clear(),this.categories.clear(),this.values.clear(),this.storage.clear(),Object.values(Pt).forEach(n=>{this.registerCategory(n)}),this.emit("reset-all",{})}loadFromStorage(){this.settings.forEach((n,o)=>{if(n.persistent!==!1){const s=this.storage.get(o);s!==void 0?this.values.set(o,s):this.values.set(o,n.defaultValue)}else this.values.set(o,n.defaultValue)})}}const zd=[{key:"general.language",label:"Language",description:"Interface language",category:"general",type:"select",defaultValue:"en",options:[{value:"en",label:"English"},{value:"ja",label:"日本語"},{value:"zh",label:"中文"},{value:"ko",label:"한국어"},{value:"es",label:"Español"},{value:"fr",label:"Français"},{value:"de",label:"Deutsch"}],order:1},{key:"general.autoSave",label:"Auto Save",description:"Automatically save changes",category:"general",type:"boolean",defaultValue:!0,order:2},{key:"general.autoSaveInterval",label:"Auto Save Interval",description:"Auto save interval in seconds",category:"general",type:"number",defaultValue:30,min:5,max:300,dependsOn:"general.autoSave",showWhen:e=>e["general.autoSave"]===!0,order:3},{key:"general.confirmBeforeExit",label:"Confirm Before Exit",description:"Show confirmation dialog before closing",category:"general",type:"boolean",defaultValue:!0,order:4},{key:"appearance.theme",label:"Theme",description:"Visual theme",category:"appearance",type:"select",defaultValue:"light",options:[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto (System)"}],order:1},{key:"appearance.fontSize",label:"Font Size",description:"Base font size in pixels",category:"appearance",type:"range",defaultValue:14,min:10,max:24,step:1,order:2},{key:"appearance.fontFamily",label:"Font Family",description:"Font family for the interface",category:"appearance",type:"select",defaultValue:"system",options:[{value:"system",label:"System Default"},{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Arial",label:"Arial"},{value:"monospace",label:"Monospace"}],order:3},{key:"appearance.showGrid",label:"Show Grid",description:"Display grid lines on canvas",category:"appearance",type:"boolean",defaultValue:!0,order:4},{key:"appearance.gridSize",label:"Grid Size",description:"Grid size in pixels",category:"appearance",type:"number",defaultValue:20,min:5,max:100,dependsOn:"appearance.showGrid",showWhen:e=>e["appearance.showGrid"]===!0,order:5},{key:"appearance.gridOpacity",label:"Grid Opacity",description:"Grid line opacity",category:"appearance",type:"range",defaultValue:.3,min:.1,max:1,step:.1,dependsOn:"appearance.showGrid",showWhen:e=>e["appearance.showGrid"]===!0,order:6},{key:"appearance.snapToGrid",label:"Snap to Grid",description:"Snap nodes to grid when moving",category:"appearance",type:"boolean",defaultValue:!1,order:7},{key:"appearance.showMinimap",label:"Show Minimap",description:"Display minimap overlay",category:"appearance",type:"boolean",defaultValue:!0,order:8},{key:"appearance.showStatusBar",label:"Show Status Bar",description:"Display status bar at bottom",category:"appearance",type:"boolean",defaultValue:!0,order:9},{key:"appearance.showToolbar",label:"Show Toolbar",description:"Display toolbar",category:"appearance",type:"boolean",defaultValue:!0,order:10},{key:"appearance.canvasBackground",label:"Canvas Background",description:"Canvas background color",category:"appearance",type:"color",defaultValue:"#ffffff",order:11},{key:"behavior.doubleClickToEdit",label:"Double Click to Edit",description:"Double click nodes to edit properties",category:"behavior",type:"boolean",defaultValue:!0,order:1},{key:"behavior.autoConnect",label:"Auto Connect",description:"Automatically connect compatible ports when dragging",category:"behavior",type:"boolean",defaultValue:!0,order:2},{key:"behavior.smoothAnimations",label:"Smooth Animations",description:"Enable smooth animations for transitions",category:"behavior",type:"boolean",defaultValue:!0,order:3},{key:"behavior.dragThreshold",label:"Drag Threshold",description:"Minimum distance to start dragging (pixels)",category:"behavior",type:"number",defaultValue:5,min:1,max:20,order:4},{key:"behavior.connectionStyle",label:"Connection Style",description:"Style of connection lines",category:"behavior",type:"select",defaultValue:"curved",options:[{value:"straight",label:"Straight"},{value:"curved",label:"Curved"},{value:"orthogonal",label:"Orthogonal"}],order:5},{key:"behavior.selectionMode",label:"Selection Mode",description:"How to select multiple nodes",category:"behavior",type:"select",defaultValue:"click",options:[{value:"click",label:"Click with Modifier"},{value:"drag",label:"Drag Selection Box"}],order:6},{key:"behavior.wheelZoomSensitivity",label:"Zoom Sensitivity",description:"Mouse wheel zoom sensitivity",category:"behavior",type:"range",defaultValue:1,min:.1,max:3,step:.1,order:7},{key:"performance.maxHistorySteps",label:"Max History Steps",description:"Maximum number of undo/redo steps",category:"performance",type:"number",defaultValue:50,min:10,max:200,order:1},{key:"performance.renderOptimization",label:"Render Optimization",description:"Enable render optimization techniques",category:"performance",type:"boolean",defaultValue:!0,order:2},{key:"performance.lazyLoading",label:"Lazy Loading",description:"Load nodes and connections lazily",category:"performance",type:"boolean",defaultValue:!0,order:3},{key:"performance.virtualScrolling",label:"Virtual Scrolling",description:"Use virtual scrolling for large node lists",category:"performance",type:"boolean",defaultValue:!0,order:4},{key:"performance.maxVisibleNodes",label:"Max Visible Nodes",description:"Maximum number of nodes to render at once",category:"performance",type:"number",defaultValue:1e3,min:100,max:5e3,order:5},{key:"keyboard.undo",label:"Undo",description:"Keyboard shortcut for undo",category:"keyboard",type:"text",defaultValue:"Ctrl+Z",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:1},{key:"keyboard.redo",label:"Redo",description:"Keyboard shortcut for redo",category:"keyboard",type:"text",defaultValue:"Ctrl+Y",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:2},{key:"keyboard.selectAll",label:"Select All",description:"Keyboard shortcut for select all",category:"keyboard",type:"text",defaultValue:"Ctrl+A",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:3},{key:"keyboard.delete",label:"Delete",description:"Keyboard shortcut for delete",category:"keyboard",type:"text",defaultValue:"Delete",order:4},{key:"keyboard.copy",label:"Copy",description:"Keyboard shortcut for copy",category:"keyboard",type:"text",defaultValue:"Ctrl+C",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:5},{key:"keyboard.paste",label:"Paste",description:"Keyboard shortcut for paste",category:"keyboard",type:"text",defaultValue:"Ctrl+V",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:6},{key:"keyboard.duplicate",label:"Duplicate",description:"Keyboard shortcut for duplicate",category:"keyboard",type:"text",defaultValue:"Ctrl+D",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:7},{key:"keyboard.group",label:"Group",description:"Keyboard shortcut for group nodes",category:"keyboard",type:"text",defaultValue:"Ctrl+G",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:8},{key:"keyboard.save",label:"Save",description:"Keyboard shortcut for save",category:"keyboard",type:"text",defaultValue:"Ctrl+S",pattern:"^(Ctrl\\+|Cmd\\+|Alt\\+|Shift\\+)*[A-Za-z0-9]+$",order:9},{key:"plugins.autoUpdate",label:"Auto Update Plugins",description:"Automatically update plugins when available",category:"plugins",type:"boolean",defaultValue:!1,order:1},{key:"plugins.allowUnsafe",label:"Allow Unsafe Plugins",description:"Allow loading plugins without security verification",category:"plugins",type:"boolean",defaultValue:!1,order:2},{key:"plugins.maxMemoryUsage",label:"Max Memory Usage",description:"Maximum memory usage for plugins (MB)",category:"plugins",type:"number",defaultValue:100,min:10,max:1e3,order:3},{key:"advanced.debugMode",label:"Debug Mode",description:"Enable debug mode with additional logging",category:"advanced",type:"boolean",defaultValue:!1,order:1},{key:"advanced.showPerformanceMetrics",label:"Show Performance Metrics",description:"Display performance metrics in the UI",category:"advanced",type:"boolean",defaultValue:!1,order:2},{key:"advanced.logLevel",label:"Log Level",description:"Minimum log level to display",category:"advanced",type:"select",defaultValue:"info",options:[{value:"debug",label:"Debug"},{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"}],order:3},{key:"advanced.experimentalFeatures",label:"Experimental Features",description:"Enable experimental features (may be unstable)",category:"advanced",type:"boolean",defaultValue:!1,order:4},{key:"advanced.customCSS",label:"Custom CSS",description:"Custom CSS to apply to the editor",category:"advanced",type:"textarea",defaultValue:"",placeholder:"/* Enter custom CSS here */",order:5}];exports.ColumnLayout=mn;exports.DEFAULT_NODE_SIZE=We;exports.DEFAULT_PORT_POSITION_CONFIG=Ie;exports.DebugOverlay=On;exports.EditorActionStateProvider=Rt;exports.ExternalDataProvider=Ht;exports.FloatingContainer=ht;exports.GridToolbox=An;exports.HistoryProvider=on;exports.InlineEditingProvider=Lt;exports.InspectorPanel=pt;exports.KeyboardShortcutProvider=Mt;exports.LocalSettingsStorage=zn;exports.Minimap=Tn;exports.NodeCanvasProvider=Ot;exports.NodeDefinitionProvider=_t;exports.NodeEditor=Mn;exports.NodeEditorProvider=tn;exports.NodeInspector=ut;exports.PortPositionProvider=kn;exports.SettingsManager=Rd;exports.SpatialGrid=Io;exports.Toolbar=Td;exports.addVectors=Ba;exports.asOriginalInspectorRender=bo;exports.asOriginalNodeRender=vo;exports.calculateNodeDragOffsets=Od;exports.computeAllPortPositions=Jt;exports.computeNodePortPositions=De;exports.createBoundingBox=Co;exports.createConnectionLookupMaps=wo;exports.createNodeDataUpdater=xo;exports.createNodeDefinition=mo;exports.createParentToChildrenMap=Gt;exports.createPortToNodeMap=Eo;exports.defaultSettings=zd;exports.doRectanglesIntersect=So;exports.getDistance=En;exports.getDraggedNodesBounds=Ad;exports.getNodeBoundingBox=we;exports.getTypedNodeData=yo;exports.getVector=Ha;exports.isRectangleInsideAnother=Bt;exports.scaleVector=Ua;exports.subtractVectors=Ga;exports.updatePortPositions=Uo;exports.useActionState=Ro;exports.useActionStateActions=at;exports.useBatchedUpdates=$o;exports.useCanvasActions=it;exports.useCanvasState=Ao;exports.useCommonActions=zo;exports.useDocumentPointerEvents=Ft;exports.useDragPointerEvents=To;exports.useDynamicConnectionPoint=ye;exports.useDynamicPortPosition=dt;exports.useEditorActionState=W;exports.useEditorActions=Kt;exports.useExternalDataRef=tt;exports.useGroupManagement=st;exports.useInlineEditing=Vt;exports.useNodeCanvas=oe;exports.useNodeDefinition=Le;exports.useNodeDefinitionList=Ve;exports.useNodeDefinitions=ze;exports.useNodeEditor=F;exports.useNodeEditorActions=rt;exports.useNodeEditorState=Oo;exports.useNodePortPositions=Oc;exports.useNodeResize=nt;exports.usePointerCapture=Yt;exports.usePointerDrag=Mo;exports.usePointerInteraction=Ke;exports.usePortPosition=Tc;exports.usePortPositions=ft;exports.usePreventPointerDefaults=Wt;exports.useSettings=ct;exports.useVisibleNodes=Zt;
